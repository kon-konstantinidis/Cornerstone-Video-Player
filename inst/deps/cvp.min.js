/*! For license information please see cvp.min.js.LICENSE.txt */
window.cvp=function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="";var a,r=function(){var e=document.currentScript;if(!e){for(var t=document.getElementsByTagName("script"),n=[],a=0;a<t.length;a++)n.push(t[a]);e=(n=n.filter((function(e){return!e.async&&!e.text&&!e.textContent}))).slice(-1)[0]}return e};if(Object.defineProperty(n,"p",{get:(a=r().src.split("/").slice(0,-1).join("/")+"/",function(){return a})}),"undefined"!=typeof jsonpScriptSrc){var o=jsonpScriptSrc;jsonpScriptSrc=function(e){var t=function(e){return/\/_dash-component-suites\//.test(e.src)}(r()),n=o(e);if(!t)return n;var a=n.split("/"),i=a.slice(-1)[0].split(".");return i.splice(1,0,"v0_0_1m1677580265"),a.splice(-1,1,i.join(".")),a.join("/")}}return n(n.s=6)}([function(e,t,n){window,e.exports=function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=70)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=window.cornerstone,r=window.cornerstoneMath,o=window.Hammer;t.default={set cornerstone(e){a=e},get cornerstone(){return a},set cornerstoneMath(e){r=e},get cornerstoneMath(){return r},set Hammer(e){o=e},get Hammer(){return o}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={MOUSE_DOWN:"cornerstonetoolsmousedown",MOUSE_UP:"cornerstonetoolsmouseup",MOUSE_DOWN_ACTIVATE:"cornerstonetoolsmousedownactivate",MOUSE_DRAG:"cornerstonetoolsmousedrag",MOUSE_MOVE:"cornerstonetoolsmousemove",MOUSE_CLICK:"cornerstonetoolsmouseclick",MOUSE_DOUBLE_CLICK:"cornerstonetoolsmousedoubleclick",MOUSE_WHEEL:"cornerstonetoolsmousewheel",TOUCH_START:"cornerstonetoolstouchstart",TOUCH_START_ACTIVE:"cornerstonetoolstouchstartactive",TOUCH_END:"cornerstonetoolstouchend",TOUCH_DRAG:"cornerstonetoolstouchdrag",TOUCH_DRAG_END:"cornerstonetoolstouchdragend",TOUCH_PINCH:"cornerstonetoolstouchpinch",TOUCH_ROTATE:"cornerstonetoolstouchrotate",TOUCH_PRESS:"cornerstonetoolstouchpress",TAP:"cornerstonetoolstap",DOUBLE_TAP:"cornerstonetoolsdoubletap",MULTI_TOUCH_START:"cornerstonetoolsmultitouchstart",MULTI_TOUCH_START_ACTIVE:"cornerstonetoolsmultitouchstartactive",MULTI_TOUCH_DRAG:"cornerstonetoolsmultitouchdrag",KEY_DOWN:"cornerstonetoolskeydown",KEY_UP:"cornerstonetoolskeyup",KEY_PRESS:"cornerstonetoolskeypress",MEASUREMENT_ADDED:"cornerstonetoolsmeasurementadded",MEASUREMENT_MODIFIED:"cornerstonetoolsmeasurementmodified",MEASUREMENT_REMOVED:"cornerstonemeasurementremoved",MEASUREMENT_COMPLETED:"cornerstonemeasurementcompleted",TOOL_DEACTIVATED:"cornerstonetoolstooldeactivated",CLIP_STOPPED:"cornerstonetoolsclipstopped",STACK_SCROLL:"cornerstonestackscroll",LINE_SAMPLE_UPDATED:"cornerstonelinesampleupdated"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getElementToolStateManager=t.setElementToolStateManager=t.clearToolState=t.removeToolState=t.getToolState=t.addToolState=void 0;var a=l(n(1)),r=l(n(0)),o=n(28),i=l(n(6));function l(e){return e&&e.__esModule?e:{default:e}}function u(e){var t=r.default.cornerstone.getEnabledElement(e);return void 0===t.toolStateManager&&(t.toolStateManager=o.globalImageIdSpecificToolStateManager),t.toolStateManager}t.addToolState=function(e,t,n){u(e).add(e,t,n);var r=a.default.MEASUREMENT_ADDED,o={toolType:t,element:e,measurementData:n};(0,i.default)(e,r,o)},t.getToolState=function(e,t){return u(e).get(e,t)},t.removeToolState=function(e,t,n){var r=u(e).get(e,t);if(r&&r.data&&r.data.length){for(var o=-1,l=0;l<r.data.length;l++)r.data[l]===n&&(o=l);if(-1!==o){r.data.splice(o,1);var d=a.default.MEASUREMENT_REMOVED,s={toolType:t,element:e,measurementData:n};(0,i.default)(e,d,s)}}},t.clearToolState=function(e,t){var n=u(e).get(e,t);void 0!==n&&(n.data=[])},t.setElementToolStateManager=function(e,t){r.default.cornerstone.getEnabledElement(e).toolStateManager=t},t.getElementToolStateManager=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getNewContext=function(e){var t=e.getContext("2d");return t.setTransform(1,0,0,1,0,0),t},t.draw=function(e,t){e.save(),t(e),e.restore()},t.path=u,t.setShadow=function(e,t){t.shadow&&(e.shadowColor=(0,r.getDefault)(t.shadowColor,"#000000"),e.shadowBlur=(0,r.getDefault)(t.shadowBlur,0),e.shadowOffsetX=(0,r.getDefault)(t.shadowOffsetX,1),e.shadowOffsetY=(0,r.getDefault)(t.shadowOffsetY,1))},t.drawLine=function(e,t,n,r,o){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel";u(e,o,(function(e){if("pixel"===i){var o=a.default.cornerstone;n=o.pixelToCanvas(t,n),r=o.pixelToCanvas(t,r)}e.moveTo(n.x,n.y),e.lineTo(r.x,r.y)}))},t.drawLines=function(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"pixel";u(e,r,(function(e){n.forEach((function(n){var r=n.start,i=n.end;if("pixel"===o){var l=a.default.cornerstone;r=l.pixelToCanvas(t,r),i=l.pixelToCanvas(t,i)}e.moveTo(r.x,r.y),e.lineTo(i.x,i.y)}))}))},t.drawJoinedLines=function(e,t,n,r,o){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel";u(e,o,(function(e){if("pixel"===i){var o=a.default.cornerstone;n=o.pixelToCanvas(t,n),r=r.map((function(e){return o.pixelToCanvas(t,e)}))}e.moveTo(n.x,n.y),r.forEach((function(t){var n=t.x,a=t.y;e.lineTo(n,a)}))}))},t.drawCircle=function(e,t,n,r,o){"pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")&&(n=a.default.cornerstone.pixelToCanvas(t,n)),u(e,o,(function(e){e.arc(n.x,n.y,r,0,2*Math.PI)}))},t.drawEllipse=function(e,t,n,r,o){"pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")&&(n=a.default.cornerstone.pixelToCanvas(t,n),r=a.default.cornerstone.pixelToCanvas(t,r));var i=Math.min(n.x,r.x),l=Math.min(n.y,r.y),d=Math.abs(n.x-r.x),s=Math.abs(n.y-r.y),c=d/2*.5522848,f=s/2*.5522848,v=i+d,m=l+s,g=i+d/2,h=l+s/2;u(e,o,(function(e){e.moveTo(i,h),e.bezierCurveTo(i,h-f,g-c,l,g,l),e.bezierCurveTo(g+c,l,v,h-f,v,h),e.bezierCurveTo(v,h+f,g+c,m,g,m),e.bezierCurveTo(g-c,m,i,h+f,i,h),e.closePath()}))},t.drawRect=function(e,t,n,r,o){if("pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")){var i=a.default.cornerstone;n=i.pixelToCanvas(t,n),r=i.pixelToCanvas(t,r)}var l=Math.min(n.x,r.x),d=Math.min(n.y,r.y),s=Math.abs(n.x-r.x),c=Math.abs(n.y-r.y);u(e,o,(function(e){e.rect(l,d,s,c)}))},t.fillOutsideRect=function(e,t,n,r,o){if("pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")){var i=a.default.cornerstone;n=i.pixelToCanvas(t,n),r=i.pixelToCanvas(t,r)}var l=Math.min(n.x,r.x),d=Math.min(n.y,r.y),s=Math.abs(n.x-r.x),c=Math.abs(n.y-r.y);u(e,o,(function(e){e.rect(0,0,e.canvas.clientWidth,e.canvas.clientHeight),e.rect(l+s,d,-s,c)}))},t.fillBox=function(e,t,n){e.fillStyle=n,e.fillRect(t.left,t.top,t.width,t.height)},t.fillTextLines=function(e,t,n,a,r){var o=i.default.getFontSize();e.font=i.default.getFont(),e.textBaseline="top",e.fillStyle=a,n.forEach((function(n,a){e.fillText(n,t.left+r,t.top+r+a*(o+r))}))};var a=l(n(0)),r=n(145),o=l(n(14)),i=l(n(20));function l(e){return e&&e.__esModule?e:{default:e}}function u(e,t,n){var a=t.color,r=t.lineWidth,i=t.fillStyle,l=t.lineDash;e.beginPath(),e.strokeStyle=a||e.strokeStyle,e.lineWidth=r||void 0===r&&o.default.getToolWidth()||e.lineWidth,l&&e.setLineDash(l),n(e),i&&(e.fillStyle=i,e.fill()),e.stroke(),l&&e.setLineDash([])}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={};t.getToolOptions=function(e,t){if(!a[e])return{};var n=a[e].find((function(e){return e.element===t}));return n?n.options:{}},t.setToolOptions=function(e,t,n){if(a[e]){var r=a[e].findIndex((function(e){return e.element===t}));if(-1===r)a[e].push({element:t,options:n});else{var o=a[e][r].options||{};a[e][r].options=Object.assign(o,n)}}else a[e]=[{element:t,options:n}]},t.clearToolOptions=function(e,t){var n=a[e];n&&(a[e]=n.filter((function(e){return e.element!==t})))},t.clearToolOptionsByToolType=function(e){delete a[e]},t.clearToolOptionsByElement=function(e){for(var t in a)a[t]=a[t].filter((function(t){return t.element!==e}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return 0!=(t&1<<e-1)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=void 0;return"function"==typeof window.CustomEvent?a=new CustomEvent(t,{detail:n,cancelable:!0}):(a=document.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,n),e.dispatchEvent(a)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a="white",r="greenyellow",o="transparent",i={setFillColor:function(e){o=e},getFillColor:function(){return o},setToolColor:function(e){a=e},getToolColor:function(){return a},setActiveColor:function(e){r=e},getActiveColor:function(){return r},getColorIfActive:function(e){return e.color?e.color:e.active?r:a}};t.default=i},function(e,t,n){"use strict";function a(e,t,n){return Math.min(Math.max(t,e),n)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=a,t.clipToBox=function(e,t){e.x=a(e.x,0,t.width),e.y=a(e.y,0,t.height)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,a,l){Object.keys(n).forEach((function(u){var d=n[u];if(!0!==d.drawnIndependently&&(!l||!0!==l.drawHandlesIfActive||d.active)){var s=function(e){return e&&e.handleRadius?e.handleRadius:i}(l),c={color:a,lineWidth:d.active?r.default.getActiveWidth():r.default.getToolWidth(),fillStyle:l&&l.fill};(0,o.drawCircle)(e,t.element,d,s,c)}}))};var a,r=(a=n(14))&&a.__esModule?a:{default:a},o=n(3),i=6},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={},n=e.toolType;function h(t){var o=t.detail,i=o.element,l=(0,g.getToolOptions)(n,i);(0,f.default)(o.which,l.mouseButtonMask)&&(e.addNewMeasurement?e.addNewMeasurement(o):function(t){var o=r.default.cornerstone,i=t.element,l=e.createNewMeasurement(t);if(l){(0,v.addToolState)(t.element,n,l),i.removeEventListener(a.default.MOUSE_MOVE,y),i.removeEventListener(a.default.MOUSE_DOWN,b),i.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,T),x&&i.removeEventListener(a.default.MOUSE_DOUBLE_CLICK,x),o.updateImage(i);var s,f=void 0;f=1===Object.keys(l.handles).length?u.default:d.default,s=!(!e.options||void 0===e.options.preventHandleOutsideImage)&&e.options.preventHandleOutsideImage,f(t,n,l,l.handles.end,(function(){l.active=!1,l.invalidated=!0,(0,c.default)(t,l.handles)?(0,v.removeToolState)(i,n,l):e.onHandleDoneMove&&e.onHandleDoneMove(i,l),i.addEventListener(a.default.MOUSE_MOVE,y),i.addEventListener(a.default.MOUSE_DOWN,b),i.addEventListener(a.default.MOUSE_DOWN_ACTIVATE,T),x&&i.addEventListener(a.default.MOUSE_DOUBLE_CLICK,x),o.updateImage(i)}),s)}}(o),t.preventDefault(),t.stopPropagation())}function p(t){var a=t.detail;o.default.setCoords(a);var i=(0,v.getToolState)(a.element,n);if(i){for(var u=!1,d=0;d<i.data.length;d++){var s=a.currentPoints.canvas,c=i.data[d];!0===(0,l.default)(a.element,c.handles,s)&&(u=!0),(e.pointNearTool(a.element,c,s)&&!c.active||!e.pointNearTool(a.element,c,s)&&c.active)&&(c.active=!c.active,u=!0)}!0===u&&r.default.cornerstone.updateImage(a.element)}}function E(t){var o=t.detail,l=void 0,d=o.element,m=(0,g.getToolOptions)(n,d);if((0,f.default)(o.which,m.mouseButtonMask)){var h=o.startPoints.canvas,p=(0,v.getToolState)(t.currentTarget,n);if(p){var E,b=void 0;for(E=!(!e.options||void 0===e.options.preventHandleOutsideImage)&&e.options.preventHandleOutsideImage,b=0;b<p.data.length;b++){l=p.data[b];var T=(0,i.default)(d,l.handles,h,6);if(T)return d.removeEventListener(a.default.MOUSE_MOVE,y),l.active=!0,(0,u.default)(o,n,l,T,w,E),t.stopImmediatePropagation(),t.stopPropagation(),void t.preventDefault()}if(e.pointNearTool){var x=e.options||{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1};for(b=0;b<p.data.length;b++)if((l=p.data[b]).active=!1,e.pointNearTool(d,l,h))return l.active=!0,d.removeEventListener(a.default.MOUSE_MOVE,y),(0,s.default)(t,l,p,n,x,w),t.stopImmediatePropagation(),t.stopPropagation(),void t.preventDefault()}}}function w(){l.invalidated=!0,(0,c.default)(o,l.handles)?(0,v.removeToolState)(d,n,l):e.onHandleDoneMove&&e.onHandleDoneMove(d,l),r.default.cornerstone.updateImage(d),d.addEventListener(a.default.MOUSE_MOVE,y)}}var y=e.mouseMoveCallback||p,b=e.mouseDownCallback||E,T=e.mouseDownActivateCallback||h,x=e.mouseDoubleClickCallback,w={enable:function(t){t.removeEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),t.removeEventListener(a.default.MOUSE_MOVE,y),t.removeEventListener(a.default.MOUSE_DOWN,b),t.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,T),x&&t.removeEventListener(a.default.MOUSE_DOUBLE_CLICK,x),t.addEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),r.default.cornerstone.updateImage(t)},disable:function(t){t.removeEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),t.removeEventListener(a.default.MOUSE_MOVE,y),t.removeEventListener(a.default.MOUSE_DOWN,b),t.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,T),x&&t.removeEventListener(a.default.MOUSE_DOUBLE_CLICK,x),r.default.cornerstone.updateImage(t)},activate:function(t,o){(0,g.setToolOptions)(n,t,{mouseButtonMask:o}),t.removeEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),t.removeEventListener(a.default.MOUSE_MOVE,y),t.removeEventListener(a.default.MOUSE_DOWN,b),t.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,T),t.addEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),t.addEventListener(a.default.MOUSE_MOVE,y),t.addEventListener(a.default.MOUSE_DOWN,b),t.addEventListener(a.default.MOUSE_DOWN_ACTIVATE,T),x&&(t.removeEventListener(a.default.MOUSE_DOUBLE_CLICK,x),t.addEventListener(a.default.MOUSE_DOUBLE_CLICK,x)),r.default.cornerstone.updateImage(t)},deactivate:function(t,o){(0,g.setToolOptions)(n,t,{mouseButtonMask:o});var i=a.default.TOOL_DEACTIVATED,l={mouseButtonMask:o,toolType:n,type:i};(0,m.default)(t,i,l),t.removeEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),t.removeEventListener(a.default.MOUSE_MOVE,y),t.removeEventListener(a.default.MOUSE_DOWN,b),t.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,T),t.addEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),t.addEventListener(a.default.MOUSE_MOVE,y),t.addEventListener(a.default.MOUSE_DOWN,b),x&&(t.removeEventListener(a.default.MOUSE_DOUBLE_CLICK,x),t.addEventListener(a.default.MOUSE_DOUBLE_CLICK,x)),e.deactivate&&e.deactivate(t,o),r.default.cornerstone.updateImage(t)},getConfiguration:function(){return t},setConfiguration:function(e){t=e},mouseDownCallback:E,mouseMoveCallback:p,mouseDownActivateCallback:h};return e.pointNearTool&&(w.pointNearTool=e.pointNearTool),x&&(w.mouseDoubleClickCallback=x),e.addNewMeasurement&&(w.addNewMeasurement=e.addNewMeasurement),w};var a=h(n(1)),r=h(n(0)),o=h(n(41)),i=h(n(27)),l=h(n(34)),u=h(n(33)),d=h(n(32)),s=h(n(40)),c=h(n(16)),f=h(n(5)),v=n(2),m=h(n(6)),g=n(4);function h(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.textBoxWidth=i,t.default=function(e,t,n,a,l,u){"[object Array]"!==Object.prototype.toString.call(t)&&(t=[t]);var d=r.default.getFontSize(),s=r.default.getBackgroundColor(),c=0;t.forEach((function(t){var n=i(e,t,5);c=Math.max(c,n)}));var f={width:c,height:5+t.length*(d+5)};return(0,o.draw)(e,(function(e){e.strokeStyle=l,u&&u.centering&&!0===u.centering.x&&(n-=f.width/2),u&&u.centering&&!0===u.centering.y&&(a-=f.height/2),f.left=n,f.top=a;var r=u&&!0===u.debug?"#FF0000":s;(0,o.fillBox)(e,f,r),(0,o.fillTextLines)(e,f,t,l,5)})),f};var a,r=(a=n(20))&&a.__esModule?a:{default:a},o=n(3);function i(e,t,n){var a=r.default.getFont(),o=e.font;a&&a!==o&&(e.font=a);var i=e.measureText(t).width;return a&&a!==o&&(e.font=o),i+2*n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=f(n(1)),r=f(n(0)),o=f(n(16)),i=f(n(27)),l=f(n(60)),u=f(n(30)),d=f(n(61)),s=n(2),c=f(n(6));function f(e){return e&&e.__esModule?e:{default:e}}function v(e){Object.keys(e).forEach((function(t){e[t].active=!1}))}function m(e){if(e)for(var t=0;t<e.data.length;t++){var n=e.data[t];n.active=!1,n.handles&&v(n.handles)}}t.default=function(e){function t(i){var l=i.detail;e.addNewMeasurement?e.addNewMeasurement(l):function(i){var l=r.default.cornerstone,d=i.element,c=e.createNewMeasurement(i);if(c){if((0,s.addToolState)(d,e.toolType,c),1===Object.keys(c.handles).length&&i.type===a.default.TAP)return c.active=!1,c.handles.end.active=!1,c.handles.end.highlight=!1,c.invalidated=!0,(0,o.default)(i,c.handles)?(0,s.removeToolState)(d,e.toolType,c):e.onHandleDoneMove&&e.onHandleDoneMove(d,c),void l.updateImage(d);d.removeEventListener(a.default.TOUCH_START_ACTIVE,e.touchDownActivateCallback||t),d.removeEventListener(a.default.TAP,e.tapCallback||n),d.removeEventListener(a.default.TOUCH_START,e.touchStartCallback||f),l.updateImage(d),(0,u.default)(i,e.toolType,c,c.handles.end,(function(){c.active=!1,c.invalidated=!0,(0,o.default)(i,c.handles)?(0,s.removeToolState)(d,e.toolType,c):e.onHandleDoneMove&&e.onHandleDoneMove(d,c),d.addEventListener(a.default.TOUCH_START_ACTIVE,e.touchDownActivateCallback||t),d.addEventListener(a.default.TAP,e.tapCallback||n),d.addEventListener(a.default.TOUCH_START,e.touchStartCallback||f),l.updateImage(d)}))}}(l),i.stopImmediatePropagation(),i.preventDefault()}function n(u){var c=u.detail,v=r.default.cornerstone,g=c.element,h=c.currentPoints.canvas,p=(0,s.getToolState)(u.currentTarget,e.toolType),E=void 0,y=void 0;function b(){m(p),(0,o.default)(c,E.handles)?(0,s.removeToolState)(g,e.toolType,E):e.onHandleDoneMove&&e.onHandleDoneMove(g,E),v.updateImage(g),g.addEventListener(a.default.TOUCH_START,e.touchStartCallback||f),g.addEventListener(a.default.TAP,e.tapCallback||n)}if(m(p),p)for(y=0;y<p.data.length;y++){E=p.data[y];var T=(0,i.default)(g,E.handles,h,25);if(T)return g.removeEventListener(a.default.TOUCH_START,e.touchStartCallback||f),g.removeEventListener(a.default.TAP,e.tapCallback||n),E.active=!0,T.active=!0,v.updateImage(g),(0,l.default)(u,e.toolType,E,T,b),u.stopImmediatePropagation(),void u.preventDefault()}if(p&&e.pointNearTool)for(y=0;y<p.data.length;y++)if(E=p.data[y],e.pointNearTool(g,E,h))return g.removeEventListener(a.default.TOUCH_START,e.touchStartCallback||f),g.removeEventListener(a.default.TAP,e.tapCallback||n),E.active=!0,v.updateImage(g),(0,d.default)(u,E,p,e.toolType,!0,b),u.stopImmediatePropagation(),void u.preventDefault();return e.touchDownActivateCallback?e.touchDownActivateCallback(u):t(u),!1}function f(t){var u=t.detail,v=r.default.cornerstone,m=u.element,g=u.startPoints.canvas,h=void 0,p=(0,s.getToolState)(t.currentTarget,e.toolType),E=void 0;function y(t,r){h.active=!1,h.invalidated=!0,(0,o.default)(u,h.handles)?(0,s.removeToolState)(u.element,e.toolType,h):e.onHandleDoneMove&&e.onHandleDoneMove(m,h),v.updateImage(u.element),m.addEventListener(a.default.TOUCH_START,e.touchStartCallback||f),m.addEventListener(a.default.TAP,e.tapCallback||n),e.pressCallback&&m.addEventListener(a.default.TOUCH_PRESS,e.pressCallback),t&&t.type===a.default.TOUCH_PRESS&&(0,c.default)(m,t.type,r)}if(p){for(E=0;E<p.data.length;E++){h=p.data[E];var b=(0,i.default)(u.element,h.handles,g,28);if(b)return m.removeEventListener(a.default.TOUCH_START,e.touchStartCallback||f),m.removeEventListener(a.default.TAP,e.tapCallback||n),e.pressCallback&&m.removeEventListener(a.default.TOUCH_PRESS,e.pressCallback),h.active=!0,(0,l.default)(t,e.toolType,h,b,y),t.stopImmediatePropagation(),t.preventDefault(),void t.stopPropagation()}if(e.pointNearTool)for(E=0;E<p.data.length;E++)if(h=p.data[E],e.pointNearTool(u.element,h,g))return m.removeEventListener(a.default.TOUCH_START,e.touchStartCallback||f),m.removeEventListener(a.default.TAP,e.tapCallback||n),e.pressCallback&&m.removeEventListener(a.default.TOUCH_PRESS,e.pressCallback),(0,d.default)(t,h,p,e.toolType,!0,y),t.stopImmediatePropagation(),t.preventDefault(),void t.stopPropagation()}}var v={enable:function(o){o.removeEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),o.removeEventListener(a.default.TOUCH_START,e.touchStartCallback||f),o.removeEventListener(a.default.TOUCH_START_ACTIVE,e.touchDownActivateCallback||t),o.removeEventListener(a.default.TAP,e.tapCallback||n),o.addEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),e.doubleTapCallback&&o.removeEventListener(a.default.DOUBLE_TAP,e.doubleTapCallback),e.pressCallback&&o.removeEventListener(a.default.TOUCH_PRESS,e.pressCallback),r.default.cornerstone.updateImage(o)},disable:function(o){o.removeEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),o.removeEventListener(a.default.TOUCH_START,e.touchStartCallback||f),o.removeEventListener(a.default.TOUCH_START_ACTIVE,e.touchDownActivateCallback||t),o.removeEventListener(a.default.TAP,e.tapCallback||n),e.doubleTapCallback&&o.removeEventListener(a.default.DOUBLE_TAP,e.doubleTapCallback),e.pressCallback&&o.removeEventListener(a.default.TOUCH_PRESS,e.pressCallback),r.default.cornerstone.updateImage(o)},activate:function(o){o.removeEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),o.removeEventListener(a.default.TOUCH_START,e.touchStartCallback||f),o.removeEventListener(a.default.TOUCH_START_ACTIVE,e.touchDownActivateCallback||t),o.removeEventListener(a.default.TAP,e.tapCallback||n),o.addEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),o.addEventListener(a.default.TOUCH_START,e.touchStartCallback||f),o.addEventListener(a.default.TOUCH_START_ACTIVE,e.touchDownActivateCallback||t),o.addEventListener(a.default.TAP,e.tapCallback||n),e.doubleTapCallback&&(o.removeEventListener(a.default.DOUBLE_TAP,e.doubleTapCallback),o.addEventListener(a.default.DOUBLE_TAP,e.doubleTapCallback)),e.pressCallback&&(o.removeEventListener(a.default.TOUCH_PRESS,e.pressCallback),o.addEventListener(a.default.TOUCH_PRESS,e.pressCallback)),r.default.cornerstone.updateImage(o)},deactivate:function(o){var i=a.default.TOOL_DEACTIVATED,l={toolType:e.toolType,type:i};(0,c.default)(o,i,l),o.removeEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),o.removeEventListener(a.default.TOUCH_START,e.touchStartCallback||f),o.removeEventListener(a.default.TOUCH_START_ACTIVE,e.touchDownActivateCallback||t),o.removeEventListener(a.default.TAP,e.tapCallback||n),o.addEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),o.addEventListener(a.default.TOUCH_START,e.touchStartCallback||f),e.doubleTapCallback&&o.removeEventListener(a.default.DOUBLE_TAP,e.doubleTapCallback),e.pressCallback&&o.removeEventListener(a.default.TOUCH_PRESS,e.pressCallback),r.default.cornerstone.updateImage(o)},touchStartCallback:e.touchStartCallback||f,touchDownActivateCallback:e.touchDownActivateCallback||t,tapCallback:e.tapCallback||n};return e.pointNearTool&&(v.pointNearTool=e.pointNearTool),e.doubleTapCallback&&(v.doubleTapCallback=e.doubleTapCallback),e.pressCallback&&(v.pressCallback=e.pressCallback),e.addNewMeasurement&&(v.addNewMeasurement=e.addNewMeasurement),v}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=void 0,r=void 0,o=void 0,i={setStartLoadHandler:function(e){a=e},getStartLoadHandler:function(){return a},setEndLoadHandler:function(e){r=e},getEndLoadHandler:function(){return r},setErrorLoadingHandler:function(e){o=e},getErrorLoadingHandler:function(){return o}};t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=1,r=2,o={setToolWidth:function(e){a=e},getToolWidth:function(){return a},setActiveWidth:function(e){r=e},getActiveWidth:function(){return r}};t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){var o=a.default.MEASUREMENT_COMPLETED,i={toolType:n,element:e,measurementData:t};(0,r.default)(e,o,i)};var a=o(n(1)),r=o(n(6));function o(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.image,a={left:0,top:0,width:n.width,height:n.height},o=!1;return Object.keys(t).forEach((function(e){var n=t[e];!0!==n.allowedOutsideImage&&!1===r.default.cornerstoneMath.point.insideRect(n,a)&&(o=!0)})),o};var a,r=(a=n(0))&&a.__esModule?a:{default:a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(!t)throw new Error("simpleMouseButtonTool: toolType is required");var n={};return{activate:function(n,a){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};i.mouseButtonMask=a,(0,o.setToolOptions)(t,n,i),n.removeEventListener(r.default.MOUSE_DOWN_ACTIVATE,e),n.addEventListener(r.default.MOUSE_DOWN_ACTIVATE,e)},disable:function(t){t.removeEventListener(r.default.MOUSE_DOWN_ACTIVATE,e)},enable:function(t){t.removeEventListener(r.default.MOUSE_DOWN_ACTIVATE,e)},deactivate:function(t){t.removeEventListener(r.default.MOUSE_DOWN_ACTIVATE,e)},getConfiguration:function(){return n},setConfiguration:function(e){n=e}}};var a,r=(a=n(1))&&a.__esModule?a:{default:a},o=n(4)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,i,l,u,d,s,c,f){var v=a.default.cornerstone,m=v.pixelToCanvas(t,n);c&&(m.x+=c);var g={centering:{x:!1,y:f}};if(n.boundingBox=(0,r.default)(e,i,m.x,m.y,d,g),n.hasMoved){var h=u(l).map((function(e){return v.pixelToCanvas(t,e)}));(0,o.default)(h,m,n.boundingBox,e,d,s)}};var a=i(n(0)),r=i(n(11)),o=i(n(108));function i(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){var a=[r.default.TOUCH_DRAG];return n&&!0===n.fireOnTouchStart&&a.push(r.default.TOUCH_START),{activate:function(i){n&&n.eventData&&(0,o.setToolOptions)(t,i,n.eventData),a.forEach((function(t){i.removeEventListener(t,e),i.addEventListener(t,e)})),n&&n.activateCallback&&n.activateCallback(i),n&&n.touchStartCallback&&i.addEventListener(r.default.TOUCH_START,n.touchStartCallback),n&&n.touchEndCallback&&i.addEventListener(r.default.TOUCH_END,n.touchEndCallback)},disable:function(t){a.forEach((function(n){t.removeEventListener(n,e)})),n&&n.disableCallback&&n.disableCallback(t),n&&n.touchStartCallback&&t.removeEventListener(r.default.TOUCH_START,n.touchStartCallback),n&&n.touchEndCallback&&t.removeEventListener(r.default.TOUCH_END,n.touchEndCallback)},enable:function(t){a.forEach((function(n){t.removeEventListener(n,e)})),n&&n.enableCallback&&n.enableCallback(t),n&&n.touchStartCallback&&t.removeEventListener(r.default.TOUCH_START,n.touchStartCallback),n&&n.touchEndCallback&&t.removeEventListener(r.default.TOUCH_END,n.touchEndCallback)},deactivate:function(t){a.forEach((function(n){t.removeEventListener(n,e)})),n&&n.deactivateCallback&&n.deactivateCallback(t),n&&n.touchStartCallback&&t.removeEventListener(r.default.TOUCH_START,n.touchStartCallback),n&&n.touchEndCallback&&t.removeEventListener(r.default.TOUCH_END,n.touchEndCallback)}}};var a,r=(a=n(1))&&a.__esModule?a:{default:a},o=n(4)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=15,r=a+"px Arial",o="transparent",i={setFont:function(e){r=e},getFont:function(){return r},setFontSize:function(e){a=e},getFontSize:function(){return a},setBackgroundColor:function(e){o=e},getBackgroundColor:function(){return o}};t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=r.default.cornerstoneMath;return e instanceof t.Vector3?e:new t.Vector3(e[0],e[1],e[2])};var a,r=(a=n(0))&&a.__esModule?a:{default:a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=r.default.cornerstone.metaData.get("imagePlaneModule",e.imageId),n=void 0,a=void 0;return t?(n=t.rowPixelSpacing||t.rowImagePixelSpacing,a=t.columnPixelSpacing||t.colImagePixelSpacing):(n=e.rowPixelSpacing,a=e.columnPixelSpacing),{rowPixelSpacing:n,colPixelSpacing:a}};var a,r=(a=n(0))&&a.__esModule?a:{default:a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=r.default.cornerstone,a=n.metaData.get("patientStudyModule",e.imageId),i=n.metaData.get("generalSeriesModule",e.imageId);if(a&&i&&"PT"===i.modality){var l=t*e.slope+e.intercept,u=a.patientWeight;if(u){var d=n.metaData.get("petIsotopeModule",e.imageId);if(d){var s=d.radiopharmaceuticalInfo,c=s.radiopharmaceuticalStartTime,f=s.radionuclideTotalDose,v=s.radionuclideHalfLife,m=i.seriesTime;if(c&&f&&v&&m){var g=o(m.fractionalSeconds||0)+m.seconds+60*m.minutes+60*m.hours*60-(o(c.fractionalSeconds)+c.seconds+60*c.minutes+60*c.hours*60);return l*u/(f*Math.exp(-g*Math.log(2)/v))*1e3}}}}};var a,r=(a=n(0))&&a.__esModule?a:{default:a};function o(e){return parseFloat("."+e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e.boundingBox)return r.default.cornerstoneMath.point.insideRect(t,e.boundingBox)};var a,r=(a=n(0))&&a.__esModule?a:{default:a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.freehand=void 0;var a=I(n(1)),r=I(n(0)),o=I(n(14)),i=I(n(7)),l=I(n(9)),u=I(n(34)),d=I(n(24)),s=I(n(23)),c=I(n(6)),f=I(n(15)),v=I(n(5)),m=I(n(18)),g=n(2),h=n(4),p=n(8),E=I(n(22)),y=n(56),b=I(n(102)),T=I(n(101)),x=I(n(100)),w=I(n(98)),C=I(n(97)),M=I(n(55)),S=n(37),O=n(3);function I(e){return e&&e.__esModule?e:{default:e}}function _(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var P="freehand",L={mouseLocation:{handles:{start:{highlight:!0,active:!0}}},keyDown:{shift:!1,ctrl:!1,alt:!1},activePencilMode:!1,spacing:5,activeHandleRadius:3,completeHandleRadius:6,alwaysShowHandles:!1,invalidColor:"crimson",modifying:!1,movingTextBox:!1,currentHandle:0,currentTool:-1};function D(e,t,n){return null!==j(e,t,n)}function j(e,t,n){var a=Y.getConfiguration();if(void 0===t.handles)return null;if(!1===t.visible)return null;for(var o=0;o<t.handles.length;o++){var i=r.default.cornerstone.pixelToCanvas(e,t.handles[o]);if(r.default.cornerstoneMath.point.distance(i,n)<a.spacing)return o}return t.textBox&&(0,d.default)(t.textBox,n)?t.textBox:null}function A(e){var t=e.detail,n=t.element,r=Y.getConfiguration(),o=(0,h.getToolOptions)(P,n);(0,v.default)(t.which,o.mouseButtonMask)&&(t.event.shiftKey&&(r.activePencilMode=!0),function(e){e.element.addEventListener(a.default.MOUSE_MOVE,N);var t=Y.getConfiguration();t.mouseLocation.handles.start.x=e.currentPoints.image.x,t.mouseLocation.handles.start.y=e.currentPoints.image.y,(0,g.addToolState)(e.element,P,{visible:!0,active:!0,invalidated:!0,color:void 0,handles:[],textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}});var n=(0,g.getToolState)(e.element,P);t.currentTool=n.data.length-1}(t),R(t),e.preventDefault(),e.stopPropagation())}function R(e){var t=(0,g.getToolState)(e.element,P);if(void 0!==t){var n=Y.getConfiguration(),o=t.data[n.currentTool];if(!o.handles.invalidHandlePlacement){var i=new S.FreehandHandleData(e.currentPoints.image);o.handles.length&&o.handles[n.currentHandle-1].lines.push(e.currentPoints.image),o.handles.push(i),n.currentHandle+=1,r.default.cornerstone.updateImage(e.element),function(e,t){var n=a.default.MEASUREMENT_MODIFIED,r={toolType:P,element:e,measurementData:t};(0,c.default)(e,n,r)}(e.element,o)}}}function k(e,t){var n=(0,g.getToolState)(e.element,P);if(n){var a=Y.getConfiguration(),o=n.data[a.currentTool],i=!1;if(o){if(o.active=!1,o.highlight=!1,o.handles.invalidHandlePlacement=!1,void 0!==t&&(o.handles.length>2?o.handles[a.currentHandle-1].lines.push(o.handles[0]):i=!0),a.modifying&&(a.modifying=!1,o.invalidated=!0),a.currentHandle=0,a.currentTool=-1,a.activePencilMode=!1,o.canComplete=!1,i)(0,g.removeToolState)(e.element,P,o);else{var l=r.default.cornerstone.metaData.get("generalSeriesModule",e.image.imageId),u=void 0;l&&(u=l.modality);var d=(0,E.default)(e.image),s=d.rowPixelSpacing,c=d.colPixelSpacing;G(o,e.element,e.image,u,s,c),(0,f.default)(e.element,o,P)}r.default.cornerstone.updateImage(e.element)}}}function U(e){var t=e.detail,n=t.element,r=(0,h.getToolOptions)(P,n);if((0,v.default)(t.which,r.mouseButtonMask)){var o=Y.getConfiguration().currentTool;if(o<0)!function(e){var t=e.detail,n=function(e){var t=e.element,n=e.currentPoints.canvas,a=(0,g.getToolState)(t,P);if(a)for(var r=void 0,o=0;o<a.data.length;o++)if(null!==(r=j(t,a.data[o],n)))return{handleNearby:r,toolIndex:o}}(t);t.event.ctrlKey?(0,x.default)(e,n):void 0!==n&&function(e,t){var n=e.detail,r=n.element,o=(0,g.getToolState)(n.element,P),i=t.handleNearby;i.hasBoundingBox?function(e,t){var n=Y.getConfiguration(),r=t.handleNearby,o=t.toolIndex;e.addEventListener(a.default.MOUSE_UP,V),e.addEventListener(a.default.MOUSE_DRAG,H),n.movingTextBox=!0,n.currentHandle=r,n.currentTool=o}(r,t):void 0!==i&&function(e,t,n){var r=Y.getConfiguration(),o=t.handleNearby,i=t.toolIndex;e.removeEventListener(a.default.MOUSE_MOVE,N),r.dragOrigin={x:n.data[i].handles[o].x,y:n.data[i].handles[o].y},e.addEventListener(a.default.MOUSE_UP,V),e.addEventListener(a.default.MOUSE_CLICK,V),e.addEventListener(a.default.MOUSE_DRAG,H),r.modifying=!0,r.currentHandle=o,r.currentTool=i}(r,t,o),e.preventDefault(),e.stopPropagation()}(e,n)}(e);else{var i=(0,g.getToolState)(t.element,P);o>=0&&i.data[o].active&&function(e,t,n){var a=e.detail,r=Y.getConfiguration(),o=a.element,i=t.data[n],l=j(o,i,a.currentPoints.canvas);!M.default.end(i.handles)&&i.canComplete?k(a,r.currentHandle):null===l&&R(a),e.preventDefault(),e.stopPropagation()}(e,i,o)}}}function N(e){var t=e.detail,n=(0,g.getToolState)(t.element,P);if(n){if(Y.getConfiguration().currentTool<0){if(!function(e,t){for(var n=!1,a=0;a<t.data.length;a++){var r=e.element,o=t.data[a],i=e.currentPoints.canvas;!0===(0,u.default)(r,o.handles,i)&&(n=!0),(D(r,o,i)&&!o.active||!D(r,o,i)&&o.active)&&(o.active=!o.active,n=!0),!0===o.textBox&&(0,d.default)(o.textBox,i)&&(o.active=!o.active,o.highlight=!o.highlight,n=!0)}return n}(t,n))return}else!function(e,t){var n=Y.getConfiguration(),a=n.currentTool,o=e.element,i=t.data[a],l=e.currentPoints.canvas;if(B(e),function(e){var t,n=Y.getConfiguration();if(e.handles.length<2)return!0;t=n.activePencilMode?function(e){var t=Y.getConfiguration().mouseLocation.handles.start,n=e.handles,a=M.default.newHandle(t,n);return!1===a&&(a=function(e,t){var n=Y.getConfiguration(),a=e.handles;if(r.default.cornerstoneMath.point.distance(a[0],t)<n.spacing)return e.canComplete=!0,!1;e.canComplete=!1;for(var o=1;o<a.length-1;o++)if(r.default.cornerstoneMath.point.distance(a[o],t)<n.spacing)return!0;return!1}(e,t)),a}(e):function(e){var t=Y.getConfiguration(),n=t.mouseLocation.handles.start,a=e.handles,o=!1;return e.canComplete=!1,r.default.cornerstoneMath.point.distance(a[0],n)<t.spacing&&!M.default.end(a)?(e.canComplete=!0,o=!1):o=M.default.newHandle(n,a),o}(e),e.handles.invalidHandlePlacement=t}(i),n.activePencilMode)!function(e,t){for(var n=Y.getConfiguration(),a=n.mouseLocation.handles.start,o=0;o<t.length;o++)if(r.default.cornerstoneMath.point.distance(t[o],a)<n.spacing)return;R(e)}(e,i.handles);else{var u=j(o,i,l);null!==u&&!u.hasBoundingBox&&u<i.handles.length-1&&(n.mouseLocation.handles.start.x=i.handles[u].x,n.mouseLocation.handles.start.y=i.handles[u].y)}}(t,n);r.default.cornerstone.updateImage(t.element)}}function H(e){var t=e.detail,n=(0,g.getToolState)(t.element,P);if(n){var a=Y.getConfiguration(),o=n.data[a.currentTool],i=a.currentHandle;B(t),a.currentTool>=0&&(0,b.default)(i,o),r.default.cornerstone.updateImage(t.element)}}function V(e){var t=e.detail,n=t.element,o=(0,g.getToolState)(t.element,P);n.removeEventListener(a.default.MOUSE_UP,V),n.removeEventListener(a.default.MOUSE_DRAG,H),n.removeEventListener(a.default.MOUSE_CLICK,V),n.addEventListener(a.default.MOUSE_MOVE,N),void 0!==o&&("handle"===(0,T.default)(e,o)&&k(t),e.preventDefault(),e.stopPropagation(),r.default.cornerstone.updateImage(t.element))}function B(e){var t=Y.getConfiguration();t.mouseLocation.handles.start.x=e.currentPoints.image.x,t.mouseLocation.handles.start.y=e.currentPoints.image.y,(0,p.clipToBox)(t.mouseLocation.handles.start,e.image)}function z(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}function W(e){var t=e.detail,n=(0,g.getToolState)(e.currentTarget,P);if(void 0!==n){var a=r.default.cornerstone,u=t.image,d=t.element,s=Y.getConfiguration(),c=a.metaData.get("generalSeriesModule",u.imageId),f=void 0,v=(0,E.default)(u),h=v.rowPixelSpacing,p=v.colPixelSpacing;c&&(f=c.modality);for(var y=(0,O.getNewContext)(t.canvasContext.canvas),b=o.default.getToolWidth(),T=function(e){var a=n.data[e];if(!1===a.visible)return"continue";(0,O.draw)(y,(function(e){var n=i.default.getColorIfActive(a),r=void 0;if(a.active?a.handles.invalidHandlePlacement?(n=s.invalidColor,r=s.invalidColor):(n=i.default.getColorIfActive(a),r=i.default.getFillColor()):r=i.default.getToolColor(),a.handles.length)for(var o=0;o<a.handles.length;o++){var c=[].concat(_(a.handles[o].lines));o!==a.handles.length-1||a.polyBoundingBox||c.push(s.mouseLocation.handles.start),(0,O.drawJoinedLines)(e,t.element,a.handles[o],c,{color:n})}var v={fill:r};if((s.alwaysShowHandles||s.keyDown.ctrl||a.active&&a.polyBoundingBox)&&(v.handleRadius=s.activeHandleRadius,(0,l.default)(e,t,a.handles,n,v)),a.canComplete&&(v.handleRadius=s.completeHandleRadius,(0,l.default)(e,t,[a.handles[0]],n,v)),a.active&&!a.polyBoundingBox&&(v.handleRadius=s.activeHandleRadius,(0,l.default)(e,t,s.mouseLocation.handles,n,v),(0,l.default)(e,t,[a.handles[0]],n,v)),G(a,d,u,f,h,p),a.polyBoundingBox&&!a.textBox.freehand){a.textBox.hasMoved||(a.textBox.x=a.polyBoundingBox.left+a.polyBoundingBox.width,a.textBox.y=a.polyBoundingBox.top+a.polyBoundingBox.height/2);var g=function(e){var t=e.meanStdDev,n=e.meanStdDevSUV,a=e.area,r=[];if(t&&void 0!==t.mean){var o="";"CT"===f&&(o=" HU");var i="Mean: "+z(t.mean.toFixed(2))+o,l="StdDev: "+z(t.stdDev.toFixed(2))+o;n&&void 0!==n.mean&&(i+=" SUV: "+z(n.mean.toFixed(2)),l+=" SUV: "+z(n.stdDev.toFixed(2))),r.push(i),r.push(l)}if(a){var u=" mm"+String.fromCharCode(178);h&&p||(u=" pixels"+String.fromCharCode(178));var d="Area: "+z(a.toFixed(2))+u;r.push(d)}return r}(a);(0,m.default)(e,d,a.textBox,g,a.handles,w,n,b,0,!0)}}))},x=0;x<n.data.length;x++)T(x)}function w(e){return e}}function G(e,t,n,a,o,i){var l=r.default.cornerstone,u=void 0,d=void 0,c=void 0;if(!1===e.invalidated)d=e.meanStdDev,c=e.meanStdDevSUV,u=e.area;else if(!e.active){for(var f={left:e.handles[0].x,right:e.handles[0].x,bottom:e.handles[0].y,top:e.handles[0].x},v=0;v<e.handles.length;v++)f.left=Math.min(f.left,e.handles[v].x),f.right=Math.max(f.right,e.handles[v].x),f.bottom=Math.min(f.bottom,e.handles[v].y),f.top=Math.max(f.top,e.handles[v].y);var m={left:f.left,top:f.bottom,width:Math.abs(f.right-f.left),height:Math.abs(f.top-f.bottom)};if(e.polyBoundingBox=m,!n.color){var g=l.getPixels(t,m.left,m.top,m.width,m.height);d=(0,C.default)(g,m,e.handles),"PT"===a&&(c={mean:(0,s.default)(n,(d.mean-n.intercept)/n.slope),stdDev:(0,s.default)(n,(d.stdDev-n.intercept)/n.slope)}),d&&!isNaN(d.mean)&&(e.meanStdDev=d,e.meanStdDevSUV=c)}var h=(i||1)*(o||1);u=(0,w.default)(e.handles,h),isNaN(u)||(e.area=u,e.unit="mm"+String.fromCharCode(178),o&&i||(e.unit="pixels"+String.fromCharCode(178))),e.invalidated=!1}}function F(e){e.removeEventListener(a.default.MOUSE_DOWN,U),e.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,A),e.removeEventListener(a.default.MOUSE_DRAG,H),e.removeEventListener(a.default.MOUSE_UP,V),e.removeEventListener(a.default.MOUSE_MOVE,N),e.removeEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,W),e.removeEventListener(a.default.KEY_DOWN,y.keyDownCallback),e.removeEventListener(a.default.KEY_UP,y.keyUpCallback)}function q(e){var t=Y.getConfiguration();if(t.currentTool>=0){var n=t.currentHandle;k({element:e,image:r.default.cornerstone.getEnabledElement(e).image},n)}}var Y={enable:function(e){q(e),F(e),e.addEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,W),r.default.cornerstone.updateImage(e)},disable:function(e){q(e),F(e),r.default.cornerstone.updateImage(e)},activate:function(e,t){(0,h.setToolOptions)(P,e,{mouseButtonMask:t}),F(e),e.addEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,W),e.addEventListener(a.default.MOUSE_MOVE,N),e.addEventListener(a.default.MOUSE_DOWN,U),e.addEventListener(a.default.MOUSE_DOWN_ACTIVATE,A),e.addEventListener(a.default.KEY_DOWN,y.keyDownCallback),e.addEventListener(a.default.KEY_UP,y.keyUpCallback),r.default.cornerstone.updateImage(e)},deactivate:function(e,t){(0,h.setToolOptions)(P,e,{mouseButtonMask:t});var n=a.default.TOOL_DEACTIVATED,o={mouseButtonMask:t,toolType:P,type:n};(0,c.default)(e,n,o),q(e),F(e),e.addEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,W),e.addEventListener(a.default.MOUSE_MOVE,N),e.addEventListener(a.default.MOUSE_DOWN,U),e.addEventListener(a.default.KEY_DOWN,y.keyDownCallback),e.addEventListener(a.default.KEY_UP,y.keyUpCallback),r.default.cornerstone.updateImage(e)},getConfiguration:function(){return L},setConfiguration:function(e){L=e},pointNearTool:D};t.freehand=Y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={};return{disable:function(t){t.removeEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,e)},enable:function(t){t.removeEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,e),t.addEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,e),r.default.cornerstone.updateImage(t)},getConfiguration:function(){return t},setConfiguration:function(e){t=e}}};var a,r=(a=n(0))&&a.__esModule?a:{default:a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,o){var i=void 0;if(t)return Object.keys(t).forEach((function(l){var u=t[l];if(u.hasOwnProperty("pointNearHandle")){if(u.pointNearHandle(e,u,n))return void(i=u)}else if(!0===u.hasBoundingBox){if((0,r.default)(u,n))return void(i=u)}else{var d=a.default.cornerstone.pixelToCanvas(e,u);if(a.default.cornerstoneMath.point.distance(d,n)<=o)return void(i=u)}})),i};var a=o(n(0)),r=o(n(24));function o(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.globalImageIdSpecificToolStateManager=t.newImageIdSpecificToolStateManager=void 0;var a,r=(a=n(0))&&a.__esModule?a:{default:a};function o(){var e={};return{get:function(t,n){var a=r.default.cornerstone.getEnabledElement(t);if(a.image&&!1!==e.hasOwnProperty(a.image.imageId)){var o=e[a.image.imageId];if(!1!==o.hasOwnProperty(n))return o[n]}},add:function(t,n,a){var o=r.default.cornerstone.getEnabledElement(t);o.image&&!1!==e.hasOwnProperty(o.image.imageId)||(e[o.image.imageId]={});var i=e[o.image.imageId];!1===i.hasOwnProperty(n)&&(i[n]={data:[]}),i[n].data.push(a)},clear:function(t){var n=r.default.cornerstone.getEnabledElement(t);n.image&&!1!==e.hasOwnProperty(n.image.imageId)&&delete e[n.image.imageId]},saveImageIdToolState:function(t){return e[t]},restoreImageIdToolState:function(t,n){e[t]=n},saveToolState:function(){return e},restoreToolState:function(t){e=t},toolState:e}}var i=o();t.newImageIdSpecificToolStateManager=o,t.globalImageIdSpecificToolStateManager=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,a){var o=r.default.cornerstone,i={start:o.pixelToCanvas(e,t),end:o.pixelToCanvas(e,n)};return r.default.cornerstoneMath.lineSegment.distanceToPoint(i,a)};var a,r=(a=n(0))&&a.__esModule?a:{default:a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,l,u,d){var s=r.default.cornerstone,c=e.element,f=s.pageToPixel(c,e.currentPoints.page.x,e.currentPoints.page.y+50),v=l.x-f.x,m=l.y-f.y;function g(e){var r=e.detail;l.x=r.currentPoints.image.x+v,l.y=r.currentPoints.image.y+m,d&&(0,i.clipToBox)(l,r.image),s.updateImage(c);var u=a.default.MEASUREMENT_MODIFIED,f={toolType:t,element:c,measurementData:n};(0,o.default)(c,u,f)}function h(e){var t=e.detail;if(c.removeEventListener(a.default.TOUCH_DRAG,g),c.removeEventListener(a.default.TOUCH_PINCH,h),c.removeEventListener(a.default.TOUCH_END,h),c.removeEventListener(a.default.TAP,h),c.removeEventListener(a.default.TOUCH_START,p),c.removeEventListener(a.default.TOOL_DEACTIVATED,E),e.type===a.default.TOUCH_PINCH||e.type===a.default.TOUCH_PRESS)return l.active=!1,s.updateImage(c),void u();l.active=!1,n.active=!1,l.x=t.currentPoints.image.x+v,l.y=t.currentPoints.image.y+m,d&&(0,i.clipToBox)(l,t.image),s.updateImage(c),"function"==typeof u&&u()}function p(e){return e.stopImmediatePropagation(),!1}function E(){c.removeEventListener(a.default.TOUCH_DRAG,g),c.removeEventListener(a.default.TOUCH_PINCH,h),c.removeEventListener(a.default.TOUCH_END,h),c.removeEventListener(a.default.TAP,h),c.removeEventListener(a.default.TOUCH_START,p),c.removeEventListener(a.default.TOOL_DEACTIVATED,E),l.active=!1,n.active=!1,l.x=e.currentPoints.image.x+v,l.y=e.currentPoints.image.y+m,d&&(0,i.clipToBox)(l,e.image),s.updateImage(c)}l.active=!0,n.active=!0,c.addEventListener(a.default.TOUCH_DRAG,g),c.addEventListener(a.default.TOUCH_PINCH,h),c.addEventListener(a.default.TOUCH_END,h),c.addEventListener(a.default.TAP,h),c.addEventListener(a.default.TOUCH_START,p),c.addEventListener(a.default.TOOL_DEACTIVATED,E)};var a=l(n(1)),r=l(n(0)),o=l(n(6)),i=n(8);function l(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{activate:function(t){t.removeEventListener(r.default.MOUSE_WHEEL,e),t.addEventListener(r.default.MOUSE_WHEEL,e)},disable:function(t){t.removeEventListener(r.default.MOUSE_WHEEL,e)},enable:function(t){t.removeEventListener(r.default.MOUSE_WHEEL,e)},deactivate:function(t){t.removeEventListener(r.default.MOUSE_WHEEL,e)}}};var a,r=(a=n(1))&&a.__esModule?a:{default:a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,l,u,d){var s=r.default.cornerstone,c=e.element;function f(e){var r=e.detail;l.active=!0,l.x=r.currentPoints.image.x,l.y=r.currentPoints.image.y,d&&(0,i.clipToBox)(l,r.image),s.updateImage(c);var u=a.default.MEASUREMENT_MODIFIED,f={toolType:t,element:c,measurementData:n};(0,o.default)(c,u,f)}function v(e){c.removeEventListener(a.default.MOUSE_MOVE,v),c.removeEventListener(a.default.MOUSE_DRAG,v),c.addEventListener(a.default.MOUSE_MOVE,f),c.addEventListener(a.default.MOUSE_DRAG,f),c.addEventListener(a.default.MOUSE_CLICK,h),e.type===a.default.MOUSE_DRAG&&c.addEventListener(a.default.MOUSE_UP,h)}function m(e){e.detail.measurementData===n&&h()}function g(e){e.detail.toolType===t&&(c.removeEventListener(a.default.MOUSE_MOVE,f),c.removeEventListener(a.default.MOUSE_DRAG,f),c.removeEventListener(a.default.MOUSE_CLICK,h),c.removeEventListener(a.default.MOUSE_UP,h),c.removeEventListener(a.default.MEASUREMENT_REMOVED,m),c.removeEventListener(a.default.TOOL_DEACTIVATED,g),l.active=!1,s.updateImage(c))}function h(){c.removeEventListener(a.default.MOUSE_MOVE,f),c.removeEventListener(a.default.MOUSE_DRAG,f),c.removeEventListener(a.default.MOUSE_CLICK,h),c.removeEventListener(a.default.MOUSE_UP,h),c.removeEventListener(a.default.MEASUREMENT_REMOVED,m),c.removeEventListener(a.default.TOOL_DEACTIVATED,g),l.active=!1,s.updateImage(c),"function"==typeof u&&u()}c.addEventListener(a.default.MOUSE_DRAG,v),c.addEventListener(a.default.MOUSE_MOVE,v),c.addEventListener(a.default.MEASUREMENT_REMOVED,m),c.addEventListener(a.default.TOOL_DEACTIVATED,g)};var a=l(n(1)),r=l(n(0)),o=l(n(6)),i=n(8);function l(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,l,u,d){var s=r.default.cornerstone,c=e.element,f=l.x-e.currentPoints.image.x,v=l.y-e.currentPoints.image.y;function m(e){var r=e.detail;!1===l.hasMoved&&(l.hasMoved=!0),l.active=!0,l.x=r.currentPoints.image.x+f,l.y=r.currentPoints.image.y+v,d&&(0,i.clipToBox)(l,r.image),s.updateImage(c);var u=a.default.MEASUREMENT_MODIFIED,m={toolType:t,element:c,measurementData:n};(0,o.default)(c,u,m)}function g(){l.active=!1,c.removeEventListener(a.default.MOUSE_DRAG,m),c.removeEventListener(a.default.MOUSE_UP,g),c.removeEventListener(a.default.MOUSE_CLICK,g),s.updateImage(c),"function"==typeof u&&u()}c.addEventListener(a.default.MOUSE_DRAG,m),c.addEventListener(a.default.MOUSE_UP,g),c.addEventListener(a.default.MOUSE_CLICK,g)};var a=l(n(1)),r=l(n(0)),o=l(n(6)),i=n(8);function l(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,a){a||(a=6);var o=function(e){var t=void 0;return Object.keys(e).forEach((function(n){var a=e[n];!0!==a.active||(t=a)})),t}(t),i=(0,r.default)(e,t,n,a);return o!==i&&(void 0!==i&&(i.active=!0),void 0!==o&&(o.active=!1),!0)};var a,r=(a=n(27))&&a.__esModule?a:{default:a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=void 0,r={default:6,IE:{9:6,10:8,default:8},Firefox:{default:6},Opera:{10:8,11:6,12:6,default:6},Chrome:{default:6},Safari:{default:6}};function o(){var e=navigator.userAgent,t=e.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],n=void 0;return/trident/i.test(t[1])?"IE "+((n=/\brv[ :]+(\d+)/g.exec(e)||[])[1]||""):"Chrome"===t[1]&&null!==(n=e.match(/\b(OPR|Edge)\/(\d+)/))?n.slice(1).join(" ").replace("OPR","Opera"):(t=t[2]?[t[1],t[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(n=e.match(/version\/(\d+)/i))&&t.splice(1,1,n[1]),t.join(" "))}function i(){var e=o().split(" "),t=e[0],n=e[1],a=r[t];return a?a[n]?a[n]:a.default:r.default}t.getDefaultSimultaneousRequests=i,t.getMaxSimultaneousRequests=function(){return a||i()},t.setMaxSimultaneousRequests=function(e){a=e},t.getBrowserInfo=o,t.isMobileDevice=function(){return new RegExp("Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini").test(navigator.userAgent)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.drawBrushOnCanvas=t.drawBrushPixels=void 0;var a,r=(a=n(0))&&a.__esModule?a:{default:a},o=n(3);t.drawBrushPixels=function(e,t,n,a){e.forEach((function(e){var r,o=(r=e[0],e[1]*a+r);t[o]=n}))},t.drawBrushOnCanvas=function(e,t,n,a){var i=r.default.cornerstone.pixelToCanvas(a,{x:0,y:0}),l=r.default.cornerstone.pixelToCanvas(a,{x:1,y:1}),u=l.x-i.x,d=l.y-i.y;(0,o.draw)(t,(function(t){e.forEach((function(e){var i=r.default.cornerstone.pixelToCanvas(a,{x:e[0],y:e[1]}),l={left:i.x,top:i.y,width:u,height:d};(0,o.fillBox)(t,l,n)}))}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FreehandHandleData=function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t.x,this.y=t.y,this.highlight=n,this.active=a,this.lines=[]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n={},a=[r.default.MULTI_TOUCH_DRAG];return t&&!0===t.fireOnTouchStart&&a.push(r.default.MULTI_TOUCH_START),{activate:function(n){a.forEach((function(t){n.removeEventListener(t,e),n.addEventListener(t,e)})),t&&t.activateCallback&&t.activateCallback(n)},disable:function(n){a.forEach((function(t){n.removeEventListener(t,e)})),t&&t.disableCallback&&t.disableCallback(n)},enable:function(n){a.forEach((function(t){n.removeEventListener(t,e)})),t&&t.enableCallback&&t.enableCallback(n)},deactivate:function(n){a.forEach((function(t){n.removeEventListener(t,e)})),t&&t.deactivateCallback&&t.deactivateCallback(n)},getConfiguration:function(){return n},setConfiguration:function(e){n=e}}};var a,r=(a=n(1))&&a.__esModule?a:{default:a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){var l=(0,r.getToolState)(e,"timeSeries");if(l&&l.data&&l.data.length){var u=a.default.cornerstone,d=l.data[0],s=d.stacks[d.currentStackIndex].currentImageIdIndex,c=d.currentStackIndex+t;if(n?(c>=d.stacks.length&&(c=0),c<0&&(c=d.stacks.length-1)):c=(0,i.default)(c,0,d.stacks.length-1),c!==d.currentStackIndex){var f=u.getViewport(e),v=d.stacks[c],m=o.default.getStartLoadHandler(),g=o.default.getEndLoadHandler(),h=o.default.getErrorLoadingHandler();m&&m(e),(!0===v.preventCache?u.loadImage(v.imageIds[s]):u.loadAndCacheImage(v.imageIds[s])).then((function(t){d.currentImageIdIndex!==s&&(v.currentImageIdIndex=s,d.currentStackIndex=c,u.displayImage(e,t,f),g&&g(e,t))}),(function(t){var n=v.imageIds[s];h&&h(e,n,t)}))}}};var a=l(n(0)),r=n(2),o=l(n(13)),i=l(n(8));function l(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,d,s,c){var f=r.default.cornerstone,v=e.detail.element;function m(e){var n=e.detail;t.active=!0,Object.keys(t.handles).forEach((function(e){var a=t.handles[e];!0!==a.movesIndependently&&(a.x+=n.deltaPoints.image.x,a.y+=n.deltaPoints.image.y,s.preventHandleOutsideImage&&(0,u.clipToBox)(a,n.image))})),f.updateImage(v);var r=a.default.MEASUREMENT_MODIFIED,o={toolType:d,element:v,measurementData:t};(0,l.default)(v,r,o),e.preventDefault(),e.stopPropagation()}function g(e){var n=e.detail;t.invalidated=!0,v.removeEventListener(a.default.MOUSE_DRAG,m),v.removeEventListener(a.default.MOUSE_UP,g),v.removeEventListener(a.default.MOUSE_CLICK,g),!0===s.deleteIfHandleOutsideImage&&(0,o.default)(n,t.handles)&&(0,i.removeToolState)(v,d,t),f.updateImage(v),"function"==typeof c&&c()}return v.addEventListener(a.default.MOUSE_DRAG,m),v.addEventListener(a.default.MOUSE_UP,g),v.addEventListener(a.default.MOUSE_CLICK,g),!0};var a=d(n(1)),r=d(n(0)),o=d(n(16)),i=n(2),l=d(n(6)),u=n(8);function d(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=void 0,r={setCoords:function(e){a=e.currentPoints.canvas},getCoords:function(){return a}};t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{page:r.default.cornerstoneMath.point.copy(e.page),image:r.default.cornerstoneMath.point.copy(e.image),client:r.default.cornerstoneMath.point.copy(e.client),canvas:r.default.cornerstoneMath.point.copy(e.canvas)}};var a,r=(a=n(0))&&a.__esModule?a:{default:a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,a,o){if(!e)throw new Error("getRGBPixels: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);var i=r.default.cornerstone.getEnabledElement(e),l=[],u=0,d=i.image.getPixelData(),s=void 0,c=void 0,f=void 0;if(i.image.color)for(c=0;c<o;c++)for(f=0;f<a;f++){var v=d[s=4*((c+n)*i.image.columns+(f+t))],m=d[s+1],g=d[s+2],h=d[s+3];l[u++]=v,l[u++]=m,l[u++]=g,l[u++]=h}return l};var a,r=(a=n(0))&&a.__esModule?a:{default:a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.width/2,a=e.height/2;if(n<=0||a<=0)return!1;var r=e.left+n,o=e.top+a,i=t.x-r,l=t.y-o;return i*i/(n*n)+l*l/(a*a)<=1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],l=(0,r.getToolState)(e,"stack");if(l&&l.data&&l.data.length){var u=l.data[0];u.pending||(u.pending=[]);var d=u.currentImageIdIndex+t;if(n?d%=u.imageIds.length:d=(0,o.default)(d,0,u.imageIds.length-1),i)(0,a.default)(e,d);else{var s={index:d};u.pending.push(s),function e(t,n,r){if(t.pending[0]===n){if(t.currentImageIdIndex===n.index)return t.pending.splice(t.pending.indexOf(n),1),void(t.pending.length>0&&e(t,t.pending[0],r));r.addEventListener(external.cornerstone.EVENTS.NEW_IMAGE,(function e(o){t.imageIds.indexOf(o.detail.image.imageId)===n.index&&(t.pending.splice(t.pending.indexOf(n),1),r.removeEventListener(external.cornerstone.EVENTS.NEW_IMAGE,e),t.pending.length>0&&function e(t,n,r){if(t.pending[0]===n){if(t.currentImageIdIndex===n.index)return t.pending.splice(t.pending.indexOf(n),1),void(t.pending.length>0&&e(t,t.pending[0],r));r.addEventListener(external.cornerstone.EVENTS.NEW_IMAGE,(function a(o){t.imageIds.indexOf(o.detail.image.imageId)===n.index&&(t.pending.splice(t.pending.indexOf(n),1),r.removeEventListener(external.cornerstone.EVENTS.NEW_IMAGE,a),t.pending.length>0&&e(t,t.pending[0],r))})),(0,a.default)(r,n.index)}}(t,t.pending[0],r))})),(0,a.default)(r,n.index)}}(u,s,e)}}};var a=i(n(66)),r=n(2),o=i(n(8));function i(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,r=(a=n(0))&&a.__esModule?a:{default:a},o=n(35),i={interaction:[],thumbnail:[],prefetch:[]},l={interaction:0,thumbnail:0,prefetch:0},u={interaction:6,thumbnail:6,prefetch:5},d=!1;function s(){d&&setTimeout((function(){f()}),20)}function c(e){var t=r.default.cornerstone,n=e.type;l[n]++,d=!0;var a=e.imageId,o=e.doneCallback,i=e.failCallback,u=t.imageCache.getImageLoadObject(a);if(u)u.promise.then((function(e){l[n]--,o(e),s()}),(function(e){l[n]--,i(e),s()}));else{var c=function(e){return"prefetch"===e.type?-5:"interactive"===e.type?0:"thumbnail"===e.type?5:void 0}(e);(!0===e.preventCache?t.loadImage(a,{priority:c,type:e.type}):t.loadAndCacheImage(a,{priority:c,type:e.type})).then((function(e){l[n]--,o(e),s()}),(function(e){l[n]--,i(e),s()}))}}function f(){var e=(0,o.getMaxSimultaneousRequests)();u={interaction:Math.max(e,1),thumbnail:Math.max(e-2,1),prefetch:Math.max(e-1,1)};for(var t=e-(l.interaction+l.thumbnail+l.prefetch),n=0;n<t;n++){var a=i.interaction.length&&l.interaction<u.interaction?i.interaction.shift():i.thumbnail.length&&l.thumbnail<u.thumbnail?i.thumbnail.shift():i.prefetch.length&&l.prefetch<u.prefetch?i.prefetch.shift():(i.interaction.length||i.thumbnail.length||i.prefetch.length||(d=!1),!1);a&&c(a)}}t.default={addRequest:function(e,t,n,a,o,l,u){if(!i.hasOwnProperty(n))throw new Error("Request type must be one of interaction, thumbnail, or prefetch");if(e&&t){var s={type:n,imageId:t,preventCache:a,doneCallback:o,failCallback:l},c=r.default.cornerstone.imageCache.getImageLoadObject(t);c?c.promise.then((function(e){o(e)}),(function(e){l(e)})):(u?i[n].unshift(s):i[n].push(s),d=!0)}},clearRequestStack:function(e){if(!i.hasOwnProperty(e))throw new Error("Request type must be one of interaction, thumbnail, or prefetch");i[e]=[]},startGrabbing:f,getRequestPool:function(){return i}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.projectPatientPointToImagePlane=function(e,t){var n=(0,r.default)(t.rowCosines),a=(0,r.default)(t.columnCosines),o=(0,r.default)(t.imagePositionPatient),i=e.clone().sub(o);return{x:n.dot(i)/t.columnPixelSpacing,y:a.dot(i)/t.rowPixelSpacing}},t.imagePointToPatientPoint=i,t.planePlaneIntersection=function(e,t){var n=(0,r.default)(e.rowCosines),o=(0,r.default)(e.columnCosines),l=(0,r.default)(e.imagePositionPatient),u=(0,r.default)(t.rowCosines),d=(0,r.default)(t.columnCosines),s=(0,r.default)(t.imagePositionPatient),c=n.clone().cross(o),f=new a.default.cornerstoneMath.Plane;f.setFromNormalAndCoplanarPoint(c,l);var v=u.clone().cross(d),m=new a.default.cornerstoneMath.Plane;m.setFromNormalAndCoplanarPoint(v,s);var g=m.clone().intersectPlane(f),h=g.origin,p=g.direction,E=i({x:t.columns,y:t.rows},t),y=s.distanceTo(E),b=new a.default.cornerstoneMath.Line3;b.start=h,b.end=h.clone().add(p.multiplyScalar(y));var T=function(e,t){var n=[];return Object.keys(t).forEach((function(a){var r=t[a],o=e.intersectLine(r);o&&n.push(o)})),n}(b,function(e){var t=i({x:0,y:0},e),n=i({x:e.columns,y:0},e),r=i({x:0,y:e.rows},e),o=i({x:e.columns,y:e.rows},e);return{top:new a.default.cornerstoneMath.Line3(t,n),left:new a.default.cornerstoneMath.Line3(t,r),right:new a.default.cornerstoneMath.Line3(n,o),bottom:new a.default.cornerstoneMath.Line3(r,o)}}(t));if(2===T.length)return{start:T[0],end:T[1]}};var a=o(n(0)),r=o(n(21));function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){var n=(0,r.default)(t.rowCosines),a=(0,r.default)(t.columnCosines),o=(0,r.default)(t.imagePositionPatient),i=n.clone().multiplyScalar(e.x);i.multiplyScalar(t.columnPixelSpacing||1);var l=a.clone().multiplyScalar(e.y);l.multiplyScalar(t.rowPixelSpacing||1);var u=i.add(l);return u.add(o),u}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=Math.round(a),i=Math.round(r);if(1===e)return[[o,i]];for(var l=[],u=0,d=-e;d<=e;d++){var s=i+d;if(!(s>t||s<0))for(var c=-e;c<=e;c++){var f=o+c;f>n||f<0||c*c+d*d<e*e&&(l[u++]=[o+c,i+d])}}return l}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.toolType;function n(e){var t=e.detail,n=!1;n=function(e){var t=e.keyCode,n=!1;return 109===t||173===t?(g(),n=!0):61!==t&&107!==t||(m(),n=!0),n}(t)||n,(n=function(e){var t=e.keyCode,n=!1;return 219===t?(p(),n=!0):221===t&&(h(),n=!0),n}(t)||n)&&r.default.cornerstone.updateImage(t.element)}function s(e){var t=M.getConfiguration(),n=r.default.cornerstone.colors.getColormap(t.colormapId);t.draw=e;var a=n.getColor(t.draw);t.hoverColor="rgba("+a[[0]]+", "+a[[1]]+", "+a[[2]]+", 1.0 )",t.dragColor="rgba("+a[[0]]+", "+a[[1]]+", "+a[[2]]+", 0.8 )"}function m(){var e=M.getConfiguration();e.radius=(0,d.default)(e.radius+1,e.minRadius,e.maxRadius)}function g(){var e=M.getConfiguration();e.radius=(0,d.default)(e.radius-1,e.minRadius,e.maxRadius)}function h(){var e=M.getConfiguration(),t=E(),n=e.draw+1;n===t&&(n=0),s(n)}function p(){var e=M.getConfiguration(),t=E(),n=e.draw-1;n<0&&(n=t-1),s(n)}function E(){var e=M.getConfiguration();return r.default.cornerstone.colors.getColormap(e.colormapId).getNumberOfColors()}function y(t){e.onMouseMove(t)}function b(t){var n=t.detail.element;e.onMouseUp(t),n.removeEventListener(a.default.MOUSE_DRAG,y),n.removeEventListener(a.default.MOUSE_DRAG,T),n.removeEventListener(a.default.MOUSE_UP,b),n.removeEventListener(a.default.MOUSE_CLICK,b)}function T(t){return e.onDrag(t),!1}function x(t){e.onMouseDoubleClick(t)}function w(n){var r=n.detail,o=r.element,i=(0,u.getToolOptions)(t,o);if((0,l.default)(r.which,i.mouseButtonMask))return o.addEventListener(a.default.MOUSE_DRAG,T),o.addEventListener(a.default.MOUSE_UP,b),o.addEventListener(a.default.MOUSE_CLICK,b),o.addEventListener(a.default.MOUSE_DOUBLE_CLICK,x),e.onMouseDown(n),!1;o.addEventListener(a.default.MOUSE_DRAG,y),o.addEventListener(a.default.MOUSE_UP,b)}function C(t){var n=t.detail,a=n.element,i=(0,o.getToolState)(a,c),l=void 0;i?l=i.data[0].pixelData:(l=new Uint8ClampedArray(n.image.width*n.image.height),(0,o.addToolState)(a,c,{pixelData:l}));var u=r.default.cornerstone.getLayer(n.element,f);u.image.setPixelData(l),u.invalid=!0,r.default.cornerstone.updateImage(a),e.onImageRendered(t)}var M=(0,i.default)({mouseMoveCallback:y,mouseDownActivateCallback:w,onImageRendered:C,deactivate:function(e){e.removeEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,C),e.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,w),e.removeEventListener(a.default.MOUSE_MOVE,y),e.removeEventListener(a.default.MOUSE_DOUBLE_CLICK,x),e.removeEventListener(a.default.KEY_DOWN,n),e.addEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,C),M.getConfiguration().active=!1}});return M.keyDownCallback=n,M.activate=function(e,i){(0,u.setToolOptions)(t,e,{mouseButtonMask:i}),e.removeEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,C),e.addEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,C),e.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,w),e.addEventListener(a.default.MOUSE_DOWN_ACTIVATE,w),e.removeEventListener(a.default.MOUSE_MOVE,y),e.addEventListener(a.default.MOUSE_MOVE,y),e.removeEventListener(a.default.KEY_DOWN,n),e.addEventListener(a.default.KEY_DOWN,n);var l=r.default.cornerstone.getEnabledElement(e),d=l.image,s=d.width,m=d.height,g=new Uint8ClampedArray(s*m),h=M.getConfiguration();h.active=!0;var p=h.colormapId;if(!p){var E=M.getConfiguration();(function(e){var t=r.default.cornerstone.colors.getColormap(e);t.setNumberOfColors(20),t.setColor(0,[255,255,255,0]),t.setColor(1,[230,25,75,102]),t.setColor(2,[60,180,175,102]),t.setColor(3,[255,225,25,102]),t.setColor(4,[0,130,200,102]),t.setColor(5,[245,130,48,102]),t.setColor(6,[145,30,180,102]),t.setColor(7,[70,240,240,102]),t.setColor(8,[240,50,230,102]),t.setColor(9,[210,245,60,102]),t.setColor(10,[250,190,190,102]),t.setColor(11,[0,128,128,102]),t.setColor(12,[230,190,255,102]),t.setColor(13,[170,110,40,102]),t.setColor(14,[255,250,200,102]),t.setColor(15,[128,0,0,102]),t.setColor(16,[170,255,195,102]),t.setColor(17,[128,128,0,102]),t.setColor(18,[255,215,180,102]),t.setColor(19,[0,0,128,102])})(p="BrushColorMap"),E.colormapId=p}var b={minPixelValue:0,maxPixelValue:1,slope:1,intercept:0,getPixelData:function(){return g},rows:l.image.height,columns:l.image.width,height:m,width:s,pixelData:g,setPixelData:function(e){g=e},colormap:p,color:!1,rgba:!1,labelmap:!0,invert:!1,columnPixelSpacing:1,rowPixelSpacing:1,sizeInBytes:l.image.width*l.image.height},T=void 0;v||(v=r.default.cornerstone.addLayer(e,r.default.cornerstone.getEnabledElement(e).image)),f&&(T=r.default.cornerstone.getLayer(e,f)),T||(f=r.default.cornerstone.addLayer(e,b,{viewport:{pixelReplication:!0}})),(0,o.addToolState)(e,c,{pixelData:g}),h.brushLayerId=f,M.setConfiguration(h),r.default.cornerstone.updateImage(e)},M.changeDrawColor=s,M.increaseRadius=m,M.decreaseRadius=g,M.nextSegmentation=h,M.previousSegmentation=p,M};var a=s(n(1)),r=s(n(0)),o=n(2),i=s(n(10)),l=s(n(5)),u=n(4),d=s(n(8));function s(e){return e&&e.__esModule?e:{default:e}}var c="brush",f=void 0,v=void 0},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{activate:function(t){t.removeEventListener(r.default.TOUCH_PINCH,e),t.addEventListener(r.default.TOUCH_PINCH,e)},disable:function(t){t.removeEventListener(r.default.TOUCH_PINCH,e)},enable:function(t){t.removeEventListener(r.default.TOUCH_PINCH,e)},deactivate:function(t){t.removeEventListener(r.default.TOUCH_PINCH,e)}}};var a,r=(a=n(1))&&a.__esModule?a:{default:a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.toolType;function m(r){var o=r.detail,i=o.element,l=(0,v.getToolOptions)(n,i);if((0,c.default)(o.which,l.mouseButtonMask))return function(r){var o=r.element,i=e.createNewMeasurement(r);i&&((0,f.addToolState)(r.element,n,i),o.removeEventListener(a.default.MOUSE_MOVE,g),(0,u.default)(r,n,i,i.handles.end,(function(){i.active=!1,(0,s.default)(r,i.handles)?(0,f.removeToolState)(r.element,n,i):e.onHandleDoneMove&&e.onHandleDoneMove(o,i),o.addEventListener(a.default.MOUSE_MOVE,g)}),t))}(o),!1}function g(t){var a=t.detail;o.default.setCoords(a);var i=(0,f.getToolState)(a.element,n);if(void 0!==i){for(var u=!1,d=a.currentPoints.canvas,s=0;s<i.data.length;s++){var c=i.data[s];!0===(0,l.default)(a.element,c.handles,d)&&(u=!0),(e.pointInsideRect(a.element,c,d)&&!c.active||!e.pointInsideRect(a.element,c,d)&&c.active)&&(c.active=!c.active,u=!0)}!0===u&&r.default.cornerstone.updateImage(a.element)}}function h(o){var l=o.detail,m=l.element,h=r.default.cornerstone,p=void 0,E=(0,v.getToolOptions)(n,m);if((0,c.default)(l.which,E.mouseButtonMask)){var y=l.startPoints.canvas,b=(0,f.getToolState)(o.currentTarget,n),T=void 0;if(void 0!==b)for(T=0;T<b.data.length;T++){p=b.data[T];var x=(0,i.default)(l.element,p.handles,y,25);if(void 0!==x)return m.removeEventListener(a.default.MOUSE_MOVE,g),p.active=!0,(0,u.default)(l,n,p,x,C,t),o.stopImmediatePropagation(),!1}var w={deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:t};if(void 0!==b&&void 0!==e.pointInsideRect)for(T=0;T<b.data.length;T++)if(p=b.data[T],e.pointInsideRect(l.element,p,y))return m.removeEventListener(a.default.MOUSE_MOVE,g),(0,d.default)(o,p,b,n,w,C),m.addEventListener(a.default.MOUSE_MOVE,g),o.stopImmediatePropagation(),!1}function C(){p.active=!1,(0,s.default)(l,p.handles)?(0,f.removeToolState)(l.element,n,p):e.onHandleDoneMove&&e.onHandleDoneMove(m,p),h.updateImage(l.element),m.addEventListener(a.default.MOUSE_MOVE,g)}}return{enable:function(t){t.removeEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),t.removeEventListener(a.default.MOUSE_MOVE,g),t.removeEventListener(a.default.MOUSE_DOWN,h),t.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,m),t.addEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),r.default.cornerstone.updateImage(t)},disable:function(t){t.removeEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),t.removeEventListener(a.default.MOUSE_MOVE,g),t.removeEventListener(a.default.MOUSE_DOWN,h),t.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,m),r.default.cornerstone.updateImage(t)},activate:function(t,o){(0,v.setToolOptions)(n,t,{mouseButtonMask:o}),t.removeEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),t.removeEventListener(a.default.MOUSE_MOVE,g),t.removeEventListener(a.default.MOUSE_DOWN,h),t.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,m),t.addEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),t.addEventListener(a.default.MOUSE_MOVE,g),t.addEventListener(a.default.MOUSE_DOWN,h),t.addEventListener(a.default.MOUSE_DOWN_ACTIVATE,m),r.default.cornerstone.updateImage(t)},deactivate:function(t,o){(0,v.setToolOptions)(n,t,{mouseButtonMask:o}),t.removeEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),t.removeEventListener(a.default.MOUSE_MOVE,g),t.removeEventListener(a.default.MOUSE_DOWN,h),t.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,m),t.addEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),t.addEventListener(a.default.MOUSE_MOVE,g),t.addEventListener(a.default.MOUSE_DOWN,h),r.default.cornerstone.updateImage(t)}}};var a=m(n(1)),r=m(n(0)),o=m(n(41)),i=m(n(27)),l=m(n(34)),u=m(n(33)),d=m(n(40)),s=m(n(16)),c=m(n(5)),f=n(2),v=n(4);function m(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.freehandSculpter=void 0;var a=m(n(1)),r=m(n(0)),o=n(25),i=m(n(7)),l=m(n(9)),u=m(n(5)),d=n(2),s=n(4),c=n(8),f=n(56),v=n(54);function m(e){return e&&e.__esModule?e:{default:e}}var g=new(n(95).Sculpter),h="freehandSculpter",p="freehand",E={mouseLocation:{handles:{start:{highlight:!0,active:!0}}},keyDown:{shift:!1,ctrl:!1,alt:!1},active:!1,minSpacing:5,maxSpacing:20,toolSizeImage:null,toolSizeCanvas:null,currentTool:null,color:i.default.getActiveColor()};function y(e){var t=e.detail,n=t.element,o=(0,s.getToolOptions)(h,n),i=I.getConfiguration(),l=!1;if(!(0,u.default)(t.which,o.mouseButtonMask))return e.stopPropagation(),void e.preventDefault();t.event.ctrlKey?(function(e){var t=I.getConfiguration(),n=e.element,a=new v.FreehandLineFinder(e).findTool();t.currentTool=a,function(e,t){for(var n=(0,d.getToolState)(e,p),a=0;a<n.data.length;a++)n.data[a].active=a===t}(n,a)}(t),l=!0):null!==i.currentTool&&(function(e){var t=I.getConfiguration(),n=e.element;(function(e){for(var t=I.getConfiguration(),n=t.currentTool,a=(0,d.getToolState)(e.element,p).data[n].handles,o=e.currentPoints.image,i=e.currentPoints.canvas,l=1/0,u=1/0,s=0;s<a.length;s++){var c=a[s],f=r.default.cornerstoneMath.point.distance(c,o);if(f<l){l=f;var v=r.default.cornerstone.pixelToCanvas(e.element,a[s]);u=r.default.cornerstoneMath.point.distance(v,i)}}t.toolSizeImage=l,t.toolSizeCanvas=u})(e),t.active=!0,C(e),n.addEventListener(a.default.MOUSE_UP,T),n.addEventListener(a.default.MOUSE_CLICK,T),n.addEventListener(a.default.MOUSE_DRAG,b)}(t),l=!0),l&&r.default.cornerstone.updateImage(t.element)}function b(e){var t=e.detail,n=(0,d.getToolState)(t.element,p);if(n){var a=I.getConfiguration(),o=n.data[a.currentTool].handles;C(t),g.sculpt(t,o),r.default.cornerstone.updateImage(t.element)}}function T(e){var t=e.detail,n=t.element,o=I.getConfiguration();n.removeEventListener(a.default.MOUSE_UP,T),n.removeEventListener(a.default.MOUSE_DRAG,b),n.removeEventListener(a.default.MOUSE_CLICK,T),o.active=!1,e.preventDefault(),e.stopPropagation(),function(e){var t=I.getConfiguration(),n=e.element;(0,d.getToolState)(n,p).data[t.currentTool].invalidated=!0,r.default.cornerstone.updateImage(n)}(t)}function x(e){w(e.detail.element)}function w(e){var t=I.getConfiguration(),n=(0,d.getToolState)(e,p);if(t.currentTool=null,n)for(var a=0;a<n.data.length;a++)n.data[a].active=!1;r.default.cornerstone.updateImage(e)}function C(e){var t=I.getConfiguration();t.mouseLocation.handles.start.x=e.currentPoints.image.x,t.mouseLocation.handles.start.y=e.currentPoints.image.y,(0,c.clipToBox)(t.mouseLocation.handles.start,e.image)}function M(e){var t=e.detail,n=t.canvasContext.canvas.getContext("2d"),a=I.getConfiguration();if(a.active){var r={fill:null,handleRadius:a.toolSizeCanvas};(0,l.default)(n,t,a.mouseLocation.handles,a.color,r)}}function S(e){w(e),O(e)}function O(e){e.removeEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,M),e.removeEventListener(a.default.MOUSE_DOWN,y),e.removeEventListener(a.default.MOUSE_DRAG,b),e.removeEventListener(a.default.MOUSE_UP,T),e.removeEventListener(a.default.KEY_DOWN,f.keyDownCallback),e.removeEventListener(a.default.KEY_UP,f.keyUpCallback),e.removeEventListener(r.default.cornerstone.EVENTS.NEW_IMAGE,x)}var I={enable:function(e){S(e)},disable:S,activate:function(e,t){(0,s.setToolOptions)(h,e,{mouseButtonMask:t}),o.freehand.enable(e),O(e),e.addEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,M),e.addEventListener(a.default.MOUSE_DOWN,y),e.addEventListener(a.default.KEY_DOWN,f.keyDownCallback),e.addEventListener(a.default.KEY_UP,f.keyUpCallback),e.addEventListener(r.default.cornerstone.EVENTS.NEW_IMAGE,x),e.focus(),r.default.cornerstone.updateImage(e)},deactivate:function(e){S(e)},getConfiguration:function(){return E},setConfiguration:function(e){E=e}};t.freehandSculpter=I},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FreehandLineFinder=void 0;var a,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=n(2),i=(a=n(0))&&a.__esModule?a:{default:a},l=n(99);t.FreehandLineFinder=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._eventData=t}return r(e,[{key:"findLine",value:function(){var e=this.findTool();if(null===e)return null;var t=this._getCloseLinesInTool(e);return t?this._findCorrectLine(e,t):null}},{key:"findTool",value:function(){return this._toolData=(0,o.getToolState)(this._eventData.element,"freehand"),this._mousePoint=this._eventData.currentPoints.canvas,this._toolData?this._nearestHandleToPointAllTools().toolIndex:null}},{key:"_nearestHandleToPointAllTools",value:function(){for(var e=this._toolData,t={toolIndex:null,handleIndex:null,distance:1/0},n=0;n<e.data.length;n++){var a=this._nearestHandleToPoint(n);null!==a&&a.distance<t.distance&&(t=a)}return t}},{key:"_nearestHandleToPoint",value:function(e){var t=this._eventData,n=this._toolData.data[e];if(void 0===n.handles)return null;if(!1===n.visible)return null;for(var a={toolIndex:e,handleIndex:null,distance:1/0},r=0;r<n.handles.length;r++){var o=i.default.cornerstone.pixelToCanvas(t.element,n.handles[r]),l=i.default.cornerstoneMath.point.distance(o,this._mousePoint);l<a.distance&&(a.handleIndex=r,a.distance=l)}return a}},{key:"_getCloseLinesInTool",value:function(t){for(var n=this._toolData.data[t].handles,a=[],r=0;r<n.length;r++){var o=e.getNextHandleIndex(r,n.length);this._distanceOfPointfromLine(n[r],n[o])<10&&a.push([r,o])}return a}},{key:"_findCorrectLine",value:function(e,t){for(var n=0;n<t.length;n++)if(this._pointProjectsToLineSegment(e,t[n]))return new l.ClickedLineData(e,t[n]);return null}},{key:"_pointProjectsToLineSegment",value:function(t,n){var a=this._eventData,r=this._toolData.data[t];if(void 0!==r.handles){if(!1===r.visible)return!1;var o=r.handles[n[0]],i=r.handles[n[1]],l=e.getCanvasPointsFromHandles(o,i,a.element),u=e.getLineAsVector(l),d=this._getLineOriginToMouseAsVector(l),s=(d[0]*u[0]+d[1]*u[1])/u.magnitude;return s>0&&s<u.magnitude}}},{key:"_getLineOriginToMouseAsVector",value:function(e){return[this._mousePoint.x-e[0].x,this._mousePoint.y-e[0].y]}},{key:"_distanceOfPointfromLine",value:function(e,t){var n=this._eventData,a=i.default.cornerstone.pixelToCanvas(n.element,e),r=i.default.cornerstone.pixelToCanvas(n.element,t),o=this._mousePoint;return Math.abs((r.y-a.y)*o.x-(r.x-a.x)*o.y+r.x*a.y-r.y*a.x)/i.default.cornerstoneMath.point.distance(a,r)}}],[{key:"getCanvasPointsFromHandles",value:function(e,t,n){var a=[];return e.x<t.x?(a.push(i.default.cornerstone.pixelToCanvas(n,e)),a.push(i.default.cornerstone.pixelToCanvas(n,t))):(a.push(i.default.cornerstone.pixelToCanvas(n,t)),a.push(i.default.cornerstone.pixelToCanvas(n,e))),a}},{key:"getLineAsVector",value:function(e){var t=[e[1].x-e[0].x,e[1].y-e[0].y];return t.magnitude=i.default.cornerstoneMath.point.distance(e[0],e[1]),t}},{key:"getNextHandleIndex",value:function(e,t){return e<t-1?e+1:0}}]),e}()},function(e,t,n){"use strict";function a(e,t,n,a){for(var i=e.length-1,l=0;l<e.length;l++)if(-1===a.indexOf(l)&&-1===a.indexOf(i)){if(r(t,n,o(e[i]),o(e[l])))return!0;i=l}else i=l;return!1}function r(e,t,n,a){var r=!1,o=[i(e,t,n),i(e,t,a),i(n,a,e),i(n,a,t)];return o[0]!==o[1]&&o[2]!==o[3]||((0===o[0]&&l(e,n,t)||0===o[1]&&l(e,a,t)||0===o[2]&&l(n,e,a)||0===o[3]&&l(n,t,a))&&(r=!0),r)}function o(e){return{x:e.x,y:e.y}}function i(e,t,n){var a=(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y);return 0===a?0:a>0?1:2}function l(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}Object.defineProperty(t,"__esModule",{value:!0});var u={newHandle:function(e,t){var n=t.length-1;return a(t,o(t[n]),o(e),[n])},end:function(e){var t=e.length-1;return a(e,o(e[t]),o(e[0]),[t,0])},modify:function(e,t){var n=o(e[t]),r=t-1;0===t&&(r=e.length-1);var i=o(e[r]);return!!a(e,n,i,[t,r])||a(e,n,i=o(e[r=t===e.length-1?0:t+1]),[t,r])}};t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.keyDownCallback=function(e){var t=e.detail,n=o.freehand.getConfiguration(),a=t.keyCode,l=!1;a===i.CTRL&&(n.keyDown.ctrl=!0,l=!0),a===i.SHIFT&&(n.keyDown.shift=!0),a===i.ALT&&(n.keyDown.alt=!0),l&&r.default.cornerstone.updateImage(t.element)},t.keyUpCallback=function(e){var t=e.detail,n=o.freehand.getConfiguration(),a=t.keyCode,l=!1;a===i.CTRL&&(n.keyDown.ctrl=!1,l=!0),a===i.SHIFT&&(n.keyDown.shift=!1),a===i.ALT&&(n.keyDown.alt=!1),l&&r.default.cornerstone.updateImage(t.element)};var a,r=(a=n(0))&&a.__esModule?a:{default:a},o=n(25),i={SHIFT:16,CTRL:17,ALT:18}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(!t)throw new Error("simpleTouchTool: toolType is required");var n={};return{activate:function(n){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,o.setToolOptions)(t,n,a),n.removeEventListener(r.default.TOUCH_START,e),n.addEventListener(r.default.TOUCH_START,e)},disable:function(t){t.removeEventListener(r.default.TOUCH_START,e)},enable:function(t){t.removeEventListener(r.default.TOUCH_START,e)},deactivate:function(t){t.removeEventListener(r.default.TOUCH_START,e)},getConfiguration:function(){return n},setConfiguration:function(e){n=e}}};var a,r=(a=n(1))&&a.__esModule?a:{default:a},o=n(4)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{activate:function(t){t.removeEventListener(r.default.DOUBLE_TAP,e),t.addEventListener(r.default.DOUBLE_TAP,e)},disable:function(t){t.removeEventListener(r.default.DOUBLE_TAP,e)},enable:function(t){t.removeEventListener(r.default.DOUBLE_TAP,e)},deactivate:function(t){t.removeEventListener(r.default.DOUBLE_TAP,e)}}};var a,r=(a=n(1))&&a.__esModule?a:{default:a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=0,r=1,o=void 0,i=void 0;function l(e,t){var n=Date.now();if(e!==o){if(n-i<=2e3)return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!1;o=e}i=n}var u=l.bind(null,a),d=l.bind(null,r);function s(e,t,n){var a=n?u:d;t.forEach((function(t){e.addEventListener(t,a)}))}function c(e,t,n){var a=n?u:d;t.forEach((function(t){e.removeEventListener(t,a)}))}var f=["mousedown","mouseup"],v=["touchstart","touchend"];function m(e){c(e,f,a),c(e,v,r)}var g={enable:function(e){m(e),s(e,f,a),s(e,v,r)},disable:m};t.default=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,i,d){l.value=!0;var s=e.detail,c=r.default.cornerstone,f=s.element,v=c.getEnabledElement(f),m=((new Date).getTime(),-57),g={x:s.currentPoints.page.x,y:s.currentPoints.page.y+m},h=c.pageToPixel(f,g.x,g.y);function p(e){var r=e.detail;l.value=!1,!1===i.hasMoved&&(i.hasMoved=!0),i.active=!0;var u=r.currentPoints,d={x:u.page.x,y:u.page.y+m};h=c.pageToPixel(f,d.x,d.y),i.x=h.x,i.y=h.y,c.updateImage(f);var s=a.default.MEASUREMENT_MODIFIED,v={toolType:t,element:f,measurementData:n};(0,o.default)(f,s,v)}function E(e){var t=e.detail;l.value=!1,i.active=!1,f.removeEventListener(a.default.TOUCH_DRAG,p),u.forEach((function(e){f.removeEventListener(e,E)})),c.updateImage(f),e.type===a.default.TOUCH_PRESS&&(t.handlePressed=n,i.x=s.currentPoints.image.x,i.y=s.currentPoints.image.y),"function"==typeof d&&d(e)}f.addEventListener(a.default.TOUCH_DRAG,p),u.forEach((function(e){f.addEventListener(e,E)})),function e(t,n,a,o,i){if(a.value){var l=r.default.cornerstone,u=((new Date).getTime(),Math.abs(n.y-i.y)),d=u/10;if(u<1)return n.y=i.y,void(a.value=!1);n.y>i.y?n.y-=d:n.y<i.y&&(n.y+=d),l.updateImage(o.element),l.requestAnimationFrame((function(){e(0,n,a,o,i)}))}}(0,i,l,v,h)};var a=i(n(1)),r=i(n(0)),o=i(n(6));function i(e){return e&&e.__esModule?e:{default:e}}var l={value:!1},u=[a.default.TOUCH_END,a.default.TOUCH_DRAG_END,a.default.TOUCH_PINCH,a.default.TOUCH_PRESS,a.default.TAP]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,u,d,s){var c=e.detail.element,f=r.default.cornerstone;function v(e){var n=e.detail;t.active=!0,Object.keys(t.handles).forEach((function(e){var a=t.handles[e];!0!==a.movesIndependently&&(a.x+=n.deltaPoints.image.x,a.y+=n.deltaPoints.image.y)})),f.updateImage(c);var r=a.default.MEASUREMENT_MODIFIED,o={toolType:u,element:c,measurementData:t};(0,l.default)(c,r,o),e.preventDefault(),e.stopPropagation()}function m(e){var n=e.detail;t.active=!1,t.invalidated=!1,c.removeEventListener(a.default.TOUCH_DRAG,v),c.removeEventListener(a.default.TOUCH_PINCH,m),c.removeEventListener(a.default.TOUCH_PRESS,m),c.removeEventListener(a.default.TOUCH_END,m),c.removeEventListener(a.default.TOUCH_DRAG_END,m),c.removeEventListener(a.default.TAP,m);var r=(0,o.default)(n,t.handles);!0===d&&!0===r&&(0,i.removeToolState)(c,u,t),f.updateImage(c),"function"==typeof s&&s(e)}return c.addEventListener(a.default.TOUCH_DRAG,v),c.addEventListener(a.default.TOUCH_PINCH,m),c.addEventListener(a.default.TOUCH_PRESS,m),c.addEventListener(a.default.TOUCH_END,m),c.addEventListener(a.default.TOUCH_DRAG_END,m),c.addEventListener(a.default.TAP,m),!0};var a=u(n(1)),r=u(n(0)),o=u(n(16)),i=n(2),l=u(n(6));function u(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={};return{activate:function(t){t.removeEventListener(r.default.KEY_DOWN,e),t.addEventListener(r.default.KEY_DOWN,e)},disable:function(t){t.removeEventListener(r.default.KEY_DOWN,e)},enable:function(t){t.removeEventListener(r.default.KEY_DOWN,e)},deactivate:function(t){t.removeEventListener(r.default.KEY_DOWN,e)},getConfiguration:function(){return t},setConfiguration:function(e){t=e}}};var a,r=(a=n(1))&&a.__esModule?a:{default:a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){for(var n=0,a=0,o=0,i=0,l=t.top;l<t.top+t.height;l++)for(var u=t.left;u<t.left+t.width;u++){var d={x:u,y:l};(0,r.default)(t,d)&&(n+=e[i],a+=e[i]*e[i],o++),i++}if(0===o)return{count:o,mean:0,variance:0,stdDev:0};var s=n/o,c=a/o-s*s;return{count:o,mean:s,variance:c,stdDev:Math.sqrt(c)}};var a,r=(a=n(44))&&a.__esModule?a:{default:a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,r,o){var i=Math.atan2(n.y-t.y,n.x-t.x),l={color:r,lineWidth:o};(0,a.drawLine)(e,void 0,t,n,l,"canvas"),l={color:r,lineWidth:o,fillStyle:r};var u=[{x:n.x-10*Math.cos(i-Math.PI/7),y:n.y-10*Math.sin(i-Math.PI/7)},{x:n.x-10*Math.cos(i+Math.PI/7),y:n.y-10*Math.sin(i+Math.PI/7)},n];(0,a.drawJoinedLines)(e,void 0,n,u,l,"canvas")};var a=n(3)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,a,o){if(!e)throw new Error("getLuminance: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);var i=r.default.cornerstone.getEnabledElement(e).image,l=[],u=0,d=i.getPixelData(),s=void 0,c=void 0,f=void 0;if(i.color)for(c=0;c<o;c++)for(f=0;f<a;f++){var v=d[s=4*((c+n)*i.columns+(f+t))],m=d[s+1],g=d[s+2];l[u++]=.2126*v+.7152*m+.0722*g}else for(c=0;c<o;c++)for(f=0;f<a;f++)s=(c+n)*i.columns+(f+t),l[u++]=d[s]*i.slope+i.intercept;return l};var a,r=(a=n(0))&&a.__esModule?a:{default:a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=(0,o.getToolState)(e,"stack");if(n&&n.data&&n.data.length){var d=r.default.cornerstone,s=void 0;if(n.data.length>1){var c=(0,o.getToolState)(e,"stackRenderer");c&&c.data&&c.data.length&&(s=c.data[0])}var f=n.data[0];t<0&&(t+=f.imageIds.length);var v=l.default.getStartLoadHandler(),m=l.default.getEndLoadHandler(),g=l.default.getErrorLoadingHandler();if(t!==f.currentImageIdIndex){v&&v(e);var h={newImageIdIndex:t,direction:t-f.currentImageIdIndex};f.currentImageIdIndex=t;var p=f.imageIds[t];(Boolean(f.preventCache)?d.loadImage(p):d.loadAndCacheImage(p)).then((function(a){if(f.currentImageIdIndex===t){try{d.getEnabledElement(e)}catch(e){return}s?(s.currentImageIdIndex=t,s.render(e,n.data)):d.displayImage(e,a),m&&m(e,a)}}),(function(n){var a=f.imageIds[t];g&&g(e,a,n)})),i.default.startGrabbing(),(0,u.default)(e,a.default.STACK_SCROLL,h)}}};var a=d(n(1)),r=d(n(0)),o=n(2),i=d(n(47)),l=d(n(13)),u=d(n(6));function d(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(n(144)),r=o(n(143));function o(e){return e&&e.__esModule?e:{default:e}}var i={getOrientationString:a.default,invertOrientationString:r.default};t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,u){var d=a.default.cornerstone,s=d.getEnabledElement(n).image,c=d.getEnabledElement(u).image;if(s&&c){var f=d.metaData.get("imagePlaneModule",s.imageId),v=d.metaData.get("imagePlaneModule",c.imageId);if(f&&v&&f.rowCosines&&f.columnCosines&&f.imagePositionPatient&&v.rowCosines&&v.columnCosines&&v.imagePositionPatient&&f.frameOfReferenceUID===v.frameOfReferenceUID){f.rowCosines=(0,i.default)(f.rowCosines),f.columnCosines=(0,i.default)(f.columnCosines),f.imagePositionPatient=(0,i.default)(f.imagePositionPatient),v.rowCosines=(0,i.default)(v.rowCosines),v.columnCosines=(0,i.default)(v.columnCosines),v.imagePositionPatient=(0,i.default)(v.imagePositionPatient);var m=f.rowCosines.clone().cross(f.columnCosines),g=v.rowCosines.clone().cross(v.columnCosines),h=m.angleTo(g);if(!((h=Math.abs(h))<.5)){var p=(0,r.default)(f,v);if(p){var E=o.default.getActiveColor();e.setTransform(1,0,0,1,0,0),(0,l.draw)(e,(function(e){(0,l.drawLine)(e,t.element,p.start,p.end,{color:E})}))}}}}};var a=u(n(0)),r=u(n(69)),o=u(n(7)),i=u(n(21)),l=n(3);function u(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=(0,a.planePlaneIntersection)(e,t);if(n)return{start:(0,a.projectPatientPointToImagePlane)(n.start,e),end:(0,a.projectPatientPointToImagePlane)(n.end,e)}};var a=n(48)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getToolOptions=t.setToolOptions=t.version=t.adaptiveBrush=t.brush=t.zoomTouchDrag=t.zoomTouchPinch=t.zoomWheel=t.zoom=t.wwwcRegionTouch=t.wwwcRegion=t.wwwcTouchDrag=t.wwwc=t.touchTool=t.touchPinchTool=t.touchDragTool=t.textMarkerTouch=t.textMarker=t.simpleMouseButtonTool=t.simpleAngleTouch=t.simpleAngle=t.seedAnnotateTouch=t.seedAnnotate=t.scaleOverlayTool=t.saveAs=t.rotateTouch=t.rotateTouchDrag=t.rotate=t.rectangleRoiTouch=t.rectangleRoi=t.probeTouch=t.probe=t.panMultiTouch=t.panTouchDrag=t.pan=t.orientationMarkers=t.multiTouchDragTool=t.mouseWheelTool=t.mouseButtonTool=t.mouseButtonRectangleTool=t.magnifyTouchDrag=t.magnify=t.lengthTouch=t.length=t.keyboardTool=t.imageStats=t.highlightTouch=t.highlight=t.freehandSculpter=t.freehand=t.eraserTouch=t.eraser=t.ellipticalRoiTouch=t.ellipticalRoi=t.dragProbeTouch=void 0,t.dragProbe=t.doubleTapZoom=t.doubleTapTool=t.displayTool=t.crosshairsTouch=t.crosshairs=t.arrowAnnotateTouch=t.arrowAnnotate=t.angleTouch=t.angle=t.touchInput=t.preventGhostClick=t.mouseWheelInput=t.mouseInput=t.keyboardInput=t.touchMoveHandle=t.touchMoveAllHandles=t.moveNewHandleTouch=t.moveNewHandle=t.moveHandle=t.moveAllHandles=t.handleActivator=t.getHandleNearImagePoint=t.drawHandles=t.anyHandlesOutsideImage=t.stopClip=t.playClip=t.stackRenderers=t.scrollIndicator=t.stackPrefetch=t.stackScrollMultiTouch=t.stackScrollTouchDrag=t.stackScrollWheel=t.stackScroll=t.stackScrollKeyboard=t.appState=t.globalFrameOfReferenceSpecificToolStateManager=t.newFrameOfReferenceSpecificToolStateManager=t.globalImageIdSpecificToolStateManager=t.newImageIdSpecificToolStateManager=t.loadHandlerManager=t.addStackStateManager=t.newStackSpecificToolStateManager=t.stackSpecificStateManager=t.textStyle=t.newTimeSeriesSpecificToolStateManager=t.addTimeSeriesStateManager=t.toolColors=t.toolCoordinates=t.getElementToolStateManager=t.setElementToolStateManager=t.clearToolState=t.removeToolState=t.getToolState=t.addToolState=t.toolStyle=t.panZoomSynchronizer=t.stackImageIndexSynchronizer=t.stackImagePositionOffsetSynchronizer=t.stackImagePositionSynchronizer=t.stackScrollSynchronizer=t.Synchronizer=t.updateImageSynchronizer=t.wwwcSynchronizer=t.timeSeriesScrollTouchDrag=t.timeSeriesScrollWheel=t.timeSeriesScroll=t.timeSeriesPlayer=t.incrementTimePoint=t.probeTool4D=t.calculateEllipseStatistics=t.calculateSUV=t.copyPoints=t.drawArrow=t.drawCircle=t.drawEllipse=t.drawTextBox=t.getLuminance=t.isMobileDevice=t.getBrowserInfo=t.getMaxSimultaneousRequests=t.getDefaultSimultaneousRequests=t.getRGBPixels=t.isMouseButtonEnabled=t.makeUnselectable=t.pointInEllipse=t.pointInsideBoundingBox=t.planePlaneIntersection=t.imagePointToPatientPoint=t.projectPatientPointToImagePlane=t.roundToDecimal=t.scroll=t.scrollToIndex=t.setContextToDisplayFontSize=t.requestPoolManager=t.orientation=t.referenceLines=t.EVENTS=t.external=t.drawing=void 0;var a=n(0);Object.defineProperty(t,"external",{enumerable:!0,get:function(){return lt(a).default}});var r=n(1);Object.defineProperty(t,"EVENTS",{enumerable:!0,get:function(){return lt(r).default}});var o=n(147);Object.defineProperty(t,"referenceLines",{enumerable:!0,get:function(){return lt(o).default}});var i=n(67);Object.defineProperty(t,"orientation",{enumerable:!0,get:function(){return lt(i).default}});var l=n(47);Object.defineProperty(t,"requestPoolManager",{enumerable:!0,get:function(){return lt(l).default}});var u=n(142);Object.defineProperty(t,"setContextToDisplayFontSize",{enumerable:!0,get:function(){return lt(u).default}});var d=n(66);Object.defineProperty(t,"scrollToIndex",{enumerable:!0,get:function(){return lt(d).default}});var s=n(46);Object.defineProperty(t,"scroll",{enumerable:!0,get:function(){return lt(s).default}});var c=n(45);Object.defineProperty(t,"roundToDecimal",{enumerable:!0,get:function(){return lt(c).default}});var f=n(48);Object.defineProperty(t,"projectPatientPointToImagePlane",{enumerable:!0,get:function(){return f.projectPatientPointToImagePlane}}),Object.defineProperty(t,"imagePointToPatientPoint",{enumerable:!0,get:function(){return f.imagePointToPatientPoint}}),Object.defineProperty(t,"planePlaneIntersection",{enumerable:!0,get:function(){return f.planePlaneIntersection}});var v=n(24);Object.defineProperty(t,"pointInsideBoundingBox",{enumerable:!0,get:function(){return lt(v).default}});var m=n(44);Object.defineProperty(t,"pointInEllipse",{enumerable:!0,get:function(){return lt(m).default}});var g=n(141);Object.defineProperty(t,"makeUnselectable",{enumerable:!0,get:function(){return lt(g).default}});var h=n(5);Object.defineProperty(t,"isMouseButtonEnabled",{enumerable:!0,get:function(){return lt(h).default}});var p=n(43);Object.defineProperty(t,"getRGBPixels",{enumerable:!0,get:function(){return lt(p).default}});var E=n(35);Object.defineProperty(t,"getDefaultSimultaneousRequests",{enumerable:!0,get:function(){return E.getDefaultSimultaneousRequests}}),Object.defineProperty(t,"getMaxSimultaneousRequests",{enumerable:!0,get:function(){return E.getMaxSimultaneousRequests}}),Object.defineProperty(t,"getBrowserInfo",{enumerable:!0,get:function(){return E.getBrowserInfo}}),Object.defineProperty(t,"isMobileDevice",{enumerable:!0,get:function(){return E.isMobileDevice}});var y=n(65);Object.defineProperty(t,"getLuminance",{enumerable:!0,get:function(){return lt(y).default}});var b=n(11);Object.defineProperty(t,"drawTextBox",{enumerable:!0,get:function(){return lt(b).default}});var T=n(140);Object.defineProperty(t,"drawEllipse",{enumerable:!0,get:function(){return lt(T).default}});var x=n(139);Object.defineProperty(t,"drawCircle",{enumerable:!0,get:function(){return lt(x).default}});var w=n(64);Object.defineProperty(t,"drawArrow",{enumerable:!0,get:function(){return lt(w).default}});var C=n(42);Object.defineProperty(t,"copyPoints",{enumerable:!0,get:function(){return lt(C).default}});var M=n(23);Object.defineProperty(t,"calculateSUV",{enumerable:!0,get:function(){return lt(M).default}});var S=n(63);Object.defineProperty(t,"calculateEllipseStatistics",{enumerable:!0,get:function(){return lt(S).default}});var O=n(138);Object.defineProperty(t,"probeTool4D",{enumerable:!0,get:function(){return lt(O).default}});var I=n(39);Object.defineProperty(t,"incrementTimePoint",{enumerable:!0,get:function(){return lt(I).default}});var _=n(135);Object.defineProperty(t,"timeSeriesPlayer",{enumerable:!0,get:function(){return lt(_).default}});var P=n(134);Object.defineProperty(t,"timeSeriesScroll",{enumerable:!0,get:function(){return P.timeSeriesScroll}}),Object.defineProperty(t,"timeSeriesScrollWheel",{enumerable:!0,get:function(){return P.timeSeriesScrollWheel}}),Object.defineProperty(t,"timeSeriesScrollTouchDrag",{enumerable:!0,get:function(){return P.timeSeriesScrollTouchDrag}});var L=n(133);Object.defineProperty(t,"wwwcSynchronizer",{enumerable:!0,get:function(){return lt(L).default}});var D=n(132);Object.defineProperty(t,"updateImageSynchronizer",{enumerable:!0,get:function(){return lt(D).default}});var j=n(131);Object.defineProperty(t,"Synchronizer",{enumerable:!0,get:function(){return lt(j).default}});var A=n(130);Object.defineProperty(t,"stackScrollSynchronizer",{enumerable:!0,get:function(){return lt(A).default}});var R=n(129);Object.defineProperty(t,"stackImagePositionSynchronizer",{enumerable:!0,get:function(){return lt(R).default}});var k=n(128);Object.defineProperty(t,"stackImagePositionOffsetSynchronizer",{enumerable:!0,get:function(){return lt(k).default}});var U=n(127);Object.defineProperty(t,"stackImageIndexSynchronizer",{enumerable:!0,get:function(){return lt(U).default}});var N=n(126);Object.defineProperty(t,"panZoomSynchronizer",{enumerable:!0,get:function(){return lt(N).default}});var H=n(14);Object.defineProperty(t,"toolStyle",{enumerable:!0,get:function(){return lt(H).default}});var V=n(2);Object.defineProperty(t,"addToolState",{enumerable:!0,get:function(){return V.addToolState}}),Object.defineProperty(t,"getToolState",{enumerable:!0,get:function(){return V.getToolState}}),Object.defineProperty(t,"removeToolState",{enumerable:!0,get:function(){return V.removeToolState}}),Object.defineProperty(t,"clearToolState",{enumerable:!0,get:function(){return V.clearToolState}}),Object.defineProperty(t,"setElementToolStateManager",{enumerable:!0,get:function(){return V.setElementToolStateManager}}),Object.defineProperty(t,"getElementToolStateManager",{enumerable:!0,get:function(){return V.getElementToolStateManager}});var B=n(41);Object.defineProperty(t,"toolCoordinates",{enumerable:!0,get:function(){return lt(B).default}});var z=n(7);Object.defineProperty(t,"toolColors",{enumerable:!0,get:function(){return lt(z).default}});var W=n(125);Object.defineProperty(t,"addTimeSeriesStateManager",{enumerable:!0,get:function(){return W.addTimeSeriesStateManager}}),Object.defineProperty(t,"newTimeSeriesSpecificToolStateManager",{enumerable:!0,get:function(){return W.newTimeSeriesSpecificToolStateManager}});var G=n(20);Object.defineProperty(t,"textStyle",{enumerable:!0,get:function(){return lt(G).default}});var F=n(124);Object.defineProperty(t,"stackSpecificStateManager",{enumerable:!0,get:function(){return F.stackSpecificStateManager}}),Object.defineProperty(t,"newStackSpecificToolStateManager",{enumerable:!0,get:function(){return F.newStackSpecificToolStateManager}}),Object.defineProperty(t,"addStackStateManager",{enumerable:!0,get:function(){return F.addStackStateManager}});var q=n(13);Object.defineProperty(t,"loadHandlerManager",{enumerable:!0,get:function(){return lt(q).default}});var Y=n(28);Object.defineProperty(t,"newImageIdSpecificToolStateManager",{enumerable:!0,get:function(){return Y.newImageIdSpecificToolStateManager}}),Object.defineProperty(t,"globalImageIdSpecificToolStateManager",{enumerable:!0,get:function(){return Y.globalImageIdSpecificToolStateManager}});var K=n(123);Object.defineProperty(t,"newFrameOfReferenceSpecificToolStateManager",{enumerable:!0,get:function(){return K.newFrameOfReferenceSpecificToolStateManager}}),Object.defineProperty(t,"globalFrameOfReferenceSpecificToolStateManager",{enumerable:!0,get:function(){return K.globalFrameOfReferenceSpecificToolStateManager}});var X=n(122);Object.defineProperty(t,"appState",{enumerable:!0,get:function(){return lt(X).default}});var Z=n(121);Object.defineProperty(t,"stackScrollKeyboard",{enumerable:!0,get:function(){return lt(Z).default}});var Q=n(120);Object.defineProperty(t,"stackScroll",{enumerable:!0,get:function(){return Q.stackScroll}}),Object.defineProperty(t,"stackScrollWheel",{enumerable:!0,get:function(){return Q.stackScrollWheel}}),Object.defineProperty(t,"stackScrollTouchDrag",{enumerable:!0,get:function(){return Q.stackScrollTouchDrag}}),Object.defineProperty(t,"stackScrollMultiTouch",{enumerable:!0,get:function(){return Q.stackScrollMultiTouch}});var J=n(119);Object.defineProperty(t,"stackPrefetch",{enumerable:!0,get:function(){return lt(J).default}});var $=n(118);Object.defineProperty(t,"scrollIndicator",{enumerable:!0,get:function(){return lt($).default}});var ee=n(117);Object.defineProperty(t,"stackRenderers",{enumerable:!0,get:function(){return lt(ee).default}});var te=n(115);Object.defineProperty(t,"playClip",{enumerable:!0,get:function(){return te.playClip}}),Object.defineProperty(t,"stopClip",{enumerable:!0,get:function(){return te.stopClip}});var ne=n(16);Object.defineProperty(t,"anyHandlesOutsideImage",{enumerable:!0,get:function(){return lt(ne).default}});var ae=n(9);Object.defineProperty(t,"drawHandles",{enumerable:!0,get:function(){return lt(ae).default}});var re=n(27);Object.defineProperty(t,"getHandleNearImagePoint",{enumerable:!0,get:function(){return lt(re).default}});var oe=n(34);Object.defineProperty(t,"handleActivator",{enumerable:!0,get:function(){return lt(oe).default}});var ie=n(40);Object.defineProperty(t,"moveAllHandles",{enumerable:!0,get:function(){return lt(ie).default}});var le=n(33);Object.defineProperty(t,"moveHandle",{enumerable:!0,get:function(){return lt(le).default}});var ue=n(32);Object.defineProperty(t,"moveNewHandle",{enumerable:!0,get:function(){return lt(ue).default}});var de=n(30);Object.defineProperty(t,"moveNewHandleTouch",{enumerable:!0,get:function(){return lt(de).default}});var se=n(61);Object.defineProperty(t,"touchMoveAllHandles",{enumerable:!0,get:function(){return lt(se).default}});var ce=n(60);Object.defineProperty(t,"touchMoveHandle",{enumerable:!0,get:function(){return lt(ce).default}});var fe=n(114);Object.defineProperty(t,"keyboardInput",{enumerable:!0,get:function(){return lt(fe).default}});var ve=n(113);Object.defineProperty(t,"mouseInput",{enumerable:!0,get:function(){return lt(ve).default}});var me=n(112);Object.defineProperty(t,"mouseWheelInput",{enumerable:!0,get:function(){return lt(me).default}});var ge=n(59);Object.defineProperty(t,"preventGhostClick",{enumerable:!0,get:function(){return lt(ge).default}});var he=n(111);Object.defineProperty(t,"touchInput",{enumerable:!0,get:function(){return lt(he).default}});var pe=n(110);Object.defineProperty(t,"angle",{enumerable:!0,get:function(){return pe.angle}}),Object.defineProperty(t,"angleTouch",{enumerable:!0,get:function(){return pe.angleTouch}});var Ee=n(109);Object.defineProperty(t,"arrowAnnotate",{enumerable:!0,get:function(){return Ee.arrowAnnotate}}),Object.defineProperty(t,"arrowAnnotateTouch",{enumerable:!0,get:function(){return Ee.arrowAnnotateTouch}});var ye=n(107);Object.defineProperty(t,"crosshairs",{enumerable:!0,get:function(){return ye.crosshairs}}),Object.defineProperty(t,"crosshairsTouch",{enumerable:!0,get:function(){return ye.crosshairsTouch}});var be=n(26);Object.defineProperty(t,"displayTool",{enumerable:!0,get:function(){return lt(be).default}});var Te=n(58);Object.defineProperty(t,"doubleTapTool",{enumerable:!0,get:function(){return lt(Te).default}});var xe=n(106);Object.defineProperty(t,"doubleTapZoom",{enumerable:!0,get:function(){return lt(xe).default}});var we=n(105);Object.defineProperty(t,"dragProbe",{enumerable:!0,get:function(){return we.dragProbe}}),Object.defineProperty(t,"dragProbeTouch",{enumerable:!0,get:function(){return we.dragProbeTouch}});var Ce=n(104);Object.defineProperty(t,"ellipticalRoi",{enumerable:!0,get:function(){return Ce.ellipticalRoi}}),Object.defineProperty(t,"ellipticalRoiTouch",{enumerable:!0,get:function(){return Ce.ellipticalRoiTouch}});var Me=n(103);Object.defineProperty(t,"eraser",{enumerable:!0,get:function(){return Me.eraser}}),Object.defineProperty(t,"eraserTouch",{enumerable:!0,get:function(){return Me.eraserTouch}});var Se=n(25);Object.defineProperty(t,"freehand",{enumerable:!0,get:function(){return Se.freehand}});var Oe=n(53);Object.defineProperty(t,"freehandSculpter",{enumerable:!0,get:function(){return Oe.freehandSculpter}});var Ie=n(94);Object.defineProperty(t,"highlight",{enumerable:!0,get:function(){return Ie.highlight}}),Object.defineProperty(t,"highlightTouch",{enumerable:!0,get:function(){return Ie.highlightTouch}});var _e=n(93);Object.defineProperty(t,"imageStats",{enumerable:!0,get:function(){return lt(_e).default}});var Pe=n(62);Object.defineProperty(t,"keyboardTool",{enumerable:!0,get:function(){return lt(Pe).default}});var Le=n(92);Object.defineProperty(t,"length",{enumerable:!0,get:function(){return Le.length}}),Object.defineProperty(t,"lengthTouch",{enumerable:!0,get:function(){return Le.lengthTouch}});var De=n(91);Object.defineProperty(t,"magnify",{enumerable:!0,get:function(){return De.magnify}}),Object.defineProperty(t,"magnifyTouchDrag",{enumerable:!0,get:function(){return De.magnifyTouchDrag}});var je=n(52);Object.defineProperty(t,"mouseButtonRectangleTool",{enumerable:!0,get:function(){return lt(je).default}});var Ae=n(10);Object.defineProperty(t,"mouseButtonTool",{enumerable:!0,get:function(){return lt(Ae).default}});var Re=n(31);Object.defineProperty(t,"mouseWheelTool",{enumerable:!0,get:function(){return lt(Re).default}});var ke=n(38);Object.defineProperty(t,"multiTouchDragTool",{enumerable:!0,get:function(){return lt(ke).default}});var Ue=n(90);Object.defineProperty(t,"orientationMarkers",{enumerable:!0,get:function(){return lt(Ue).default}});var Ne=n(89);Object.defineProperty(t,"pan",{enumerable:!0,get:function(){return Ne.pan}}),Object.defineProperty(t,"panTouchDrag",{enumerable:!0,get:function(){return Ne.panTouchDrag}});var He=n(88);Object.defineProperty(t,"panMultiTouch",{enumerable:!0,get:function(){return lt(He).default}});var Ve=n(87);Object.defineProperty(t,"probe",{enumerable:!0,get:function(){return Ve.probe}}),Object.defineProperty(t,"probeTouch",{enumerable:!0,get:function(){return Ve.probeTouch}});var Be=n(86);Object.defineProperty(t,"rectangleRoi",{enumerable:!0,get:function(){return Be.rectangleRoi}}),Object.defineProperty(t,"rectangleRoiTouch",{enumerable:!0,get:function(){return Be.rectangleRoiTouch}});var ze=n(85);Object.defineProperty(t,"rotate",{enumerable:!0,get:function(){return ze.rotate}}),Object.defineProperty(t,"rotateTouchDrag",{enumerable:!0,get:function(){return ze.rotateTouchDrag}});var We=n(84);Object.defineProperty(t,"rotateTouch",{enumerable:!0,get:function(){return lt(We).default}});var Ge=n(83);Object.defineProperty(t,"saveAs",{enumerable:!0,get:function(){return lt(Ge).default}});var Fe=n(82);Object.defineProperty(t,"scaleOverlayTool",{enumerable:!0,get:function(){return lt(Fe).default}});var qe=n(81);Object.defineProperty(t,"seedAnnotate",{enumerable:!0,get:function(){return qe.seedAnnotate}}),Object.defineProperty(t,"seedAnnotateTouch",{enumerable:!0,get:function(){return qe.seedAnnotateTouch}});var Ye=n(80);Object.defineProperty(t,"simpleAngle",{enumerable:!0,get:function(){return Ye.simpleAngle}}),Object.defineProperty(t,"simpleAngleTouch",{enumerable:!0,get:function(){return Ye.simpleAngleTouch}});var Ke=n(17);Object.defineProperty(t,"simpleMouseButtonTool",{enumerable:!0,get:function(){return lt(Ke).default}});var Xe=n(79);Object.defineProperty(t,"textMarker",{enumerable:!0,get:function(){return Xe.textMarker}}),Object.defineProperty(t,"textMarkerTouch",{enumerable:!0,get:function(){return Xe.textMarkerTouch}});var Ze=n(19);Object.defineProperty(t,"touchDragTool",{enumerable:!0,get:function(){return lt(Ze).default}});var Qe=n(51);Object.defineProperty(t,"touchPinchTool",{enumerable:!0,get:function(){return lt(Qe).default}});var Je=n(12);Object.defineProperty(t,"touchTool",{enumerable:!0,get:function(){return lt(Je).default}});var $e=n(78);Object.defineProperty(t,"wwwc",{enumerable:!0,get:function(){return $e.wwwc}}),Object.defineProperty(t,"wwwcTouchDrag",{enumerable:!0,get:function(){return $e.wwwcTouchDrag}});var et=n(77);Object.defineProperty(t,"wwwcRegion",{enumerable:!0,get:function(){return et.wwwcRegion}}),Object.defineProperty(t,"wwwcRegionTouch",{enumerable:!0,get:function(){return et.wwwcRegionTouch}});var tt=n(76);Object.defineProperty(t,"zoom",{enumerable:!0,get:function(){return tt.zoom}}),Object.defineProperty(t,"zoomWheel",{enumerable:!0,get:function(){return tt.zoomWheel}}),Object.defineProperty(t,"zoomTouchPinch",{enumerable:!0,get:function(){return tt.zoomTouchPinch}}),Object.defineProperty(t,"zoomTouchDrag",{enumerable:!0,get:function(){return tt.zoomTouchDrag}});var nt=n(75);Object.defineProperty(t,"brush",{enumerable:!0,get:function(){return nt.brush}});var at=n(72);Object.defineProperty(t,"adaptiveBrush",{enumerable:!0,get:function(){return at.adaptiveBrush}});var rt=n(71);Object.defineProperty(t,"version",{enumerable:!0,get:function(){return lt(rt).default}});var ot=n(4);Object.defineProperty(t,"setToolOptions",{enumerable:!0,get:function(){return ot.setToolOptions}}),Object.defineProperty(t,"getToolOptions",{enumerable:!0,get:function(){return ot.getToolOptions}});var it=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(3));function lt(e){return e&&e.__esModule?e:{default:e}}t.drawing=it},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="2.6.0"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.adaptiveBrush=void 0;var a=u(n(0)),r=n(2),o=u(n(50)),i=u(n(49)),l=n(36);function u(e){return e&&e.__esModule?e:{default:e}}var d="brush",s={draw:1,radius:5,tolerance:5,minRadius:1,maxRadius:20,hoverColor:"rgba(230, 25, 75, 1.0)",dragColor:"rgba(230, 25, 75, 0.8)",active:!1},c=void 0,f=void 0,v=void 0,m=void 0,g=void 0;function h(e){var t=E.getConfiguration(),n=e.element,o=a.default.cornerstone.getLayer(n,t.brushLayerId),u=a.default.cornerstone.getLayers(n)[0],s=o.image,g=s.rows,h=s.columns,p=(0,r.getToolState)(n,d).data[0];m=function(e,t,n,a){for(var r=E.getConfiguration(),o=r.draw,u=Math.round(c.x),d=Math.round(c.y),s=null,m=[],g=r.radius;0!==s&&g>r.minRadius;){s=0,m=(0,i.default)(g,n,a,u,d);for(var h=0;h<m.length;h++){var p=m[h][0],y=e[m[h][1]*a+p];if(y>f||y<v){s++;break}}g--}return 0===s&&(0,l.drawBrushPixels)(m,t,o,a),g}(u.image.getPixelData(),p.pixelData,g,h),o.invalid=!0,a.default.cornerstone.updateImage(n)}function p(e){var t=E.getConfiguration(),n=e.element,o=a.default.cornerstone.getLayer(n,t.brushLayerId),u=o.image,s=u.rows,c=u.columns,f=e.currentPoints.image,v=f.x,m=f.y,g=(0,r.getToolState)(n,d).data[0].pixelData,h=t.draw,p=t.radius;if(!(v<0||v>c||m<0||m>s)){var y=(0,i.default)(p,s,c,v,m);(0,l.drawBrushPixels)(y,g,h,c),o.invalid=!0,a.default.cornerstone.updateImage(n)}}var E=(0,o.default)({onMouseMove:function(e){var t=e.detail;c=t.currentPoints.image,a.default.cornerstone.updateImage(t.element)},onMouseDown:function(e){var t=e.detail,n=t.element,r=E.getConfiguration(),o=a.default.cornerstone.getLayer(n,r.brushLayerId),l=a.default.cornerstone.getLayers(n)[0],u=t.currentPoints.image,d=u.x,s=u.y,m=o.image,y=m.rows,b=m.columns,T=(0,i.default)(r.radius,y,b,d,s);0===r.draw?p(t):(function(e,t,n){var a=E.getConfiguration().tolerance,r=Number.MAX_VALUE,o=-Number.MAX_VALUE;e.forEach((function(e){var a=e[1]*n+e[0],i=t[a];r=Math.min(i,r),o=Math.max(i,o)})),v=r-a,f=o+a}(T,l.image.getPixelData(),b),h(t)),g=!0,c=t.currentPoints.image},onMouseUp:function(e){var t=e.detail;c=t.currentPoints.image;var n=E.getConfiguration();g=!1,m=n.radius,a.default.cornerstone.updateImage(t.element)},onDrag:function(e){var t=e.detail;0===s.draw?p(t):h(t),g=!0,c=t.currentPoints.image},toolType:"adaptiveBrush",onImageRendered:function(e){var t=e.detail;if(c){var n=t.image,a=n.rows,r=n.columns,o=c,u=o.x,d=o.y;if(!(u<0||u>r||d<0||d>a)){var s=E.getConfiguration(),f=t.canvasContext,v=g?s.dragColor:s.hoverColor,h=t.element;if(m=g&&m||s.radius,f.setTransform(1,0,0,1,0,0),s.active){var p=(0,i.default)(m,a,r,u,d);(0,l.drawBrushOnCanvas)(p,f,v,h)}}}}});E.setConfiguration(s),t.adaptiveBrush=E},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();t.Queue=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.store={},this.front=0,this.end=0}return a(e,[{key:"enqueue",value:function(e){this.store[this.end]=e,this.end++}},{key:"dequeue",value:function(){if(this.front===this.end)return null;var e=this.store[this.front];return delete this.store[this.front],this.front++,e}},{key:"size",value:function(){return this.end-this.front}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fillColor=t.isCircleInPolygon=t.connectEndsOfBrush=t.getEndOfCircle=void 0;var a=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(r)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=n(36),o=n(73);function i(e,t,n,a){for(var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=e;e<t?o<=t:o>=t;o+=e<t?1:-1){if(r&&n(a,o))return o;if(!r&&n(o,a))return o}return null}function l(e,t,n){return t[e]===n}function u(e,t,n,a,r,i){var u=e,d=t,s=0,c=new o.Queue,f=[],v=[0,1,0,-1],m=[-1,0,1,0],g=0,h=function(e,t){return t*n+e};c.enqueue({x:e,y:t});for(var p=0;p<a*n;p+=1)f.push(0);for(f[h(e,t)]=1;0!==c.size()&&g<=a*n;){g+=1;var E=c.dequeue(),y=h(E.x,E.y);if(s<f[y]){var b=[E.x,E.y,f[y]];u=b[0],d=b[1],s=b[2]}for(var T=0;T<4;T+=1){var x=E.y+m[T],w=E.x+v[T],C=h(w,x);x<0||x>=a||w<0||w>=n||l(C,r,i)&&0===f[C]&&(f[C]=f[y]+1,c.enqueue({x:w,y:x}))}}return{x:u,y:d}}function d(e,t,n){for(var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=[],o=e;e<t?o<=t:o>=t;o+=e<t?1:-1)r.push(a?[n,o]:[o,n]);return r}t.getEndOfCircle=function(e,t,n,a,r,o){var u=function(e,t){return t*n+e};return[i(t,0,(function(e,t){return!l(u(e,t-1),r,o)}),e,!0),i(e,n,(function(e,t){return!l(u(e+1,t),r,o)}),t,!1),i(t,a,(function(e,t){return!l(u(e,t+1),r,o)}),e,!0),i(e,0,(function(e,t){return!l(u(e-1,t),r,o)}),t,!1)]},t.connectEndsOfBrush=function(e,t,n,o,s,c,f){var v=function(e,t,a){return(0,r.drawBrushPixels)([[e,t]],c,a,n)},m=function(e,t){return(0,r.drawBrushPixels)(e,c,t,n)},g=function(e,t,n,a,r,o,u){for(var d=[0,1,0,-1],s=[-1,0,1,0],c=Number.MAX_SAFE_INTEGER,f=-1,v=void 0,m=void 0,g=void 0,h=function(e,t){return t*n+e},p=function(p){var E=void 0,y=void 0,b=void 0;if(p%2){if(E=t,null===(y=i(r[p]+d[p],1===p?n:0,(function(e,t){return l(h(e,t),o,u)}),E,!1)))return"continue";b=i(y+d[p],1===p?n:0,(function(e,t){return!l(h(e+d[p],t+s[p]),o,u)}),E,!1)}else{if(E=e,null===(y=i(r[p]+s[p],0===p?0:a,(function(e,t){return l(h(e,t),o,u)}),E,!0)))return"continue";b=i(y+s[p],0===p?0:a,(function(e,t){return!l(h(e+d[p],t+s[p]),o,u)}),E,!0)}var T=Math.abs(y-(p%2?e:t));c>T&&(c=T,f=p,v=E,m=y,g=b)},E=0;E<r.length;E++)p(E);return c===Number.MAX_SAFE_INTEGER?[null,null,null,null]:[f,v,m,g]}(e,t,n,o,s,c,f),h=a(g,4),p=h[0],E=h[1],y=h[2],b=h[3],T=[];if(null===p)return!1;if(m(d(y,b,E,!(p%2)),0),p%2){var x=u(y,E-1,n,o,c,f),w=u(y,E+1,n,o,c,f);T.push(x),T.push(w)}else{var C=u(E-1,y,n,o,c,f),M=u(E+1,y,n,o,c,f);T.push(C),T.push(M)}if(m(d(y,b,E,!(p%2)),f),T.sort((function(e,t){return e.x-t.x})),T[0].x===T[1].x)m(d(T[0].y,T[1].y,T[0].x,!0),f);else{var S=(T[1].y-T[0].y)/(T[1].x-T[0].x),O=T[0].y-S*T[0].x;if(Math.abs(S)>=1){T.sort((function(e,t){return e.y-t.y}));for(var I=T[0].y;I<=T[1].y;I+=1)for(var _=-0;_<=2;_+=1)v(Math.round((I-O)/S)+_,I,f)}else for(var P=T[0].x;P<=T[1].x;P+=1)for(var L=-0;L<=2;L+=1)v(P,Math.round(S*P+O)+L,f)}return!0},t.isCircleInPolygon=function(e,t,n,a,r,o,u){var d=function(e,t){return t*n+e},s=i(r[3]-1,0,(function(e,t){return l(d(e,t),o,u)}),t,!1),c=i(r[1]+1,n,(function(e,t){return l(d(e,t),o,u)}),t,!1);return s&&c},t.fillColor=function(e,t,n,a,i,u){var d=new o.Queue,s=[0,1,0,-1],c=[-1,0,1,0],f=0,v=function(e,t){return t*n+e},m=function(e,t,a){return(0,r.drawBrushPixels)([[e,t]],i,a,n)};for(d.enqueue({x:e,y:t}),m(e,t,u);0!==d.size()&&f<=a*n;){f+=1;for(var g=d.dequeue(),h=0;h<4;h+=1){var p=g.y+c[h],E=g.x+s[h];p<0||p>=a||E<0||E>=n||l(v(E,p),i,u)||(d.enqueue({x:E,y:p}),m(E,p,u))}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.brush=void 0;var a=d(n(0)),r=n(2),o=d(n(50)),i=d(n(49)),l=n(36),u=n(74);function d(e){return e&&e.__esModule?e:{default:e}}var s="brush",c=void 0,f=!1;function v(e){var t=m.getConfiguration(),n=e.element,o=a.default.cornerstone.getLayer(n,t.brushLayerId),u=o.image,d=u.rows,c=u.columns,f=e.currentPoints.image,v=f.x,g=f.y,h=(0,r.getToolState)(n,s).data[0].pixelData,p=t.draw,E=t.radius;if(!(v<0||v>c||g<0||g>d)){var y=(0,i.default)(E,d,c,v,g);(0,l.drawBrushPixels)(y,h,p,c),o.invalid=!0,a.default.cornerstone.updateImage(n)}}var m=(0,o.default)({onMouseMove:function(e){var t=e.detail;c=t.currentPoints.image,a.default.cornerstone.updateImage(t.element)},onMouseDown:function(e){var t=e.detail;v(t),f=!0,c=t.currentPoints.image},onMouseUp:function(e){var t=e.detail;c=t.currentPoints.image,f=!1},onDrag:function(e){var t=e.detail;v(t),f=!0,c=t.currentPoints.image},toolType:"brush",onImageRendered:function(e){var t=e.detail;if(c){var n=t.image,a=n.rows,r=n.columns,o=c,u=o.x,d=o.y;if(!(u<0||u>r||d<0||d>a)){var s=m.getConfiguration(),v=s.radius,g=t.canvasContext,h=f?s.dragColor:s.hoverColor,p=t.element;if(g.setTransform(1,0,0,1,0,0),s.active){var E=(0,i.default)(v,a,r,u,d);(0,l.drawBrushOnCanvas)(E,g,h,p)}}}},onMouseDoubleClick:function(e){!function(e){var t=m.getConfiguration(),n=t.radius,o=e.element,i=a.default.cornerstone.getLayer(o,t.brushLayerId),l=i.image,d=l.rows,c=l.columns,f=e.currentPoints.image,v=f.x,g=f.y,h=(0,r.getToolState)(o,s).data[0].pixelData,p=t.draw;if(!(v<0||v>c||g<0||g>d)){v=Math.round(v),g=Math.round(g);var E=(0,u.getEndOfCircle)(v,g,c,d,h,p);Math.abs(E[0]-E[2])>2*n&&Math.abs(E[1]-E[3])>2*n||((0,u.connectEndsOfBrush)(v,g,c,d,E,h,p)&&(0,u.isCircleInPolygon)(v,g,c,d,E,h,p)&&(0,u.fillColor)(v,E[0]-1,c,d,h,p),i.invalid=!0,a.default.cornerstone.updateImage(o))}}(e.detail)}});m.setConfiguration({draw:1,radius:5,minRadius:1,maxRadius:20,hoverColor:"rgba(230, 25, 75, 1.0)",dragColor:"rgba(230, 25, 75, 0.8)",active:!1}),t.brush=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.zoomTouchDrag=t.zoomTouchPinch=t.zoomWheel=t.zoom=void 0;var a=f(n(1)),r=f(n(0)),o=f(n(17)),i=f(n(5)),l=f(n(31)),u=f(n(51)),d=f(n(19)),s=n(4),c=n(8);function f(e){return e&&e.__esModule?e:{default:e}}var v="zoom",m=void 0;function g(e,t){var n=b.getConfiguration(),a=Math.log(e.scale)/Math.log(1.7)+t,r=Math.pow(1.7,a);return n.maxScale&&r>n.maxScale?e.scale=n.maxScale:n.minScale&&r<n.minScale?e.scale=n.minScale:e.scale=r,e}function h(e,t){if(t.hflip&&(e.x*=-1),t.vflip&&(e.y*=-1),0!==t.rotation){var n=t.rotation*Math.PI/180,a=Math.cos(n),r=Math.sin(n),o=e.x*a-e.y*r,i=e.x*r+e.y*a;e.x=o,e.y=i}return e}function p(e,t){var n=r.default.cornerstone,a=e.element,o=g(e.viewport,t);n.setViewport(a,o);var i=n.pageToPixel(a,e.startPoints.page.x,e.startPoints.page.y),l={x:e.startPoints.image.x-i.x,y:e.startPoints.image.y-i.y};l=h(l,o),o.translation.x-=l.x,o.translation.y-=l.y,n.setViewport(a,o)}function E(e){var t=e.detail.element;t.removeEventListener(a.default.MOUSE_DRAG,y),t.removeEventListener(a.default.MOUSE_UP,E),t.removeEventListener(a.default.MOUSE_CLICK,E)}function y(e){var t=e.detail;if(!t.deltaPoints.page.y)return!1;var n=t.deltaPoints.page.y/100,a=b.getConfiguration();a&&a.invert&&(n*=-1),b.strategy(t,n),e.preventDefault(),e.stopPropagation()}var b=(0,o.default)((function(e){var t=e.detail,n=t.element,r=(0,s.getToolOptions)(v,n);(0,i.default)(t.which,r.mouseButtonMask)&&(m=t.startPoints,n.addEventListener(a.default.MOUSE_DRAG,y),n.addEventListener(a.default.MOUSE_UP,E),n.addEventListener(a.default.MOUSE_CLICK,E),e.preventDefault(),e.stopPropagation())}),v);b.strategies={default:p,translate:function(e,t){var n=e.element,a=e.image,o=b.getConfiguration(),i=g(e.viewport,t),l={x:0,y:0};if(t<0)i.scale<3&&(Math.abs(i.translation.x)<.01?i.translation.x=0:l.x=i.translation.x/8,Math.abs(i.translation.y)<.01?i.translation.y=0:l.y=i.translation.y/8);else{o&&o.preventZoomOutsideImage&&(0,c.clipToBox)(m.image,a);var u={x:a.width/2-m.image.x,y:a.height/2-m.image.y};u=h(u,i);var d={x:i.translation.x-u.x,y:i.translation.y-u.y};Math.abs(d.x)<.01?i.translation.x=u.x:l.x=d.x/8,Math.abs(d.y)<.01?i.translation.y=u.y:l.y=d.y/8}i.translation.x-=l.x,i.translation.y-=l.y,r.default.cornerstone.setViewport(n,i)},zoomToCenter:function(e,t){var n=e.element,a=g(e.viewport,t);r.default.cornerstone.setViewport(n,a)}},b.strategy=p;var T=(0,l.default)((function(e){var t=e.detail,n=-t.direction/4,a=b.getConfiguration();a&&a.invert&&(n*=-1);var o=g(t.viewport,n);r.default.cornerstone.setViewport(t.element,o)})),x=(0,u.default)((function(e){var t=e.detail,n=r.default.cornerstone,a=b.getConfiguration(),o=t.viewport,i=t.element;o.scale+=t.scaleChange*o.scale,a.maxScale&&o.scale>a.maxScale?o.scale=a.maxScale:a.minScale&&o.scale<a.minScale&&(o.scale=a.minScale),n.setViewport(i,o);var l=n.pageToPixel(i,t.startPoints.page.x,t.startPoints.page.y),u={x:t.startPoints.image.x-l.x,y:t.startPoints.image.y-l.y};u=h(u,o),o.translation.x-=u.x,o.translation.y-=u.y,n.setViewport(i,o)})),w=(0,d.default)(y,v);t.zoom=b,t.zoomWheel=T,t.zoomTouchPinch=x,t.zoomTouchDrag=w},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wwwcRegionTouch=t.wwwcRegion=void 0;var a=f(n(1)),r=f(n(0)),o=f(n(7)),i=n(2),l=f(n(65)),u=f(n(5)),d=n(4),s=f(n(8)),c=n(3);function f(e){return e&&e.__esModule?e:{default:e}}var v="wwwcRegion",m={minWindowWidth:10};function g(e){var t=e.detail.element,n=(0,i.getToolState)(t,v);n&&n.data&&(n.data=[]),t.removeEventListener(a.default.MOUSE_MOVE,T),t.removeEventListener(a.default.MOUSE_DRAG,T),t.removeEventListener(a.default.MOUSE_UP,h),t.removeEventListener(a.default.MOUSE_CLICK,h),t.addEventListener(a.default.MOUSE_DOWN,y)}function h(e){var t=e.detail,n=t.element;n.removeEventListener(a.default.MOUSE_MOVE,T),n.removeEventListener(a.default.MOUSE_DRAG,T),n.removeEventListener(a.default.MOUSE_UP,h),n.removeEventListener(a.default.MOUSE_CLICK,h),n.addEventListener(a.default.MOUSE_DOWN,y);var r=(0,i.getToolState)(t.element,v);r&&r.data&&r.data.length&&(r.data[0].endPoint={x:t.currentPoints.image.x,y:t.currentPoints.image.y},p(t))}function p(e){var t=r.default.cornerstone,n=(0,i.getToolState)(e.element,v);if(n&&n.data&&n.data.length){var a=n.data[0].startPoint,o=n.data[0].endPoint,u=Math.abs(a.x-o.x),d=Math.abs(a.y-o.y),c=Math.min(a.x,o.x),f=Math.min(a.y,o.y);c=(0,s.default)(c,0,e.image.width),f=(0,s.default)(f,0,e.image.height),u=Math.floor(Math.min(u,Math.abs(e.image.width-c))),d=Math.floor(Math.min(d,Math.abs(e.image.height-f)));var m=function(e,t,n){var a=e.length;if(a<2)return{min:t,max:n,mean:(t+n)/2};for(var r=n,o=t,i=0,l=0;l<a;l++){var u=e[l];r=Math.min(r,u),o=Math.max(o,u),i+=u}return{min:r,max:o,mean:i/a}}((0,l.default)(e.element,c,f,u,d),e.image.minPixelValue,e.image.maxPixelValue),g=M.getConfiguration(),h=t.getViewport(e.element);void 0===g.minWindowWidth&&(g.minWindowWidth=10),h.voi.windowWidth=Math.max(Math.abs(m.max-m.min),g.minWindowWidth),h.voi.windowCenter=m.mean,t.setViewport(e.element,h),n.data=[],t.updateImage(e.element)}}function E(e){var t=e.detail.element;t.removeEventListener(a.default.MOUSE_MOVE,E),t.removeEventListener(a.default.MOUSE_DRAG,E),t.addEventListener(a.default.MOUSE_MOVE,T),t.addEventListener(a.default.MOUSE_DRAG,T),t.addEventListener(a.default.MOUSE_CLICK,h),e.type===a.default.MOUSE_DRAG&&t.addEventListener(a.default.MOUSE_UP,h)}function y(e){var t=e.detail,n=t.element,r=(0,d.getToolOptions)(v,n);if((0,u.default)(t.which,r.mouseButtonMask))return n.addEventListener(a.default.MOUSE_DRAG,E),n.addEventListener(a.default.MOUSE_MOVE,E),n.removeEventListener(a.default.MOUSE_DOWN,y),b(t),!1}function b(e){var t=(0,i.getToolState)(e.element,v);t&&t.data&&(t.data=[]);var n={startPoint:{x:e.currentPoints.image.x,y:e.currentPoints.image.y}};(0,i.addToolState)(e.element,v,n)}function T(e){var t=e.detail,n=t.element,a=(0,i.getToolState)(n,v);a&&a.data&&a.data.length&&(a.data[0].endPoint={x:t.currentPoints.image.x,y:t.currentPoints.image.y},r.default.cornerstone.updateImage(n))}function x(e){var t=e.detail,n=t.element,a=t.canvasContext,r=(0,i.getToolState)(t.element,v);if(r&&r.data&&r.data.length){var l=r.data[0].startPoint,u=r.data[0].endPoint;if(l&&u){a.setTransform(1,0,0,1,0,0);var d=o.default.getActiveColor(),s=M.getConfiguration();(0,c.draw)(a,(function(e){(0,c.setShadow)(e,s),(0,c.drawRect)(e,n,l,u,{color:d})}))}}}function w(e){e.removeEventListener(a.default.MOUSE_DOWN,y),e.removeEventListener(a.default.MOUSE_UP,h),e.removeEventListener(a.default.MOUSE_CLICK,h),e.removeEventListener(a.default.MOUSE_DRAG,T),e.removeEventListener(a.default.MOUSE_MOVE,T),e.removeEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,x),e.removeEventListener(r.default.cornerstone.EVENTS.NEW_IMAGE,g),r.default.cornerstone.updateImage(e)}function C(e){e.removeEventListener(a.default.TOUCH_DRAG,T),e.removeEventListener(a.default.TOUCH_START,b),e.removeEventListener(a.default.TOUCH_DRAG_END,p),e.removeEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,x)}var M={activate:function(e,t){(0,d.setToolOptions)(v,e,{mouseButtonMask:t}),(0,i.getToolState)(e,v)||(0,i.addToolState)(e,v,[]),e.removeEventListener(a.default.MOUSE_DOWN,y),e.removeEventListener(a.default.MOUSE_UP,h),e.removeEventListener(a.default.MOUSE_CLICK,h),e.removeEventListener(a.default.MOUSE_DRAG,T),e.removeEventListener(a.default.MOUSE_MOVE,T),e.removeEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,x),e.removeEventListener(r.default.cornerstone.EVENTS.NEW_IMAGE,g),e.addEventListener(a.default.MOUSE_DOWN,y),e.addEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,x),e.addEventListener(r.default.cornerstone.EVENTS.NEW_IMAGE,g),r.default.cornerstone.updateImage(e)},deactivate:w,disable:w,setConfiguration:function(e){m=e},getConfiguration:function(){return m}},S={activate:function(e){(0,i.getToolState)(e,v)||(0,i.addToolState)(e,v,[]),e.removeEventListener(a.default.TOUCH_DRAG,T),e.removeEventListener(a.default.TOUCH_START,b),e.removeEventListener(a.default.TOUCH_DRAG_END,p),e.removeEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,x),e.addEventListener(a.default.TOUCH_DRAG,T),e.addEventListener(a.default.TOUCH_START,b),e.addEventListener(a.default.TOUCH_DRAG_END,p),e.addEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,x)},deactivate:C,disable:C};t.wwwcRegion=M,t.wwwcRegionTouch=S},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wwwcTouchDrag=t.wwwc=void 0;var a=d(n(1)),r=d(n(0)),o=d(n(17)),i=d(n(19)),l=d(n(5)),u=n(4);function d(e){return e&&e.__esModule?e:{default:e}}var s="wwwc";function c(e){var t=e.detail.element;t.removeEventListener(a.default.MOUSE_DRAG,v),t.removeEventListener(a.default.MOUSE_UP,c),t.removeEventListener(a.default.MOUSE_CLICK,c)}function f(e){var t=(e.image.maxPixelValue*e.image.slope+e.image.intercept-(e.image.minPixelValue*e.image.slope+e.image.intercept))/1024,n=e.deltaPoints.page.x*t,a=e.deltaPoints.page.y*t;e.viewport.voi.windowWidth+=n,e.viewport.voi.windowCenter+=a}function v(e){var t=e.detail;m.strategy(t),r.default.cornerstone.setViewport(t.element,t.viewport)}var m=(0,o.default)((function(e){var t=e.detail,n=t.element,r=(0,u.getToolOptions)(s,n);(0,l.default)(t.which,r.mouseButtonMask)&&(n.addEventListener(a.default.MOUSE_DRAG,v),n.addEventListener(a.default.MOUSE_UP,c),n.addEventListener(a.default.MOUSE_CLICK,c),e.preventDefault(),e.stopPropagation())}),s);m.strategies={default:f},m.strategy=f;var g=(0,i.default)((function(e){var t=e.detail;e.stopImmediatePropagation();var n=t,a=(n.image.maxPixelValue*n.image.slope+n.image.intercept-(n.image.minPixelValue*n.image.slope+n.image.intercept))/1024,o=n.deltaPoints.page.x*a,i=n.deltaPoints.page.y*a,l=m.getConfiguration();l.orientation?0===l.orientation?(n.viewport.voi.windowWidth+=o,n.viewport.voi.windowCenter+=i):(n.viewport.voi.windowWidth+=i,n.viewport.voi.windowCenter+=o):(n.viewport.voi.windowWidth+=o,n.viewport.voi.windowCenter+=i),r.default.cornerstone.setViewport(n.element,n.viewport)}));t.wwwc=m,t.wwwcTouchDrag=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.textMarkerTouch=t.textMarker=void 0;var a=g(n(1)),r=g(n(0)),o=g(n(10)),i=g(n(12)),l=g(n(24)),u=g(n(7)),d=g(n(5)),s=n(11),c=g(s),f=n(2),v=n(4),m=n(3);function g(e){return e&&e.__esModule?e:{default:e}}var h="textMarker";function p(e){var t=b.getConfiguration();if(t.current){var n={visible:!0,active:!0,text:t.current,color:void 0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0,hasBoundingBox:!0}}},a={left:0,top:0,width:e.image.width,height:e.image.height};if(r.default.cornerstoneMath.point.insideRect(n.handles.end,a)){var o=t.markers.indexOf(t.current);return t.ascending?(o+=1)>=t.markers.length&&(t.loop?o-=t.markers.length:o=-1):(o-=1)<0&&(t.loop?o+=t.markers.length:o=-1),t.current=t.markers[o],n}}}function E(e,t,n){if(!1===t.visible)return!1;if(t.handles.end.boundingBox){var a=r.default.cornerstoneMath.rect.distanceToPoint(t.handles.end.boundingBox,n),o=(0,l.default)(t.handles.end,n);return a<10||o}}function y(e){var t=e.detail,n=(0,f.getToolState)(t.element,h);if(n)for(var a=(0,m.getNewContext)(t.canvasContext.canvas),o=b.getConfiguration(),i=function(e){var i=n.data[e];if(!1===i.visible)return"continue";var l=u.default.getColorIfActive(i);(0,m.draw)(a,(function(e){(0,m.setShadow)(e,o),i.textWidth=(0,s.textBoxWidth)(e,i.text,5);var n=r.default.cornerstone.pixelToCanvas(t.element,i.handles.end);i.handles.end.boundingBox=(0,c.default)(e,i.text,n.x,n.y-10,l,{centering:{x:!0,y:!0}})}))},l=0;l<n.data.length;l++)i(l)}var b=(0,o.default)({createNewMeasurement:p,onImageRendered:y,pointNearTool:E,toolType:h,mouseDoubleClickCallback:function(e){var t=e.detail,n=r.default.cornerstone,o=t.element,i=void 0,l=(0,v.getToolOptions)(h,o);if((0,d.default)(t.which,l.mouseButtonMask)){var u=b.getConfiguration(),s=t.currentPoints.canvas,c=(0,f.getToolState)(o,h);if(c){for(var m=0;m<c.data.length;m++)if(E(0,i=c.data[m],s))return i.active=!0,n.updateImage(o),o.removeEventListener(a.default.MOUSE_MOVE,b.mouseMoveCallback),o.removeEventListener(a.default.MOUSE_DOWN,b.mouseDownCallback),o.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,b.mouseDownActivateCallback),o.removeEventListener(a.default.MOUSE_DOUBLE_CLICK,b.mouseDoubleClickCallback),u.changeTextCallback(i,t,g),e.stopImmediatePropagation(),e.preventDefault(),void e.stopPropagation();e.preventDefault(),e.stopPropagation()}}function g(e,t,r){!0===r?(0,f.removeToolState)(o,h,e):e.text=t,e.active=!1,n.updateImage(o),o.addEventListener(a.default.MOUSE_MOVE,b.mouseMoveCallback),o.addEventListener(a.default.MOUSE_DOWN,b.mouseDownCallback),o.addEventListener(a.default.MOUSE_DOWN_ACTIVATE,b.mouseDownActivateCallback),o.addEventListener(a.default.MOUSE_DOUBLE_CLICK,b.mouseDoubleClickCallback)}}}),T=(0,i.default)({createNewMeasurement:p,onImageRendered:y,pointNearTool:E,toolType:h,pressCallback:function(e){var t=e.detail,n=r.default.cornerstone,o=t.element,i=void 0;function l(e,t,r){!0===r?(0,f.removeToolState)(o,h,e):e.text=t,e.active=!1,n.updateImage(o),o.addEventListener(a.default.TOUCH_DRAG,T.touchMoveCallback),o.addEventListener(a.default.TOUCH_START_ACTIVE,T.touchDownActivateCallback),o.addEventListener(a.default.TOUCH_START,T.touchStartCallback),o.addEventListener(a.default.TAP,T.tapCallback),o.addEventListener(a.default.TOUCH_PRESS,T.pressCallback)}var u=b.getConfiguration(),d=t.currentPoints.canvas,s=(0,f.getToolState)(o,h);if(!s)return!1;if(t.handlePressed)return t.handlePressed.active=!0,n.updateImage(o),o.removeEventListener(a.default.TOUCH_DRAG,T.touchMoveCallback),o.removeEventListener(a.default.TOUCH_START_ACTIVE,T.touchDownActivateCallback),o.removeEventListener(a.default.TOUCH_START,T.touchStartCallback),o.removeEventListener(a.default.TAP,T.tapCallback),o.removeEventListener(a.default.TOUCH_PRESS,T.pressCallback),u.changeTextCallback(t.handlePressed,t,l),e.stopImmediatePropagation(),e.preventDefault(),void e.stopPropagation();for(var c=0;c<s.data.length;c++)if(E(0,i=s.data[c],d))return i.active=!0,n.updateImage(o),o.removeEventListener(a.default.TOUCH_DRAG,T.touchMoveCallback),o.removeEventListener(a.default.TOUCH_START_ACTIVE,T.touchDownActivateCallback),o.removeEventListener(a.default.TOUCH_START,T.touchStartCallback),o.removeEventListener(a.default.TAP,T.tapCallback),o.removeEventListener(a.default.TOUCH_PRESS,T.pressCallback),u.changeTextCallback(i,t,l),e.stopImmediatePropagation(),e.preventDefault(),void e.stopPropagation();e.preventDefault(),e.stopPropagation()}});t.textMarker=b,t.textMarkerTouch=T},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.simpleAngleTouch=t.simpleAngle=void 0;var a=T(n(1)),r=T(n(0)),o=T(n(10)),i=T(n(45)),l=T(n(18)),u=T(n(14)),d=T(n(7)),s=T(n(16)),c=T(n(32)),f=T(n(30)),v=T(n(9)),m=T(n(12)),g=T(n(29)),h=n(2),p=n(3),E=n(11),y=T(n(15)),b=T(n(22));function T(e){return e&&e.__esModule?e:{default:e}}var x="simpleAngle";function w(e){return{visible:!0,active:!0,color:void 0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},middle:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function C(e,t,n){return!1!==t.visible&&((0,g.default)(e,t.handles.start,t.handles.middle,n)<25||(0,g.default)(e,t.handles.middle,t.handles.end,n)<25)}function M(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function S(e){var t=e.detail,n=(0,h.getToolState)(e.currentTarget,x);if(n)for(var a=r.default.cornerstone,o=t.enabledElement,i=(0,p.getNewContext)(t.canvasContext.canvas),s=u.default.getToolWidth(),c=_.getConfiguration(),f=function(e){var r=n.data[e];if(!1===r.visible)return"continue";(0,p.draw)(i,(function(e){(0,p.setShadow)(e,c);var n=d.default.getColorIfActive(r),i=a.pixelToCanvas(t.element,r.handles.start),u=a.pixelToCanvas(t.element,r.handles.middle);(0,p.drawJoinedLines)(e,t.element,r.handles.start,[r.handles.middle,r.handles.end],{color:n});var f={drawHandlesIfActive:c&&c.drawHandlesOnHover};if((0,v.default)(e,t,r.handles,n,f),I(r,t.image),r.rAngle){var m=function(e,t){var n=(0,b.default)(t),a=n.rowPixelSpacing,r=n.colPixelSpacing,o=a&&r?"":" (isotropic)";return e.unit=String.fromCharCode(parseInt("00B0",16))+o,e.rAngle.toString()+e.unit}(r,t.image),h=void 0;if(!r.handles.textBox.hasMoved){h={x:u.x,y:u.y};var y=(0,E.textBoxWidth)(e,m,5);u.x<i.x?h.x-=15+y:h.x+=15;var T=a.internal.getTransform(o);T.invert();var x=T.transformPoint(h.x,h.y);r.handles.textBox.x=x.x,r.handles.textBox.y=x.y}(0,l.default)(e,t.element,r.handles.textBox,m,r.handles,g,n,s,0,!0)}}))},m=0;m<n.data.length;m++)f(m);function g(e){return[e.start,e.middle,e.end]}}function O(e,t){I(t,r.default.cornerstone.getImage(e)),(0,y.default)(e,t,x)}function I(e,t){var n=(0,b.default)(t),a=n.rowPixelSpacing,r=n.colPixelSpacing;a=a||1,r=r||1;var o={x:(Math.ceil(e.handles.middle.x)-Math.ceil(e.handles.start.x))*r,y:(Math.ceil(e.handles.middle.y)-Math.ceil(e.handles.start.y))*a},l={x:(Math.ceil(e.handles.end.x)-Math.ceil(e.handles.middle.x))*r,y:(Math.ceil(e.handles.end.y)-Math.ceil(e.handles.middle.y))*a},u={x:(Math.ceil(e.handles.end.x)-Math.ceil(e.handles.start.x))*r,y:(Math.ceil(e.handles.end.y)-Math.ceil(e.handles.start.y))*a},d=M(o),s=M(l),c=M(u),f=Math.acos((Math.pow(d,2)+Math.pow(s,2)-Math.pow(c,2))/(2*d*s));f*=180/Math.PI,e.rAngle=(0,i.default)(f,2)}var _=(0,o.default)({createNewMeasurement:w,addNewMeasurement:function(e){var t=r.default.cornerstone,n=w(e),o=e.element;(0,h.addToolState)(o,x,n),o.removeEventListener(a.default.MOUSE_MOVE,_.mouseMoveCallback),o.removeEventListener(a.default.MOUSE_DRAG,_.mouseMoveCallback),o.removeEventListener(a.default.MOUSE_DOWN,_.mouseDownCallback),o.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,_.mouseDownActivateCallback),t.updateImage(o),(0,c.default)(e,x,n,n.handles.middle,(function(){if(n.active=!1,(0,s.default)(e,n.handles))return(0,h.removeToolState)(o,x,n),o.addEventListener(a.default.MOUSE_MOVE,_.mouseMoveCallback),o.addEventListener(a.default.MOUSE_DRAG,_.mouseMoveCallback),o.addEventListener(a.default.MOUSE_DOWN,_.mouseDownCallback),o.addEventListener(a.default.MOUSE_DOWN_ACTIVATE,_.mouseDownActivateCallback),void t.updateImage(o);n.handles.end.active=!0,t.updateImage(o),(0,c.default)(e,x,n,n.handles.end,(function(){n.active=!1,(0,s.default)(e,n.handles)?(0,h.removeToolState)(o,x,n):O(o,n),o.addEventListener(a.default.MOUSE_MOVE,_.mouseMoveCallback),o.addEventListener(a.default.MOUSE_DRAG,_.mouseMoveCallback),o.addEventListener(a.default.MOUSE_DOWN,_.mouseDownCallback),o.addEventListener(a.default.MOUSE_DOWN_ACTIVATE,_.mouseDownActivateCallback),t.updateImage(o)}))}))},onImageRendered:S,pointNearTool:C,toolType:x,onHandleDoneMove:O}),P=(0,m.default)({createNewMeasurement:w,addNewMeasurement:function(e){var t=r.default.cornerstone,n=w(e),o=e.element;(0,h.addToolState)(o,x,n),o.removeEventListener(a.default.TOUCH_DRAG,P.touchMoveCallback),o.removeEventListener(a.default.TOUCH_START_ACTIVE,P.touchDownActivateCallback),o.removeEventListener(a.default.TOUCH_START,P.touchStartCallback),o.removeEventListener(a.default.TAP,P.tapCallback),t.updateImage(o),(0,f.default)(e,x,n,n.handles.middle,(function(){if((0,s.default)(e,n.handles))return(0,h.removeToolState)(o,x,n),o.addEventListener(a.default.TOUCH_DRAG,P.touchMoveCallback),o.addEventListener(a.default.TOUCH_START,P.touchStartCallback),o.addEventListener(a.default.TOUCH_START_ACTIVE,P.touchDownActivateCallback),o.addEventListener(a.default.TAP,P.tapCallback),void t.updateImage(o);(0,f.default)(e,x,n,n.handles.end,(function(){(0,s.default)(e,n.handles)?((0,h.removeToolState)(o,x,n),t.updateImage(o)):O(o,n),o.addEventListener(a.default.TOUCH_DRAG,P.touchMoveCallback),o.addEventListener(a.default.TOUCH_START,P.touchStartCallback),o.addEventListener(a.default.TOUCH_START_ACTIVE,P.touchDownActivateCallback),o.addEventListener(a.default.TAP,P.tapCallback)}))}))},onImageRendered:S,pointNearTool:C,toolType:x,onHandleDoneMove:O});t.simpleAngle=_,t.simpleAngleTouch=P},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.seedAnnotateTouch=t.seedAnnotate=void 0;var a=b(n(1)),r=b(n(0)),o=b(n(10)),i=b(n(12)),l=b(n(20)),u=b(n(14)),d=b(n(7)),s=b(n(16)),c=b(n(33)),f=b(n(9)),v=b(n(5)),m=b(n(24)),g=b(n(18)),h=n(2),p=n(4),E=n(3),y=n(11);function b(e){return e&&e.__esModule?e:{default:e}}var T="seedAnnotate",x={getTextCallback:function(e){e(prompt("Enter your annotation:"))},changeTextCallback:function(e,t,n){n(prompt("Change your annotation:"))},drawHandles:!1,drawHandlesOnHover:!0,currentLetter:"A",currentNumber:0,showCoordinates:!0,countUp:!0};function w(e){return{visible:!0,active:!0,color:void 0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function C(e,t,n){if(!1===t.visible)return!1;if(t.handles.end){var a=r.default.cornerstone.pixelToCanvas(e,t.handles.end);return r.default.cornerstoneMath.point.distance(a,n)<25}}function M(e){var t=e.detail,n=(0,h.getToolState)(e.currentTarget,T);if(n)for(var a=r.default.cornerstone,o=t.enabledElement,i=(0,E.getNewContext)(t.canvasContext.canvas),s=t.canvasContext.canvas.width,c=u.default.getToolWidth(),v=S.getConfiguration(),m=function(e){var r=n.data[e];if(!1===r.visible)return"continue";(0,E.draw)(i,(function(e){(0,E.setShadow)(e,v);var n=d.default.getColorIfActive(r),i=a.pixelToCanvas(t.element,r.handles.end);(0,E.drawCircle)(e,t.element,r.handles.end,6,{color:n});var u={drawHandlesIfActive:v&&v.drawHandlesOnHover};if(v.drawHandles&&(0,f.default)(e,t,i,n,u),r.text&&""!==r.text){var m=function(e){return v.showCoordinates?e.text+" x: "+Math.round(e.handles.end.x)+" y: "+Math.round(e.handles.end.y):e.text}(r),h=(0,y.textBoxWidth)(e,m,5),p=l.default.getFontSize()+10,T=Math.max(h,p)/2+5;i.x>s/2&&(T=-T);var x=void 0;if(!r.handles.textBox.hasMoved){x={x:i.x-h/2+T,y:i.y-p/2};var w=a.internal.getTransform(o);w.invert();var C=w.transformPoint(x.x,x.y);r.handles.textBox.x=C.x,r.handles.textBox.y=C.y}(0,g.default)(e,t.element,r.handles.textBox,m,r.handles,b,n,c,0,!1)}}))},p=0;p<n.data.length;p++)m(p);function b(e){return[e.end]}}var S=(0,o.default)({addNewMeasurement:function(e){var t=r.default.cornerstone,n=e.element,a=S.getConfiguration(),o=w(e);function i(e){null===e?(0,h.removeToolState)(n,T,o):o.text=e,o.active=!1,t.updateImage(n)}(0,h.addToolState)(n,T,o),t.updateImage(n),(0,c.default)(e,T,o,o.handles.end,(function(){(0,s.default)(e,o.handles)&&(0,h.removeToolState)(n,T,o),void 0===o.text&&a.getTextCallback(i),t.updateImage(n)}))},createNewMeasurement:w,onImageRendered:M,pointNearTool:C,toolType:T,mouseDoubleClickCallback:function(e){var t=e.detail,n=r.default.cornerstone,a=t.element,o=void 0,i=(0,p.getToolOptions)(T,a);if((0,v.default)(t.which,i.mouseButtonMask)){var l=S.getConfiguration(),u=t.currentPoints.canvas,d=(0,h.getToolState)(a,T);if(d){for(var s=0;s<d.data.length;s++)if(o=d.data[s],C(a,o,u)||(0,m.default)(o.handles.textBox,u))return o.active=!0,n.updateImage(a),l.changeTextCallback(o,t,c),e.stopImmediatePropagation(),!1;e.preventDefault(),e.stopPropagation()}}function c(e,t,r){!0===r?(0,h.removeToolState)(a,T,e):e.text=t,e.active=!1,n.updateImage(a)}}});S.setConfiguration(x);var O=(0,i.default)({addNewMeasurement:function(e){var t=r.default.cornerstone,n=e.element,a=S.getConfiguration(),o=w(e);function i(e){null===e?(0,h.removeToolState)(n,T,o):o.text=e,o.active=!1,t.updateImage(n)}(0,h.addToolState)(n,T,o),t.updateImage(n),(0,c.default)(e,T,o,o.handles.end,(function(){(0,s.default)(e,o.handles)&&(0,h.removeToolState)(n,T,o),void 0===o.text&&a.getTextCallback(i),t.updateImage(n)}))},createNewMeasurement:w,onImageRendered:M,pointNearTool:C,toolType:T,pressCallback:function(e){var t=e.detail,n=r.default.cornerstone,o=t.element,i=void 0;function l(e,t,r){console.log("pressCallback doneChangingTextCallback"),!0===r?(0,h.removeToolState)(o,T,e):e.text=t,e.active=!1,n.updateImage(o),o.addEventListener(a.default.TOUCH_START,O.touchStartCallback),o.addEventListener(a.default.TOUCH_START_ACTIVE,O.touchDownActivateCallback),o.addEventListener(a.default.TAP,O.tapCallback)}var u=S.getConfiguration(),d=t.currentPoints.canvas,s=(0,h.getToolState)(o,T);if(!s)return!1;if(t.handlePressed)return o.removeEventListener(a.default.TOUCH_START,O.touchStartCallback),o.removeEventListener(a.default.TOUCH_START_ACTIVE,O.touchDownActivateCallback),o.removeEventListener(a.default.TAP,O.tapCallback),u.changeTextCallback(t.handlePressed,t,l),e.stopImmediatePropagation(),!1;for(var c=0;c<s.data.length;c++)if(i=s.data[c],C(o,i,d)||(0,m.default)(i.handles.textBox,d))return i.active=!0,n.updateImage(o),o.removeEventListener(a.default.TOUCH_START,O.touchStartCallback),o.removeEventListener(a.default.TOUCH_START_ACTIVE,O.touchDownActivateCallback),o.removeEventListener(a.default.TAP,O.tapCallback),u.changeTextCallback(i,t,l),e.stopImmediatePropagation(),!1;e.preventDefault(),e.stopPropagation()}});t.seedAnnotate=S,t.seedAnnotateTouch=O},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(n(26)),r=i(n(0)),o=n(3);function i(e){return e&&e.__esModule?e:{default:e}}function l(e,t,n,a,r){var o={left:0,top:0,width:t.width,height:t.height},i=a*Math.min(1e3,t.width),l=r*Math.min(1e3,t.height);return{topLeft:{x:(o={left:o.left+i,top:o.top+l,width:o.width-2*i,height:o.height-2*l}).left,y:o.top},bottomRight:{x:o.left+o.width,y:o.top+o.height}}}function u(e){var t=e.detail,n=(0,o.getNewContext)(t.canvasContext.canvas),a=t.image,i=t.viewport,u=r.default.cornerstone.metaData.get("imagePlaneModule",a.imageId),s=void 0,c=void 0;if(u?(s=u.rowPixelSpacing||u.rowImagePixelSpacing,c=u.columnPixelSpacing||u.colImagePixelSpacing):(s=a.rowPixelSpacing,c=a.columnPixelSpacing),s&&c){var f={width:n.canvas.width,height:n.canvas.height},v={width:a.width,height:a.height},m=10/s*i.scale,g=10/c*i.scale,h=l(0,f,0,.25,.05),p=l(0,f,0,.05,.15);if(f.width&&f.height&&v.width&&v.height&&h&&p){var E=d.getConfiguration(),y=Object.assign({},{hscaleBounds:h,vscaleBounds:p,verticalMinorTick:m,horizontalMinorTick:g,minorTickLength:12.5,majorTickLength:25,verticalLine:{start:{x:p.bottomRight.x,y:p.topLeft.y},end:{x:p.bottomRight.x,y:p.bottomRight.y}},horizontalLine:{start:{x:h.topLeft.x,y:h.bottomRight.y},end:{x:h.bottomRight.x,y:h.bottomRight.y}}},E),b={color:y.color,lineWidth:y.lineWidth},T=function(e){for(var t=0,n=[];e.verticalLine.start.y+t*e.verticalMinorTick<=e.vscaleBounds.bottomRight.y;){var a={x:e.verticalLine.start.x,y:e.verticalLine.start.y+t*e.verticalMinorTick},r={x:0,y:e.verticalLine.start.y+t*e.verticalMinorTick};r.x=t%5==0?e.verticalLine.start.x-e.majorTickLength:e.verticalLine.start.x-e.minorTickLength,n.push({start:a,end:r}),t++}return n}(y),x=function(e){for(var t=0,n=[];e.horizontalLine.start.x+t*e.horizontalMinorTick<=e.hscaleBounds.bottomRight.x;){var a={x:e.horizontalLine.start.x+t*e.horizontalMinorTick,y:e.horizontalLine.start.y},r={x:e.horizontalLine.start.x+t*e.horizontalMinorTick,y:0};r.y=t%5==0?e.horizontalLine.start.y-e.majorTickLength:e.horizontalLine.start.y-e.minorTickLength,n.push({start:a,end:r}),t++}return n}(y);(0,o.draw)(n,(function(e){e.shadowColor=y.shadowColor,e.shadowBlur=y.shadowBlur,(0,o.drawLine)(e,void 0,y.verticalLine.start,y.verticalLine.end,b,"canvas"),(0,o.drawLine)(e,void 0,y.horizontalLine.start,y.horizontalLine.end,b,"canvas"),(0,o.drawLines)(e,void 0,T,b,"canvas"),(0,o.drawLines)(e,void 0,x,b,"canvas")}))}}}var d=(0,a.default)(u);d.setConfiguration({color:"white",lineWidth:2,shadowColor:"black",shadowBlur:4}),d.disable=function(e){e.removeEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,u),r.default.cornerstone.updateImage(e)},t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",a=e.querySelector("canvas");if(a.msToBlob){var r=a.msToBlob();return window.navigator.msSaveBlob(r,t)}var o=document.createElement("a");if(o.download=t,o.href=a.toDataURL(n,1),document.createEvent){var i=document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),o.dispatchEvent(i)}else o.fireEvent&&o.fireEvent("onclick")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(n(1)),r=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function i(e){var t=e.detail;return t.viewport.rotation+=t.rotation,r.default.cornerstone.setViewport(t.element,t.viewport),!1}var l={activate:function(e){e.removeEventListener(a.default.TOUCH_ROTATE,i),e.addEventListener(a.default.TOUCH_ROTATE,i)},disable:function(e){e.removeEventListener(a.default.TOUCH_ROTATE,i)}};t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.rotateTouchDrag=t.rotate=void 0;var a=d(n(1)),r=d(n(0)),o=d(n(17)),i=d(n(57)),l=d(n(5)),u=n(4);function d(e){return e&&e.__esModule?e:{default:e}}var s="rotate";function c(e,t,n){var a=e.element.getBoundingClientRect(e.element),o=e.element.clientWidth,i=e.element.clientHeight,l=e.viewport.scale,u=e.viewport.translation,d=a.left+o/2+u.x*l,s=a.top+i/2+u.y*l,c=t,f=e.currentPoints.client.x,v=e.currentPoints.client.y,m=Math.sqrt(Math.pow(d-c.x,2)+Math.pow(s-c.y,2)),g=Math.sqrt(Math.pow(d-f,2)+Math.pow(s-v,2)),h=Math.sqrt(Math.pow(c.x-f,2)+Math.pow(c.y-v,2)),p=180*Math.acos((Math.pow(m,2)+Math.pow(g,2)-Math.pow(h,2))/(2*m*g))/Math.PI;(c.x-d)*(v-s)-(c.y-s)*(f-d)<0&&(p=-p),e.viewport.rotation=n+p,r.default.cornerstone.setViewport(e.element,e.viewport)}function f(e,t,n){var a=n.detail;v.strategy(a,e,t),r.default.cornerstone.setViewport(a.element,a.viewport),n.preventDefault(),n.stopPropagation()}var v=(0,o.default)((function(e){var t=e.detail,n=t.element,r=(0,u.getToolOptions)(s,n),o={x:t.currentPoints.client.x,y:t.currentPoints.client.y},i=t.viewport.rotation;if((0,l.default)(t.which,r.mouseButtonMask)){var d=f.bind({},o,i),c=function e(t){var n=t.detail.element;n.removeEventListener(a.default.MOUSE_DRAG,d),n.removeEventListener(a.default.MOUSE_UP,e),n.removeEventListener(a.default.MOUSE_CLICK,e)};n.addEventListener(a.default.MOUSE_DRAG,d),n.addEventListener(a.default.MOUSE_UP,c),n.addEventListener(a.default.MOUSE_CLICK,c),e.preventDefault(),e.stopPropagation()}}),s);v.strategies={default:c,horizontal:function(e){e.viewport.rotation+=e.deltaPoints.page.x/e.viewport.scale,r.default.cornerstone.setViewport(e.element,e.viewport)},vertical:function(e){e.viewport.rotation+=e.deltaPoints.page.y/e.viewport.scale,r.default.cornerstone.setViewport(e.element,e.viewport)}},v.strategy=c;var m=(0,i.default)((function(e){var t=e.detail,n=t.element,r={x:t.currentPoints.client.x,y:t.currentPoints.client.y},o=t.viewport.rotation,i=f.bind({},r,o);n.addEventListener(a.default.TOUCH_DRAG,i),n.addEventListener(a.default.TOUCH_END,(function e(t){var n=t.detail.element;n.removeEventListener(a.default.TOUCH_DRAG,i),n.removeEventListener(a.default.TOUCH_END,e)})),e.preventDefault(),e.stopPropagation()}),s);t.rotate=v,t.rotateTouchDrag=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.rectangleRoiTouch=t.rectangleRoi=void 0;var a=g(n(0)),r=g(n(10)),o=g(n(12)),i=g(n(14)),l=g(n(7)),u=g(n(9)),d=g(n(23)),s=g(n(15)),c=n(2),f=g(n(18)),v=n(3),m=g(n(22));function g(e){return e&&e.__esModule?e:{default:e}}var h="rectangleRoi";function p(e){return{visible:!0,active:!0,invalidated:!0,color:void 0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function E(e,t,n){if(!1===t.visible)return!1;var r=a.default.cornerstone,o=r.pixelToCanvas(e,t.handles.start),i=r.pixelToCanvas(e,t.handles.end),l={left:Math.min(o.x,i.x),top:Math.min(o.y,i.y),width:Math.abs(o.x-i.x),height:Math.abs(o.y-i.y)};return a.default.cornerstoneMath.rect.distanceToPoint(l,n)<5}function y(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}function b(e){var t=e.detail,n=(0,c.getToolState)(e.currentTarget,h);if(n){var r=a.default.cornerstone,o=t.image,d=t.element,s=i.default.getToolWidth(),g=w.getConfiguration(),p=r.metaData.get("generalSeriesModule",o.imageId),E=void 0,b=(0,m.default)(t.image),T=b.rowPixelSpacing,C=b.colPixelSpacing;p&&(E=p.modality);for(var M=(0,v.getNewContext)(t.canvasContext.canvas),S=function(e){var a=n.data[e];if(!1===a.visible)return"continue";(0,v.draw)(M,(function(e){(0,v.setShadow)(e,g);var n=l.default.getColorIfActive(a);(0,v.drawRect)(e,d,a.handles.start,a.handles.end,{color:n}),g&&g.drawHandlesOnHover?!0===a.active?(0,u.default)(e,t,a.handles,n):(0,u.default)(e,t,a.handles,n,{drawHandlesIfActive:!0}):(0,u.default)(e,t,a.handles,n),x(a,d,o,E,T,C);var r=function(e){var t=e.meanStdDev,n=e.meanStdDevSUV,a=e.area,r=[];if(t&&t.mean){var o="";"CT"===E&&(o=" HU");var i="Mean: "+y(t.mean.toFixed(2))+o,l="StdDev: "+y(t.stdDev.toFixed(2))+o;n&&void 0!==n.mean&&(i+=" SUV: "+y(n.mean.toFixed(2)),l+=" SUV: "+y(n.stdDev.toFixed(2))),r.push(i),r.push(l)}if(a){var u=" mm"+String.fromCharCode(178);T&&C||(u=" pixels"+String.fromCharCode(178));var d="Area: "+y(a.toFixed(2))+u;r.push(d)}return r}(a);a.handles.textBox.hasMoved||(a.handles.textBox.x=Math.max(a.handles.start.x,a.handles.end.x),a.handles.textBox.y=(a.handles.start.y+a.handles.end.y)/2),(0,f.default)(e,d,a.handles.textBox,r,a.handles,I,n,s,0,!0)}))},O=0;O<n.data.length;O++)S(O)}function I(e){var t=Math.min(e.start.x,e.end.x),n=Math.min(e.start.y,e.end.y),a=Math.abs(e.start.x-e.end.x),r=Math.abs(e.start.y-e.end.y);return[{x:t+a/2,y:n},{x:t,y:n+r/2},{x:t+a/2,y:n+r},{x:t+a,y:n+r/2}]}}function T(e,t){var n=a.default.cornerstone.getImage(e),r=a.default.cornerstone.metaData.get("generalSeriesModule",n.imageId),o=void 0,i=(0,m.default)(n),l=i.rowPixelSpacing,u=i.colPixelSpacing;r&&(o=r.modality),x(t,e,n,o,l,u),(0,s.default)(e,t,h)}function x(e,t,n,r,o,i){var l=a.default.cornerstone,u=void 0,s=void 0,c=void 0;if(!1===e.invalidated)s=e.meanStdDev,c=e.meanStdDevSUV,u=e.area;else{var f={left:Math.min(e.handles.start.x,e.handles.end.x),top:Math.min(e.handles.start.y,e.handles.end.y),width:Math.abs(e.handles.start.x-e.handles.end.x),height:Math.abs(e.handles.start.y-e.handles.end.y)};n.color||(s=function(e,t){for(var n=0,a=0,r=0,o=0,i=t.top;i<t.top+t.height;i++)for(var l=t.left;l<t.left+t.width;l++)n+=e[o],a+=e[o]*e[o],r++,o++;if(0===r)return{count:r,mean:0,variance:0,stdDev:0};var u=n/r,d=a/r-u*u;return{count:r,mean:u,variance:d,stdDev:Math.sqrt(d)}}(l.getPixels(t,f.left,f.top,f.width,f.height),f),"PT"===r&&(c={mean:(0,d.default)(n,(s.mean-n.intercept)/n.slope),stdDev:(0,d.default)(n,(s.stdDev-n.intercept)/n.slope)}),s&&!isNaN(s.mean)&&(e.meanStdDev=s,e.meanStdDevSUV=c)),u=f.width*(i||1)*(f.height*(o||1)),isNaN(u)||(e.area=u,e.unit="mm"+String.fromCharCode(178),o&&i||(e.unit="pixels"+String.fromCharCode(178))),e.invalidated=!1}}var w=(0,r.default)({createNewMeasurement:p,onImageRendered:b,pointNearTool:E,toolType:h,onHandleDoneMove:T}),C=(0,o.default)({createNewMeasurement:p,onImageRendered:b,pointNearTool:E,toolType:h,onHandleDoneMove:T});t.rectangleRoi=w,t.rectangleRoiTouch=C},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.probeTouch=t.probe=void 0;var a=g(n(15)),r=g(n(0)),o=g(n(10)),i=g(n(12)),l=g(n(7)),u=g(n(20)),d=g(n(9)),s=g(n(11)),c=g(n(43)),f=g(n(23)),v=n(2),m=n(3);function g(e){return e&&e.__esModule?e:{default:e}}var h="probe";function p(e){return{visible:!0,active:!0,color:void 0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}}}function E(e,t,n){if(!1===t.visible)return!1;var a=r.default.cornerstone.pixelToCanvas(e,t.handles.end);return r.default.cornerstoneMath.point.distance(a,n)<5}function y(e){var t=e.detail,n=(0,v.getToolState)(e.currentTarget,h);if(n)for(var a=r.default.cornerstone,o=(0,m.getNewContext)(t.canvasContext.canvas),i=u.default.getFontSize(),c=x.getConfiguration(),f=function(e){var r=n.data[e];if(!1===r.visible)return"continue";(0,m.draw)(o,(function(e){var n=l.default.getColorIfActive(r);if((0,d.default)(e,t,r.handles,n),(!c||!c.disableTextBox)&&(T(r,t.element,t.image),r.str&&r.text)){var o={x:r.handles.end.x+3,y:r.handles.end.y-3},u=a.pixelToCanvas(t.element,o);(0,s.default)(e,r.str,u.x,u.y+i+5,n),(0,s.default)(e,r.text,u.x,u.y,n)}}))},g=0;g<n.data.length;g++)f(g)}function b(e,t){T(t,e,r.default.cornerstone.getImage(e)),(0,a.default)(e,t,h)}function T(e,t,n){var a=Math.round(e.handles.end.x),o=Math.round(e.handles.end.y),i=void 0;if(a>=0&&o>=0&&a<n.columns&&o<n.rows)if(n.color)e.text=a+", "+o,i=(0,c.default)(t,a,o,1,1),e.str="R: "+i[0]+" G: "+i[1]+" B: "+i[2];else{var l=(i=r.default.cornerstone.getStoredPixels(t,a,o,1,1))[0],u=l*n.slope+n.intercept,d=(0,f.default)(n,l);e.text=a+", "+o,e.str="SP: "+l+" MO: "+parseFloat(u.toFixed(3)),d&&(e.str+=" SUV: "+parseFloat(d.toFixed(3)))}}var x=(0,o.default)({createNewMeasurement:p,onImageRendered:y,pointNearTool:E,toolType:h,onHandleDoneMove:b}),w=(0,i.default)({createNewMeasurement:p,onImageRendered:y,pointNearTool:E,toolType:h,onHandleDoneMove:b});t.probe=x,t.probeTouch=w},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(n(0));function r(e){return e&&e.__esModule?e:{default:e}}var o=(0,r(n(38)).default)((function(e){var t=e.detail,n=o.getConfiguration();n&&n.testPointers(t)&&(t.viewport.translation.x+=t.deltaPoints.page.x/t.viewport.scale,t.viewport.translation.y+=t.deltaPoints.page.y/t.viewport.scale,a.default.cornerstone.setViewport(t.element,t.viewport),e.preventDefault(),e.stopPropagation())}));o.setConfiguration({testPointers:function(e){return e.numPointers>=2}}),t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.panTouchDrag=t.pan=void 0;var a=d(n(1)),r=d(n(0)),o=d(n(17)),i=d(n(19)),l=d(n(5)),u=n(4);function d(e){return e&&e.__esModule?e:{default:e}}var s="pan";function c(e){var t=e.detail.element;t.removeEventListener(a.default.MOUSE_DRAG,f),t.removeEventListener(a.default.MOUSE_UP,c),t.removeEventListener(a.default.MOUSE_CLICK,c)}function f(e){var t=e.detail,n=t.viewport.scale,a=t.viewport.scale,o=t.image.columnPixelSpacing||1,i=t.image.rowPixelSpacing||1;i<o?n*=o/i:o<i&&(a*=i/o),t.viewport.translation.x+=t.deltaPoints.page.x/n,t.viewport.translation.y+=t.deltaPoints.page.y/a,r.default.cornerstone.setViewport(t.element,t.viewport),e.preventDefault(),e.stopPropagation()}var v=(0,o.default)((function(e){var t=e.detail,n=t.element,r=(0,u.getToolOptions)(s,n);(0,l.default)(t.which,r.mouseButtonMask)&&(n.addEventListener(a.default.MOUSE_DRAG,f),n.addEventListener(a.default.MOUSE_UP,c),n.addEventListener(a.default.MOUSE_CLICK,c),e.preventDefault(),e.stopPropagation())}),s),m=(0,i.default)(f,s);t.pan=v,t.panTouchDrag=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(n(0)),r=s(n(67)),o=s(n(26)),i=s(n(7)),l=n(11),u=s(l),d=n(3);function s(e){return e&&e.__esModule?e:{default:e}}var c=(0,o.default)((function(e){var t=e.detail,n=t.element,o=function(e){var t=a.default.cornerstone,n=t.getEnabledElement(e),o=t.metaData.get("imagePlaneModule",n.image.imageId);if(o&&o.rowCosines&&o.columnCosines){var i=r.default.getOrientationString(o.rowCosines),l=r.default.getOrientationString(o.columnCosines),u=r.default.invertOrientationString(i);return{top:r.default.invertOrientationString(l),bottom:l,left:u,right:i}}}(n);if(o){var s=function(e){var t=a.default.cornerstone,n=t.getEnabledElement(e),r=void 0;r={x:n.image.width/2,y:5};var o=t.pixelToCanvas(e,r);r={x:n.image.width/2,y:n.image.height-5};var i=t.pixelToCanvas(e,r);r={x:5,y:n.image.height/2};var l=t.pixelToCanvas(e,r);return r={x:n.image.width-10,y:n.image.height/2},{top:o,bottom:i,left:l,right:t.pixelToCanvas(e,r)}}(n),f=(0,d.getNewContext)(t.canvasContext.canvas),v=i.default.getToolColor(),m=(0,l.textBoxWidth)(f,o.top,0),g=(0,l.textBoxWidth)(f,o.left,0),h=(0,l.textBoxWidth)(f,o.right,0),p=(0,l.textBoxWidth)(f,o.bottom,0);(0,u.default)(f,o.top,s.top.x-m/2,s.top.y,v),(0,u.default)(f,o.left,s.left.x-g/2,s.left.y,v);var E=c.getConfiguration();E&&E.drawAllMarkers&&((0,u.default)(f,o.right,s.right.x-h/2,s.right.y,v),(0,u.default)(f,o.bottom,s.bottom.x-p/2,s.bottom.y,v))}}));t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.magnifyTouchDrag=t.magnify=void 0;var a=s(n(1)),r=s(n(0)),o=n(35),i=s(n(5)),l=n(4),u=n(8),d=n(3);function s(e){return e&&e.__esModule?e:{default:e}}var c="magnify",f={magnifySize:300,magnificationLevel:5},v=void 0,m=void 0,g=void 0;function h(e){var t=e.detail,n=t.element;n.removeEventListener(a.default.MOUSE_DRAG,T),n.removeEventListener(a.default.MOUSE_UP,h),n.removeEventListener(a.default.MOUSE_CLICK,h),p(t)}function p(e){e.element.querySelector(".magnifyTool").style.display="none",document.body.style.cursor="default",C()}function E(e){var t=e.detail,n=t.element,o=(0,l.getToolOptions)(c,n);(e.isTouchEvent||(0,i.default)(t.which,o.mouseButtonMask))&&(n.addEventListener(a.default.MOUSE_DRAG,T),n.addEventListener(a.default.TOUCH_DRAG,T),n.addEventListener(a.default.MOUSE_UP,h),n.addEventListener(a.default.TOUCH_END,h),n.addEventListener(a.default.MOUSE_CLICK,h),n.addEventListener(r.default.cornerstone.EVENTS.NEW_IMAGE,y),function(e){C();var t=e.enabledElement;void 0===t&&(t=r.default.cornerstone.getEnabledElement(e.element));var n=S.getConfiguration().magnificationLevel,a=t.canvas,o=t.image;(g=document.createElement("div")).width=a.width*n,g.height=a.height*n,r.default.cornerstone.enable(g,t.options);var i=r.default.cornerstone.getEnabledElement(g),l=r.default.cornerstone.getViewport(t.element);(m=i.canvas).width=a.width*n,m.height=a.height*n,i.viewport=Object.assign({},l),l.scale*=n,r.default.cornerstone.displayImage(g,o),r.default.cornerstone.setViewport(g,l)}(t),window.requestAnimationFrame((function(){return x(t)})),e.preventDefault(),e.stopPropagation())}function y(e){var t=e.detail;t.currentPoints=void 0,x(t)}function b(e){var t=e.detail,n=t.element;n.removeEventListener(a.default.TOUCH_DRAG_END,b),n.removeEventListener(a.default.TOUCH_END,b),n.removeEventListener(r.default.cornerstone.EVENTS.NEW_IMAGE,y),p(t)}function T(e){var t=e.detail,n=t.element;x(t),!0===t.isTouchEvent&&(n.addEventListener(a.default.TOUCH_DRAG_END,b),n.addEventListener(a.default.TOUCH_END,b)),e.preventDefault(),e.stopPropagation()}function x(e){var t=e.element,n=t.querySelector(".magnifyTool");if(n||w(e.element),void 0!==m){var a=S.getConfiguration(),o=a.magnifySize,i=a.magnificationLevel,l=t.querySelector("canvas:not(.magnifyTool)"),s=(0,d.getNewContext)(n),c=o,f=r.default.cornerstone.pixelToCanvas(e.element,e.currentPoints.image);(0,u.clipToBox)(f,l),s.clearRect(0,0,o,o);var g={left:0,top:0,width:o,height:o};(0,d.fillBox)(s,g,"transparent");var h={x:f.x*i-.5*c,y:f.y*i-.5*c};"Safari"===v&&(h.x=Math.max(h.x,0),h.y=Math.max(h.y,0)),h.x=Math.min(h.x,m.width),h.y=Math.min(h.y,m.height),s.drawImage(m,h.x,h.y,c,c,0,0,c,c),n.style.top=f.y-.5*o+"px",n.style.left=f.x-.5*o+"px",e.isTouchEvent&&(n.style.top=f.y-.5*o-120+"px"),n.style.display="block",document.body.style.cursor="none"}}function w(e){if(null===e.querySelector(".magnifyTool")){var t=document.createElement("canvas");t.classList.add("magnifyTool");var n=S.getConfiguration();t.width=n.magnifySize,t.height=n.magnifySize,t.style.position="absolute",t.style.display="none",e.appendChild(t)}}function C(){void 0!==g&&(r.default.cornerstone.disable(g),g=void 0,m=void 0)}function M(e){e.removeEventListener(a.default.MOUSE_DOWN,E),function(e){var t=e.querySelector(".magnifyTool");t&&e.removeChild(t)}(e)}var S={enable:function(e){var t=S.getConfiguration(t);if(!v){var n=(0,o.getBrowserInfo)().split(" ");v=n[0]}w(e)},activate:function(e,t){(0,l.setToolOptions)(c,e,{mouseButtonMask:t}),e.removeEventListener(a.default.MOUSE_DOWN,E),e.addEventListener(a.default.MOUSE_DOWN,E),w(e)},deactivate:M,disable:M,getConfiguration:function(){return f},setConfiguration:function(e){f=e}};function O(e){e.removeEventListener(a.default.TOUCH_START,E),e.addEventListener(a.default.TOUCH_START,E)}function I(e){e.removeEventListener(a.default.TOUCH_START,E)}var _={activate:O,deactivate:I,enable:O,disable:I};t.magnify=S,t.magnifyTouchDrag=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.lengthTouch=t.length=void 0;var a=g(n(0)),r=g(n(10)),o=g(n(12)),i=g(n(15)),l=g(n(18)),u=g(n(14)),d=g(n(7)),s=g(n(9)),c=n(2),f=g(n(29)),v=n(3),m=g(n(22));function g(e){return e&&e.__esModule?e:{default:e}}var h="length";function p(e){return{visible:!0,active:!0,color:void 0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function E(e,t,n){return!1!==t.visible&&(0,f.default)(e,t.handles.start,t.handles.end,n)<25}function y(e,t){var n=a.default.cornerstone.getImage(e),r=(0,m.default)(n);T(t,r.rowPixelSpacing,r.colPixelSpacing),(0,i.default)(e,t,h)}function b(e){var t=e.detail,n=(0,c.getToolState)(e.currentTarget,h);if(n)for(var a=(0,v.getNewContext)(t.canvasContext.canvas),r=t.element,o=u.default.getToolWidth(),i=x.getConfiguration(),f=(0,m.default)(t.image),g=f.rowPixelSpacing,p=f.colPixelSpacing,E=function(e){var u=n.data[e];if(!1===u.visible)return"continue";(0,v.draw)(a,(function(e){(0,v.setShadow)(e,i);var n=d.default.getColorIfActive(u);(0,v.drawLine)(e,r,u.handles.start,u.handles.end,{color:n});var a={drawHandlesIfActive:i&&i.drawHandlesOnHover};if((0,s.default)(e,t,u.handles,n,a),T(u,g,p),!u.handles.textBox.hasMoved){var c={x:Math.max(u.handles.start.x,u.handles.end.x)};c.x===u.handles.start.x?c.y=u.handles.start.y:c.y=u.handles.end.y,u.handles.textBox.x=c.x,u.handles.textBox.y=c.y}var f=function(e,t,n){var a=" mm";return t&&n||(a=" pixels"),e.unit=a.trim(),""+e.length.toFixed(2)+a}(u,g,p);(0,l.default)(e,r,u.handles.textBox,f,u.handles,b,n,o,10,!0)}))},y=0;y<n.data.length;y++)E(y);function b(e){var t={x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2};return[e.start,t,e.end]}}function T(e,t,n){var a=(e.handles.end.x-e.handles.start.x)*(n||1),r=(e.handles.end.y-e.handles.start.y)*(t||1),o=Math.sqrt(a*a+r*r);e.length=o}var x=(0,r.default)({createNewMeasurement:p,onImageRendered:b,pointNearTool:E,toolType:h,onHandleDoneMove:y}),w=(0,o.default)({createNewMeasurement:p,onImageRendered:b,pointNearTool:E,toolType:h,onHandleDoneMove:y});t.length=x,t.lengthTouch=w},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(n(26)),r=i(n(11)),o=n(3);function i(e){return e&&e.__esModule?e:{default:e}}var l=(0,a.default)((function(e){var t=e.detail,n=t.image.stats,a=(0,o.getNewContext)(t.canvasContext.canvas),i=[];Object.keys(n).forEach((function(e){var t=e+" : "+n[e];i.push(t)})),(0,r.default)(a,i,0,0,"orange"),i.forEach((function(e){console.log(e)}))}));t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.highlightTouch=t.highlight=void 0;var a=c(n(15)),r=c(n(0)),o=c(n(52)),i=c(n(12)),l=c(n(7)),u=c(n(9)),d=n(2),s=n(3);function c(e){return e&&e.__esModule?e:{default:e}}var f="highlight";function v(e){var t=(0,d.getToolState)(e.event.currentTarget,f);if(!(t&&t.data&&t.data.length>0))return{visible:!0,active:!0,color:void 0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}}}function m(e,t,n){var a=r.default.cornerstone,o=a.pixelToCanvas(e,t.handles.start),i=a.pixelToCanvas(e,t.handles.end),l=Math.min(o.x,i.x),u=Math.min(o.y,i.y),d=Math.abs(o.x-i.x),s=Math.abs(o.y-i.y),c=!1;return n.x>=l&&n.x<=l+d&&n.y>=u&&n.y<=u+s&&(c=!0),c}function g(e,t,n){if(!1===t.visible)return!1;var a=r.default.cornerstone,o=a.pixelToCanvas(e,t.handles.start),i=a.pixelToCanvas(e,t.handles.end),l={left:Math.min(o.x,i.x),top:Math.min(o.y,i.y),width:Math.abs(o.x-i.x),height:Math.abs(o.y-i.y)};return r.default.cornerstoneMath.rect.distanceToPoint(l,n)<5}function h(e){var t=e.detail,n=(0,d.getToolState)(e.currentTarget,f);if(void 0!==n){var a=(0,s.getNewContext)(t.canvasContext.canvas),r=n.data[0];!1!==r.visible&&r&&(0,s.draw)(a,(function(e){var n={color:"transparent",fillStyle:"rgba(0,0,0,0.7)"};(0,s.fillOutsideRect)(e,t.element,r.handles.start,r.handles.end,n);var a=l.default.getColorIfActive(r);n={color:a,lineDash:[4]},(0,s.drawRect)(e,t.element,r.handles.start,r.handles.end,n),(0,u.default)(e,t,r.handles,a)}))}}function p(e,t){(0,a.default)(e,t,f)}var E=(0,o.default)({createNewMeasurement:v,onImageRendered:h,pointNearTool:g,pointInsideRect:m,toolType:f,onHandleDoneMove:p},!0),y=(0,i.default)({createNewMeasurement:v,onImageRendered:h,pointNearTool:g,pointInsideRect:m,toolType:f,onHandleDoneMove:p},!0);t.highlight=E,t.highlightTouch=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sculpter=void 0;var a,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=(a=n(0))&&a.__esModule?a:{default:a},i=n(53),l=n(37),u=n(8);t.Sculpter=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,[{key:"sculpt",value:function(e,t){this._setData(e,t),this._pushHandles(),this._insertNewHandles(),this._consolidateHandles()}},{key:"_setData",value:function(e,t){var n=i.freehandSculpter.getConfiguration();this._eventData=e,this._element=e.element,this._image=e.image,this._mousePoint=e.currentPoints.image,this._dataHandles=t,this._toolSize=n.toolSizeImage,this._minSpacing=n.minSpacing,this._maxSpacing=n.maxSpacing}},{key:"_pushHandles",value:function(){for(var e=this._dataHandles,t=this._mousePoint,n=this._toolSize,a=0;a<e.length;a++){var r=o.default.cornerstoneMath.point.distance(e[a],t);r<n&&this._pushOneHandle(a,r)}}},{key:"_pushOneHandle",value:function(t,n){var a=this._dataHandles,r=a[t],o=this._mousePoint,i=this._toolSize,l=(r.x-o.x)/n,d=(r.y-o.y)/n,s={x:o.x+i*l,y:o.y+i*d};(0,u.clipToBox)(s,this._image),r.x=s.x,r.y=s.y;var c=e.getPreviousHandleIndex(t,a.length);a[c].lines.pop(),a[c].lines.push(r)}},{key:"_insertNewHandles",value:function(){for(var e=this._findNewHandleIndicies(),t=0,n=0;n<e.length;n++){var a=e[n]+1+t;this._insertHandleRadially(a),t++}}},{key:"_findNewHandleIndicies",value:function(){for(var t=this._dataHandles,n=[],a=0;a<t.length;a++){var r=o.default.cornerstone.pixelToCanvas(this._element,t[a]),i=e.getNextHandleIndex(a,t.length),l=o.default.cornerstone.pixelToCanvas(this._element,t[i]);o.default.cornerstoneMath.point.distance(r,l)>this._maxSpacing&&n.push(a)}return n}},{key:"_insertHandleRadially",value:function(t){var n=this._dataHandles,a=t-1,r=e.getNextHandleIndexBeforeInsert(t,n.length),o=this._getInsertPosition(t,a,r),i=new l.FreehandHandleData(o);n.splice(t,0,i),n[a].lines.pop(),n[a].lines.push(n[t]),t===n.length-1?n[t].lines.push(n[0]):n[t].lines.push(n[t+1])}},{key:"_getInsertPosition",value:function(e,t,n){var a=this._toolSize,r=this._mousePoint,i=this._dataHandles,l={x:(i[t].x+i[n].x)/2,y:(i[t].y+i[n].y)/2},d=o.default.cornerstoneMath.point.distance(r,l),s=void 0;if(d<a){var c={x:(l.x-r.x)/d,y:(l.y-r.y)/d};s={x:r.x+a*c.x,y:r.y+a*c.y}}else s=l;return(0,u.clipToBox)(s,this._image),s}},{key:"_consolidateHandles",value:function(){if(this._dataHandles.length>3){var e=this._findCloseHandlePairs();this._mergeCloseHandles(e)}}},{key:"_mergeCloseHandles",value:function(t){for(var n=0,a=0;a<t.length;a++){var r=e.getCorrectedPair(t[a],n);this._combineHandles(r),n++}var o=this._findCloseHandlePairs();o.length&&this._mergeCloseHandles(o)}},{key:"_findCloseHandlePairs",value:function(){for(var t=this._dataHandles,n=this._element,a=[],r=t.length,i=0;i<r;i++){var l=o.default.cornerstone.pixelToCanvas(n,t[i]),u=e.getNextHandleIndex(i,t.length),d=o.default.cornerstone.pixelToCanvas(n,t[u]);if(o.default.cornerstoneMath.point.distance(l,d)<this._minSpacing){var s=[i,u];a.push(s),0===i&&(r-=1),i++}}return a}},{key:"_combineHandles",value:function(t){var n=this._dataHandles,a={x:(n[t[0]].x+n[t[1]].x)/2,y:(n[t[0]].y+n[t[1]].y)/2};(0,u.clipToBox)(a,this._image),n[t[0]].x=a.x,n[t[0]].y=a.y;var r=e.getNextHandleIndex(t[1],n.length);n[t[0]].lines.pop(),n[t[0]].lines.push(n[r]),n.splice(t[1],1)}}],[{key:"getNextHandleIndex",value:function(e,t){return e===t-1?0:e+1}},{key:"getNextHandleIndexBeforeInsert",value:function(e,t){return e===t?0:e}},{key:"getPreviousHandleIndex",value:function(e,t){return 0===e?t-1:e-1}},{key:"getCorrectedPair",value:function(e,t){var n=[e[0]-t,e[1]-t];return n[1]<0&&(n[1]=0),n}}]),e}()},function(e,t,n){"use strict";function a(e,t,n){return a=e.y,r=t.y,o=n.y,!(!(r<a&&a<o||o<a&&a<r)||!function(e,t,n){if(t.x>e.x&&n.x>e.x)return!0;if(t.x===n.x)return e.x<t.x;if(t.x>n.x){var a=t;t=n,n=a}var r=function(e,t,n){var a=(n.y-t.y)/(n.x-t.x);return{value:t.x+a*(e.x-t.x),gradient:a}}(e,t,n);return Math.sign(r.gradient)*e.y>r.value}(e,t,n));var a,r,o}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){for(var n=!1,r=e.length-1,o=0;o<e.length;o++)a(t,e[o],e[r])&&(n=!n),r=o;return n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){var a={count:0,mean:0,variance:0,stdDev:0},r=function(e,t,n){for(var a={value:0,squared:0,count:0},r=0,i=t.top;i<t.top+t.height;i++)for(var l=t.left;l<t.left+t.width;l++)o(n,{x:l,y:i},a,e[r]),r++;return a}(e,t,n);return 0===r.count||(a.count=r.count,a.mean=r.value/r.count,a.variance=r.squared/r.count-a.mean*a.mean,a.stdDev=Math.sqrt(a.variance)),a};var a,r=(a=n(96))&&a.__esModule?a:{default:a};function o(e,t,n,a){(0,r.default)(e,t)&&(n.value+=a,n.squared+=a*a,n.count++)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=0,a=e.length-1;t=t||1;for(var r=0;r<e.length;r++)n+=(e[a].x+e[r].x)*(e[a].y-e[r].y),a=r;return Math.abs(n*t/2)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClickedLineData=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.toolIndex=t,this.handleIndexArray=n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.detail;if(t&&null!==t.handleNearby)!function(e,t){var n=(0,i.getToolState)(e.element,u);if(void 0!==n){var a=t.handleIndex,r=t.toolIndex,o=n.data[r];o.handles.length<=3||(a===o.handles.length-1?(o.handles[a-1].lines.pop(),o.handles[a-1].lines.push(o.handles[0])):0===a?(o.handles[o.handles.length-1].lines.pop(),o.handles[o.handles.length-1].lines.push(o.handles[a+1])):(o.handles[a-1].lines.pop(),o.handles[a-1].lines.push(o.handles[a+1])),o.handles.splice(a,1),o.invalidated=!0,o.active=!0,o.highlight=!0,l.default.cornerstone.updateImage(e.element))}}(n,{toolIndex:t.toolIndex,handleIndex:t.handleNearby});else{var a=new r.FreehandLineFinder(n).findLine();a&&function(e,t){var n=(0,i.getToolState)(e.element,u);if(void 0!==n){var a=n.data[t.toolIndex],r=function(e){for(var t=e.handleIndexArray,n=1/0,a=t.includes(0),r=0;r<t.length;r++){var o=t[r];0!==o&&o<n&&(n=o)}return a&&1===n&&(n=0),++n}(t);if(r!==1/0){var d=new o.FreehandHandleData(e.currentPoints.image);a.handles.splice(r,0,d),a.handles[r-1].lines.pop(),a.handles[r-1].lines.push(e.currentPoints.image),r===a.handles.length-1?a.handles[r].lines.push(a.handles[0]):a.handles[r].lines.push(a.handles[r+1]),a.active=!0,a.highlight=!0,a.invalidated=!0,l.default.cornerstone.updateImage(e.element)}}}(n,a)}e.preventDefault(),e.stopPropagation()};var a,r=n(54),o=n(37),i=n(2),l=(a=n(0))&&a.__esModule?a:{default:a},u="freehand"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){e.detail;var n=a.freehand.getConfiguration();return!0===n.movingTextBox?(function(e,t){var n=a.freehand.getConfiguration();n.movingTextBox=!1,t.data[n.currentTool].invalidated=!0,n.currentHandle=0,n.currentTool=-1}(0,t),"textBox"):n.modifying?(function(e,t){var n=a.freehand.getConfiguration(),r=n.currentTool,o=t.data[r].handles;if(o.invalidHandlePlacement){var i=n.currentHandle,l=o[i],u=void 0;u=0===i?o[o.length-1]:o[i-1],l.x=n.dragOrigin.x,l.y=n.dragOrigin.y,u.lines[0]=l,o.invalidHandlePlacement=!1}}(0,t),"handle"):null};var a=n(25)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=r.freehand.getConfiguration();n.movingTextBox&&function(e){var t=r.freehand.getConfiguration();e.hasMoved=!0,e.x=t.mouseLocation.handles.start.x,e.y=t.mouseLocation.handles.start.y}(e),n.modifying&&function(e,t){var n,a=r.freehand.getConfiguration();if(t.handles.invalidHandlePlacement=o.default.modify(t.handles,e),t.active=!0,t.highlight=!0,t.handles[e].x=a.mouseLocation.handles.start.x,t.handles[e].y=a.mouseLocation.handles.start.y,n=0===e?t.handles.length-1:e-1,e>=0){var i=t.handles[n].lines.length-1,l=t.handles[n].lines[i];l.x=a.mouseLocation.handles.start.x,l.y=a.mouseLocation.handles.start.y}}(e,t)};var a,r=n(25),o=(a=n(55))&&a.__esModule?a:{default:a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.eraserTouch=t.eraser=void 0;var a=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(r)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(70)),o=s(n(0)),i=s(n(1)),l=n(4),u=s(n(57)),d=s(n(5));function s(e){return e&&e.__esModule?e:{default:e}}var c="eraser",f={supportedTools:{}};function v(e){var t=e.detail.currentPoints.canvas,n=e.detail.element,i=(0,l.getToolOptions)(c,n).mouseButtonMask,u=e.detail.which,s=!1,v=!1;(0,d.default)(u,i)&&(Object.entries(f.supportedTools).forEach((function(e){var o=a(e,2),i=o[0],l=o[1],u=r.getToolState(n,i);u&&u.data.forEach((function(e){!s&&l.pointNearTool(n,e,t)&&(r.removeToolState(n,i,e),s=!0,v=!0)}))})),v&&o.default.cornerstone.updateImage(n))}function m(e){var t=e.detail.currentPoints.canvas,n=e.detail.element,i=!1,l=!1;Object.entries(f.supportedTools).forEach((function(e){var o=a(e,2),u=o[0],d=o[1],s=r.getToolState(n,u);s&&s.data.forEach((function(e){e.active&&(e.active=!1,i=!0),!l&&d.pointNearTool(n,e,t)&&(e.active=!0,i=!0,l=!0)}))})),i&&o.default.cornerstone.updateImage(n)}var g={activate:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n.mouseButtonMask=t,(0,l.setToolOptions)(c,e,n),e.removeEventListener(i.default.MOUSE_DOWN_ACTIVATE,v),e.removeEventListener(i.default.MOUSE_MOVE,m),e.addEventListener(i.default.MOUSE_DOWN_ACTIVATE,v),e.addEventListener(i.default.MOUSE_MOVE,m),f.supportedTools={},Object.keys(r).forEach((function(e){var t=r[e];"function"==typeof t.pointNearTool&&(f.supportedTools[e]=t)}))},disable:function(e){e.removeEventListener(i.default.MOUSE_DOWN_ACTIVATE,v),e.removeEventListener(i.default.MOUSE_MOVE,m)},enable:function(e){e.removeEventListener(i.default.MOUSE_DOWN_ACTIVATE,v),e.removeEventListener(i.default.MOUSE_MOVE,m)},deactivate:function(e){e.removeEventListener(i.default.MOUSE_DOWN_ACTIVATE,v),e.removeEventListener(i.default.MOUSE_MOVE,m)},getConfiguration:function(){return f},setConfiguration:function(e){f=e}},h=(0,u.default)(v,c);t.eraser=g,t.eraserTouch=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ellipticalRoiTouch=t.ellipticalRoi=void 0;var a=p(n(0)),r=p(n(10)),o=p(n(12)),i=p(n(14)),l=p(n(7)),u=p(n(9)),d=p(n(44)),s=p(n(63)),c=p(n(23)),f=p(n(15)),v=p(n(18)),m=n(2),g=n(3),h=p(n(22));function p(e){return e&&e.__esModule?e:{default:e}}var E="ellipticalRoi";function y(e){return{visible:!0,active:!0,invalidated:!0,color:void 0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function b(e,t,n,r){if(!1===t.visible)return!1;var o=a.default.cornerstone,i=o.pixelToCanvas(e,t.handles.start),l=o.pixelToCanvas(e,t.handles.end),u={left:Math.min(i.x,l.x)+r/2,top:Math.min(i.y,l.y)+r/2,width:Math.abs(i.x-l.x)-r,height:Math.abs(i.y-l.y)-r},s={left:Math.min(i.x,l.x)-r/2,top:Math.min(i.y,l.y)-r/2,width:Math.abs(i.x-l.x)+r,height:Math.abs(i.y-l.y)+r},c=(0,d.default)(u,n);return!(!(0,d.default)(s,n)||c)}function T(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}function x(e){var t=e.detail,n=(0,m.getToolState)(e.currentTarget,E);if(n){var r=a.default.cornerstone,o=t.image,d=t.element,s=i.default.getToolWidth(),c=M.getConfiguration(),f=r.metaData.get("generalSeriesModule",o.imageId),p=void 0,y=(0,h.default)(t.image),b=y.rowPixelSpacing,x=y.colPixelSpacing;f&&(p=f.modality);for(var C=(0,g.getNewContext)(t.canvasContext.canvas),S=function(e){var a=n.data[e];if(!1===a.visible)return"continue";(0,g.draw)(C,(function(e){(0,g.setShadow)(e,c);var n=l.default.getColorIfActive(a);(0,g.drawEllipse)(e,d,a.handles.start,a.handles.end,{color:n}),c&&c.drawHandlesOnHover?!0===a.active?(0,u.default)(e,t,a.handles,n):(0,u.default)(e,t,a.handles,n,{drawHandlesIfActive:!0}):(0,u.default)(e,t,a.handles,n),w(a,d,o,p,b,x),a.handles.textBox.hasMoved||(a.handles.textBox.x=Math.max(a.handles.start.x,a.handles.end.x),a.handles.textBox.y=(a.handles.start.y+a.handles.end.y)/2);var r=function(e){var t=e.meanStdDev,n=e.meanStdDevSUV,a=e.area,r=[];if(t&&void 0!==t.mean){var o="";"CT"===p&&(o=" HU");var i="Mean: "+T(t.mean.toFixed(2))+o,l="StdDev: "+T(t.stdDev.toFixed(2))+o;n&&void 0!==n.mean&&(i+=" SUV: "+T(n.mean.toFixed(2)),l+=" SUV: "+T(n.stdDev.toFixed(2))),r.push(i),r.push(l)}if(a){var u=" mm"+String.fromCharCode(178);b&&x||(u=" pixels"+String.fromCharCode(178));var d="Area: "+T(a.toFixed(2))+u;r.push(d)}return r}(a);(0,v.default)(e,d,a.handles.textBox,r,a.handles,I,n,s,0,!0)}))},O=0;O<n.data.length;O++)S(O)}function I(e){var t=Math.min(e.start.x,e.end.x),n=Math.min(e.start.y,e.end.y),a=Math.abs(e.start.x-e.end.x),r=Math.abs(e.start.y-e.end.y);return[{x:t+a/2,y:n},{x:t,y:n+r/2},{x:t+a/2,y:n+r},{x:t+a,y:n+r/2}]}}function w(e,t,n,r,o,i){var l=a.default.cornerstone,u=void 0,d=void 0,f=void 0;if(!1===e.invalidated)d=e.meanStdDev,f=e.meanStdDevSUV,u=e.area;else{var v={left:Math.round(Math.min(e.handles.start.x,e.handles.end.x)),top:Math.round(Math.min(e.handles.start.y,e.handles.end.y)),width:Math.round(Math.abs(e.handles.start.x-e.handles.end.x)),height:Math.round(Math.abs(e.handles.start.y-e.handles.end.y))};if(!n.color){var m=l.getPixels(t,v.left,v.top,v.width,v.height);d=(0,s.default)(m,v),"PT"===r&&(f={mean:(0,c.default)(n,(d.mean-n.intercept)/n.slope),stdDev:(0,c.default)(n,(d.stdDev-n.intercept)/n.slope)}),d&&!isNaN(d.mean)&&(e.meanStdDev=d,e.meanStdDevSUV=f)}u=Math.PI*(v.width*(i||1)/2)*(v.height*(o||1)/2),isNaN(u)||(e.area=u,e.unit="mm"+String.fromCharCode(178),o&&i||(e.unit="pixels"+String.fromCharCode(178))),e.invalidated=!1}}function C(e,t){var n=a.default.cornerstone.getImage(e),r=a.default.cornerstone.metaData.get("generalSeriesModule",n.imageId),o=void 0,i=(0,h.default)(n),l=i.rowPixelSpacing,u=i.colPixelSpacing;r&&(o=r.modality),w(t,e,n,o,l,u),(0,f.default)(e,t,E)}var M=(0,r.default)({createNewMeasurement:y,onImageRendered:x,pointNearTool:function(e,t,n){return b(e,t,n,15)},toolType:E,onHandleDoneMove:C}),S=(0,o.default)({createNewMeasurement:y,onImageRendered:x,pointNearTool:function(e,t,n){return b(e,t,n,25)},toolType:E,onHandleDoneMove:C});t.ellipticalRoi=M,t.ellipticalRoiTouch=S},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dragProbeTouch=t.dragProbe=void 0;var a=h(n(1)),r=h(n(0)),o=h(n(17)),i=h(n(19)),l=h(n(20)),u=h(n(7)),d=n(11),s=h(d),c=h(n(43)),f=h(n(23)),v=h(n(5)),m=n(4),g=n(3);function h(e){return e&&e.__esModule?e:{default:e}}var p="dragProbe",E=void 0;function y(e){var t=r.default.cornerstone,n=t.getEnabledElement(e.element),a=(0,g.getNewContext)(n.canvas),o=u.default.getActiveColor(),i=l.default.getFontSize(),d=w.getConfiguration(),v=Math.round(e.currentPoints.image.x),m=Math.round(e.currentPoints.image.y);v<0||m<0||v>=e.image.columns||m>=e.image.rows||(0,g.draw)(a,(function(n){(0,g.setShadow)(n,d);var a=void 0,r=void 0,l=void 0;if(e.image.color)a=(0,c.default)(e.element,v,m,1,1),r=v+", "+m,l="R: "+a[0]+" G: "+a[1]+" B: "+a[2]+" A: "+a[3];else{var u=(a=t.getStoredPixels(e.element,v,m,1,1))[0],h=u*e.image.slope+e.image.intercept,p=(0,f.default)(e.image,u);r=v+", "+m,l="SP: "+u+" MO: "+parseFloat(h.toFixed(3)),p&&(l+=" SUV: "+parseFloat(p.toFixed(3)))}var E={x:e.currentPoints.image.x+3,y:e.currentPoints.image.y-3},y=t.pixelToCanvas(e.element,E);(0,s.default)(n,l,y.x,y.y+i+5,o),(0,s.default)(n,r,y.x,y.y,o)}))}function b(e){var t=e.detail,n=t.element;n.removeEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,T),n.removeEventListener(a.default.MOUSE_DRAG,x),n.removeEventListener(a.default.MOUSE_UP,b),n.removeEventListener(a.default.MOUSE_CLICK,b),r.default.cornerstone.updateImage(t.element)}function T(){E&&(w.strategy(E),E=null)}function x(e){var t=e.detail,n=t.element;E=t,r.default.cornerstone.updateImage(n),e.preventDefault(),e.stopPropagation()}var w=(0,o.default)((function(e){var t=e.detail,n=t.element,o=(0,m.getToolOptions)(p,n);(0,v.default)(t.which,o.mouseButtonMask)&&(n.addEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,T),n.addEventListener(a.default.MOUSE_DRAG,x),n.addEventListener(a.default.MOUSE_UP,b),n.addEventListener(a.default.MOUSE_CLICK,b),w.strategy(t),e.preventDefault(),e.stopPropagation())}),p);w.strategies={default:y,minimal:function(e){var t,n=r.default.cornerstone,a=e.element,o=n.getEnabledElement(a),i=o.image,v=(0,g.getNewContext)(o.canvas),m=u.default.getActiveColor(),h=w.getConfiguration();(t=!0===e.isTouchEvent?n.pageToPixel(a,e.currentPoints.page.x,e.currentPoints.page.y-4*l.default.getFontSize()):n.pageToPixel(a,e.currentPoints.page.x,e.currentPoints.page.y-l.default.getFontSize()/2)).x<0||t.y<0||t.x>=i.columns||t.y>=i.rows||(0,g.draw)(v,(function(r){(0,g.setShadow)(r,h);var o=n.metaData.get("generalSeriesModule",i.imageId),u=void 0;o&&(u=o.modality);var v=void 0,p="";if(i.color)p="R: "+(v=(0,c.default)(a,t.x,t.y,1,1))[0]+" G: "+v[1]+" B: "+v[2];else{var E=(v=n.getStoredPixels(a,t.x,t.y,1,1))[0],y=E*e.image.slope+e.image.intercept,b=parseFloat(y.toFixed(2));if("CT"===u)p+="HU: "+b;else if("PT"===u){p+=b;var T=(0,f.default)(e.image,E);T&&(p+=" SUV: "+parseFloat(T.toFixed(2)))}else p+=b}var x,w=n.pixelToCanvas(a,t),C=(0,d.textBoxWidth)(r,p,5);x=!0===e.isTouchEvent?{x:-C/2,y:-l.default.getFontSize()-10-12}:{x:12,y:-(l.default.getFontSize()+10)/2},(0,g.drawCircle)(r,a,w,6,{color:m},"canvas"),(0,s.default)(r,p,w.x+x.x,w.y+x.y,m)}))}},w.strategy=y;var C={fireOnTouchStart:!0,touchStartCallback:function(e){e.detail.element.addEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,T)},touchEndCallback:function(e){var t=e.detail.element;t.removeEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,T),r.default.cornerstone.updateImage(t)}},M=(0,i.default)(x,p,C);t.dragProbe=w,t.dragProbeTouch=M},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(n(0));function r(e){return e&&e.__esModule?e:{default:e}}function o(e){a.default.cornerstone.fitToWindow(e.element)}var i=(0,r(n(58)).default)((function(e){var t=e.detail;i.strategy(t),e.preventDefault(),e.stopPropagation()}));i.strategies={default:o},i.strategy=o,t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.crosshairsTouch=t.crosshairs=void 0;var a=c(n(1)),r=c(n(0)),o=c(n(13)),i=n(2),l=c(n(5)),u=n(48),d=c(n(21)),s=n(4);function c(e){return e&&e.__esModule?e:{default:e}}var f="crosshairs";function v(e){var t=e.detail;e.stopImmediatePropagation();var n=(0,i.getToolState)(e.currentTarget,f);if(n){var a=r.default.cornerstone,l=e.currentTarget,s=a.getEnabledElement(l).image.imageId,c=a.metaData.get("imagePlaneModule",s);if(c){var v=t.currentPoints.image,m=(0,u.imagePointToPatientPoint)(v,c);n.data[0].synchronizationContext.getSourceElements().forEach((function(e){if(e!==l){var t=Number.MAX_VALUE,n=-1,r=(0,i.getToolState)(e,"stack");if(void 0!==r){var u=r.data[0];if(u.imageIds.forEach((function(e,r){var o=a.metaData.get("imagePlaneModule",e);if(o&&o.imagePositionPatient&&o.rowCosines&&o.columnCosines){var i=(0,d.default)(o.imagePositionPatient),l=(0,d.default)(o.rowCosines),u=(0,d.default)(o.columnCosines).clone().cross(l.clone()),s=Math.abs(u.clone().dot(i)-u.clone().dot(m));s<t&&(t=s,n=r)}})),n!==u.currentImageIdIndex&&-1!==n&&void 0!==u.imageIds[n]){var s=o.default.getStartLoadHandler(),c=o.default.getEndLoadHandler(),f=o.default.getErrorLoadingHandler();s&&s(e),(!0===u.preventCache?a.loadImage(u.imageIds[n]):a.loadAndCacheImage(u.imageIds[n])).then((function(t){var r=a.getViewport(e);u.currentImageIdIndex=n,a.displayImage(e,t,r),c&&c(e,t)}),(function(t){var a=u.imageIds[n];f&&f(e,a,t)}))}}}}))}}}function m(e){var t=e.detail.element;t.removeEventListener(a.default.MOUSE_DRAG,h),t.removeEventListener(a.default.MOUSE_UP,m)}function g(e){var t=e.detail,n=t.element,r=(0,s.getToolOptions)(f,n);(0,l.default)(t.which,r.mouseButtonMask)&&(n.addEventListener(a.default.MOUSE_DRAG,h),n.addEventListener(a.default.MOUSE_UP,m),v(e),e.preventDefault(),e.stopPropagation())}function h(e){v(e),e.preventDefault(),e.stopPropagation()}function p(e,t,n){(0,s.setToolOptions)(f,e,{mouseButtonMask:t}),(0,i.clearToolState)(e,f),(0,i.addToolState)(e,f,{synchronizationContext:n}),e.removeEventListener(a.default.MOUSE_DOWN,g),e.addEventListener(a.default.MOUSE_DOWN,g)}function E(e){e.removeEventListener(a.default.MOUSE_DOWN,g)}var y={activate:p,deactivate:E,enable:p,disable:E};function b(e){var t=e.detail.element;t.removeEventListener(a.default.TOUCH_DRAG,x),t.removeEventListener(a.default.TOUCH_DRAG_END,b)}function T(e){var t=e.detail.element;return t.addEventListener(a.default.TOUCH_DRAG,x),t.addEventListener(a.default.TOUCH_DRAG_END,b),v(e),!1}function x(e){v(e),e.preventDefault(),e.stopPropagation()}function w(e,t){(0,i.clearToolState)(e,f),(0,i.addToolState)(e,f,{synchronizationContext:t}),e.removeEventListener(a.default.TOUCH_START,T),e.addEventListener(a.default.TOUCH_START,T)}function C(e){e.removeEventListener(a.default.TOUCH_START,T)}var M={activate:w,deactivate:C,enable:w,disable:C};t.crosshairs=y,t.crosshairsTouch=M},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,a,i,l){var u=e.length>0?r.default.cornerstoneMath.point.findClosestPoint(e,t):t,d=[{x:n.left+n.width/2,y:n.top},{x:n.left,y:n.top+n.height/2},{x:n.left+n.width/2,y:n.top+n.height},{x:n.left+n.width,y:n.top+n.height/2}],s=r.default.cornerstoneMath.point.findClosestPoint(d,u),c={color:i,lineWidth:l,lineDash:[2,3]};(0,o.drawLine)(a,void 0,u,s,c,"canvas")};var a,r=(a=n(0))&&a.__esModule?a:{default:a},o=n(3)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrowAnnotateTouch=t.arrowAnnotate=void 0;var a=M(n(1)),r=M(n(0)),o=M(n(10)),i=M(n(12)),l=M(n(14)),u=M(n(20)),d=M(n(7)),s=M(n(9)),c=M(n(64)),f=M(n(32)),v=M(n(30)),m=M(n(16)),g=M(n(5)),h=M(n(24)),p=M(n(18)),E=n(2),y=n(4),b=M(n(29)),T=n(3),x=n(11),w=M(n(6)),C=M(n(15));function M(e){return e&&e.__esModule?e:{default:e}}var S="arrowAnnotate",O={getTextCallback:function(e){e(prompt("Enter your annotation:"))},changeTextCallback:function(e,t,n){n(prompt("Change your annotation:"))},drawHandles:!1,drawHandlesOnHover:!0,arrowFirst:!0};function I(e){return{visible:!0,active:!0,color:void 0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function _(e,t,n){return!1!==t.visible&&(0,b.default)(e,t.handles.start,t.handles.end,n)<25}function P(e){var t=e.detail,n=(0,E.getToolState)(e.currentTarget,S);if(n)for(var a=t.enabledElement,o=r.default.cornerstone,i=(0,T.getNewContext)(t.canvasContext.canvas),f=l.default.getToolWidth(),v=D.getConfiguration(),m=function(e){var r=n.data[e];if(!1===r.visible)return"continue";(0,T.draw)(i,(function(e){(0,T.setShadow)(e,v);var n=d.default.getColorIfActive(r),i=o.pixelToCanvas(t.element,r.handles.start),l=o.pixelToCanvas(t.element,r.handles.end);v.arrowFirst?(0,c.default)(e,l,i,n,f):(0,c.default)(e,i,l,n,f);var m={drawHandlesIfActive:v&&v.drawHandlesOnHover};v.drawHandles&&(0,s.default)(e,t,r.handles,n,m);var g=function(e){return e.text}(r);if(g&&""!==g){var E=(0,x.textBoxWidth)(e,g,5),y=u.default.getFontSize()+10,b=Math.max(E,y)/2+5;if(l.x<i.x&&(b=-b),!r.handles.textBox.hasMoved){var w;w=v.arrowFirst?{x:l.x-E/2+b,y:l.y-y/2}:{x:i.x-E/2-b,y:i.y-y/2};var C=o.internal.getTransform(a);C.invert();var M=C.transformPoint(w.x,w.y);r.handles.textBox.x=M.x,r.handles.textBox.y=M.y}(0,p.default)(e,t.element,r.handles.textBox,g,r.handles,h,n,f,0,!1)}}))},g=0;g<n.data.length;g++)m(g);function h(e){var t={x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2};return[e.start,t,e.end]}}function L(e,t){(0,C.default)(e,t,S)}var D=(0,o.default)({addNewMeasurement:function(e){var t=e.element,n=I(e),o=r.default.cornerstone;function i(e){null===e?(0,E.removeToolState)(t,S,n):n.text=e,n.active=!1,o.updateImage(t);var r=a.default.MEASUREMENT_MODIFIED,i={toolType:S,element:t,measurementData:n};(0,w.default)(t,r,i),t.addEventListener(a.default.MOUSE_MOVE,D.mouseMoveCallback),t.addEventListener(a.default.MOUSE_DOWN,D.mouseDownCallback),t.addEventListener(a.default.MOUSE_DOWN_ACTIVATE,D.mouseDownActivateCallback),t.addEventListener(a.default.MOUSE_DOUBLE_CLICK,D.mouseDoubleClickCallback)}(0,E.addToolState)(t,S,n),t.removeEventListener(a.default.MOUSE_MOVE,D.mouseMoveCallback),t.removeEventListener(a.default.MOUSE_DOWN,D.mouseDownCallback),t.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,D.mouseDownActivateCallback),t.removeEventListener(a.default.MOUSE_DOUBLE_CLICK,D.mouseDoubleClickCallback),o.updateImage(t),(0,f.default)(e,S,n,n.handles.end,(function(){if((0,m.default)(e,n.handles))(0,E.removeToolState)(t,S,n);else{var a=D.getConfiguration();void 0===n.text&&a.getTextCallback(i),L(t,n)}o.updateImage(t)}))},createNewMeasurement:I,onImageRendered:P,pointNearTool:_,toolType:S,mouseDoubleClickCallback:function(e){var t=e.detail,n=t.element,a=r.default.cornerstone,o=(0,y.getToolOptions)(S,n),i=void 0;if((0,g.default)(t.which,o.mouseButtonMask)){var l=D.getConfiguration(),u=t.currentPoints.canvas,d=(0,E.getToolState)(n,S);if(d)for(var s=0;s<d.data.length;s++)if(i=d.data[s],_(n,i,u)||(0,h.default)(i.handles.textBox,u))return i.active=!0,a.updateImage(n),l.changeTextCallback(i,t,c),e.stopImmediatePropagation(),!1}function c(e,t,r){!0===r?(0,E.removeToolState)(n,S,e):e.text=t,e.active=!1,a.updateImage(n)}},onHandleDoneMove:L});D.setConfiguration(O);var j=(0,i.default)({addNewMeasurement:function(e){var t=e.element,n=I(e),o=r.default.cornerstone;function i(e){null===e?(0,E.removeToolState)(t,S,n):n.text=e,n.active=!1,o.updateImage(t);var r=a.default.MEASUREMENT_MODIFIED,i={toolType:S,element:t,measurementData:n};(0,w.default)(t,r,i),t.addEventListener(a.default.TOUCH_PRESS,j.pressCallback),t.addEventListener(a.default.TOUCH_START_ACTIVE,j.touchDownActivateCallback),t.addEventListener(a.default.TAP,j.tapCallback)}(0,E.addToolState)(t,S,n),t.removeEventListener(a.default.TOUCH_PRESS,j.pressCallback),t.removeEventListener(a.default.TOUCH_START_ACTIVE,j.touchDownActivateCallback),t.removeEventListener(a.default.TAP,j.tapCallback),o.updateImage(t),(0,v.default)(e,S,n,n.handles.end,(function(){if((0,m.default)(e,n.handles))(0,E.removeToolState)(t,S,n);else{var a=D.getConfiguration();void 0===n.text&&a.getTextCallback(i),L(t,n)}o.updateImage(t)}))},createNewMeasurement:I,onImageRendered:P,pointNearTool:_,toolType:S,pressCallback:function(e){var t=e.detail,n=t.element,o=r.default.cornerstone,i=void 0;function l(e,t,r){console.log("pressCallback doneChangingTextCallback"),!0===r?(0,E.removeToolState)(n,S,e):e.text=t,e.active=!1,o.updateImage(n),n.addEventListener(a.default.TOUCH_START,j.touchStartCallback),n.addEventListener(a.default.TOUCH_START_ACTIVE,j.touchDownActivateCallback),n.addEventListener(a.default.TAP,j.tapCallback)}var u=D.getConfiguration(),d=t.currentPoints.canvas,s=(0,E.getToolState)(n,S);if(s){if(t.handlePressed)return n.removeEventListener(a.default.TOUCH_START,j.touchStartCallback),n.removeEventListener(a.default.TOUCH_START_ACTIVE,j.touchDownActivateCallback),n.removeEventListener(a.default.TAP,j.tapCallback),u.changeTextCallback(t.handlePressed,t,l),e.stopImmediatePropagation(),!1;for(var c=0;c<s.data.length;c++)if(i=s.data[c],_(n,i,d)||(0,h.default)(i.handles.textBox,d))return i.active=!0,o.updateImage(n),n.removeEventListener(a.default.TOUCH_START,j.touchStartCallback),n.removeEventListener(a.default.TOUCH_START_ACTIVE,j.touchDownActivateCallback),n.removeEventListener(a.default.TAP,j.tapCallback),u.changeTextCallback(i,t,l),e.stopImmediatePropagation(),!1;e.preventDefault(),e.stopPropagation()}},onHandleDoneMove:L});t.arrowAnnotate=D,t.arrowAnnotateTouch=j},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.angleTouch=t.angle=void 0;var a=g(n(0)),r=g(n(10)),o=g(n(12)),i=g(n(11)),l=g(n(45)),u=g(n(7)),d=g(n(9)),s=n(2),c=g(n(29)),f=n(3),v=g(n(15)),m=g(n(22));function g(e){return e&&e.__esModule?e:{default:e}}var h="angle";function p(e){return{visible:!0,active:!0,color:void 0,handles:{start:{x:e.currentPoints.image.x-20,y:e.currentPoints.image.y+10,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},start2:{x:e.currentPoints.image.x-20,y:e.currentPoints.image.y+10,highlight:!0,active:!1},end2:{x:e.currentPoints.image.x,y:e.currentPoints.image.y+20,highlight:!0,active:!1}}}}function E(e,t,n){return!1!==t.visible&&((0,c.default)(e,t.handles.start,t.handles.end,n)<5||(0,c.default)(e,t.handles.start2,t.handles.end2,n)<5)}function y(e){var t=e.detail,n=(0,s.getToolState)(e.currentTarget,h);if(void 0!==n)for(var r=(0,f.getNewContext)(t.canvasContext.canvas),o=x.getConfiguration(),l=a.default.cornerstone,c=function(e){var a=n.data[e];if(!1===a.visible)return"continue";(0,f.draw)(r,(function(e){(0,f.setShadow)(e,o);var n=u.default.getColorIfActive(a),r=[{start:a.handles.start,end:a.handles.end},{start:a.handles.start2,end:a.handles.end2}];(0,f.drawLines)(e,t.element,r,{color:n}),(0,d.default)(e,t,a.handles),b(a,t.image);var s=a.rAngle;a.unit=String.fromCharCode(parseInt("00B0",16));var c=s.toString()+a.unit,v=l.pixelToCanvas(t.element,a.handles.start2),m=l.pixelToCanvas(t.element,a.handles.end2),g=(v.x+m.x)/2,h=(v.y+m.y)/2;(0,i.default)(e,c,g,h,n)}))},v=0;v<n.data.length;v++)c(v)}function b(e,t){var n=(0,m.default)(t),a=n.rowPixelSpacing,r=n.colPixelSpacing;a=a||1,r=r||1;var o=(Math.ceil(e.handles.start.x)-Math.ceil(e.handles.end.x))*r,i=(Math.ceil(e.handles.start.y)-Math.ceil(e.handles.end.y))*a,u=(Math.ceil(e.handles.start2.x)-Math.ceil(e.handles.end2.x))*r,d=(Math.ceil(e.handles.start2.y)-Math.ceil(e.handles.end2.y))*a,s=Math.acos(Math.abs((o*u+i*d)/(Math.sqrt(o*o+i*i)*Math.sqrt(u*u+d*d))));s*=180/Math.PI,e.rAngle=(0,l.default)(s,2)}function T(e,t){b(t,a.default.cornerstone.getImage(e)),(0,v.default)(e,t,h)}var x=(0,r.default)({createNewMeasurement:p,onImageRendered:y,pointNearTool:E,toolType:h,onHandleDoneMove:T}),w=(0,o.default)({createNewMeasurement:p,onImageRendered:y,pointNearTool:E,toolType:h,onHandleDoneMove:T});t.angle=x,t.angleTouch=w},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=d(n(1)),r=d(n(0)),o=d(n(42)),i=d(n(59)),l=d(n(6)),u=n(4);function d(e){return e&&e.__esModule?e:{default:e}}var s=void 0,c=void 0,f=void 0,v=void 0,m=void 0,g=void 0,h=void 0,p=void 0,E=1,y=0,b=!1,T=!1,x=void 0,w="touchInput";function C(e){var t=r.default.cornerstone,n=e.currentTarget||e.srcEvent.currentTarget,i=t.getEnabledElement(n);if(i.image){var u=void 0,d=void 0,w=void 0,C=void 0;switch(e.preventDefault(),(e.pointers&&e.pointers.length>1||e.touches&&e.touches.length>1)&&(T=!1,clearTimeout(h)),e.type){case"tap":T=!1,clearTimeout(h),(c={page:r.default.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:t.pageToPixel(n,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=t.pixelToCanvas(n,c.image),u=a.default.TAP,m={event:e,viewport:t.getViewport(n),image:i.image,element:n,currentPoints:c,type:u,isTouchEvent:!0},(0,l.default)(n,u,m);break;case"doubletap":T=!1,clearTimeout(h),(c={page:r.default.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:t.pageToPixel(n,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=t.pixelToCanvas(n,c.image),u=a.default.DOUBLE_TAP,m={event:e,viewport:t.getViewport(n),image:i.image,element:n,currentPoints:c,type:u,isTouchEvent:!0},(0,l.default)(n,u,m);break;case"pinchstart":T=!1,clearTimeout(h),E=1;break;case"pinchmove":if(T=!1,clearTimeout(h),!0===b){E=e.scale,b=!1;break}d=(e.scale-E)/E,(s={page:e.center,image:t.pageToPixel(n,e.center.x,e.center.y)}).canvas=t.pixelToCanvas(n,s.image),u=a.default.TOUCH_PINCH,m={event:e,startPoints:s,viewport:t.getViewport(n),image:i.image,element:n,direction:e.scale<1?1:-1,scaleChange:d,type:u,isTouchEvent:!0},(0,l.default)(n,u,m),E=e.scale;break;case"touchstart":E=1,clearTimeout(h),clearTimeout(g),g=setTimeout((function(){(s={page:r.default.cornerstoneMath.point.pageToPoint(e.touches[0]),image:t.pageToPixel(n,e.touches[0].pageX,e.touches[0].pageY),client:{x:e.touches[0].clientX,y:e.touches[0].clientY}}).canvas=t.pixelToCanvas(n,s.image),u=a.default.TOUCH_START,e.touches.length>1&&(u=a.default.MULTI_TOUCH_START),m={event:e,viewport:t.getViewport(n),image:i.image,element:n,startPoints:s,currentPoints:s,type:u,isTouchEvent:!0},!0===(0,l.default)(n,u,m)&&(u=a.default.TOUCH_START_ACTIVE,e.touches.length>1&&(u=a.default.MULTI_TOUCH_START_ACTIVE),m.type=u,(0,l.default)(n,u,m)),f=(0,o.default)(s)}),50),T=!0,p=0,h=setTimeout((function(){T&&((c={page:r.default.cornerstoneMath.point.pageToPoint(e.touches[0]),image:t.pageToPixel(n,e.touches[0].pageX,e.touches[0].pageY),client:{x:e.touches[0].clientX,y:e.touches[0].clientY}}).canvas=t.pixelToCanvas(n,s.image),u=a.default.TOUCH_PRESS,m={event:e,viewport:t.getViewport(n),image:i.image,element:n,currentPoints:c,type:u,isTouchEvent:!0},(0,l.default)(n,u,m))}),700);break;case"touchend":E=1,T=!1,clearTimeout(h),setTimeout((function(){(s={page:r.default.cornerstoneMath.point.pageToPoint(e.changedTouches[0]),image:t.pageToPixel(n,e.changedTouches[0].pageX,e.changedTouches[0].pageY),client:{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}}).canvas=t.pixelToCanvas(n,s.image),u=a.default.TOUCH_END,m={event:e,viewport:t.getViewport(n),image:i.image,element:n,startPoints:s,currentPoints:s,type:u,isTouchEvent:!0},(0,l.default)(n,u,m)}),50);break;case"panmove":w={x:e.deltaX-x.x,y:e.deltaY-x.y},x={x:e.deltaX,y:e.deltaY},(c={page:{x:f.page.x+w.x,y:f.page.y+w.y},image:t.pageToPixel(n,f.page.x+w.x,f.page.y+w.y),client:{x:f.client.x+w.x,y:f.client.y+w.y}}).canvas=t.pixelToCanvas(n,c.image),v={page:r.default.cornerstoneMath.point.subtract(c.page,f.page),image:r.default.cornerstoneMath.point.subtract(c.image,f.image),client:r.default.cornerstoneMath.point.subtract(c.client,f.client),canvas:r.default.cornerstoneMath.point.subtract(c.canvas,f.canvas)},(p+=Math.sqrt(v.page.x*v.page.x+v.page.y*v.page.y))>5&&(T=!1,clearTimeout(h)),u=a.default.TOUCH_DRAG,e.pointers.length>1&&(u=a.default.MULTI_TOUCH_DRAG),m={viewport:t.getViewport(n),image:i.image,element:n,startPoints:s,lastPoints:f,currentPoints:c,deltaPoints:v,numPointers:e.pointers.length,type:u,isTouchEvent:!0},(0,l.default)(n,u,m),f=(0,o.default)(c);break;case"panstart":x={x:e.deltaX,y:e.deltaY},(c={page:r.default.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:t.pageToPixel(n,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=t.pixelToCanvas(n,c.image),f=(0,o.default)(c);break;case"panend":if(T=!1,clearTimeout(h),!f)return!1;(c={page:r.default.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:t.pageToPixel(n,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=t.pixelToCanvas(n,c.image),v={page:r.default.cornerstoneMath.point.subtract(c.page,f.page),image:r.default.cornerstoneMath.point.subtract(c.image,f.image),client:r.default.cornerstoneMath.point.subtract(c.client,f.client),canvas:r.default.cornerstoneMath.point.subtract(c.canvas,f.canvas)},u=a.default.TOUCH_DRAG_END,m={event:e.srcEvent,viewport:t.getViewport(n),image:i.image,element:n,startPoints:s,lastPoints:f,currentPoints:c,deltaPoints:v,type:u,isTouchEvent:!0},(0,l.default)(n,u,m),2==e.pointers.length-e.changedPointers.length&&(b=!0);break;case"rotatemove":T=!1,clearTimeout(h),C=e.rotation-y,y=e.rotation,u=a.default.TOUCH_ROTATE,m={event:e.srcEvent,viewport:t.getViewport(n),image:i.image,element:n,rotation:C,type:u},(0,l.default)(n,u,m)}return!1}}function M(e){i.default.disable(e),["touchstart","touchend"].forEach((function(t){e.removeEventListener(t,C)}));var t=(0,u.getToolOptions)(w,e).hammer;t&&t.off("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",C)}var S={enable:function(e){M(e);var t=r.default.Hammer,n={inputClass:t.SUPPORT_POINTER_EVENTS?t.PointerEventInput:t.TouchInput},a=new t.Manager(e,n),o={pointers:0,direction:t.DIRECTION_ALL,threshold:0},l=new t.Pan(o),d=new t.Pinch({threshold:0}),s=new t.Rotate({threshold:0});d.recognizeWith(l),d.recognizeWith(s),s.recognizeWith(l);var c=new t.Tap({event:"doubletap",taps:2,interval:1500,threshold:50,posThreshold:50});c.recognizeWith(l),a.add([c,l,s,d]),a.on("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",C),i.default.enable(e),["touchstart","touchend"].forEach((function(t){e.addEventListener(t,C)}));var f=(0,u.getToolOptions)(w,e);f.hammer=a,(0,u.setToolOptions)(w,e,f)},disable:M};t.default=S},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(n(1)),r=i(n(0)),o=i(n(6));function i(e){return e&&e.__esModule?e:{default:e}}function l(e){var t=r.default.cornerstone,n=e.currentTarget,i=t.getEnabledElement(n);if(i.image&&!("mousewheel"===e.type&&0===e.wheelDeltaY||"DOMMouseScroll"===e.type&&1===e.axis)){e.preventDefault();var l=void 0,u=void 0;void 0!==e.pageX&&void 0!==e.pageY?(l=e.pageX,u=e.pageY):(l=e.x,u=e.y);var d=t.pageToPixel(n,l,u),s=((e=window.event&&window.event.wheelDelta?window.event:e).wheelDelta?e.wheelDelta:e.deltaY?-e.deltaY:e.detail?-e.detail:e.wheelDelta)<0?-1:1,c={element:n,viewport:t.getViewport(n),image:i.image,direction:s,pageX:l,pageY:u,imageX:d.x,imageY:d.y};(0,o.default)(n,a.default.MOUSE_WHEEL,c)}}var u=["mousewheel","DOMMouseScroll"];function d(e){u.forEach((function(t){e.removeEventListener(t,l)}))}var s={enable:function(e){d(e),u.forEach((function(t){e.addEventListener(t,l)}))},disable:d};t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=l(n(1)),r=l(n(0)),o=l(n(42)),i=l(n(6));function l(e){return e&&e.__esModule?e:{default:e}}var u=!0,d=void 0;function s(e){return"number"!=typeof e.buttons?e.which:0===e.buttons?0:e.buttons%2==1?1:e.buttons%4==2?3:e.buttons%8==4?2:0}function c(){u=!1}function f(e){var t=r.default.cornerstone,n=e.currentTarget,l=t.getEnabledElement(n);if(l.image){var u=a.default.MOUSE_DOUBLE_CLICK,d={page:r.default.cornerstoneMath.point.pageToPoint(e),image:t.pageToPixel(n,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};d.canvas=t.pixelToCanvas(n,d.image);var s=(0,o.default)(d),c={event:e,which:e.which,viewport:t.getViewport(n),image:l.image,element:n,startPoints:d,lastPoints:s,currentPoints:d,deltaPoints:{x:0,y:0},type:u};(0,i.default)(n,u,c)}}function v(e){var t=r.default.cornerstone,n=e.currentTarget,l=t.getEnabledElement(n);if(l.image){d=setTimeout(c,200);var f=a.default.MOUSE_DOWN;n.removeEventListener("mousemove",m);var v={page:r.default.cornerstoneMath.point.pageToPoint(e),image:t.pageToPixel(n,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};v.canvas=t.pixelToCanvas(n,v.image);var g=(0,o.default)(v),h={event:e,which:s(e),viewport:t.getViewport(n),image:l.image,element:n,startPoints:v,lastPoints:g,currentPoints:v,deltaPoints:{x:0,y:0},type:f};(0,i.default)(h.element,f,h)&&(h.type=a.default.MOUSE_DOWN_ACTIVATE,(0,i.default)(h.element,a.default.MOUSE_DOWN_ACTIVATE,h));var p=s(e);document.addEventListener("mousemove",E),document.addEventListener("mouseup",(function e(o){clearTimeout(d);var s=a.default.MOUSE_UP;u&&(s=a.default.MOUSE_CLICK);var c={page:r.default.cornerstoneMath.point.pageToPoint(o),image:t.pageToPixel(n,o.pageX,o.pageY),client:{x:o.clientX,y:o.clientY}};c.canvas=t.pixelToCanvas(n,c.image);var f={page:r.default.cornerstoneMath.point.subtract(c.page,g.page),image:r.default.cornerstoneMath.point.subtract(c.image,g.image),client:r.default.cornerstoneMath.point.subtract(c.client,g.client),canvas:r.default.cornerstoneMath.point.subtract(c.canvas,g.canvas)},h={event:o,which:p,viewport:t.getViewport(n),image:l.image,element:n,startPoints:v,lastPoints:g,currentPoints:c,deltaPoints:f,type:s};(0,i.default)(h.element,s,h),document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",e),n.addEventListener("mousemove",m),u=!0}))}function E(e){var u=a.default.MOUSE_DRAG,d={page:r.default.cornerstoneMath.point.pageToPoint(e),image:t.pageToPixel(n,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};d.canvas=t.pixelToCanvas(n,d.image);var s={page:r.default.cornerstoneMath.point.subtract(d.page,g.page),image:r.default.cornerstoneMath.point.subtract(d.image,g.image),client:r.default.cornerstoneMath.point.subtract(d.client,g.client),canvas:r.default.cornerstoneMath.point.subtract(d.canvas,g.canvas)},c={which:p,viewport:t.getViewport(n),image:l.image,element:n,startPoints:v,lastPoints:g,currentPoints:d,deltaPoints:s,type:u,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey};(0,i.default)(c.element,u,c),g=(0,o.default)(d)}}function m(e){var t=r.default.cornerstone,n=e.currentTarget,l=t.getEnabledElement(n);if(l.image){var u=a.default.MOUSE_MOVE,d={page:r.default.cornerstoneMath.point.pageToPoint(e),image:t.pageToPixel(n,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};d.canvas=t.pixelToCanvas(n,d.image);var s=(0,o.default)(d),c={page:r.default.cornerstoneMath.point.pageToPoint(e),image:t.pageToPixel(n,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};c.canvas=t.pixelToCanvas(n,c.image);var f={page:r.default.cornerstoneMath.point.subtract(c.page,s.page),image:r.default.cornerstoneMath.point.subtract(c.image,s.image),client:r.default.cornerstoneMath.point.subtract(c.client,s.client),canvas:r.default.cornerstoneMath.point.subtract(c.canvas,s.canvas)},v={viewport:t.getViewport(n),image:l.image,element:n,startPoints:d,lastPoints:s,currentPoints:c,deltaPoints:f,type:u};(0,i.default)(n,u,v),s=(0,o.default)(c)}}function g(e){e.removeEventListener("mousedown",v),e.removeEventListener("mousemove",m),e.removeEventListener("dblclick",f)}var h={enable:function(e){g(e),e.addEventListener("mousedown",v),e.addEventListener("mousemove",m),e.addEventListener("dblclick",f)},disable:g};t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(n(1)),r=i(n(0)),o=i(n(6));function i(e){return e&&e.__esModule?e:{default:e}}var l=void 0,u=void 0;function d(e){var t=r.default.cornerstone,n=e.currentTarget,i=t.getEnabledElement(n);if(i.image){var d={event:window.event||e,element:n,viewport:t.getViewport(n),image:i.image,currentPoints:{page:{x:l,y:u},image:t.pageToPixel(n,l,u)},keyCode:e.keyCode,which:e.which};d.currentPoints.canvas=t.pixelToCanvas(n,d.currentPoints.image);var s={keydown:a.default.KEY_DOWN,keypress:a.default.KEY_PRESS,keyup:a.default.KEY_UP};(0,o.default)(n,s[e.type],d)}}function s(e){l=e.pageX,u=e.pageY}var c=["keydown","keypress","keyup"],f={enable:function(e){c.forEach((function(t){e.removeEventListener(t,d),e.addEventListener(t,d)})),e.removeEventListener("mousemove",s),e.addEventListener("mousemove",s)},disable:function(e){c.forEach((function(t){e.removeEventListener(t,d)})),e.removeEventListener("mousemove",s)}};t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stopClip=t.playClip=void 0;var a=u(n(1)),r=u(n(0)),o=u(n(13)),i=n(2),l=u(n(6));function u(e){return e&&e.__esModule?e:{default:e}}var d="playClip";function s(e){var t=e.intervalId;void 0!==t&&(e.intervalId=void 0,e.usingFrameTimeVector?clearTimeout(t):clearInterval(t))}t.playClip=function(e,t){var n=void 0,u=void 0;if(void 0===e)throw new Error("playClip: element must not be undefined");var c=(0,i.getToolState)(e,"stack");if(c&&c.data&&c.data.length){var f=r.default.cornerstone,v=void 0;if(c.data.length>1){var m=(0,i.getToolState)(e,"stackRenderer");m&&m.data&&m.data.length&&(v=m.data[0])}var g=c.data[0],h=(0,i.getToolState)(e,d);h&&h.data&&h.data.length?s(n=h.data[0]):(n={intervalId:void 0,framesPerSecond:30,lastFrameTimeStamp:void 0,frameRate:0,frameTimeVector:void 0,ignoreFrameTimeVector:!1,usingFrameTimeVector:!1,speed:1,reverse:!1,loop:!0},(0,i.addToolState)(e,d,n)),(t<0||t>0)&&(n.framesPerSecond=Number(t),n.reverse=n.framesPerSecond<0,n.ignoreFrameTimeVector=!0),!0!==n.ignoreFrameTimeVector&&n.frameTimeVector&&n.frameTimeVector.length===g.imageIds.length&&(u=function(e,t){var n=void 0,a=void 0,r=void 0,o=0,i=e.length,l=[];for(l.isTimeVarying=!1,("number"!=typeof t||t<=0)&&(t=1),n=1;n<i;n++)r=Number(e[n])/t|0,l.push(r),1===n?a=r:r!==a&&(l.isTimeVarying=!0),o+=r;return l.length>0&&(r=l.isTimeVarying?o/l.length|0:l[0],l.push(r)),l}(n.frameTimeVector,n.speed));var p=function(){var t=void 0,r=void 0,i=void 0,u=g.currentImageIdIndex,d=g.imageIds.length;if(n.reverse?u--:u++,!n.loop&&(u<0||u>=d))return s(n),void function(e){var t={element:e};(0,l.default)(e,a.default.CLIP_STOPPED,t)}(e);u>=d&&(u=0),u<0&&(u=d-1),u!==g.currentImageIdIndex&&(t=o.default.getStartLoadHandler(),r=o.default.getEndLoadHandler(),i=o.default.getErrorLoadingHandler(),t&&t(e),(!0===g.preventCache?f.loadImage(g.imageIds[u]):f.loadAndCacheImage(g.imageIds[u])).then((function(t){try{g.currentImageIdIndex=u,v?(v.currentImageIdIndex=u,v.render(e,c.data)):f.displayImage(e,t),r&&r(e,t)}catch(e){return}}),(function(t){var n=g.imageIds[u];i&&i(e,n,t)})))};u&&u.length>0&&u.isTimeVarying?(n.usingFrameTimeVector=!0,n.intervalId=setTimeout((function e(){n.intervalId=setTimeout(e,u[g.currentImageIdIndex]),p()}),0)):(n.usingFrameTimeVector=!1,n.intervalId=setInterval(p,1e3/Math.abs(n.framesPerSecond)))}},t.stopClip=function(e){var t=(0,i.getToolState)(e,d);t&&t.data&&t.data.length&&s(t.data[0])}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=(a=n(0))&&a.__esModule?a:{default:a},i=n(2),l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentImageIdIndex=0,this.layerIds=[],this.findImageFn=void 0}return r(e,[{key:"render",value:function(e,t){var n=this;if(!Number.isInteger(this.currentImageIdIndex))throw new Error("FusionRenderer: render - Image ID Index is not an integer");if(!this.findImageFn)throw new Error("No findImage function has been defined");t||(t=(0,i.getToolState)(e,"stack").data);var a=o.default.cornerstone,r=t[0],l=r.imageIds[this.currentImageIdIndex],u=t.slice(1,t.length);return a.loadAndCacheImage(l).then((function(t){var o=n.layerIds[0],i=[];return o?a.setLayerImage(e,t,o):(o=a.addLayer(e,t,r.options),n.layerIds.push(o)),a.displayImage(e,t),u.forEach((function(t,r){var u=n.findImageFn(t.imageIds,l),d=r+1,s=n.layerIds[d];if(s||(s=a.addLayer(e,void 0,t.options),n.layerIds.push(s)),u){var c=a.loadAndCacheImage(u).then((function(t){a.setLayerImage(e,t,s),a.updateImage(e)}));i.push(c)}else a.setLayerImage(e,void 0,s),a.setActiveLayer(e,o),a.updateImage(e)})),Promise.all(i)}))}}]),e}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,r=(a=n(116))&&a.__esModule?a:{default:a},o={};o.FusionRenderer=r.default,t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,r=(a=n(26))&&a.__esModule?a:{default:a},o=n(2),i=n(3),l=(0,r.default)((function(e){var t=e.detail,n=t.element,a=t.enabledElement.canvas.width,r=t.enabledElement.canvas.height;if(!a||!r)return!1;var u=(0,i.getNewContext)(t.enabledElement.canvas);(0,i.draw)(u,(function(e){var t=l.getConfiguration(),u=void 0;u="horizontal"===t.orientation?{left:0,top:r-6,width:a,height:6}:{left:0,top:0,width:6,height:r},(0,i.fillBox)(e,u,t.backgroundColor);var d=(0,o.getToolState)(n,"stack");if(d&&d.data&&d.data.length){var s=d.data[0].imageIds,c=d.data[0].currentImageIdIndex,f=a/s.length,v=r/s.length,m=f*c,g=v*c;u="horizontal"===t.orientation?{left:m,top:r-6,width:f,height:6}:{left:0,top:g,width:6,height:v},(0,i.fillBox)(e,u,t.fillColor)}}))}));l.setConfiguration({backgroundColor:"rgb(19, 63, 141)",fillColor:"white",orientation:"horizontal"}),t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=u(n(0)),r=u(n(47)),o=u(n(13)),i=n(2),l=n(35);function u(e){return e&&e.__esModule?e:{default:e}}var d="stackPrefetch",s="prefetch",c={maxImagesToPrefetch:1/0,preserveExistingPool:!1},f=void 0,v=function(e){return Math.max.apply(null,e)},m=function(e){return Math.min.apply(null,e)};function g(e){var t=(0,i.getToolState)(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0],l=(0,i.getToolState)(e,d);if(l){var u=l.data[0]||{};if(u.indicesToRequest&&u.indicesToRequest.length||(u.enabled=!1),!1!==u.enabled&&(l.data[0].indicesToRequest.sort((function(e,t){return e-t})),u.indicesToRequest.slice().forEach((function(e){var t=n.imageIds[e];t&&a.default.cornerstone.imageCache.getImageLoadObject(t)&&A(e)})),u.indicesToRequest.length)){c.preserveExistingPool||r.default.clearRequestStack(s);for(var f,g,h,p,E=(f=u.indicesToRequest,g=n.currentImageIdIndex,h=[],p=[],f.forEach((function(e){e<g?h.push(e):e>g&&p.push(e)})),{low:f.indexOf(v(h)),high:f.indexOf(m(p))}),y=void 0,b=void 0,T=o.default.getErrorLoadingHandler(),x=E.low,w=E.high,C=[];x>=0||w<u.indicesToRequest.length;){var M=n.currentImageIdIndex,S=!(M-u.indicesToRequest[x]>c.maxImagesToPrefetch)&&x>=0,O=!(u.indicesToRequest[w]-M>c.maxImagesToPrefetch)&&w<u.indicesToRequest.length;if(!O&&!S)break;S&&(b=u.indicesToRequest[x--],y=n.imageIds[b],C.push(y)),O&&(b=u.indicesToRequest[w++],y=n.imageIds[b],C.push(y))}var I=!0,_=!1,P=void 0;try{for(var L,D=C.reverse()[Symbol.iterator]();!(I=(L=D.next()).done);I=!0){var j=L.value;r.default.addRequest(e,j,s,!1,R,k,!0)}}catch(e){_=!0,P=e}finally{try{!I&&D.return&&D.return()}finally{if(_)throw P}}r.default.startGrabbing()}}}function A(e){var t=u.indicesToRequest.indexOf(e);t>-1&&u.indicesToRequest.splice(t,1)}function R(e){A(n.imageIds.indexOf(e.imageId))}function k(t){console.log("prefetch errored: "+t),T&&T(e,y,t,"stackPrefetch")}}function h(e){return function(t){var n=t.detail,a=void 0;try{a=(0,i.getToolState)(e,"stack")}catch(e){return}if(a&&a.data&&a.data.length){var r=a.data[0].imageIds.indexOf(n.imageId);if(!(r<0)){var o=(0,i.getToolState)(e,d);o&&o.data&&o.data.length&&o.data[0].indicesToRequest.push(r)}}}}function p(e){clearTimeout(f),f=setTimeout((function(){var t=e.target;try{g(t)}catch(e){return}}),10)}function E(){r.default.clearRequestStack(s)}var y={enable:function(e){(0,i.getToolState)(e,d).data=[];var t=(0,i.getToolState)(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];if(!0!==n.preventCache){var r={indicesToRequest:function(e,t){e=Math.round(e)||0;var n=[],a=(t=Math.round(t)||0)-e+1;if(a<=0)return n;for(;a--;)n[a]=t--;return n}(0,n.imageIds.length-1),enabled:!0,direction:1},o=r.indicesToRequest.indexOf(n.currentImageIdIndex);r.indicesToRequest.splice(o,1),(0,i.addToolState)(e,d,r),g(e),e.removeEventListener(a.default.cornerstone.EVENTS.NEW_IMAGE,p),e.addEventListener(a.default.cornerstone.EVENTS.NEW_IMAGE,p);var l=h(e);a.default.cornerstone.events.removeEventListener(a.default.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,l),a.default.cornerstone.events.addEventListener(a.default.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,l),a.default.cornerstone.events.removeEventListener(a.default.cornerstone.EVENTS.IMAGE_CACHE_FULL,E),a.default.cornerstone.events.addEventListener(a.default.cornerstone.EVENTS.IMAGE_CACHE_FULL,E)}else console.warn("A stack that should not be cached was given the stackPrefetch")}},disable:function(e){clearTimeout(f),e.removeEventListener(a.default.cornerstone.EVENTS.NEW_IMAGE,p);var t=h(e);a.default.cornerstone.events.removeEventListener(a.default.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,t),a.default.cornerstone.events.removeEventListener(a.default.cornerstone.EVENTS.IMAGE_CACHE_FULL,E);var n=(0,i.getToolState)(e,d);n&&n.data.length&&(n.data[0].enabled=!1,r.default.clearRequestStack(s))},getConfiguration:function(){return c},setConfiguration:function(e){c=e,e.maxSimultaneousRequests&&(0,l.setMaxSimultaneousRequests)(e.maxSimultaneousRequests)}};t.default=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stackScrollMultiTouch=t.stackScrollTouchDrag=t.stackScrollWheel=t.stackScroll=void 0;var a=f(n(1)),r=f(n(19)),o=f(n(38)),i=f(n(17)),l=f(n(31)),u=f(n(5)),d=f(n(46)),s=n(2),c=n(4);function f(e){return e&&e.__esModule?e:{default:e}}var v="stackScroll";function m(e){var t=e.detail.element;t.removeEventListener(a.default.MOUSE_DRAG,g),t.removeEventListener(a.default.MOUSE_UP,m),t.removeEventListener(a.default.MOUSE_CLICK,m)}function g(e){var t=e.detail,n=t.element,a=(0,s.getToolState)(n,"stack");if(a&&a.data&&a.data.length){var r=a.data[0],o=h.getConfiguration(),i=!0;o&&void 0!==o.allowSkipping&&(i=o.allowSkipping);var l=Math.max(2,n.offsetHeight/Math.max(r.imageIds.length,8));o&&o.stackScrollSpeed&&(l=o.stackScrollSpeed);var u=(0,c.getToolOptions)(v,n),f=u.deltaY||0;if(f+=t.deltaPoints.page.y,Math.abs(f)>=l){var m=Math.round(f/l);(0,d.default)(n,m,!1,i),u.deltaY=f%l}else u.deltaY=f;(0,c.setToolOptions)(v,n,u),e.preventDefault(),e.stopPropagation()}}var h=(0,i.default)((function(e){var t=e.detail,n=t.element,r=(0,c.getToolOptions)(v,n);if((0,u.default)(t.which,r.mouseButtonMask))return r.deltaY=0,(0,c.setToolOptions)(v,n,r),n.addEventListener(a.default.MOUSE_DRAG,g),n.addEventListener(a.default.MOUSE_UP,m),n.addEventListener(a.default.MOUSE_CLICK,m),e.stopImmediatePropagation(),!1}),v),p=(0,l.default)((function(e){var t=e.detail,n=-t.direction,a=h.getConfiguration(),r=!1,o=!0;a&&(r=void 0!==a.loop&&a.loop,o=void 0===a.allowSkipping||a.allowSkipping),(0,d.default)(t.element,n,r,o)})),E={eventData:{deltaY:0}},y=(0,r.default)(g,"stackScrollTouchDrag",E),b=(0,o.default)((function(e){var t=e.detail,n=b.getConfiguration();n&&n.testPointers(t)&&g(e)}),E);b.setConfiguration({testPointers:function(e){return e.numPointers>=3}}),t.stackScroll=h,t.stackScrollWheel=p,t.stackScrollTouchDrag=y,t.stackScrollMultiTouch=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(n(46));function r(e){return e&&e.__esModule?e:{default:e}}var o=38,i=40,l=(0,r(n(62)).default)((function(e){var t=e.detail,n=t.keyCode;if(n===o||n===i){var r=1;n===i&&(r=-1),(0,a.default)(t.element,r)}}));t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,r=(a=n(0))&&a.__esModule?a:{default:a},o=n(28),i=n(2),l={save:function(e){var t={imageIdToolState:o.globalImageIdSpecificToolStateManager.saveToolState(),elementToolState:{},elementViewport:{}};return e.forEach((function(e){var n=(0,i.getElementToolStateManager)(e);n!==o.globalImageIdSpecificToolStateManager&&(t.elementToolState[e.id]=n.saveToolState(),t.elementViewport[e.id]=r.default.cornerstone.getViewport(e))})),t},restore:function(e){if(e.hasOwnProperty("imageIdToolState")&&e.hasOwnProperty("elementToolState")&&e.hasOwnProperty("elementViewport")){var t=r.default.cornerstone;return o.globalImageIdSpecificToolStateManager.restoreToolState(e.imageIdToolState),Object.keys(e.elementViewport).forEach((function(n){var a=document.getElementById(n);if(a&&e.elementToolState.hasOwnProperty(n)){var r=(0,i.getElementToolStateManager)(a);if(r!==o.globalImageIdSpecificToolStateManager){r.restoreToolState(e.elementToolState[n]);var l=e.elementViewport[n];t.setViewport(a,l),t.updateImage(a)}}})),e}}};t.default=l},function(e,t,n){"use strict";function a(){var e={};return{get:function(t,n){if(!1!==e.hasOwnProperty(t)){var a=e[t];if(!1!==a.hasOwnProperty(n))return a[n]}},add:function(t,n,a){!1===e.hasOwnProperty(t)&&(e[t]={});var r=e[t];!1===r.hasOwnProperty(n)&&(r[n]={data:[]}),r[n].data.push(a)},remove:function(t,n,a){if(!1!==e.hasOwnProperty(t)){var r=e[t];if(!1!==r.hasOwnProperty(n)){for(var o=r[n],i=-1,l=0;l<o.data.length;l++)o.data[l]===a&&(i=l);-1!==i&&o.data.splice(i,1)}}}}}Object.defineProperty(t,"__esModule",{value:!0});var r=a();t.newFrameOfReferenceSpecificToolStateManager=a,t.globalFrameOfReferenceSpecificToolStateManager=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addStackStateManager=t.newStackSpecificToolStateManager=t.stackSpecificStateManager=void 0;var a=n(28),r=n(2);function o(e,t){var n={};return{get:function(a,r){return e.indexOf(r)>=0?(!1===n.hasOwnProperty(r)&&(n[r]={data:[]}),n[r]):t.get(a,r)},add:function(a,r,o){if(!(e.indexOf(r)>=0))return t.add(a,r,o);!1===n.hasOwnProperty(r)&&(n[r]={data:[]}),n[r].data.push(o)},saveToolState:function(){return n},restoreToolState:function(e){n=e},toolState:n}}var i=[];function l(e,t){var n=(0,r.getElementToolStateManager)(e);n||(n=a.globalImageIdSpecificToolStateManager);var l=["stack","stackPrefetch","playClip","volume","slab","referenceLines","crosshairs","stackRenderer"];t&&(l=l.concat(t));var u=o(l,n);i.push(u),(0,r.setElementToolStateManager)(e,u)}var u={newStackSpecificToolStateManager:o,addStackStateManager:l};t.stackSpecificStateManager=u,t.newStackSpecificToolStateManager=o,t.addStackStateManager=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.newTimeSeriesSpecificToolStateManager=t.addTimeSeriesStateManager=void 0;var a=n(28),r=n(2);function o(e,t){var n={};return{get:function(a,r){return e.indexOf(r)>=0?(!1===n.hasOwnProperty(r)&&(n[r]={data:[]}),n[r]):t.get(a,r)},add:function(a,r,o){if(!(e.indexOf(r)>=0))return t.add(a,r,o);!1===n.hasOwnProperty(r)&&(n[r]={data:[]}),n[r].data.push(o)}}}var i=[];t.addTimeSeriesStateManager=function(e,t){t=t||["timeSeries"];var n=(0,r.getElementToolStateManager)(e);void 0===n&&(n=a.globalImageIdSpecificToolStateManager);var l=o(t,n);i.push(l),(0,r.setElementToolStateManager)(e,l)},t.newTimeSeriesSpecificToolStateManager=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(n!==t){var a=r.default.cornerstone,o=a.getViewport(t),i=a.getViewport(n);i.scale===o.scale&&i.translation.x===o.translation.x&&i.translation.y===o.translation.y||(i.scale=o.scale,i.translation.x=o.translation.x,i.translation.y=o.translation.y,e.setViewport(n,i))}};var a,r=(a=n(0))&&a.__esModule?a:{default:a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(n!==t){var l=a.default.cornerstone,u=(0,r.getToolState)(t,"stack").data[0],d=(0,r.getToolState)(n,"stack").data[0],s=u.currentImageIdIndex;if((s=(0,i.default)(s,0,d.imageIds.length-1))!==d.currentImageIdIndex){var c=o.default.getStartLoadHandler(),f=o.default.getEndLoadHandler(),v=o.default.getErrorLoadingHandler();c&&c(n),(!0===d.preventCache?l.loadImage(d.imageIds[s]):l.loadAndCacheImage(d.imageIds[s])).then((function(t){var a=l.getViewport(n);d.currentImageIdIndex=s,e.displayImage(n,t,a),f&&f(n,t)}),(function(e){var t=d.imageIds[s];v&&v(n,t,e)}))}}};var a=l(n(0)),r=n(2),o=l(n(13)),i=l(n(8));function l(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,l,u){if(n!==t){var d=a.default.cornerstone,s=d.getEnabledElement(t),c=d.metaData.get("imagePlaneModule",s.image.imageId);if(void 0!==c&&void 0!==c.imagePositionPatient){var f=(0,i.default)(c.imagePositionPatient),v=(0,r.getToolState)(n,"stack").data[0],m=Number.MAX_VALUE,g=-1;if(u){var h=f.clone().add(u);if(v.imageIds.forEach((function(e,t){var n=d.metaData.get("imagePlaneModule",e);if(void 0!==n&&void 0!==n.imagePositionPatient){var a=(0,i.default)(n.imagePositionPatient),r=h.distanceToSquared(a);r<m&&(m=r,g=t)}})),g!==v.currentImageIdIndex&&-1!==g){var p=o.default.getStartLoadHandler(),E=o.default.getEndLoadHandler(),y=o.default.getErrorLoadingHandler();v.currentImageIdIndex=g;var b=v.imageIds[g];p&&p(n),(!0===v.preventCache?d.loadImage(b):d.loadAndCacheImage(b)).then((function(t){var a=d.getViewport(n);v.currentImageIdIndex===g&&(e.displayImage(n,t,a),E&&E(n,t))}),(function(e){var t=v.imageIds[g];y&&y(n,t,e)}))}}}}};var a=l(n(0)),r=n(2),o=l(n(13)),i=l(n(21));function l(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(n!==t){var l=a.default.cornerstone,u=l.getEnabledElement(t).image,d=l.metaData.get("imagePlaneModule",u.imageId);if(void 0!==d&&void 0!==d.imagePositionPatient){var s=(0,i.default)(d.imagePositionPatient),c=(0,r.getToolState)(n,"stack").data[0],f=Number.MAX_VALUE,v=-1;if(c.imageIds.forEach((function(e,t){var n=l.metaData.get("imagePlaneModule",e);if(void 0!==n&&void 0!==n.imagePositionPatient){var a=(0,i.default)(n.imagePositionPatient).distanceToSquared(s);a<f&&(f=a,v=t)}})),v!==c.currentImageIdIndex){var m=o.default.getStartLoadHandler(),g=o.default.getEndLoadHandler(),h=o.default.getErrorLoadingHandler();c.currentImageIdIndex=v;var p=c.imageIds[v];m&&m(n),-1!==v&&(!0===c.preventCache?l.loadImage(p):l.loadAndCacheImage(p)).then((function(t){var a=l.getViewport(n);c.currentImageIdIndex===v&&(e.displayImage(n,t,a),g&&g(n,t))}),(function(e){var t=c.imageIds[v];h&&h(n,t,e)}))}}}};var a=l(n(0)),r=n(2),o=l(n(13)),i=l(n(21));function l(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,l){if(t!==n&&l&&l.direction){var u=a.default.cornerstone,d=(0,r.getToolState)(n,"stack").data[0],s=d.currentImageIdIndex+l.direction;if(s=(0,i.default)(s,0,d.imageIds.length-1),d.currentImageIdIndex!==s){var c=o.default.getStartLoadHandler(),f=o.default.getEndLoadHandler(),v=o.default.getErrorLoadingHandler();d.currentImageIdIndex=s;var m=d.imageIds[s];c&&c(n),(!0===d.preventCache?u.loadImage(m):u.loadAndCacheImage(m)).then((function(t){var a=u.getViewport(n);d.currentImageIdIndex===s&&(e.displayImage(n,t,a),f&&f(n,t))}),(function(e){var t=d.imageIds[s];v&&v(n,t,e)}))}}};var a=l(n(0)),r=n(2),o=l(n(13)),i=l(n(8));function l(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(n(0)),r=i(n(21)),o=n(4);function i(e){return e&&e.__esModule?e:{default:e}}function l(e){return e.filter((function(e,t,n){return n.indexOf(e)===t}))}t.default=function(e,t){var n=a.default.cornerstone,i=this,u=[],d=[],s=!1,c={},f=t;function v(e,t){i.enabled&&u.length&&d.length&&(s=!0,d.forEach((function(n){var a=d.indexOf(n);if(-1!==a){var r=c.imageIds.targetElements[a],o=u.indexOf(e);if(-1!==o){var l=c.imageIds.sourceElements[o],s=void 0;l===r?s=0:void 0!==c.distances[l]&&(s=c.distances[l][r]),f(i,e,n,t,s)}}})),s=!1)}function m(e){var t=e.detail;!0!==s&&v(e.currentTarget,t)}function g(e){var t=e.detail.element;i.remove(t),(0,o.clearToolOptionsByElement)(t)}this.enabled=!0,this.setHandler=function(e){f=e},this.getHandler=function(){return f},this.getDistances=function(){u.length&&d.length&&(c.distances={},c.imageIds={sourceElements:[],targetElements:[]},u.forEach((function(e){var t=n.getEnabledElement(e);if(t&&t.image){var a=t.image.imageId,o=n.metaData.get("imagePlaneModule",a);if(o&&o.imagePositionPatient){var i=(0,r.default)(o.imagePositionPatient);c.hasOwnProperty(t)||(c.distances[a]={},c.imageIds.sourceElements.push(a),d.forEach((function(t){var o=n.getEnabledElement(t);if(o&&o.image){var l=o.image.imageId;if(c.imageIds.targetElements.push(l),e!==t&&a!==l&&!c.distances[a].hasOwnProperty(l)){var u=n.metaData.get("imagePlaneModule",l);if(u&&u.imagePositionPatient){var d=(0,r.default)(u.imagePositionPatient);c.distances[a][l]=d.clone().sub(i)}}}})),Object.keys(c.distances[a]).length||delete c.distances[a])}}})))},this.addSource=function(t){-1===u.indexOf(t)&&(u.push(t),e.split(" ").forEach((function(e){t.addEventListener(e,m)})),i.getDistances(),i.updateDisableHandlers())},this.addTarget=function(e){-1===d.indexOf(e)&&(d.push(e),i.getDistances(),f(i,e,e,0),i.updateDisableHandlers())},this.add=function(e){i.addSource(e),i.addTarget(e)},this.removeSource=function(t){var n=u.indexOf(t);-1!==n&&(u.splice(n,1),e.split(" ").forEach((function(e){t.removeEventListener(e,m)})),i.getDistances(),v(t),i.updateDisableHandlers())},this.removeTarget=function(e){var t=d.indexOf(e);-1!==t&&(d.splice(t,1),i.getDistances(),f(i,e,e,0),i.updateDisableHandlers())},this.remove=function(e){i.removeTarget(e),i.removeSource(e)},this.getSourceElements=function(){return u},this.getTargetElements=function(){return d},this.displayImage=function(e,t,a){s=!0,n.displayImage(e,t,a),s=!1},this.setViewport=function(e,t){s=!0,n.setViewport(e,t),s=!1},this.updateDisableHandlers=function(){l(u.concat(d)).forEach((function(e){e.removeEventListener(a.default.cornerstone.EVENTS.ELEMENT_DISABLED,g),e.addEventListener(a.default.cornerstone.EVENTS.ELEMENT_DISABLED,g)}))},this.destroy=function(){l(u.concat(d)).forEach((function(e){i.remove(e)}))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){n!==t&&r.default.cornerstone.updateImage(n)};var a,r=(a=n(0))&&a.__esModule?a:{default:a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(n!==t){var a=r.default.cornerstone,o=a.getViewport(t),i=a.getViewport(n);i.voi.windowWidth===o.voi.windowWidth&&i.voi.windowCenter===o.voi.windowCenter&&i.invert===o.invert||(i.voi.windowWidth=o.voi.windowWidth,i.voi.windowCenter=o.voi.windowCenter,i.invert=o.invert,e.setViewport(n,i))}};var a,r=(a=n(0))&&a.__esModule?a:{default:a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.timeSeriesScrollTouchDrag=t.timeSeriesScrollWheel=t.timeSeriesScroll=void 0;var a=c(n(1)),r=c(n(17)),o=c(n(19)),i=c(n(31)),l=c(n(39)),u=c(n(5)),d=n(2),s=n(4);function c(e){return e&&e.__esModule?e:{default:e}}var f="timeSeriesScroll";function v(e){var t=e.detail.element;t.removeEventListener(a.default.MOUSE_DRAG,m),t.removeEventListener(a.default.MOUSE_UP,v),t.removeEventListener(a.default.MOUSE_CLICK,v)}function m(e){var t=e.detail,n=t.element;e.data.deltaY+=t.deltaPoints.page.y;var a=(0,d.getToolState)(t.element,"timeSeries");if(void 0!==a&&void 0!==a.data&&0!==a.data.length){var r=a.data[0],o=n.offsetHeight/r.stacks.length;if(void 0!==e.data.options&&void 0!==e.data.options.timeSeriesScrollSpeed&&(o=e.data.options.timeSeriesScrollSpeed),e.data.deltaY>=o||e.data.deltaY<=-o){var i=Math.round(e.data.deltaY/o),u=e.data.deltaY%o;(0,l.default)(t.element,i),e.data.deltaY=u}return!1}}var g=(0,r.default)((function(e){var t=e.detail,n=t.element,r=(0,s.getToolOptions)(f,n);if((0,u.default)(t.which,r.mouseButtonMask))return r.deltaY=0,(0,s.setToolOptions)(f,n,r),n.addEventListener(a.default.MOUSE_DRAG,m),n.addEventListener(a.default.MOUSE_UP,v),n.addEventListener(a.default.MOUSE_CLICK,v),e.stopImmediatePropagation(),!1}),f),h=(0,i.default)((function(e){var t=e.detail,n=-t.direction;(0,l.default)(t.element,n)})),p=(0,o.default)((function(e){var t=e.originalEvent.detail,n={deltaY:0};n.deltaY+=t.deltaPoints.page.y;var a=(0,d.getToolState)(t.element,"stack");if(void 0!==a&&void 0!==a.data&&0!==a.data.length){if(n.deltaY>=3||n.deltaY<=-3){var r=n.deltaY/3,o=n.deltaY%3;(0,l.default)(n.element,r),n.deltaY=o}return!1}}));t.timeSeriesScroll=g,t.timeSeriesScrollWheel=h,t.timeSeriesScrollTouchDrag=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,r=n(2),o=(a=n(39))&&a.__esModule?a:{default:a},i="timeSeriesPlayer",l={start:function(e,t){if(void 0===e)throw new Error("playClip: element must not be undefined");void 0===t&&(t=30);var n=(0,r.getToolState)(e,"timeSeries");if(void 0!==n&&void 0!==n.data&&0!==n.data.length){var a=(0,r.getToolState)(e,i),l=void 0;void 0===a||0===a.data.length?(l={intervalId:void 0,framesPerSecond:t,lastFrameTimeStamp:void 0,frameRate:0},(0,r.addToolState)(e,i,l)):(l=a.data[0]).framesPerSecond=t,void 0===l.intervalId&&(l.intervalId=setInterval((function(){l.framesPerSecond>0?(0,o.default)(e,1,!0):(0,o.default)(e,-1,!0)}),1e3/Math.abs(l.framesPerSecond)))}},stop:function(e){var t=(0,r.getToolState)(e,i);if(t&&t.data&&t.data.length){var n=t.data[0];clearInterval(n.intervalId),n.intervalId=void 0}}};t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=r.default.cornerstone,t=this;t.samples=[],this.set=function(n){t.samples=n,(0,o.default)(e.events,a.default.LINE_SAMPLE_UPDATED)}};var a=i(n(1)),r=i(n(0)),o=i(n(6));function i(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(n(1)),r=i(n(0)),o=i(n(6));function i(e){return e&&e.__esModule?e:{default:e}}var l=new function(){var e=r.default.cornerstone,t=this;t.measurements=[],this.add=function(n){var r={index:t.measurements.push(n),measurement:n};(0,o.default)(e.events,a.default.MEASUREMENT_ADDED,r)},this.remove=function(n){var r=t.measurements[n];t.measurements.splice(n,1);var i={index:n,measurement:r};(0,o.default)(e.events,a.default.MEASUREMENT_REMOVED,i)}};t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=c(n(0)),r=c(n(10)),o=c(n(9)),i=n(2),l=c(n(137)),u=c(n(136)),d=c(n(11)),s=n(3);function c(e){return e&&e.__esModule?e:{default:e}}var f="probe4D",v=(0,r.default)({createNewMeasurement:function(e){var t=(0,i.getToolState)(e.element,"timeSeries");if(void 0!==t&&void 0!==t.data&&0!==t.data.length){var n=t.data[0],r={timeSeries:n,lineSample:new u.default,imageIdIndex:n.stacks[n.currentStackIndex].currentImageIdIndex,visible:!0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}};return function(e){var t=a.default.cornerstone,n=[];e.timeSeries.stacks.forEach((function(a){(!0===a.preventCache?t.loadImage(a.imageIds[e.imageIdIndex]):t.loadAndCacheImage(a.imageIds[e.imageIdIndex])).then((function(t){var a=Math.round(e.handles.end.x)+Math.round(e.handles.end.y)*t.width,r=t.getPixelData()[a];n.push(r)}))})),e.lineSample.set(n)}(r),l.default.add(r),r}},onImageRendered:function(e){var t=a.default.cornerstone,n=e.detail,r=(0,i.getToolState)(e.currentTarget,f);if(r){var l=n.canvasContext;l.setTransform(1,0,0,1,0,0);for(var u=function(e){(0,s.draw)(l,(function(a){var i=r.data[e];(0,o.default)(a,n,i.handles,"white");var l={x:i.handles.end.x+3,y:i.handles.end.y-3},u=t.pixelToCanvas(n.element,l);(0,d.default)(a,i.handles.end.x+", "+i.handles.end.y,u.x,u.y,"white")}))},c=0;c<r.data.length;c++)u(c)}},toolType:f});t.default=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,r){var o={color:n,lineWidth:r};(0,a.drawCircle)(e,void 0,t,6,o,"canvas")};var a=n(3)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,r,o){var i={x:t,y:n},l={x:t+r,y:n+o};(0,a.drawEllipse)(e,void 0,i,l,{},"canvas")};var a=n(3)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){e.style.webkitUserSelect="none",e.style.webkitTouchCallout="none",e.style.mozUserSelect="none",e.style.msUserSelect="none",e.style.oUserSelect="none",e.style.khtmlUserSelect="none",e.style.userSelect="none",e.unselectable="on",e.oncontextmenu=function(){return!1},!0===t&&(e.style.pointerEvents="none")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){return r.default.cornerstone.setToPixelCoordinateSystem(e,t,.1),{fontSize:n/e.viewport.scale/.1,lineHeight:n/e.viewport.scale/.1,fontScale:.1}};var a,r=(a=n(0))&&a.__esModule?a:{default:a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.replace("H","f");return(t=(t=(t=(t=(t=t.replace("F","h")).replace("R","l")).replace("L","r")).replace("A","p")).replace("P","a")).toUpperCase()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t=(0,r.default)(e),n="",o=t.x<0?"R":"L",i=t.y<0?"A":"P",l=t.z<0?"F":"H",u=new a.default.cornerstoneMath.Vector3(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z)),d=0;d<3;d++)if(u.x>1e-4&&u.x>u.y&&u.x>u.z)n+=o,u.x=0;else if(u.y>1e-4&&u.y>u.x&&u.y>u.z)n+=i,u.y=0;else{if(!(u.z>1e-4&&u.z>u.x&&u.z>u.y))break;n+=l,u.z=0}return n};var a=o(n(0)),r=o(n(21));function o(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefault=function(e,t){return void 0!==e?e:t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(n(0)),r=n(2),o=i(n(68));function i(e){return e&&e.__esModule?e:{default:e}}var l="referenceLines";function u(e){var t=e.detail,n=(0,r.getToolState)(e.currentTarget,l);if(void 0!==n){var o=n.data[0].synchronizationContext.getSourceElements(),i=n.data[0].renderer,u=t.canvasContext.canvas.getContext("2d");a.default.cornerstone.setToPixelCoordinateSystem(t.enabledElement,u),o.forEach((function(n){n!==e.currentTarget&&i(u,t,e.currentTarget,n)}))}}var d={enable:function(e,t,n){n=n||o.default,(0,r.addToolState)(e,l,{synchronizationContext:t,renderer:n}),e.removeEventListener(a.default.cornerstone.EVENTS.IMAGE_RENDERED,u),e.addEventListener(a.default.cornerstone.EVENTS.IMAGE_RENDERED,u),a.default.cornerstone.updateImage(e)},disable:function(e){e.removeEventListener(a.default.cornerstone.EVENTS.IMAGE_RENDERED,u),a.default.cornerstone.updateImage(e)}};t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(n(69)),r=i(n(146)),o=i(n(68));function i(e){return e&&e.__esModule?e:{default:e}}var l={calculateReferenceLine:a.default,tool:r.default,renderActiveReferenceLine:o.default};t.default=l}])},function(e,t){e.exports=window.React},function(e,t,n){var a;window,a=function(){return function(e){var t=window.webpackHotUpdate;window.webpackHotUpdate=function(e,n){!function(e,t){if(b[e]&&y[e]){for(var n in y[e]=!1,t)Object.prototype.hasOwnProperty.call(t,n)&&(m[n]=t[n]);0==--h&&0===p&&C()}}(e,n),t&&t(e,n)};var n,a=!0,r="4d8d88ba53621f59b9a9",o={},i=[],l=[];function u(e){var t=S[e];if(!t)return O;var a=function(a){return t.hot.active?(S[a]?-1===S[a].parents.indexOf(e)&&S[a].parents.push(e):(i=[e],n=a),-1===t.children.indexOf(a)&&t.children.push(a)):(console.warn("[HMR] unexpected require("+a+") from disposed module "+e),i=[]),O(a)},r=function(e){return{configurable:!0,enumerable:!0,get:function(){return O[e]},set:function(t){O[e]=t}}};for(var o in O)Object.prototype.hasOwnProperty.call(O,o)&&"e"!==o&&"t"!==o&&Object.defineProperty(a,o,r(o));return a.e=function(e){return"ready"===c&&f("prepare"),p++,O.e(e).then(t,(function(e){throw t(),e}));function t(){p--,"prepare"===c&&(E[e]||w(e),0===p&&0===h&&C())}},a.t=function(e,t){return 1&t&&(e=a(e)),O.t(e,-2&t)},a}function d(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:n!==e,active:!0,accept:function(e,n){if(void 0===e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"==typeof e)for(var a=0;a<e.length;a++)t._acceptedDependencies[e[a]]=n||function(){};else t._acceptedDependencies[e]=n||function(){}},decline:function(e){if(void 0===e)t._selfDeclined=!0;else if("object"==typeof e)for(var n=0;n<e.length;n++)t._declinedDependencies[e[n]]=!0;else t._declinedDependencies[e]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var n=t._disposeHandlers.indexOf(e);n>=0&&t._disposeHandlers.splice(n,1)},check:x,apply:M,status:function(e){if(!e)return c;s.push(e)},addStatusHandler:function(e){s.push(e)},removeStatusHandler:function(e){var t=s.indexOf(e);t>=0&&s.splice(t,1)},data:o[e]};return n=void 0,t}var s=[],c="idle";function f(e){c=e;for(var t=0;t<s.length;t++)s[t].call(null,e)}var v,m,g,h=0,p=0,E={},y={},b={};function T(e){return+e+""===e?+e:e}function x(e){if("idle"!==c)throw new Error("check() is only allowed in idle status");return a=e,f("check"),(t=1e4,t=t||1e4,new Promise((function(e,n){if("undefined"==typeof XMLHttpRequest)return n(new Error("No browser support"));try{var a=new XMLHttpRequest,o=O.p+""+r+".hot-update.json";a.open("GET",o,!0),a.timeout=t,a.send(null)}catch(e){return n(e)}a.onreadystatechange=function(){if(4===a.readyState)if(0===a.status)n(new Error("Manifest request to "+o+" timed out."));else if(404===a.status)e();else if(200!==a.status&&304!==a.status)n(new Error("Manifest request to "+o+" failed."));else{try{var t=JSON.parse(a.responseText)}catch(e){return void n(e)}e(t)}}}))).then((function(e){if(!e)return f("idle"),null;y={},E={},b=e.c,g=e.h,f("prepare");var t=new Promise((function(e,t){v={resolve:e,reject:t}}));return m={},w("cornerstone"),"prepare"===c&&0===p&&0===h&&C(),t}));var t}function w(e){b[e]?(y[e]=!0,h++,function(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("script");n.charset="utf-8",n.src=O.p+""+e+"."+r+".hot-update.js",t.appendChild(n)}(e)):E[e]=!0}function C(){f("ready");var e=v;if(v=null,e)if(a)Promise.resolve().then((function(){return M(a)})).then((function(t){e.resolve(t)}),(function(t){e.reject(t)}));else{var t=[];for(var n in m)Object.prototype.hasOwnProperty.call(m,n)&&t.push(T(n));e.resolve(t)}}function M(t){if("ready"!==c)throw new Error("apply() is only allowed in ready status");var n,a,l,u,d;function s(e){for(var t=[e],n={},a=t.slice().map((function(e){return{chain:[e],id:e}}));a.length>0;){var r=a.pop(),o=r.id,i=r.chain;if((u=S[o])&&!u.hot._selfAccepted){if(u.hot._selfDeclined)return{type:"self-declined",chain:i,moduleId:o};if(u.hot._main)return{type:"unaccepted",chain:i,moduleId:o};for(var l=0;l<u.parents.length;l++){var d=u.parents[l],s=S[d];if(s){if(s.hot._declinedDependencies[o])return{type:"declined",chain:i.concat([d]),moduleId:o,parentId:d};-1===t.indexOf(d)&&(s.hot._acceptedDependencies[o]?(n[d]||(n[d]=[]),v(n[d],[o])):(delete n[d],t.push(d),a.push({chain:i.concat([d]),id:d})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:n}}function v(e,t){for(var n=0;n<t.length;n++){var a=t[n];-1===e.indexOf(a)&&e.push(a)}}t=t||{};var h={},p=[],E={},y=function(){console.warn("[HMR] unexpected require("+w.moduleId+") to disposed module")};for(var x in m)if(Object.prototype.hasOwnProperty.call(m,x)){var w;d=T(x);var C=!1,M=!1,I=!1,_="";switch((w=m[x]?s(d):{type:"disposed",moduleId:x}).chain&&(_="\nUpdate propagation: "+w.chain.join(" -> ")),w.type){case"self-declined":t.onDeclined&&t.onDeclined(w),t.ignoreDeclined||(C=new Error("Aborted because of self decline: "+w.moduleId+_));break;case"declined":t.onDeclined&&t.onDeclined(w),t.ignoreDeclined||(C=new Error("Aborted because of declined dependency: "+w.moduleId+" in "+w.parentId+_));break;case"unaccepted":t.onUnaccepted&&t.onUnaccepted(w),t.ignoreUnaccepted||(C=new Error("Aborted because "+d+" is not accepted"+_));break;case"accepted":t.onAccepted&&t.onAccepted(w),M=!0;break;case"disposed":t.onDisposed&&t.onDisposed(w),I=!0;break;default:throw new Error("Unexception type "+w.type)}if(C)return f("abort"),Promise.reject(C);if(M)for(d in E[d]=m[d],v(p,w.outdatedModules),w.outdatedDependencies)Object.prototype.hasOwnProperty.call(w.outdatedDependencies,d)&&(h[d]||(h[d]=[]),v(h[d],w.outdatedDependencies[d]));I&&(v(p,[w.moduleId]),E[d]=y)}var P,L=[];for(a=0;a<p.length;a++)d=p[a],S[d]&&S[d].hot._selfAccepted&&L.push({module:d,errorHandler:S[d].hot._selfAccepted});f("dispose"),Object.keys(b).forEach((function(e){!1===b[e]&&function(e){delete installedChunks[e]}(e)}));for(var D,j,A=p.slice();A.length>0;)if(d=A.pop(),u=S[d]){var R={},k=u.hot._disposeHandlers;for(l=0;l<k.length;l++)(n=k[l])(R);for(o[d]=R,u.hot.active=!1,delete S[d],delete h[d],l=0;l<u.children.length;l++){var U=S[u.children[l]];U&&(P=U.parents.indexOf(d))>=0&&U.parents.splice(P,1)}}for(d in h)if(Object.prototype.hasOwnProperty.call(h,d)&&(u=S[d]))for(j=h[d],l=0;l<j.length;l++)D=j[l],(P=u.children.indexOf(D))>=0&&u.children.splice(P,1);for(d in f("apply"),r=g,E)Object.prototype.hasOwnProperty.call(E,d)&&(e[d]=E[d]);var N=null;for(d in h)if(Object.prototype.hasOwnProperty.call(h,d)&&(u=S[d])){j=h[d];var H=[];for(a=0;a<j.length;a++)if(D=j[a],n=u.hot._acceptedDependencies[D]){if(-1!==H.indexOf(n))continue;H.push(n)}for(a=0;a<H.length;a++){n=H[a];try{n(j)}catch(e){t.onErrored&&t.onErrored({type:"accept-errored",moduleId:d,dependencyId:j[a],error:e}),t.ignoreErrored||N||(N=e)}}}for(a=0;a<L.length;a++){var V=L[a];d=V.module,i=[d];try{O(d)}catch(e){if("function"==typeof V.errorHandler)try{V.errorHandler(e)}catch(n){t.onErrored&&t.onErrored({type:"self-accept-error-handler-errored",moduleId:d,error:n,originalError:e}),t.ignoreErrored||N||(N=n),N||(N=e)}else t.onErrored&&t.onErrored({type:"self-accept-errored",moduleId:d,error:e}),t.ignoreErrored||N||(N=e)}}return N?(f("fail"),Promise.reject(N)):(f("idle"),new Promise((function(e){e(p)})))}var S={};function O(t){if(S[t])return S[t].exports;var n=S[t]={i:t,l:!1,exports:{},hot:d(t),parents:(l=i,i=[],l),children:[]};return e[t].call(n.exports,n,n.exports,u(t)),n.l=!0,n.exports}return O.m=e,O.c=S,O.d=function(e,t,n){O.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},O.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},O.t=function(e,t){if(1&t&&(e=O(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(O.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)O.d(n,a,function(t){return e[t]}.bind(null,a));return n},O.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return O.d(t,"a",t),t},O.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},O.p="",O.h=function(){return r},u("./index.js")(O.s="./index.js")}({"./canvasToPixel.js":function(e,t,n){"use strict";n.r(t);var a=n("./enabledElements.js"),r=n("./internal/getTransform.js");t.default=function(e,t){var n=Object(a.getEnabledElement)(e),o=Object(r.default)(n);return o.invert(),o.transformPoint(t.x,t.y)}},"./colors/colormap.js":function(e,t,n){"use strict";n.r(t),n.d(t,"getColormapsList",(function(){return u})),n.d(t,"getColormap",(function(){return d}));var a=n("./colors/lookupTable.js"),r=[0,0,0,0],o={hotIron:{name:"Hot Iron",numOfColors:256,colors:[[0,0,0,255],[2,0,0,255],[4,0,0,255],[6,0,0,255],[8,0,0,255],[10,0,0,255],[12,0,0,255],[14,0,0,255],[16,0,0,255],[18,0,0,255],[20,0,0,255],[22,0,0,255],[24,0,0,255],[26,0,0,255],[28,0,0,255],[30,0,0,255],[32,0,0,255],[34,0,0,255],[36,0,0,255],[38,0,0,255],[40,0,0,255],[42,0,0,255],[44,0,0,255],[46,0,0,255],[48,0,0,255],[50,0,0,255],[52,0,0,255],[54,0,0,255],[56,0,0,255],[58,0,0,255],[60,0,0,255],[62,0,0,255],[64,0,0,255],[66,0,0,255],[68,0,0,255],[70,0,0,255],[72,0,0,255],[74,0,0,255],[76,0,0,255],[78,0,0,255],[80,0,0,255],[82,0,0,255],[84,0,0,255],[86,0,0,255],[88,0,0,255],[90,0,0,255],[92,0,0,255],[94,0,0,255],[96,0,0,255],[98,0,0,255],[100,0,0,255],[102,0,0,255],[104,0,0,255],[106,0,0,255],[108,0,0,255],[110,0,0,255],[112,0,0,255],[114,0,0,255],[116,0,0,255],[118,0,0,255],[120,0,0,255],[122,0,0,255],[124,0,0,255],[126,0,0,255],[128,0,0,255],[130,0,0,255],[132,0,0,255],[134,0,0,255],[136,0,0,255],[138,0,0,255],[140,0,0,255],[142,0,0,255],[144,0,0,255],[146,0,0,255],[148,0,0,255],[150,0,0,255],[152,0,0,255],[154,0,0,255],[156,0,0,255],[158,0,0,255],[160,0,0,255],[162,0,0,255],[164,0,0,255],[166,0,0,255],[168,0,0,255],[170,0,0,255],[172,0,0,255],[174,0,0,255],[176,0,0,255],[178,0,0,255],[180,0,0,255],[182,0,0,255],[184,0,0,255],[186,0,0,255],[188,0,0,255],[190,0,0,255],[192,0,0,255],[194,0,0,255],[196,0,0,255],[198,0,0,255],[200,0,0,255],[202,0,0,255],[204,0,0,255],[206,0,0,255],[208,0,0,255],[210,0,0,255],[212,0,0,255],[214,0,0,255],[216,0,0,255],[218,0,0,255],[220,0,0,255],[222,0,0,255],[224,0,0,255],[226,0,0,255],[228,0,0,255],[230,0,0,255],[232,0,0,255],[234,0,0,255],[236,0,0,255],[238,0,0,255],[240,0,0,255],[242,0,0,255],[244,0,0,255],[246,0,0,255],[248,0,0,255],[250,0,0,255],[252,0,0,255],[254,0,0,255],[255,0,0,255],[255,2,0,255],[255,4,0,255],[255,6,0,255],[255,8,0,255],[255,10,0,255],[255,12,0,255],[255,14,0,255],[255,16,0,255],[255,18,0,255],[255,20,0,255],[255,22,0,255],[255,24,0,255],[255,26,0,255],[255,28,0,255],[255,30,0,255],[255,32,0,255],[255,34,0,255],[255,36,0,255],[255,38,0,255],[255,40,0,255],[255,42,0,255],[255,44,0,255],[255,46,0,255],[255,48,0,255],[255,50,0,255],[255,52,0,255],[255,54,0,255],[255,56,0,255],[255,58,0,255],[255,60,0,255],[255,62,0,255],[255,64,0,255],[255,66,0,255],[255,68,0,255],[255,70,0,255],[255,72,0,255],[255,74,0,255],[255,76,0,255],[255,78,0,255],[255,80,0,255],[255,82,0,255],[255,84,0,255],[255,86,0,255],[255,88,0,255],[255,90,0,255],[255,92,0,255],[255,94,0,255],[255,96,0,255],[255,98,0,255],[255,100,0,255],[255,102,0,255],[255,104,0,255],[255,106,0,255],[255,108,0,255],[255,110,0,255],[255,112,0,255],[255,114,0,255],[255,116,0,255],[255,118,0,255],[255,120,0,255],[255,122,0,255],[255,124,0,255],[255,126,0,255],[255,128,4,255],[255,130,8,255],[255,132,12,255],[255,134,16,255],[255,136,20,255],[255,138,24,255],[255,140,28,255],[255,142,32,255],[255,144,36,255],[255,146,40,255],[255,148,44,255],[255,150,48,255],[255,152,52,255],[255,154,56,255],[255,156,60,255],[255,158,64,255],[255,160,68,255],[255,162,72,255],[255,164,76,255],[255,166,80,255],[255,168,84,255],[255,170,88,255],[255,172,92,255],[255,174,96,255],[255,176,100,255],[255,178,104,255],[255,180,108,255],[255,182,112,255],[255,184,116,255],[255,186,120,255],[255,188,124,255],[255,190,128,255],[255,192,132,255],[255,194,136,255],[255,196,140,255],[255,198,144,255],[255,200,148,255],[255,202,152,255],[255,204,156,255],[255,206,160,255],[255,208,164,255],[255,210,168,255],[255,212,172,255],[255,214,176,255],[255,216,180,255],[255,218,184,255],[255,220,188,255],[255,222,192,255],[255,224,196,255],[255,226,200,255],[255,228,204,255],[255,230,208,255],[255,232,212,255],[255,234,216,255],[255,236,220,255],[255,238,224,255],[255,240,228,255],[255,242,232,255],[255,244,236,255],[255,246,240,255],[255,248,244,255],[255,250,248,255],[255,252,252,255],[255,255,255,255]]},pet:{name:"PET",numColors:256,colors:[[0,0,0,255],[0,2,1,255],[0,4,3,255],[0,6,5,255],[0,8,7,255],[0,10,9,255],[0,12,11,255],[0,14,13,255],[0,16,15,255],[0,18,17,255],[0,20,19,255],[0,22,21,255],[0,24,23,255],[0,26,25,255],[0,28,27,255],[0,30,29,255],[0,32,31,255],[0,34,33,255],[0,36,35,255],[0,38,37,255],[0,40,39,255],[0,42,41,255],[0,44,43,255],[0,46,45,255],[0,48,47,255],[0,50,49,255],[0,52,51,255],[0,54,53,255],[0,56,55,255],[0,58,57,255],[0,60,59,255],[0,62,61,255],[0,65,63,255],[0,67,65,255],[0,69,67,255],[0,71,69,255],[0,73,71,255],[0,75,73,255],[0,77,75,255],[0,79,77,255],[0,81,79,255],[0,83,81,255],[0,85,83,255],[0,87,85,255],[0,89,87,255],[0,91,89,255],[0,93,91,255],[0,95,93,255],[0,97,95,255],[0,99,97,255],[0,101,99,255],[0,103,101,255],[0,105,103,255],[0,107,105,255],[0,109,107,255],[0,111,109,255],[0,113,111,255],[0,115,113,255],[0,117,115,255],[0,119,117,255],[0,121,119,255],[0,123,121,255],[0,125,123,255],[0,128,125,255],[1,126,127,255],[3,124,129,255],[5,122,131,255],[7,120,133,255],[9,118,135,255],[11,116,137,255],[13,114,139,255],[15,112,141,255],[17,110,143,255],[19,108,145,255],[21,106,147,255],[23,104,149,255],[25,102,151,255],[27,100,153,255],[29,98,155,255],[31,96,157,255],[33,94,159,255],[35,92,161,255],[37,90,163,255],[39,88,165,255],[41,86,167,255],[43,84,169,255],[45,82,171,255],[47,80,173,255],[49,78,175,255],[51,76,177,255],[53,74,179,255],[55,72,181,255],[57,70,183,255],[59,68,185,255],[61,66,187,255],[63,64,189,255],[65,63,191,255],[67,61,193,255],[69,59,195,255],[71,57,197,255],[73,55,199,255],[75,53,201,255],[77,51,203,255],[79,49,205,255],[81,47,207,255],[83,45,209,255],[85,43,211,255],[86,41,213,255],[88,39,215,255],[90,37,217,255],[92,35,219,255],[94,33,221,255],[96,31,223,255],[98,29,225,255],[100,27,227,255],[102,25,229,255],[104,23,231,255],[106,21,233,255],[108,19,235,255],[110,17,237,255],[112,15,239,255],[114,13,241,255],[116,11,243,255],[118,9,245,255],[120,7,247,255],[122,5,249,255],[124,3,251,255],[126,1,253,255],[128,0,255,255],[130,2,252,255],[132,4,248,255],[134,6,244,255],[136,8,240,255],[138,10,236,255],[140,12,232,255],[142,14,228,255],[144,16,224,255],[146,18,220,255],[148,20,216,255],[150,22,212,255],[152,24,208,255],[154,26,204,255],[156,28,200,255],[158,30,196,255],[160,32,192,255],[162,34,188,255],[164,36,184,255],[166,38,180,255],[168,40,176,255],[170,42,172,255],[171,44,168,255],[173,46,164,255],[175,48,160,255],[177,50,156,255],[179,52,152,255],[181,54,148,255],[183,56,144,255],[185,58,140,255],[187,60,136,255],[189,62,132,255],[191,64,128,255],[193,66,124,255],[195,68,120,255],[197,70,116,255],[199,72,112,255],[201,74,108,255],[203,76,104,255],[205,78,100,255],[207,80,96,255],[209,82,92,255],[211,84,88,255],[213,86,84,255],[215,88,80,255],[217,90,76,255],[219,92,72,255],[221,94,68,255],[223,96,64,255],[225,98,60,255],[227,100,56,255],[229,102,52,255],[231,104,48,255],[233,106,44,255],[235,108,40,255],[237,110,36,255],[239,112,32,255],[241,114,28,255],[243,116,24,255],[245,118,20,255],[247,120,16,255],[249,122,12,255],[251,124,8,255],[253,126,4,255],[255,128,0,255],[255,130,4,255],[255,132,8,255],[255,134,12,255],[255,136,16,255],[255,138,20,255],[255,140,24,255],[255,142,28,255],[255,144,32,255],[255,146,36,255],[255,148,40,255],[255,150,44,255],[255,152,48,255],[255,154,52,255],[255,156,56,255],[255,158,60,255],[255,160,64,255],[255,162,68,255],[255,164,72,255],[255,166,76,255],[255,168,80,255],[255,170,85,255],[255,172,89,255],[255,174,93,255],[255,176,97,255],[255,178,101,255],[255,180,105,255],[255,182,109,255],[255,184,113,255],[255,186,117,255],[255,188,121,255],[255,190,125,255],[255,192,129,255],[255,194,133,255],[255,196,137,255],[255,198,141,255],[255,200,145,255],[255,202,149,255],[255,204,153,255],[255,206,157,255],[255,208,161,255],[255,210,165,255],[255,212,170,255],[255,214,174,255],[255,216,178,255],[255,218,182,255],[255,220,186,255],[255,222,190,255],[255,224,194,255],[255,226,198,255],[255,228,202,255],[255,230,206,255],[255,232,210,255],[255,234,214,255],[255,236,218,255],[255,238,222,255],[255,240,226,255],[255,242,230,255],[255,244,234,255],[255,246,238,255],[255,248,242,255],[255,250,246,255],[255,252,250,255],[255,255,255,255]]},hotMetalBlue:{name:"Hot Metal Blue",numColors:256,colors:[[0,0,0,255],[0,0,2,255],[0,0,4,255],[0,0,6,255],[0,0,8,255],[0,0,10,255],[0,0,12,255],[0,0,14,255],[0,0,16,255],[0,0,17,255],[0,0,19,255],[0,0,21,255],[0,0,23,255],[0,0,25,255],[0,0,27,255],[0,0,29,255],[0,0,31,255],[0,0,33,255],[0,0,35,255],[0,0,37,255],[0,0,39,255],[0,0,41,255],[0,0,43,255],[0,0,45,255],[0,0,47,255],[0,0,49,255],[0,0,51,255],[0,0,53,255],[0,0,55,255],[0,0,57,255],[0,0,59,255],[0,0,61,255],[0,0,63,255],[0,0,65,255],[0,0,67,255],[0,0,69,255],[0,0,71,255],[0,0,73,255],[0,0,75,255],[0,0,77,255],[0,0,79,255],[0,0,81,255],[0,0,83,255],[0,0,84,255],[0,0,86,255],[0,0,88,255],[0,0,90,255],[0,0,92,255],[0,0,94,255],[0,0,96,255],[0,0,98,255],[0,0,100,255],[0,0,102,255],[0,0,104,255],[0,0,106,255],[0,0,108,255],[0,0,110,255],[0,0,112,255],[0,0,114,255],[0,0,116,255],[0,0,117,255],[0,0,119,255],[0,0,121,255],[0,0,123,255],[0,0,125,255],[0,0,127,255],[0,0,129,255],[0,0,131,255],[0,0,133,255],[0,0,135,255],[0,0,137,255],[0,0,139,255],[0,0,141,255],[0,0,143,255],[0,0,145,255],[0,0,147,255],[0,0,149,255],[0,0,151,255],[0,0,153,255],[0,0,155,255],[0,0,157,255],[0,0,159,255],[0,0,161,255],[0,0,163,255],[0,0,165,255],[0,0,167,255],[3,0,169,255],[6,0,171,255],[9,0,173,255],[12,0,175,255],[15,0,177,255],[18,0,179,255],[21,0,181,255],[24,0,183,255],[26,0,184,255],[29,0,186,255],[32,0,188,255],[35,0,190,255],[38,0,192,255],[41,0,194,255],[44,0,196,255],[47,0,198,255],[50,0,200,255],[52,0,197,255],[55,0,194,255],[57,0,191,255],[59,0,188,255],[62,0,185,255],[64,0,182,255],[66,0,179,255],[69,0,176,255],[71,0,174,255],[74,0,171,255],[76,0,168,255],[78,0,165,255],[81,0,162,255],[83,0,159,255],[85,0,156,255],[88,0,153,255],[90,0,150,255],[93,2,144,255],[96,4,138,255],[99,6,132,255],[102,8,126,255],[105,9,121,255],[108,11,115,255],[111,13,109,255],[114,15,103,255],[116,17,97,255],[119,19,91,255],[122,21,85,255],[125,23,79,255],[128,24,74,255],[131,26,68,255],[134,28,62,255],[137,30,56,255],[140,32,50,255],[143,34,47,255],[146,36,44,255],[149,38,41,255],[152,40,38,255],[155,41,35,255],[158,43,32,255],[161,45,29,255],[164,47,26,255],[166,49,24,255],[169,51,21,255],[172,53,18,255],[175,55,15,255],[178,56,12,255],[181,58,9,255],[184,60,6,255],[187,62,3,255],[190,64,0,255],[194,66,0,255],[198,68,0,255],[201,70,0,255],[205,72,0,255],[209,73,0,255],[213,75,0,255],[217,77,0,255],[221,79,0,255],[224,81,0,255],[228,83,0,255],[232,85,0,255],[236,87,0,255],[240,88,0,255],[244,90,0,255],[247,92,0,255],[251,94,0,255],[255,96,0,255],[255,98,3,255],[255,100,6,255],[255,102,9,255],[255,104,12,255],[255,105,15,255],[255,107,18,255],[255,109,21,255],[255,111,24,255],[255,113,26,255],[255,115,29,255],[255,117,32,255],[255,119,35,255],[255,120,38,255],[255,122,41,255],[255,124,44,255],[255,126,47,255],[255,128,50,255],[255,130,53,255],[255,132,56,255],[255,134,59,255],[255,136,62,255],[255,137,65,255],[255,139,68,255],[255,141,71,255],[255,143,74,255],[255,145,76,255],[255,147,79,255],[255,149,82,255],[255,151,85,255],[255,152,88,255],[255,154,91,255],[255,156,94,255],[255,158,97,255],[255,160,100,255],[255,162,103,255],[255,164,106,255],[255,166,109,255],[255,168,112,255],[255,169,115,255],[255,171,118,255],[255,173,121,255],[255,175,124,255],[255,177,126,255],[255,179,129,255],[255,181,132,255],[255,183,135,255],[255,184,138,255],[255,186,141,255],[255,188,144,255],[255,190,147,255],[255,192,150,255],[255,194,153,255],[255,196,156,255],[255,198,159,255],[255,200,162,255],[255,201,165,255],[255,203,168,255],[255,205,171,255],[255,207,174,255],[255,209,176,255],[255,211,179,255],[255,213,182,255],[255,215,185,255],[255,216,188,255],[255,218,191,255],[255,220,194,255],[255,222,197,255],[255,224,200,255],[255,226,203,255],[255,228,206,255],[255,229,210,255],[255,231,213,255],[255,233,216,255],[255,235,219,255],[255,237,223,255],[255,239,226,255],[255,240,229,255],[255,242,232,255],[255,244,236,255],[255,246,239,255],[255,248,242,255],[255,250,245,255],[255,251,249,255],[255,253,252,255],[255,255,255,255]]},pet20Step:{name:"PET 20 Step",numColors:256,colors:[[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255]]},gray:{name:"Gray",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,1,1]]}},jet:{name:"Jet",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.35,0,0],[.66,1,1],[.89,1,1],[1,.5,.5]],green:[[0,0,0],[.125,0,0],[.375,1,1],[.64,1,1],[.91,0,0],[1,0,0]],blue:[[0,.5,.5],[.11,1,1],[.34,1,1],[.65,0,0],[1,0,0]]}},hsv:{name:"HSV",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[.15873,1,1],[.174603,.96875,.96875],[.333333,.03125,.03125],[.349206,0,0],[.666667,0,0],[.68254,.03125,.03125],[.84127,.96875,.96875],[.857143,1,1],[1,1,1]],green:[[0,0,0],[.15873,.9375,.9375],[.174603,1,1],[.507937,1,1],[.666667,.0625,.0625],[.68254,0,0],[1,0,0]],blue:[[0,0,0],[.333333,0,0],[.349206,.0625,.0625],[.507937,1,1],[.84127,1,1],[.857143,.9375,.9375],[1,.09375,.09375]]}},hot:{name:"Hot",numColors:256,gamma:1,segmentedData:{red:[[0,.0416,.0416],[.365079,1,1],[1,1,1]],green:[[0,0,0],[.365079,0,0],[.746032,1,1],[1,1,1]],blue:[[0,0,0],[.746032,0,0],[1,1,1]]}},cool:{name:"Cool",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,1,1],[1,0,0]],blue:[[0,1,1],[1,1,1]]}},spring:{name:"Spring",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,0,0]]}},summer:{name:"Summer",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,.5,.5],[1,1,1]],blue:[[0,.4,.4],[1,.4,.4]]}},autumn:{name:"Autumn",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,0,0]]}},winter:{name:"Winter",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,0,0]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,.5,.5]]}},bone:{name:"Bone",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.746032,.652778,.652778],[1,1,1]],green:[[0,0,0],[.365079,.319444,.319444],[.746032,.777778,.777778],[1,1,1]],blue:[[0,0,0],[.365079,.444444,.444444],[1,1,1]]}},copper:{name:"Copper",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.809524,1,1],[1,1,1]],green:[[0,0,0],[1,.7812,.7812]],blue:[[0,0,0],[1,.4975,.4975]]}},spectral:{name:"Spectral",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.05,.4667,.4667],[.1,.5333,.5333],[.15,0,0],[.2,0,0],[.25,0,0],[.3,0,0],[.35,0,0],[.4,0,0],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,.7333,.7333],[.7,.9333,.9333],[.75,1,1],[.8,1,1],[.85,1,1],[.9,.8667,.8667],[.95,.8,.8],[1,.8,.8]],green:[[0,0,0],[.05,0,0],[.1,0,0],[.15,0,0],[.2,0,0],[.25,.4667,.4667],[.3,.6,.6],[.35,.6667,.6667],[.4,.6667,.6667],[.45,.6,.6],[.5,.7333,.7333],[.55,.8667,.8667],[.6,1,1],[.65,1,1],[.7,.9333,.9333],[.75,.8,.8],[.8,.6,.6],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]],blue:[[0,0,0],[.05,.5333,.5333],[.1,.6,.6],[.15,.6667,.6667],[.2,.8667,.8667],[.25,.8667,.8667],[.3,.8667,.8667],[.35,.6667,.6667],[.4,.5333,.5333],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,0,0],[.7,0,0],[.75,0,0],[.8,0,0],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]]}},coolwarm:{name:"CoolWarm",numColors:256,gamma:1,segmentedData:{red:[[0,.2298057,.2298057],[.03125,.26623388,.26623388],[.0625,.30386891,.30386891],[.09375,.342804478,.342804478],[.125,.38301334,.38301334],[.15625,.424369608,.424369608],[.1875,.46666708,.46666708],[.21875,.509635204,.509635204],[.25,.552953156,.552953156],[.28125,.596262162,.596262162],[.3125,.639176211,.639176211],[.34375,.681291281,.681291281],[.375,.722193294,.722193294],[.40625,.761464949,.761464949],[.4375,.798691636,.798691636],[.46875,.833466556,.833466556],[.5,.865395197,.865395197],[.53125,.897787179,.897787179],[.5625,.924127593,.924127593],[.59375,.944468518,.944468518],[.625,.958852946,.958852946],[.65625,.96732803,.96732803],[.6875,.969954137,.969954137],[.71875,.966811177,.966811177],[.75,.958003065,.958003065],[.78125,.943660866,.943660866],[.8125,.923944917,.923944917],[.84375,.89904617,.89904617],[.875,.869186849,.869186849],[.90625,.834620542,.834620542],[.9375,.795631745,.795631745],[.96875,.752534934,.752534934],[1,.705673158,.705673158]],green:[[0,.298717966,.298717966],[.03125,.353094838,.353094838],[.0625,.406535296,.406535296],[.09375,.458757618,.458757618],[.125,.50941904,.50941904],[.15625,.558148092,.558148092],[.1875,.604562568,.604562568],[.21875,.648280772,.648280772],[.25,.688929332,.688929332],[.28125,.726149107,.726149107],[.3125,.759599947,.759599947],[.34375,.788964712,.788964712],[.375,.813952739,.813952739],[.40625,.834302879,.834302879],[.4375,.849786142,.849786142],[.46875,.860207984,.860207984],[.5,.86541021,.86541021],[.53125,.848937047,.848937047],[.5625,.827384882,.827384882],[.59375,.800927443,.800927443],[.625,.769767752,.769767752],[.65625,.734132809,.734132809],[.6875,.694266682,.694266682],[.71875,.650421156,.650421156],[.75,.602842431,.602842431],[.78125,.551750968,.551750968],[.8125,.49730856,.49730856],[.84375,.439559467,.439559467],[.875,.378313092,.378313092],[.90625,.312874446,.312874446],[.9375,.24128379,.24128379],[.96875,.157246067,.157246067],[1,.01555616,.01555616]],blue:[[0,.753683153,.753683153],[.03125,.801466763,.801466763],[.0625,.84495867,.84495867],[.09375,.883725899,.883725899],[.125,.917387822,.917387822],[.15625,.945619588,.945619588],[.1875,.968154911,.968154911],[.21875,.98478814,.98478814],[.25,.995375608,.995375608],[.28125,.999836203,.999836203],[.3125,.998151185,.998151185],[.34375,.990363227,.990363227],[.375,.976574709,.976574709],[.40625,.956945269,.956945269],[.4375,.931688648,.931688648],[.46875,.901068838,.901068838],[.5,.865395561,.865395561],[.53125,.820880546,.820880546],[.5625,.774508472,.774508472],[.59375,.726736146,.726736146],[.625,.678007945,.678007945],[.65625,.628751763,.628751763],[.6875,.579375448,.579375448],[.71875,.530263762,.530263762],[.75,.481775914,.481775914],[.78125,.434243684,.434243684],[.8125,.387970225,.387970225],[.84375,.343229596,.343229596],[.875,.300267182,.300267182],[.90625,.259301199,.259301199],[.9375,.220525627,.220525627],[.96875,.184115123,.184115123],[1,.150232812,.150232812]]}},blues:{name:"Blues",numColors:256,gamma:1,segmentedData:{red:[[0,.9686274528503418,.9686274528503418],[.125,.8705882430076599,.8705882430076599],[.25,.7764706015586853,.7764706015586853],[.375,.6196078658103943,.6196078658103943],[.5,.41960784792900085,.41960784792900085],[.625,.25882354378700256,.25882354378700256],[.75,.12941177189350128,.12941177189350128],[.875,.0313725508749485,.0313725508749485],[1,.0313725508749485,.0313725508749485]],green:[[0,.9843137264251709,.9843137264251709],[.125,.9215686321258545,.9215686321258545],[.25,.8588235378265381,.8588235378265381],[.375,.7921568751335144,.7921568751335144],[.5,.6823529601097107,.6823529601097107],[.625,.572549045085907,.572549045085907],[.75,.4431372582912445,.4431372582912445],[.875,.3176470696926117,.3176470696926117],[1,.1882352977991104,.1882352977991104]],blue:[[0,1,1],[.125,.9686274528503418,.9686274528503418],[.25,.9372549057006836,.9372549057006836],[.375,.8823529481887817,.8823529481887817],[.5,.8392156958580017,.8392156958580017],[.625,.7764706015586853,.7764706015586853],[.75,.7098039388656616,.7098039388656616],[.875,.6117647290229797,.6117647290229797],[1,.41960784792900085,.41960784792900085]]}}};function i(e,t){for(var n=0,a=e.length-1;n<=a;){var r=n+Math.floor((a-n)/2),o=e[r];if(o===t)return r;t<o?a=r-1:n=r+1}return n}function l(e,t,n){var a,r=[],o=[],l=[],u=[];for(n=null===n?1:n,a=0;a<t.length;a++){var d=t[a];r.push((e-1)*d[0]),o.push(d[1]),l.push(d[1])}var s=function(e,t,n){for(var a=(t-e)/((n=null===n?100:n)-1),r=[];n-- >0;)r.push(e),e+=a;return r[r.length-1]=t,r}(0,1,e);for(a=0;a<e;a++)s[a]=(e-1)*Math.pow(s[a],n);var c=function(e,t){var n,a=[],r=t.length;for(e.sort((function(e,t){return e-t})),n=0;n<r;n++)a[n]=i(e,t[n]);return a}(r,s);for(a=1;a<e-1;a++){var f=c[a],v=(s[a]-r[f-1])/(r[f]-r[f-1]),m=o[f]-l[f-1];u[a]=v*m+l[f-1]}return u[0]=l[0],u[e-1]=o[t.length-1],u}function u(){var e=[];return Object.keys(o).forEach((function(t){if(o.hasOwnProperty(t)){var n=o[t];e.push({id:t,name:n.name})}})),e.sort((function(e,t){var n=e.name.toLowerCase(),a=t.name.toLowerCase();return n===a?0:n<a?-1:1})),e}function d(e,t){var n=o[e];return n||(n=o[e]=t||{name:"",colors:[]}),!n.colors&&n.segmentedData&&(n.colors=function(e,t,n){var a,r=[];n=null===n?1:n;var o=l(t=null===t?256:t,e.red,n),i=l(t,e.green,n),u=l(t,e.blue,n);for(a=0;a<t;a++){var d=[Math.round(255*o[a]),Math.round(255*i[a]),Math.round(255*u[a]),255];r.push(d)}return r}(n.segmentedData,n.numColors,n.gamma)),{getId:function(){return e},getColorSchemeName:function(){return n.name},setColorSchemeName:function(e){n.name=e},getNumberOfColors:function(){return n.colors.length},setNumberOfColors:function(e){for(;n.colors.length<e;)n.colors.push(r);n.colors.length=e},getColor:function(e){return this.isValidIndex(e)?n.colors[e]:r},getColorRepeating:function(e){var t=n.colors.length;return e=t?e%t:0,this.getColor(e)},setColor:function(e,t){this.isValidIndex(e)&&(n.colors[e]=t)},addColor:function(e){n.colors.push(e)},insertColor:function(e,t){this.isValidIndex(e)&&n.colors.splice(e,1,t)},removeColor:function(e){this.isValidIndex(e)&&n.colors.splice(e,1)},clearColors:function(){n.colors=[]},buildLookupTable:function(e){if(e){var t=n.colors.length;e.setNumberOfTableValues(t);for(var a=0;a<t;a++)e.setTableValue(a,n.colors[a])}},createLookupTable:function(){var e=new a.default;return this.buildLookupTable(e),e},isValidIndex:function(e){return e>=0&&e<n.colors.length}}}},"./colors/index.js":function(e,t,n){"use strict";n.r(t);var a=n("./colors/colormap.js"),r=n("./colors/lookupTable.js");t.default={getColormap:a.getColormap,getColormapsList:a.getColormapsList,LookupTable:r.default}},"./colors/lookupTable.js":function(e,t,n){"use strict";function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function r(e,t,n){if(e>1)throw new Error("HSVToRGB expects hue < 1");var a=[];if(0===t)return a[0]=n,a[1]=n,a[2]=n,a;var r=Math.floor(6*e),o=6*e-r,i=n*(1-t),l=n*(1-t*o),u=n*(1-t*(1-o));switch(r){case 0:case 6:a[0]=n,a[1]=u,a[2]=i;break;case 1:a[0]=l,a[1]=n,a[2]=i;break;case 2:a[0]=i,a[1]=n,a[2]=u;break;case 3:a[0]=i,a[1]=l,a[2]=n;break;case 4:a[0]=u,a[1]=i,a[2]=n;break;case 5:a[0]=n,a[1]=i,a[2]=l}return a}n.r(t);var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.NumberOfColors=256,this.Ramp="linear",this.TableRange=[0,255],this.HueRange=[0,.66667],this.SaturationRange=[1,1],this.ValueRange=[1,1],this.AlphaRange=[1,1],this.NaNColor=[128,0,0,255],this.BelowRangeColor=[0,0,0,255],this.UseBelowRangeColor=!0,this.AboveRangeColor=[255,255,255,255],this.UseAboveRangeColor=!0,this.InputRange=[0,255],this.Table=[]}var t,n,o;return t=e,(n=[{key:"setNumberOfTableValues",value:function(e){this.NumberOfColors=e}},{key:"setRamp",value:function(e){this.Ramp=e}},{key:"setTableRange",value:function(e,t){this.TableRange[0]=e,this.TableRange[1]=t}},{key:"setHueRange",value:function(e,t){this.HueRange[0]=e,this.HueRange[1]=t}},{key:"setSaturationRange",value:function(e,t){this.SaturationRange[0]=e,this.SaturationRange[1]=t}},{key:"setValueRange",value:function(e,t){this.ValueRange[0]=e,this.ValueRange[1]=t}},{key:"setRange",value:function(e,t){this.InputRange[0]=e,this.InputRange[1]=t}},{key:"setAlphaRange",value:function(e,t){this.AlphaRange[0]=e,this.AlphaRange[1]=t}},{key:"getColor",value:function(e){return this.mapValue(e)}},{key:"build",value:function(e){if(!(this.Table.length>1)||e){this.Table=[];var t,n,a,o,i=this.NumberOfColors-1;i?(t=(this.HueRange[1]-this.HueRange[0])/i,n=(this.SaturationRange[1]-this.SaturationRange[0])/i,a=(this.ValueRange[1]-this.ValueRange[0])/i,o=(this.AlphaRange[1]-this.AlphaRange[0])/i):t=n=a=o=0;for(var l=0;l<=i;l++){var u=this.HueRange[0]+l*t,d=this.SaturationRange[0]+l*n,s=this.ValueRange[0]+l*a,c=this.AlphaRange[0]+l*o,f=r(u,d,s),v=[];switch(this.Ramp){case"scurve":v[0]=Math.floor(127.5*(1+Math.cos((1-f[0])*Math.PI))),v[1]=Math.floor(127.5*(1+Math.cos((1-f[1])*Math.PI))),v[2]=Math.floor(127.5*(1+Math.cos((1-f[2])*Math.PI))),v[3]=Math.floor(255*c);break;case"linear":v[0]=Math.floor(255*f[0]+.5),v[1]=Math.floor(255*f[1]+.5),v[2]=Math.floor(255*f[2]+.5),v[3]=Math.floor(255*c+.5);break;case"sqrt":v[0]=Math.floor(255*Math.sqrt(f[0])+.5),v[1]=Math.floor(255*Math.sqrt(f[1])+.5),v[2]=Math.floor(255*Math.sqrt(f[2])+.5),v[3]=Math.floor(255*Math.sqrt(c)+.5);break;default:throw new Error("Invalid Ramp value (".concat(this.Ramp,")"))}this.Table.push(v)}this.buildSpecialColors()}}},{key:"buildSpecialColors",value:function(){var e=this.NumberOfColors,t=e+0,n=e+1,a=e+2;this.UseBelowRangeColor||0===e?this.Table[t]=this.BelowRangeColor:this.Table[t]=this.Table[0],this.UseAboveRangeColor||0===e?this.Table[n]=this.AboveRangeColor:this.Table[n]=this.Table[e-1],this.Table[a]=this.NaNColor}},{key:"mapValue",value:function(e){var t=this.getIndex(e);if(t<0)return this.NaNColor;if(0===t){if(this.UseBelowRangeColor&&e<this.TableRange[0])return this.BelowRangeColor}else if(t===this.NumberOfColors-1&&this.UseAboveRangeColor&&e>this.TableRange[1])return this.AboveRangeColor;return this.Table[t]}},{key:"getIndex",value:function(e){var t={Range:[]};if(t.MaxIndex=this.NumberOfColors-1,t.Shift=-this.TableRange[0],this.TableRange[1]<=this.TableRange[0]?t.Scale=Number.MAX_VALUE:t.Scale=t.MaxIndex/(this.TableRange[1]-this.TableRange[0]),t.Range[0]=this.TableRange[0],t.Range[1]=this.TableRange[1],isNaN(e))return-1;var n=function(e,t){var n;return n=e<t.Range[0]?t.MaxIndex+0+1.5:e>t.Range[1]?t.MaxIndex+1+1.5:(e+t.Shift)*t.Scale,Math.floor(n)}(e,t);return n===this.NumberOfColors+0?n=0:n===this.NumberOfColors+1&&(n=this.NumberOfColors-1),n}},{key:"setTableValue",value:function(e,t){if(5===arguments.length&&(t=Array.prototype.slice.call(arguments,1)),e<0)throw new Error("Can't set the table value for negative index (".concat(e,")"));e>=this.NumberOfColors&&new Error("Index ".concat(e," is greater than the number of colors ").concat(this.NumberOfColors)),this.Table[e]=t,0!==e&&e!==this.NumberOfColors-1||this.buildSpecialColors()}}])&&a(t.prototype,n),o&&a(t,o),e}();t.default=o},"./disable.js":function(e,t,n){"use strict";n.r(t);var a=n("./enabledElements.js"),r=n("./triggerEvent.js"),o=n("./events.js");t.default=function(e){if(void 0===e)throw new Error("disable: element must not be undefined");for(var t=Object(a.getEnabledElements)(),n=0;n<t.length;n++)if(t[n].element===e){var i={element:e};Object(r.default)(e,o.default.ELEMENT_DISABLED,i),Object(r.default)(o.events,o.default.ELEMENT_DISABLED,i),t[n].element.removeChild(t[n].canvas),t[n].canvas=void 0,t.splice(n,1);break}}},"./displayImage.js":function(e,t,n){"use strict";n.r(t);var a=n("./enabledElements.js"),r=n("./internal/getDefaultViewport.js"),o=n("./updateImage.js"),i=n("./internal/now.js"),l=n("./layers.js"),u=n("./triggerEvent.js"),d=n("./events.js");t.default=function(e,t,n){if(void 0===e)throw new Error("displayImage: parameter element must not be undefined");if(void 0===t)throw new Error("displayImage: parameter image must not be undefined");var s,c=Object(a.getEnabledElement)(e),f=c.image;if(c.image=t,c.layers&&c.layers.length&&Object(l.setLayerImage)(e,t),void 0===c.viewport&&(c.viewport=Object(r.default)(c.canvas,t)),n)for(var v in n)null!==n[v]&&(c.viewport[v]=n[v]);void 0!==c.lastImageTimeStamp&&(s=(1e3/(Object(i.default)()-c.lastImageTimeStamp)).toFixed()),c.lastImageTimeStamp=Object(i.default)();var m={viewport:c.viewport,element:c.element,image:c.image,oldImage:f,enabledElement:c,frameRate:s};Object(u.default)(c.element,d.default.NEW_IMAGE,m),Object(o.default)(e)}},"./draw.js":function(e,t,n){"use strict";n.r(t);var a=n("./enabledElements.js"),r=n("./internal/drawImage.js");t.default=function(e){var t=Object(a.getEnabledElement)(e);Object(r.default)(t)}},"./drawInvalidated.js":function(e,t,n){"use strict";n.r(t);var a=n("./enabledElements.js"),r=n("./internal/drawImage.js");t.default=function(){for(var e=Object(a.getEnabledElements)(),t=0;t<e.length;t++){var n=e[t];!0===n.invalid&&Object(r.default)(n,!0)}}},"./enable.js":function(e,t,n){"use strict";n.r(t);var a=n("./enabledElements.js"),r=n("./resize.js"),o=n("./internal/drawImageSync.js"),i=n("./internal/requestAnimationFrame.js"),l=n("./internal/tryEnableWebgl.js"),u=n("./triggerEvent.js"),d=n("./generateUUID.js"),s=n("./events.js"),c=n("./internal/getCanvas.js");t.default=function(e,t){if(void 0===e)throw new Error("enable: parameter element cannot be undefined");t&&t.renderer&&"webgl"===t.renderer.toLowerCase()&&Object(l.default)(t);var n={element:e,canvas:Object(c.default)(e),image:void 0,invalid:!1,needsRedraw:!0,options:Object.assign({},t),layers:[],data:{},renderingTools:{},uuid:Object(d.default)()};Object(a.addEnabledElement)(n),Object(u.default)(s.events,s.default.ELEMENT_ENABLED,n),Object(r.default)(e,!0),function e(t){if(void 0!==n.canvas){var a={enabledElement:n,timestamp:t};Object(u.default)(n.element,s.default.PRE_RENDER,a),n.needsRedraw&&function(e){return void 0!==e.image||e.layers.length>0}(n)&&Object(o.default)(n,n.invalid),Object(i.default)(e)}}()}},"./enabledElementData.js":function(e,t,n){"use strict";n.r(t),n.d(t,"getElementData",(function(){return r})),n.d(t,"removeElementData",(function(){return o}));var a=n("./enabledElements.js");function r(e,t){var n=Object(a.getEnabledElement)(e);return!1===n.data.hasOwnProperty(t)&&(n.data[t]={}),n.data[t]}function o(e,t){delete Object(a.getEnabledElement)(e).data[t]}},"./enabledElements.js":function(e,t,n){"use strict";n.r(t),n.d(t,"getEnabledElement",(function(){return r})),n.d(t,"addEnabledElement",(function(){return o})),n.d(t,"getEnabledElementsByImageId",(function(){return i})),n.d(t,"getEnabledElements",(function(){return l}));var a=[];function r(e){if(void 0===e)throw new Error("getEnabledElement: parameter element must not be undefined");for(var t=0;t<a.length;t++)if(a[t].element===e)return a[t];throw new Error("element not enabled")}function o(e){if(void 0===e)throw new Error("getEnabledElement: enabledElement element must not be undefined");a.push(e)}function i(e){var t=[];return a.forEach((function(n){n.image&&n.image.imageId===e&&t.push(n)})),t}function l(){return a}},"./events.js":function(e,t,n){"use strict";function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}n.r(t),n.d(t,"events",(function(){return r})),t.default={NEW_IMAGE:"cornerstonenewimage",INVALIDATED:"cornerstoneinvalidated",PRE_RENDER:"cornerstoneprerender",IMAGE_CACHE_MAXIMUM_SIZE_CHANGED:"cornerstoneimagecachemaximumsizechanged",IMAGE_CACHE_PROMISE_REMOVED:"cornerstoneimagecachepromiseremoved",IMAGE_CACHE_FULL:"cornerstoneimagecachefull",IMAGE_CACHE_CHANGED:"cornerstoneimagecachechanged",WEBGL_TEXTURE_REMOVED:"cornerstonewebgltextureremoved",WEBGL_TEXTURE_CACHE_FULL:"cornerstonewebgltexturecachefull",IMAGE_LOADED:"cornerstoneimageloaded",IMAGE_LOAD_PROGRESS:"cornerstoneimageloadprogress",IMAGE_LOAD_FAILED:"cornerstoneimageloadfailed",ELEMENT_RESIZED:"cornerstoneelementresized",IMAGE_RENDERED:"cornerstoneimagerendered",LAYER_ADDED:"cornerstonelayeradded",LAYER_REMOVED:"cornerstonelayerremoved",ACTIVE_LAYER_CHANGED:"cornerstoneactivelayerchanged",ELEMENT_DISABLED:"cornerstoneelementdisabled",ELEMENT_ENABLED:"cornerstoneelementenabled"};var r=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.listeners={},this.namespaces={}}var t,n,r;return t=e,(n=[{key:"addEventNamespaceListener",value:function(e,t){e.indexOf(".")<=0||(this.namespaces[e]=t,this.addEventListener(e.split(".")[0],t))}},{key:"removeEventNamespaceListener",value:function(e){e.indexOf(".")<=0||!this.namespaces[e]||(this.removeEventListener(e.split(".")[0],this.namespaces[e]),delete this.namespaces[e])}},{key:"addEventListener",value:function(e,t){e.indexOf(".")>0?this.addEventNamespaceListener(e,t):(e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t))}},{key:"removeEventListener",value:function(e,t){if(e.indexOf(".")>0)this.removeEventNamespaceListener(e);else if(e in this.listeners)for(var n=this.listeners[e],a=0,r=n.length;a<r;a++)if(n[a]===t)return void n.splice(a,1)}},{key:"dispatchEvent",value:function(e){if(!(e.type in this.listeners))return!0;for(var t=this.listeners[e.type].slice(),n=0,a=t.length;n<a;n++)t[n].call(this,e);return!e.defaultPrevented}}])&&a(t.prototype,n),r&&a(t,r),e}())},"./falseColorMapping.js":function(e,t,n){"use strict";n.r(t),n.d(t,"convertImageToFalseColorImage",(function(){return l})),n.d(t,"convertToFalseColorImage",(function(){return u})),n.d(t,"restoreImage",(function(){return i}));var a=n("./enabledElements.js"),r=n("./pixelDataToFalseColorData.js"),o=n("./colors/colormap.js");function i(e){return!(!e.restore||"function"!=typeof e.restore||(e.restore(),0))}function l(e,t){if(e.color&&!e.falseColor)throw new Error("Color transforms are not implemented yet");var n=(t=function(e){return e&&"string"==typeof e&&(e=Object(o.getColormap)(e)),e}(t)).getId();if(e.colormapId===n)return!1;if(i(e),n){var a=e.minPixelValue||0,l=e.maxPixelValue||255;e.restore=function(e){if(e.restore)return e.restore;var t=e.color,n=e.rgba,a=e.cachedLut,r=e.slope,o=e.windowWidth,i=e.windowCenter,l=e.minPixelValue,u=e.maxPixelValue;return function(){if(e.color=t,e.rgba=n,e.cachedLut=a,e.slope=r,e.windowWidth=o,e.windowCenter=i,e.minPixelValue=l,e.maxPixelValue=u,e.origPixelData){var d=e.origPixelData;e.getPixelData=function(){return d}}e.origPixelData=void 0,e.colormapId=void 0,e.falseColor=void 0}}(e);var u=t.createLookupTable();u.setTableRange(a,l),Object(r.default)(e,u);var d=function(e){for(var t,n=Number.MAX_VALUE,a=Number.MIN_VALUE,r=e.length,o=0;o<r;o++)n=n<(t=e[o])?n:t,a=a>t?a:t;return{minPixelValue:n,maxPixelValue:a}}(e.getPixelData());e.minPixelValue=d.minPixelValue,e.maxPixelValue=d.maxPixelValue,e.windowWidth=255,e.windowCenter=128,e.colormapId=n}return!0}function u(e,t){return l(Object(a.getEnabledElement)(e).image,t)}},"./fitToWindow.js":function(e,t,n){"use strict";n.r(t);var a=n("./enabledElements.js"),r=n("./updateImage.js"),o=n("./internal/getImageFitScale.js");t.default=function(e){var t=Object(a.getEnabledElement)(e),n=t.image;t.viewport.scale=Object(o.default)(t.canvas,n,t.viewport.rotation).scaleFactor,t.viewport.translation.x=0,t.viewport.translation.y=0,Object(r.default)(e)}},"./generateUUID.js":function(e,t,n){"use strict";n.r(t),t.default=function(){var e=(new Date).getTime();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(e+=performance.now()),"x.x.x.x.x.x.xxxx.xxx.x.x.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))}},"./getDefaultViewportForImage.js":function(e,t,n){"use strict";n.r(t);var a=n("./enabledElements.js"),r=n("./internal/getDefaultViewport.js");t.default=function(e,t){var n=Object(a.getEnabledElement)(e);return Object(r.default)(n.canvas,t)}},"./getImage.js":function(e,t,n){"use strict";n.r(t);var a=n("./enabledElements.js");t.default=function(e){return Object(a.getEnabledElement)(e).image}},"./getPixels.js":function(e,t,n){"use strict";n.r(t);var a=n("./enabledElements.js"),r=n("./getStoredPixels.js"),o=n("./internal/getModalityLUT.js");t.default=function(e,t,n,i,l){var u=Object(r.default)(e,t,n,i,l),d=Object(a.getEnabledElement)(e),s=Object(o.default)(d.image.slope,d.image.intercept,d.viewport.modalityLUT);return u.map(s)}},"./getStoredPixels.js":function(e,t,n){"use strict";n.r(t);var a=n("./enabledElements.js");t.default=function(e,t,n,r,o){if(void 0===e)throw new Error("getStoredPixels: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);for(var i=Object(a.getEnabledElement)(e),l=[],u=0,d=i.image.getPixelData(),s=0;s<o;s++)for(var c=0;c<r;c++){var f=(s+n)*i.image.columns+(c+t);l[u++]=d[f]}return l}},"./getViewport.js":function(e,t,n){"use strict";n.r(t);var a=n("./enabledElements.js");t.default=function(e){var t=Object(a.getEnabledElement)(e).viewport;if(void 0!==t)return Object.assign({},t)}},"./imageCache.js":function(e,t,n){"use strict";n.r(t),n.d(t,"cachedImages",(function(){return u})),n.d(t,"setMaximumSizeBytes",(function(){return d})),n.d(t,"putImageLoadObject",(function(){return c})),n.d(t,"getImageLoadObject",(function(){return f})),n.d(t,"removeImageLoadObject",(function(){return v})),n.d(t,"getCacheInfo",(function(){return m})),n.d(t,"purgeCache",(function(){return g})),n.d(t,"changeImageIdCacheSize",(function(){return h}));var a=n("./events.js"),r=n("./triggerEvent.js"),o=1073741824,i=0,l={},u=[];function d(e){if(void 0===e)throw new Error("setMaximumSizeBytes: parameter numBytes must not be undefined");if(void 0===e.toFixed)throw new Error("setMaximumSizeBytes: parameter numBytes must be a number");o=e,Object(r.default)(a.events,a.default.IMAGE_CACHE_MAXIMUM_SIZE_CHANGED),s()}function s(){if(!(i<=o)){for(u.sort((function(e,t){return e.timeStamp>t.timeStamp?-1:e.timeStamp<t.timeStamp?1:0}));i>o;){var e=u[u.length-1].imageId;v(e),Object(r.default)(a.events,a.default.IMAGE_CACHE_PROMISE_REMOVED,{imageId:e})}var t=m();Object(r.default)(a.events,a.default.IMAGE_CACHE_FULL,t)}}function c(e,t){if(void 0===e)throw new Error("putImageLoadObject: imageId must not be undefined");if(void 0===t.promise)throw new Error("putImageLoadObject: imageLoadObject.promise must not be undefined");if(!0===l.hasOwnProperty(e))throw new Error("putImageLoadObject: imageId already in cache");if(t.cancelFn&&"function"!=typeof t.cancelFn)throw new Error("putImageLoadObject: imageLoadObject.cancelFn must be a function");var n={loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:t,timeStamp:Date.now(),sizeInBytes:0};l[e]=n,u.push(n),t.promise.then((function(e){if(-1!==u.indexOf(n)){if(n.loaded=!0,n.image=e,void 0===e.sizeInBytes)throw new Error("putImageLoadObject: image.sizeInBytes must not be undefined");if(void 0===e.sizeInBytes.toFixed)throw new Error("putImageLoadObject: image.sizeInBytes is not a number");n.sizeInBytes=e.sizeInBytes,i+=n.sizeInBytes;var t={action:"addImage",image:n};Object(r.default)(a.events,a.default.IMAGE_CACHE_CHANGED,t),n.sharedCacheKey=e.sharedCacheKey,s()}}),(function(){var t=l[e];u.splice(u.indexOf(t),1),delete l[e]}))}function f(e){if(void 0===e)throw new Error("getImageLoadObject: imageId must not be undefined");var t=l[e];if(void 0!==t)return t.timeStamp=Date.now(),t.imageLoadObject}function v(e){if(void 0===e)throw new Error("removeImageLoadObject: imageId must not be undefined");var t=l[e];if(void 0===t)throw new Error("removeImageLoadObject: imageId was not present in imageCache");u.splice(u.indexOf(t),1),i-=t.sizeInBytes;var n,o={action:"deleteImage",image:t};Object(r.default)(a.events,a.default.IMAGE_CACHE_CHANGED,o),(n=t.imageLoadObject).promise.then((function(){n.decache&&n.decache()}),(function(){n.decache&&n.decache()})),delete l[e]}function m(){return{maximumSizeInBytes:o,cacheSizeInBytes:i,numberOfImagesCached:u.length}}function g(){for(;u.length>0;)v(u[0].imageId)}function h(e,t){var n=l[e];n&&n.imageLoadObject.promise.then((function(e){var o=t-e.sizeInBytes;e.sizeInBytes=t,n.sizeInBytes=t,i+=o;var l={action:"changeImageSize",image:e};Object(r.default)(a.events,a.default.IMAGE_CACHE_CHANGED,l)}))}t.default={imageCache:l,cachedImages:u,setMaximumSizeBytes:d,putImageLoadObject:c,getImageLoadObject:f,removeImageLoadObject:v,getCacheInfo:m,purgeCache:g,changeImageIdCacheSize:h}},"./imageLoader.js":function(e,t,n){"use strict";n.r(t),n.d(t,"loadImage",(function(){return d})),n.d(t,"loadAndCacheImage",(function(){return s})),n.d(t,"registerImageLoader",(function(){return c})),n.d(t,"registerUnknownImageLoader",(function(){return f}));var a,r=n("./imageCache.js"),o=n("./events.js"),i=n("./triggerEvent.js"),l={};function u(e,t){var n=e.indexOf(":"),r=e.substring(0,n),u=l[r];if(null==u){if(void 0!==a)return a(e);throw new Error("loadImageFromImageLoader: no image loader for imageId")}var d=u(e,t);return d.promise.then((function(e){Object(i.default)(o.events,o.default.IMAGE_LOADED,{image:e})}),(function(t){var n={imageId:e,error:t};Object(i.default)(o.events,o.default.IMAGE_LOAD_FAILED,n)})),d}function d(e,t){if(void 0===e)throw new Error("loadImage: parameter imageId must not be undefined");var n=Object(r.getImageLoadObject)(e);return void 0!==n?n.promise:u(e,t).promise}function s(e,t){if(void 0===e)throw new Error("loadAndCacheImage: parameter imageId must not be undefined");var n=Object(r.getImageLoadObject)(e);return void 0!==n||(n=u(e,t),Object(r.putImageLoadObject)(e,n)),n.promise}function c(e,t){l[e]=t}function f(e){var t=a;return a=e,t}},"./index.js":function(e,t,n){"use strict";n.r(t);var a=n("./events.js");n.d(t,"EVENTS",(function(){return a.default})),n.d(t,"events",(function(){return a.events}));var r=n("./enabledElements.js");n.d(t,"getEnabledElement",(function(){return r.getEnabledElement})),n.d(t,"addEnabledElement",(function(){return r.addEnabledElement})),n.d(t,"getEnabledElementsByImageId",(function(){return r.getEnabledElementsByImageId})),n.d(t,"getEnabledElements",(function(){return r.getEnabledElements}));var o=n("./layers.js");n.d(t,"addLayer",(function(){return o.addLayer})),n.d(t,"removeLayer",(function(){return o.removeLayer})),n.d(t,"getLayer",(function(){return o.getLayer})),n.d(t,"getLayers",(function(){return o.getLayers})),n.d(t,"getVisibleLayers",(function(){return o.getVisibleLayers})),n.d(t,"setActiveLayer",(function(){return o.setActiveLayer})),n.d(t,"getActiveLayer",(function(){return o.getActiveLayer})),n.d(t,"purgeLayers",(function(){return o.purgeLayers})),n.d(t,"setLayerImage",(function(){return o.setLayerImage}));var i=n("./falseColorMapping.js");n.d(t,"convertImageToFalseColorImage",(function(){return i.convertImageToFalseColorImage})),n.d(t,"convertToFalseColorImage",(function(){return i.convertToFalseColorImage})),n.d(t,"restoreImage",(function(){return i.restoreImage}));var l=n("./enabledElementData.js");n.d(t,"getElementData",(function(){return l.getElementData})),n.d(t,"removeElementData",(function(){return l.removeElementData}));var u=n("./imageLoader.js");n.d(t,"loadImage",(function(){return u.loadImage})),n.d(t,"loadAndCacheImage",(function(){return u.loadAndCacheImage})),n.d(t,"registerImageLoader",(function(){return u.registerImageLoader})),n.d(t,"registerUnknownImageLoader",(function(){return u.registerUnknownImageLoader}));var d=n("./requestPool/imageLoadPoolManager.ts");n.d(t,"imageLoadPoolManager",(function(){return d.default}));var s=n("./requestPool/imageRetrievalPoolManager.ts");n.d(t,"imageRetrievalPoolManager",(function(){return s.default}));var c=n("./requestPool/RequestPoolManager.ts");n.d(t,"RequestPoolManager",(function(){return c.RequestPoolManager}));var f=n("./canvasToPixel.js");n.d(t,"canvasToPixel",(function(){return f.default}));var v=n("./colors/index.js");n.d(t,"colors",(function(){return v.default}));var m=n("./disable.js");n.d(t,"disable",(function(){return m.default}));var g=n("./displayImage.js");n.d(t,"displayImage",(function(){return g.default}));var h=n("./draw.js");n.d(t,"draw",(function(){return h.default}));var p=n("./internal/drawImage.js");n.d(t,"drawImage",(function(){return p.default}));var E=n("./drawInvalidated.js");n.d(t,"drawInvalidated",(function(){return E.default}));var y=n("./enable.js");n.d(t,"enable",(function(){return y.default}));var b=n("./fitToWindow.js");n.d(t,"fitToWindow",(function(){return b.default}));var T=n("./internal/generateLut.js");n.d(t,"generateLut",(function(){return T.default}));var x=n("./internal/getDefaultViewport.js");n.d(t,"getDefaultViewport",(function(){return x.default}));var w=n("./getDefaultViewportForImage.js");n.d(t,"getDefaultViewportForImage",(function(){return w.default}));var C=n("./internal/getDisplayedArea.js");n.d(t,"getDisplayedArea",(function(){return C.default}));var M=n("./getImage.js");n.d(t,"getImage",(function(){return M.default}));var S=n("./getPixels.js");n.d(t,"getPixels",(function(){return S.default}));var O=n("./getStoredPixels.js");n.d(t,"getStoredPixels",(function(){return O.default}));var I=n("./getViewport.js");n.d(t,"getViewport",(function(){return I.default}));var _=n("./imageCache.js");n.d(t,"imageCache",(function(){return _.default}));var P=n("./internal/index.js");n.d(t,"internal",(function(){return P.default}));var L=n("./invalidate.js");n.d(t,"invalidate",(function(){return L.default}));var D=n("./invalidateImageId.js");n.d(t,"invalidateImageId",(function(){return D.default}));var j=n("./metaData.js");n.d(t,"metaData",(function(){return j.default}));var A=n("./pageToPixel.js");n.d(t,"pageToPixel",(function(){return A.default}));var R=n("./pixelDataToFalseColorData.js");n.d(t,"pixelDataToFalseColorData",(function(){return R.default}));var k=n("./pixelToCanvas.js");n.d(t,"pixelToCanvas",(function(){return k.default}));var U=n("./rendering/renderColorImage.js");n.d(t,"renderColorImage",(function(){return U.renderColorImage}));var N=n("./rendering/renderGrayscaleImage.js");n.d(t,"renderGrayscaleImage",(function(){return N.renderGrayscaleImage}));var H=n("./rendering/renderLabelMapImage.js");n.d(t,"renderLabelMapImage",(function(){return H.renderLabelMapImage}));var V=n("./rendering/renderPseudoColorImage.js");n.d(t,"renderPseudoColorImage",(function(){return V.renderPseudoColorImage}));var B=n("./rendering/renderToCanvas.js");n.d(t,"renderToCanvas",(function(){return B.default}));var z=n("./rendering/renderWebImage.js");n.d(t,"renderWebImage",(function(){return z.renderWebImage}));var W=n("./rendering/index.js");n.d(t,"rendering",(function(){return W.default}));var G=n("./internal/requestAnimationFrame.js");n.d(t,"requestAnimationFrame",(function(){return G.default}));var F=n("./reset.js");n.d(t,"reset",(function(){return F.default}));var q=n("./resize.js");n.d(t,"resize",(function(){return q.default}));var Y=n("./internal/setDefaultViewport.js");n.d(t,"setDefaultViewport",(function(){return Y.default}));var K=n("./setToPixelCoordinateSystem.js");n.d(t,"setToPixelCoordinateSystem",(function(){return K.default}));var X=n("./setViewport.js");n.d(t,"setViewport",(function(){return X.default}));var Z=n("./internal/storedColorPixelDataToCanvasImageData.js");n.d(t,"storedColorPixelDataToCanvasImageData",(function(){return Z.default}));var Q=n("./internal/storedPixelDataToCanvasImageData.js");n.d(t,"storedPixelDataToCanvasImageData",(function(){return Q.default}));var J=n("./internal/storedPixelDataToCanvasImageDataColorLUT.js");n.d(t,"storedPixelDataToCanvasImageDataColorLUT",(function(){return J.default}));var $=n("./internal/storedPixelDataToCanvasImageDataPseudocolorLUT.js");n.d(t,"storedPixelDataToCanvasImageDataPseudocolorLUT",(function(){return $.default}));var ee=n("./triggerEvent.js");n.d(t,"triggerEvent",(function(){return ee.default}));var te=n("./updateImage.js");n.d(t,"updateImage",(function(){return te.default}));var ne=n("./webgl/index.js");n.d(t,"webGL",(function(){return ne.default}));var ae={drawImage:p.default,generateLut:T.default,getDefaultViewport:x.default,requestAnimationFrame:G.default,storedPixelDataToCanvasImageData:Q.default,storedColorPixelDataToCanvasImageData:Z.default,storedPixelDataToCanvasImageDataColorLUT:J.default,storedPixelDataToCanvasImageDataPseudocolorLUT:$.default,internal:P.default,renderLabelMapImage:H.renderLabelMapImage,renderPseudoColorImage:V.renderPseudoColorImage,renderColorImage:U.renderColorImage,renderGrayscaleImage:N.renderGrayscaleImage,renderWebImage:z.renderWebImage,renderToCanvas:B.default,canvasToPixel:f.default,disable:m.default,displayImage:g.default,draw:h.default,drawInvalidated:E.default,enable:y.default,getElementData:l.getElementData,removeElementData:l.removeElementData,getEnabledElement:r.getEnabledElement,addEnabledElement:r.addEnabledElement,getEnabledElementsByImageId:r.getEnabledElementsByImageId,getEnabledElements:r.getEnabledElements,addLayer:o.addLayer,removeLayer:o.removeLayer,getLayer:o.getLayer,getLayers:o.getLayers,getVisibleLayers:o.getVisibleLayers,setActiveLayer:o.setActiveLayer,getActiveLayer:o.getActiveLayer,purgeLayers:o.purgeLayers,setLayerImage:o.setLayerImage,fitToWindow:b.default,getDefaultViewportForImage:w.default,getDisplayedArea:C.default,setDefaultViewport:Y.default,getImage:M.default,getPixels:S.default,getStoredPixels:O.default,getViewport:I.default,loadImage:u.loadImage,loadAndCacheImage:u.loadAndCacheImage,registerImageLoader:u.registerImageLoader,registerUnknownImageLoader:u.registerUnknownImageLoader,invalidate:L.default,invalidateImageId:D.default,pageToPixel:A.default,pixelToCanvas:k.default,reset:F.default,resize:q.default,setToPixelCoordinateSystem:K.default,setViewport:X.default,updateImage:te.default,pixelDataToFalseColorData:R.default,rendering:W.default,imageCache:_.default,metaData:j.default,webGL:ne.default,colors:v.default,convertImageToFalseColorImage:i.convertImageToFalseColorImage,convertToFalseColorImage:i.convertToFalseColorImage,restoreImage:i.restoreImage,EVENTS:a.default,events:a.events,triggerEvent:ee.default,imageLoadPoolManager:d.default,imageRetrievalPoolManager:s.default,RequestPoolManager:c.RequestPoolManager};t.default=ae},"./internal/calculateTransform.js":function(e,t,n){"use strict";n.r(t);var a=n("./internal/transform.js"),r=n("./internal/getDisplayedArea.js");t.default=function(e,t){var n=new a.Transform;n.translate(e.canvas.width/2,e.canvas.height/2);var o=e.viewport.rotation;0!==o&&n.rotate(o*Math.PI/180);var i=e.viewport.scale,l=e.viewport.scale,u=Object(r.default)(e.image,e.viewport),d=u.tlhc.x-1,s=u.tlhc.y-1,c=u.brhc.x-d,f=u.brhc.y-s;if("NONE"===u.presentationSizeMode)e.image.rowPixelSpacing<e.image.columnPixelSpacing?i*=e.image.columnPixelSpacing/e.image.rowPixelSpacing:e.image.columnPixelSpacing<e.image.rowPixelSpacing&&(l*=e.image.rowPixelSpacing/e.image.columnPixelSpacing);else if(i=u.columnPixelSpacing,l=u.rowPixelSpacing,"SCALE TO FIT"===u.presentationSizeMode){var v=e.canvas.height/(f*l),m=e.canvas.width/(c*i);i=l=Math.min(m,v),u.rowPixelSpacing<u.columnPixelSpacing?i*=u.columnPixelSpacing/u.rowPixelSpacing:u.columnPixelSpacing<u.rowPixelSpacing&&(l*=u.rowPixelSpacing/u.columnPixelSpacing)}return n.scale(i,l),0!==o&&n.rotate(-o*Math.PI/180),n.translate(e.viewport.translation.x,e.viewport.translation.y),0!==o&&n.rotate(o*Math.PI/180),void 0!==t&&n.scale(t,t),e.viewport.hflip&&n.scale(-1,1),e.viewport.vflip&&n.scale(1,-1),n.translate(-c/2,-f/2),n.translate(-d,-s),n}},"./internal/computeAutoVoi.js":function(e,t,n){"use strict";function a(e,t){if(!function(e){return e.voiLUT&&e.voiLUT.lut&&e.voiLUT.lut.length>0||void 0!==e.voi.windowWidth&&void 0!==e.voi.windowCenter}(e)){var n=t.maxPixelValue*t.slope+t.intercept,a=t.minPixelValue*t.slope+t.intercept,r=n-a,o=(n+a)/2;void 0===e.voi?e.voi={windowWidth:r,windowCenter:o}:(e.voi.windowWidth=r,e.voi.windowCenter=o)}}n.r(t),n.d(t,"default",(function(){return a}))},"./internal/createViewport.js":function(e,t,n){"use strict";n.r(t);var a=n("./internal/setDefaultViewport.js");t.default=function(){var e={scale:1,translation:{x:0,y:0},voi:{windowWidth:void 0,windowCenter:void 0},invert:!1,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:void 0,voiLUT:void 0,colormap:void 0,labelmap:!1,displayedArea:void 0};return Object.assign({},e,a.state.viewport)}},"./internal/drawCompositeImage.js":function(e,t,n){"use strict";n.r(t);var a=n("./layers.js"),r=n("./rendering/renderGrayscaleImage.js"),o=n("./rendering/renderColorImage.js"),i=n("./rendering/renderPseudoColorImage.js"),l=n("./rendering/renderLabelMapImage.js"),u=n("./setToPixelCoordinateSystem.js"),d=n("./internal/getDisplayedArea.js");function s(e){var t=e.syncProps||{};t.originalScale=e.viewport.scale,e.syncProps=t}function c(e,t){e.forEach((function(e){if(e!==t&&e.viewport&&t.viewport){e.syncProps||s(e);var n,a,r=(a=e,(n=t).syncProps||s(n),a.syncProps||s(a),a.syncProps.originalScale/n.syncProps.originalScale);e.viewport.scale=t.viewport.scale*r,e.viewport.rotation=t.viewport.rotation,e.viewport.translation={x:t.viewport.translation.x/r,y:t.viewport.translation.y/r},e.viewport.hflip=t.viewport.hflip,e.viewport.vflip=t.viewport.vflip}}))}t.default=function(e,t){var n=e.element,f=Object(a.getLayers)(n),v=Object(a.getActiveLayer)(n),m=Object(a.getVisibleLayers)(n),g=!e.lastSyncViewportsState&&e.syncViewports;e.lastSyncViewportsState=e.syncViewports,g&&f.forEach((function(e){e.viewport&&s(e)})),!0===e.syncViewports&&c(m,v);var h=e.canvas.getContext("2d",{desynchronized:!0});h.setTransform(1,0,0,1,0,0),h.fillStyle="black",h.fillRect(0,0,e.canvas.width,e.canvas.height),function(e,t,n){t.forEach((function(t,a){if(t.image){e.save(),t.canvas=e.canvas,Object(u.default)(t,e);var s=t.viewport.colormap||t.options.colormap,c=t.viewport.labelmap,f=t.invalid||n;if(s&&""!==s&&!0===c)Object(l.addLabelMapLayer)(t,f);else if(s&&""!==s)Object(i.addPseudoColorLayer)(t,f);else if(!0===t.image.color)Object(o.addColorLayer)(t,f);else{var v=0===a;Object(r.addGrayscaleLayer)(t,f,v)}t.options&&t.options.opacity?e.globalAlpha=t.options.opacity:e.globalAlpha=1,t.options&&t.options.fillStyle&&(e.fillStyle=t.options.fillStyle),e.imageSmoothingEnabled=!t.viewport.pixelReplication,e.mozImageSmoothingEnabled=e.imageSmoothingEnabled;var m=Object(d.default)(t.image,t.viewport),g=m.tlhc.x-1,h=m.tlhc.y-1,p=m.brhc.x-g,E=m.brhc.y-h;e.drawImage(t.canvas,g,h,p,E,g,h,p,E),e.restore(),t.invalid=!1}}))}(h,m,t)}},"./internal/drawImage.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.needsRedraw=!0,t&&(e.invalid=!0)}},"./internal/drawImageSync.js":function(e,t,n){"use strict";n.r(t);var a=n("./internal/now.js"),r=n("./internal/drawCompositeImage.js"),o=n("./rendering/renderColorImage.js"),i=n("./rendering/renderGrayscaleImage.js"),l=n("./rendering/renderPseudoColorImage.js"),u=n("./rendering/renderLabelMapImage.js"),d=n("./triggerEvent.js"),s=n("./events.js");t.default=function(e,t){var n=e.image,c=e.element,f=e.layers||[];if(e.canvas&&e.image){var v=Object(a.default)();if(n.stats={lastGetPixelDataTime:-1,lastStoredPixelDataToCanvasImageDataTime:-1,lastPutImageDataTime:-1,lastRenderTime:-1,lastLutGenerateTime:-1},f&&f.length)Object(r.default)(e,t);else if(n){var m=n.render;m||(m=e.viewport.colormap&&""!==e.viewport.colormap&&!0===e.image.labelmap?u.renderLabelMapImage:e.viewport.colormap&&""!==e.viewport.colormap?l.renderPseudoColorImage:n.color?o.renderColorImage:i.renderGrayscaleImage),m(e,t)}var g=Object(a.default)()-v,h={viewport:e.viewport,element:c,image:n,enabledElement:e,canvasContext:e.canvas.getContext("2d",{desynchronized:!0}),renderTimeInMs:g};n.stats.lastRenderTime=g,e.invalid=!1,e.needsRedraw=!1,Object(d.default)(c,s.default.IMAGE_RENDERED,h)}}},"./internal/generateColorLut.js":function(e,t,n){"use strict";n.r(t);var a=n("./internal/getVOILut.js");t.default=function(e,t,n,r,o){var i=e.maxPixelValue,l=e.minPixelValue,u=Math.min(l,0);if(void 0===e.cachedLut){var d=i-u+1;e.cachedLut={},e.cachedLut.lutArray=new Uint8ClampedArray(d)}var s=e.cachedLut.lutArray,c=Object(a.default)(t,n,o);if(!0===r)for(var f=l;f<=i;f++)s[f+-u]=255-c(f);else for(var v=l;v<=i;v++)s[v+-u]=c(v);return s}},"./internal/generateLut.js":function(e,t,n){"use strict";n.r(t);var a=n("./internal/getModalityLUT.js"),r=n("./internal/getVOILut.js");t.default=function(e,t,n,o,i,l){var u=e.maxPixelValue,d=e.minPixelValue,s=Math.min(d,0);if(void 0===e.cachedLut){var c=u-s+1;e.cachedLut={},e.cachedLut.lutArray=new Uint8ClampedArray(c)}var f=e.cachedLut.lutArray,v=Boolean(e.slope%1)||Boolean(e.intercept%1),m=Object(a.default)(e.slope,e.intercept,i),g=Object(r.default)(t,n,l,v);if(!0===o)for(var h=d;h<=u;h++)f[h+-s]=255-g(m(h));else for(var p=d;p<=u;p++)f[p+-s]=g(m(p));return f}},"./internal/getCanvas.js":function(e,t,n){"use strict";function a(e){var t="canvas.".concat("cornerstone-canvas");return e.querySelector(t)||function(e){var t=document.createElement("canvas");return t.style.display="block",t.classList.add("cornerstone-canvas"),e.appendChild(t),t}(e)}n.r(t),n.d(t,"default",(function(){return a}))},"./internal/getDefaultViewport.js":function(e,t,n){"use strict";n.r(t);var a=n("./internal/createViewport.js"),r=n("./internal/getImageFitScale.js");t.default=function(e,t){if(void 0===e)throw new Error("getDefaultViewport: parameter canvas must not be undefined");return void 0===t?Object(a.default)():{scale:Object(r.default)(e,t,0).scaleFactor,translation:{x:0,y:0},voi:{windowWidth:t.windowWidth,windowCenter:t.windowCenter},invert:t.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:t.modalityLUT,voiLUT:t.voiLUT,colormap:t.colormap,labelmap:Boolean(t.labelmap),displayedArea:void 0}}},"./internal/getDisplayedArea.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t&&t.displayedArea)return t.displayedArea;if(void 0===e)throw new Error("getDisplayedArea: parameter image must not be undefined");return{tlhc:{x:1,y:1},brhc:{x:e.columns,y:e.rows},rowPixelSpacing:void 0===e.rowPixelSpacing?1:e.rowPixelSpacing,columnPixelSpacing:void 0===e.columnPixelSpacing?1:e.columnPixelSpacing,presentationSizeMode:"NONE"}}},"./internal/getFillStyle.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){var t=(e.viewport||{}).invert,n=(e.options||{}).fillStyle;return-1!==["black","white"].indexOf(n)&&t?"white":"black"}},"./internal/getImageFitScale.js":function(e,t,n){"use strict";n.r(t);var a=n("./internal/validator.js"),r=n("./internal/getImageSize.js");t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Object(a.validateParameterUndefinedOrNull)(e,"getImageScale: parameter windowSize must not be undefined"),Object(a.validateParameterUndefinedOrNull)(t,"getImageScale: parameter image must not be undefined");var o=Object(r.default)(t,n),i=t.rowPixelSpacing||1,l=t.columnPixelSpacing||1,u=1,d=1;i<l?d=l/i:u=i/l;var s=e.height/o.height/u,c=e.width/o.width/d;return{verticalScale:s,horizontalScale:c,scaleFactor:Math.min(c,s)}}},"./internal/getImageSize.js":function(e,t,n){"use strict";n.r(t);var a=n("./internal/validator.js");function r(e){return!(null==e||0===e||180===e)}t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Object(a.validateParameterUndefinedOrNull)(e,"getImageSize: parameter image must not be undefined"),Object(a.validateParameterUndefinedOrNull)(e.width,"getImageSize: parameter image must have width"),Object(a.validateParameterUndefinedOrNull)(e.height,"getImageSize: parameter image must have height"),r(t)?{height:e.width,width:e.height}:{width:e.width,height:e.height}}},"./internal/getModalityLUT.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t,n){return n?function(e){var t=e.lut[0],n=e.lut[e.lut.length-1],a=e.firstValueMapped+e.lut.length;return function(r){return r<e.firstValueMapped?t:r>=a?n:e.lut[r]}}(n):function(e,t){return function(n){return n*e+t}}(e,t)}},"./internal/getTransform.js":function(e,t,n){"use strict";n.r(t);var a=n("./internal/calculateTransform.js");t.default=function(e){return Object(a.default)(e)}},"./internal/getVOILut.js":function(e,t,n){"use strict";function a(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}n.r(t),t.default=function(e,t,n,r){return n?function(e,t){var n=Math.max.apply(Math,a(e.lut)).toString(2).length-8,r=e.lut[0]>>n,o=e.lut[e.lut.length-1]>>n,i=e.firstValueMapped+e.lut.length-1;return function(a){return a<e.firstValueMapped?r:a>=i?o:t?e.lut[Math.round(a)-e.firstValueMapped]>>n:e.lut[a-e.firstValueMapped]>>n}}(n,r):function(e,t){return function(n){return 255*((n-t)/e+.5)}}(e,t)}},"./internal/guid.js":function(e,t,n){"use strict";function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}n.r(t),t.default=function(){return"".concat(a()+a(),"-").concat(a(),"-").concat(a(),"-").concat(a(),"-").concat(a()).concat(a()).concat(a())}},"./internal/index.js":function(e,t,n){"use strict";n.r(t);var a=n("./internal/transform.js"),r=n("./internal/calculateTransform.js"),o=n("./internal/drawImage.js"),i=n("./internal/generateLut.js"),l=n("./internal/getDefaultViewport.js"),u=n("./internal/getTransform.js"),d=n("./internal/requestAnimationFrame.js"),s=n("./internal/setDefaultViewport.js"),c=n("./internal/storedColorPixelDataToCanvasImageData.js"),f=n("./internal/storedPixelDataToCanvasImageData.js"),v=n("./internal/storedPixelDataToCanvasImageDataColorLUT.js"),m=n("./internal/storedPixelDataToCanvasImageDataPseudocolorLUT.js"),g=n("./internal/storedPixelDataToCanvasImageDataRGBA.js");t.default={drawImage:o.default,generateLut:i.default,getDefaultViewport:l.default,requestAnimationFrame:d.default,setDefaultViewport:s.default,storedPixelDataToCanvasImageData:f.default,storedPixelDataToCanvasImageDataRGBA:g.default,storedPixelDataToCanvasImageDataColorLUT:v.default,storedPixelDataToCanvasImageDataPseudocolorLUT:m.default,storedColorPixelDataToCanvasImageData:c.default,getTransform:u.default,calculateTransform:r.default,Transform:a.Transform}},"./internal/now.js":function(e,t,n){"use strict";n.r(t),t.default=function(){return window.performance?performance.now():Date.now()}},"./internal/requestAnimationFrame.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){return window.requestAnimationFrame(e)||window.webkitRequestAnimationFrame(e)||window.mozRequestAnimationFrame(e)||window.oRequestAnimationFrame(e)||window.msRequestAnimationFrame(e)||function(e){window.setTimeout(e,1e3/60)}(e)}},"./internal/setDefaultViewport.js":function(e,t,n){"use strict";n.r(t),n.d(t,"state",(function(){return a}));var a={viewport:{}};t.default=function(e){a.viewport=e||{}}},"./internal/storedColorPixelDataToCanvasImageData.js":function(e,t,n){"use strict";n.r(t);var a=n("./internal/now.js");t.default=function(e,t,n){var r=Object(a.default)(),o=e.getPixelData();e.stats.lastGetPixelDataTime=Object(a.default)()-r;var i=e.minPixelValue,l=0,u=0,d=o.length;if(r=Object(a.default)(),i<0)for(;u<d;)n[l++]=t[o[u++]+-i],n[l++]=t[o[u++]+-i],n[l]=t[o[u]+-i],u+=2,l+=2;else for(;u<d;)n[l++]=t[o[u++]],n[l++]=t[o[u++]],n[l]=t[o[u]],u+=2,l+=2;e.stats.lastStoredPixelDataToCanvasImageDataTime=Object(a.default)()-r}},"./internal/storedPixelDataToCanvasImageData.js":function(e,t,n){"use strict";n.r(t);var a=n("./internal/now.js");t.default=function(e,t,n){var r=Object(a.default)(),o=e.getPixelData();e.stats.lastGetPixelDataTime=Object(a.default)()-r;var i=o.length,l=e.minPixelValue,u=3,d=0;if(r=Object(a.default)(),o instanceof Int16Array)if(l<0)for(;d<i;)n[u]=t[o[d++]+-l],u+=4;else for(;d<i;)n[u]=t[o[d++]],u+=4;else if(o instanceof Uint16Array)for(;d<i;)n[u]=t[o[d++]],u+=4;else if(l<0)for(;d<i;)n[u]=t[o[d++]+-l],u+=4;else for(;d<i;)n[u]=t[o[d++]],u+=4;e.stats.lastStoredPixelDataToCanvasImageDataTime=Object(a.default)()-r}},"./internal/storedPixelDataToCanvasImageDataColorLUT.js":function(e,t,n){"use strict";n.r(t);var a=n("./colors/index.js"),r=n("./internal/now.js");t.default=function(e,t,n){var o=Object(r.default)(),i=e.getPixelData();e.stats.lastGetPixelDataTime=Object(r.default)()-o;var l,u,d=i.length,s=e.minPixelValue,c=0,f=0;if(o=Object(r.default)(),u=t instanceof a.default.LookupTable?t.Table:t,s<0)for(;f<d;)l=u[i[f++]+-s],n[c++]=l[0],n[c++]=l[1],n[c++]=l[2],n[c++]=l[3];else for(;f<d;)l=u[i[f++]],n[c++]=l[0],n[c++]=l[1],n[c++]=l[2],n[c++]=l[3];e.stats.lastStoredPixelDataToCanvasImageDataTime=Object(r.default)()-o}},"./internal/storedPixelDataToCanvasImageDataPseudocolorLUT.js":function(e,t,n){"use strict";n.r(t);var a=n("./colors/index.js"),r=n("./internal/now.js");t.default=function(e,t,n,o){var i=Object(r.default)(),l=e.getPixelData();e.stats.lastGetPixelDataTime=Object(r.default)()-i;var u,d,s=l.length,c=e.minPixelValue,f=0,v=0;if(i=Object(r.default)(),d=n instanceof a.default.LookupTable?n.Table:n,c<0)for(;v<s;)u=d[t[l[v++]+-c]],o[f++]=u[0],o[f++]=u[1],o[f++]=u[2],o[f++]=u[3];else for(;v<s;)u=d[t[l[v++]]],o[f++]=u[0],o[f++]=u[1],o[f++]=u[2],o[f++]=u[3];e.stats.lastStoredPixelDataToCanvasImageDataTime=Object(r.default)()-i}},"./internal/storedPixelDataToCanvasImageDataRGBA.js":function(e,t,n){"use strict";n.r(t);var a=n("./internal/now.js");t.default=function(e,t,n){var r=Object(a.default)(),o=e.getPixelData();e.stats.lastGetPixelDataTime=Object(a.default)()-r;var i,l=o.length,u=e.minPixelValue,d=0,s=0;if(r=Object(a.default)(),o instanceof Int16Array)if(u<0)for(;s<l;)i=t[o[s++]+-u],n[d++]=i,n[d++]=i,n[d++]=i,n[d++]=255;else for(;s<l;)i=t[o[s++]],n[d++]=i,n[d++]=i,n[d++]=i,n[d++]=255;else if(o instanceof Uint16Array)for(;s<l;)i=t[o[s++]],n[d++]=i,n[d++]=i,n[d++]=i,n[d++]=255;else if(u<0)for(;s<l;)i=t[o[s++]+-u],n[d++]=i,n[d++]=i,n[d++]=i,n[d++]=255;else for(;s<l;)i=t[o[s++]],n[d++]=i,n[d++]=i,n[d++]=i,n[d++]=255;e.stats.lastStoredPixelDataToCanvasImageDataTime=Object(a.default)()-r}},"./internal/storedRGBAPixelDataToCanvasImageData.js":function(e,t,n){"use strict";n.r(t);var a=n("./internal/now.js");t.default=function(e,t,n){var r=Object(a.default)(),o=e.getPixelData();e.stats.lastGetPixelDataTime=Object(a.default)()-r;var i=e.minPixelValue,l=0,u=0,d=o.length;if(r=Object(a.default)(),i<0)for(;u<d;)n[l++]=t[o[u++]+-i],n[l++]=t[o[u++]+-i],n[l++]=t[o[u++]+-i],n[l++]=o[u++];else for(;u<d;)n[l++]=t[o[u++]],n[l++]=t[o[u++]],n[l++]=t[o[u++]],n[l++]=o[u++];e.stats.lastStoredPixelDataToCanvasImageDataTime=Object(a.default)()-r}},"./internal/transform.js":function(e,t,n){"use strict";function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}n.r(t),n.d(t,"Transform",(function(){return r}));var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.reset()}var t,n,r;return t=e,(n=[{key:"reset",value:function(){this.m=[1,0,0,1,0,0]}},{key:"clone",value:function(){var t=new e;return t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5],t}},{key:"multiply",value:function(e){var t=this.m[0]*e.m[0]+this.m[2]*e.m[1],n=this.m[1]*e.m[0]+this.m[3]*e.m[1],a=this.m[0]*e.m[2]+this.m[2]*e.m[3],r=this.m[1]*e.m[2]+this.m[3]*e.m[3],o=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4],i=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5];this.m[0]=t,this.m[1]=n,this.m[2]=a,this.m[3]=r,this.m[4]=o,this.m[5]=i}},{key:"invert",value:function(){var e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=this.m[3]*e,n=-this.m[1]*e,a=-this.m[2]*e,r=this.m[0]*e,o=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),i=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=t,this.m[1]=n,this.m[2]=a,this.m[3]=r,this.m[4]=o,this.m[5]=i}},{key:"rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),a=this.m[0]*t+this.m[2]*n,r=this.m[1]*t+this.m[3]*n,o=this.m[0]*-n+this.m[2]*t,i=this.m[1]*-n+this.m[3]*t;this.m[0]=a,this.m[1]=r,this.m[2]=o,this.m[3]=i}},{key:"translate",value:function(e,t){this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t}},{key:"scale",value:function(e,t){this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t}},{key:"transformPoint",value:function(e,t){var n=e,a=t;return{x:e=n*this.m[0]+a*this.m[2]+this.m[4],y:t=n*this.m[1]+a*this.m[3]+this.m[5]}}}])&&a(t.prototype,n),r&&a(t,r),e}()},"./internal/tryEnableWebgl.js":function(e,t,n){"use strict";n.r(t);var a=n("./webgl/index.js");t.default=function(e){return a.default.renderer.isWebGLAvailable()?(a.default.renderer.initRenderer(),e.renderer="webgl",e.desynchronized=!0,e.preserveDrawingBuffer=!0,!0):(console.error("WebGL not available, falling back to Canvas renderer"),delete e.renderer,delete e.preserveDrawingBuffer,!1)}},"./internal/validator.js":function(e,t,n){"use strict";function a(e,t){if(void 0===e)throw new Error(t)}function r(e,t){if(null==e)throw new Error(t)}n.r(t),n.d(t,"validateParameterUndefined",(function(){return a})),n.d(t,"validateParameterUndefinedOrNull",(function(){return r}))},"./invalidate.js":function(e,t,n){"use strict";n.r(t);var a=n("./enabledElements.js"),r=n("./triggerEvent.js"),o=n("./events.js");t.default=function(e){var t=Object(a.getEnabledElement)(e);t.invalid=!0,t.needsRedraw=!0;var n={element:e};Object(r.default)(e,o.default.INVALIDATED,n)}},"./invalidateImageId.js":function(e,t,n){"use strict";n.r(t);var a=n("./enabledElements.js"),r=n("./internal/drawImage.js");t.default=function(e){Object(a.getEnabledElementsByImageId)(e).forEach((function(e){Object(r.default)(e,!0)}))}},"./layers.js":function(e,t,n){"use strict";n.r(t),n.d(t,"rescaleImage",(function(){return c})),n.d(t,"addLayer",(function(){return f})),n.d(t,"removeLayer",(function(){return v})),n.d(t,"getLayer",(function(){return m})),n.d(t,"getLayers",(function(){return g})),n.d(t,"getVisibleLayers",(function(){return h})),n.d(t,"setActiveLayer",(function(){return p})),n.d(t,"setLayerImage",(function(){return E})),n.d(t,"getActiveLayer",(function(){return y})),n.d(t,"purgeLayers",(function(){return b}));var a=n("./internal/guid.js"),r=n("./enabledElements.js"),o=n("./internal/getDefaultViewport.js"),i=n("./internal/getDisplayedArea.js"),l=n("./updateImage.js"),u=n("./triggerEvent.js"),d=n("./events.js");function s(e,t,n){var a=t.element,r={viewport:t.viewport,element:t.element,image:t.image,enabledElement:t,layerId:n};Object(u.default)(a,e,r)}function c(e,t){if(e.layerId===t.layerId)throw new Error("rescaleImage: both arguments represent the same layer");var n=e.image,a=t.image;if(n.imageId&&a.imageId){var r=Object(i.default)(a,t.viewport),o=Object(i.default)(n,e.viewport),l=r.columnPixelSpacing*a.width/(o.columnPixelSpacing*n.width),u=t.viewport.scale/e.viewport.scale*l;t.viewport.scale=e.viewport.scale*u}}function f(e,t,n){var i,l=Object(a.default)(),u=Object(r.getEnabledElement)(e),f=u.layers;t&&(i=Object(o.default)(u.canvas,t),n&&n.viewport&&(i=Object.assign(i,n.viewport))),!1!==u.syncViewports&&(u.syncViewports=!0);var v={image:t,layerId:l,viewport:i,options:n||{},renderingTools:{}};return f.length&&t&&c(f[0],v),f.push(v),s(d.default.LAYER_ADDED,u,l),1===f.length&&t&&p(e,l),l}function v(e,t){var n=Object(r.getEnabledElement)(e),a=n.layers,o=n.layers.findIndex((function(e){return e.layerId===t}));-1!==o&&(a.splice(o,1),t===n.activeLayerId&&a.length&&p(e,a[0].layerId),s(d.default.LAYER_REMOVED,n,t))}function m(e,t){return Object(r.getEnabledElement)(e).layers.find((function(e){return e.layerId===t}))}function g(e){return Object(r.getEnabledElement)(e).layers}function h(e){return Object(r.getEnabledElement)(e).layers.filter((function(e){return e.options&&!1!==e.options.visible&&0!==e.options.opacity}))}function p(e,t){var n=Object(r.getEnabledElement)(e);if(n.activeLayerId!==t){var a=n.layers.findIndex((function(e){return e.layerId===t}));if(-1===a)throw new Error("setActiveLayer: layer not found in layers array");var o=n.layers[a];if(!o.image)throw new Error("setActiveLayer: layer with undefined image cannot be set as active.");n.activeLayerId=t,n.image=o.image,n.viewport=o.viewport,Object(l.default)(e),s(d.default.ACTIVE_LAYER_CHANGED,n,t)}}function E(e,t,n){var a,i=Object(r.getEnabledElement)(e),l=i.layers[0];if(!(a=n?m(e,n):y(e)))throw new Error("setLayerImage: Layer not found");if(a.image=t,t){if(!a.viewport){var u=Object(o.default)(i.canvas,t);a.options&&a.options.viewport&&(a.viewport=Object.assign(u,a.options.viewport)),l.layerId!==n&&c(l,a)}}else a.viewport=void 0}function y(e){var t=Object(r.getEnabledElement)(e);return t.layers.find((function(e){return e.layerId===t.activeLayerId}))}function b(e){var t=Object(r.getEnabledElement)(e);t.layers=[],delete t.activeLayerId,delete t.lastSyncViewportsState}},"./metaData.js":function(e,t,n){"use strict";n.r(t),n.d(t,"addProvider",(function(){return r})),n.d(t,"removeProvider",(function(){return o}));var a=[];function r(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(t=0;t<a.length&&!(a[t].priority<=n);t++);a.splice(t,0,{priority:n,provider:e})}function o(e){for(var t=0;t<a.length;t++)if(a[t].provider===e){a.splice(t,1);break}}t.default={addProvider:r,removeProvider:o,get:function(e,t){for(var n=0;n<a.length;n++){var r=a[n].provider(e,t);if(void 0!==r)return r}}}},"./pageToPixel.js":function(e,t,n){"use strict";n.r(t);var a=n("./enabledElements.js"),r=n("./internal/getTransform.js");t.default=function(e,t,n){var o=Object(a.getEnabledElement)(e);if(void 0===o.image)throw new Error("image has not been loaded yet");var i=e.getBoundingClientRect(),l={x:t-i.left-window.pageXOffset,y:n-i.top-window.pageYOffset},u=Object(r.default)(o);return u.invert(),u.transformPoint(l.x,l.y)}},"./pixelDataToFalseColorData.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return r}));var a=n("./colors/index.js");function r(e,t){if(e.color&&!e.falseColor)throw new Error("Color transforms are not implemented yet");var n,r,o=e.minPixelValue,i=0,l=0,u=e.width*e.height,d=e.origPixelData||e.getPixelData(),s=new Uint8Array(4*u);if(e.color=!0,e.falseColor=!0,e.origPixelData=d,t instanceof a.default.LookupTable)for(t.build();l<u;)n=d[l++],r=t.mapValue(n),s[i++]=r[0],s[i++]=r[1],s[i++]=r[2],s[i++]=r[3];else if(o<0)for(;l<u;)n=d[l++],s[i++]=t[n+-o][0],s[i++]=t[n+-o][1],s[i++]=t[n+-o][2],s[i++]=t[n+-o][3];else for(;l<u;)n=d[l++],s[i++]=t[n][0],s[i++]=t[n][1],s[i++]=t[n][2],s[i++]=t[n][3];e.rgba=!0,e.cachedLut=void 0,e.render=void 0,e.slope=1,e.intercept=0,e.minPixelValue=0,e.maxPixelValue=255,e.windowWidth=255,e.windowCenter=128,e.getPixelData=function(){return s}}},"./pixelToCanvas.js":function(e,t,n){"use strict";n.r(t);var a=n("./enabledElements.js"),r=n("./internal/getTransform.js");t.default=function(e,t){var n=Object(a.getEnabledElement)(e);return Object(r.default)(n).transformPoint(t.x,t.y)}},"./rendering/doesImageNeedToBeRendered.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){var n=e.renderingTools.lastRenderedImageId,a=e.renderingTools.lastRenderedViewport;return t.imageId!==n||!a||a.windowCenter!==e.viewport.voi.windowCenter||a.windowWidth!==e.viewport.voi.windowWidth||a.invert!==e.viewport.invert||a.rotation!==e.viewport.rotation||a.hflip!==e.viewport.hflip||a.vflip!==e.viewport.vflip||a.modalityLUT!==e.viewport.modalityLUT||a.voiLUT!==e.viewport.voiLUT||a.colormap!==e.viewport.colormap}},"./rendering/getLut.js":function(e,t,n){"use strict";n.r(t);var a=n("./internal/computeAutoVoi.js"),r=n("./rendering/lutMatches.js"),o=n("./internal/generateLut.js");t.default=function(e,t,n){return void 0!==e.cachedLut&&e.cachedLut.windowCenter===t.voi.windowCenter&&e.cachedLut.windowWidth===t.voi.windowWidth&&Object(r.default)(e.cachedLut.modalityLUT,t.modalityLUT)&&Object(r.default)(e.cachedLut.voiLUT,t.voiLUT)&&e.cachedLut.invert===t.invert&&!0!==n||(Object(a.default)(t,e),Object(o.default)(e,t.voi.windowWidth,t.voi.windowCenter,t.invert,t.modalityLUT,t.voiLUT),e.cachedLut.windowWidth=t.voi.windowWidth,e.cachedLut.windowCenter=t.voi.windowCenter,e.cachedLut.invert=t.invert,e.cachedLut.voiLUT=t.voiLUT,e.cachedLut.modalityLUT=t.modalityLUT),e.cachedLut.lutArray}},"./rendering/index.js":function(e,t,n){"use strict";n.r(t);var a=n("./rendering/renderColorImage.js"),r=n("./rendering/renderGrayscaleImage.js"),o=n("./rendering/renderWebImage.js"),i=n("./rendering/renderPseudoColorImage.js"),l=n("./rendering/renderLabelMapImage.js"),u=n("./rendering/renderToCanvas.js");t.default={colorImage:a.renderColorImage,grayscaleImage:r.renderGrayscaleImage,webImage:o.renderWebImage,pseudoColorImage:i.renderPseudoColorImage,labelMapImage:l.renderLabelMapImage,toCanvas:u.default}},"./rendering/initializeRenderCanvas.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){var n=e.renderingTools.renderCanvas;n.width=t.width,n.height=t.height;var a=n.getContext("2d",{desynchronized:!0});a.fillStyle="white",a.fillRect(0,0,n.width,n.height);var r=a.getImageData(0,0,t.width,t.height);e.renderingTools.renderCanvasContext=a,e.renderingTools.renderCanvasData=r}},"./rendering/lutMatches.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){return!e&&!t||!(!e||!t)&&e.id===t.id}},"./rendering/renderColorImage.js":function(e,t,n){"use strict";n.r(t),n.d(t,"renderColorImage",(function(){return g})),n.d(t,"addColorLayer",(function(){return h}));var a=n("./internal/now.js"),r=n("./internal/getFillStyle.js"),o=n("./internal/generateColorLut.js"),i=n("./internal/storedColorPixelDataToCanvasImageData.js"),l=n("./internal/storedRGBAPixelDataToCanvasImageData.js"),u=n("./setToPixelCoordinateSystem.js"),d=n("./webgl/index.js"),s=n("./rendering/doesImageNeedToBeRendered.js"),c=n("./rendering/initializeRenderCanvas.js"),f=n("./rendering/saveLastRendered.js"),v=n("./internal/getDisplayedArea.js");function m(e,t,n){var r=!0===e.renderingTools.lastRenderedIsColor;e.renderingTools.renderCanvas&&r||(e.renderingTools.renderCanvas=document.createElement("canvas"));var u=e.renderingTools.renderCanvas;if(255===e.viewport.voi.windowWidth&&128===e.viewport.voi.windowCenter&&!1===e.viewport.invert&&t.getCanvas&&t.getCanvas())return t.getCanvas();if(!1===Object(s.default)(e,t)&&!0!==n)return u;u.width===t.width&&u.height===t.height||Object(c.default)(e,t);var d=Object(a.default)(),f=function(e,t){return void 0!==e.cachedLut&&e.cachedLut.windowCenter===t.voi.windowCenter&&e.cachedLut.windowWidth===t.voi.windowWidth&&e.cachedLut.invert===t.invert||(Object(o.default)(e,t.voi.windowWidth,t.voi.windowCenter,t.invert),e.cachedLut.windowWidth=t.voi.windowWidth,e.cachedLut.windowCenter=t.voi.windowCenter,e.cachedLut.invert=t.invert),e.cachedLut.lutArray}(t,e.viewport);t.stats=t.stats||{},t.stats.lastLutGenerateTime=Object(a.default)()-d;var v=e.renderingTools.renderCanvasData,m=e.renderingTools.renderCanvasContext;return t.rgba?Object(l.default)(t,f,v.data):Object(i.default)(t,f,v.data),d=Object(a.default)(),m.putImageData(v,0,0),t.stats.lastPutImageDataTime=Object(a.default)()-d,u}function g(e,t){if(void 0===e)throw new Error("renderColorImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("renderColorImage: image must be loaded before it can be drawn");var a,o=e.canvas.getContext("2d",{desynchronized:!0});o.setTransform(1,0,0,1,0,0),o.fillStyle=Object(r.default)(e),o.fillRect(0,0,e.canvas.width,e.canvas.height),o.imageSmoothingEnabled=!e.viewport.pixelReplication,o.mozImageSmoothingEnabled=o.imageSmoothingEnabled,Object(u.default)(e,o),a=e.options&&e.options.renderer&&"webgl"===e.options.renderer.toLowerCase()?d.default.renderer.render(e):m(e,n,t);var i=Object(v.default)(e.image,e.viewport),l=i.tlhc.x-1,s=i.tlhc.y-1,c=i.brhc.x-l,g=i.brhc.y-s;o.drawImage(a,l,s,c,g,l,s,c,g),e.renderingTools=Object(f.default)(e)}function h(e,t){if(void 0===e)throw new Error("addColorLayer: layer parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("addColorLayer: image must be loaded before it can be drawn");n.rgba=!0,e.canvas=m(e,n,t);var a=e.canvas.getContext("2d",{desynchronized:!0});a.imageSmoothingEnabled=!e.viewport.pixelReplication,a.mozImageSmoothingEnabled=a.imageSmoothingEnabled,e.renderingTools=Object(f.default)(e)}},"./rendering/renderGrayscaleImage.js":function(e,t,n){"use strict";n.r(t),n.d(t,"renderGrayscaleImage",(function(){return g})),n.d(t,"addGrayscaleLayer",(function(){return h}));var a=n("./internal/getFillStyle.js"),r=n("./internal/storedPixelDataToCanvasImageData.js"),o=n("./internal/storedPixelDataToCanvasImageDataRGBA.js"),i=n("./setToPixelCoordinateSystem.js"),l=n("./internal/now.js"),u=n("./webgl/index.js"),d=n("./rendering/getLut.js"),s=n("./rendering/doesImageNeedToBeRendered.js"),c=n("./rendering/initializeRenderCanvas.js"),f=n("./rendering/saveLastRendered.js"),v=n("./internal/getDisplayedArea.js");function m(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=!0===e.renderingTools.lastRenderedIsColor;e.renderingTools.renderCanvas&&!i||(e.renderingTools.renderCanvas=document.createElement("canvas"),Object(c.default)(e,t));var u=e.renderingTools.renderCanvas;if(!1===Object(s.default)(e,t)&&!0!==n)return u;u.width===t.width&&u.height===t.height||Object(c.default)(e,t);var f=Object(l.default)(),v=Object(d.default)(t,e.viewport,n);t.stats=t.stats||{},t.stats.lastLutGenerateTime=Object(l.default)()-f;var m=e.renderingTools.renderCanvasData,g=e.renderingTools.renderCanvasContext;return a?Object(r.default)(t,v,m.data):Object(o.default)(t,v,m.data),f=Object(l.default)(),g.putImageData(m,0,0),t.stats.lastPutImageDataTime=Object(l.default)()-f,u}function g(e,t){if(void 0===e)throw new Error("drawImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("drawImage: image must be loaded before it can be drawn");var r,o=e.canvas.getContext("2d",{desynchronized:!0});o.setTransform(1,0,0,1,0,0),o.fillStyle=Object(a.default)(e),o.fillRect(0,0,e.canvas.width,e.canvas.height),o.imageSmoothingEnabled=!e.viewport.pixelReplication,o.mozImageSmoothingEnabled=o.imageSmoothingEnabled,Object(i.default)(e,o),r=e.options&&e.options.renderer&&"webgl"===e.options.renderer.toLowerCase()?u.default.renderer.render(e):m(e,n,t);var l=Object(v.default)(e.image,e.viewport),d=l.tlhc.x-1,s=l.tlhc.y-1,c=l.brhc.x-d,g=l.brhc.y-s;o.drawImage(r,d,s,c,g,d,s,c,g),e.renderingTools=Object(f.default)(e)}function h(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0===e)throw new Error("addGrayscaleLayer: layer parameter must not be undefined");var a=e.image;if(void 0===a)throw new Error("addGrayscaleLayer: image must be loaded before it can be drawn");e.canvas=m(e,a,t,n);var r=e.canvas.getContext("2d",{desynchronized:!0});r.imageSmoothingEnabled=!e.viewport.pixelReplication,r.mozImageSmoothingEnabled=r.imageSmoothingEnabled,e.renderingTools=Object(f.default)(e)}},"./rendering/renderLabelMapImage.js":function(e,t,n){"use strict";n.r(t),n.d(t,"renderLabelMapImage",(function(){return v})),n.d(t,"addLabelMapLayer",(function(){return m}));var a=n("./setToPixelCoordinateSystem.js"),r=n("./internal/now.js"),o=n("./internal/getFillStyle.js"),i=n("./rendering/initializeRenderCanvas.js"),l=n("./rendering/saveLastRendered.js"),u=n("./rendering/doesImageNeedToBeRendered.js"),d=n("./internal/storedPixelDataToCanvasImageDataColorLUT.js"),s=n("./colors/index.js"),c=n("./internal/getDisplayedArea.js");function f(e,t,n){e.renderingTools.renderCanvas||(e.renderingTools.renderCanvas=document.createElement("canvas"));var a=e.renderingTools.renderCanvas,o=e.viewport.colormap||e.options.colormap;if(e.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),o&&"string"==typeof o&&(o=s.default.getColormap(o)),!o)throw new Error("renderLabelMapImage: colormap not found.");var l=o.getId();if(!1===Object(u.default)(e,t)&&!0!==n&&e.renderingTools.colormapId===l)return a;a.width===t.width&&a.height===t.height||Object(i.default)(e,t);var c=Object(r.default)();e.renderingTools.colorLut&&!n&&e.renderingTools.colormapId===l||(e.renderingTools.colorLut=o.createLookupTable(),e.renderingTools.colormapId=l),t.stats=t.stats||{},t.stats.lastLutGenerateTime=Object(r.default)()-c;var f=e.renderingTools.colorLut,v=e.renderingTools.renderCanvasData,m=e.renderingTools.renderCanvasContext;return Object(d.default)(t,f,v.data),c=Object(r.default)(),m.putImageData(v,0,0),t.stats.lastPutImageDataTime=Object(r.default)()-c,a}function v(e,t){if(void 0===e)throw new Error("renderLabelMapImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("renderLabelMapImage: image must be loaded before it can be drawn");var r=e.canvas.getContext("2d",{desynchronized:!0});r.setTransform(1,0,0,1,0,0),r.fillStyle=Object(o.default)(e),r.fillRect(0,0,e.canvas.width,e.canvas.height),r.imageSmoothingEnabled=!e.viewport.pixelReplication,r.mozImageSmoothingEnabled=r.imageSmoothingEnabled,Object(a.default)(e,r);var i=f(e,n,t),u=Object(c.default)(e.image,e.viewport),d=u.tlhc.x-1,s=u.tlhc.y-1,v=u.brhc.x-d,m=u.brhc.y-s;r.drawImage(i,d,s,v,m,d,s,v,m),e.renderingTools=Object(l.default)(e)}function m(e,t){if(void 0===e)throw new Error("addLabelMapLayer: layer parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("addLabelMapLayer: image must be loaded before it can be drawn");e.canvas=f(e,n,t);var a=e.canvas.getContext("2d",{desynchronized:!0});a.imageSmoothingEnabled=!e.viewport.pixelReplication,a.mozImageSmoothingEnabled=a.imageSmoothingEnabled,e.renderingTools=Object(l.default)(e)}},"./rendering/renderPseudoColorImage.js":function(e,t,n){"use strict";n.r(t),n.d(t,"renderPseudoColorImage",(function(){return m})),n.d(t,"addPseudoColorLayer",(function(){return g}));var a=n("./setToPixelCoordinateSystem.js"),r=n("./internal/now.js"),o=n("./internal/getFillStyle.js"),i=n("./rendering/initializeRenderCanvas.js"),l=n("./rendering/getLut.js"),u=n("./rendering/saveLastRendered.js"),d=n("./rendering/doesImageNeedToBeRendered.js"),s=n("./internal/storedPixelDataToCanvasImageDataPseudocolorLUT.js"),c=n("./colors/index.js"),f=n("./internal/getDisplayedArea.js");function v(e,t,n){e.renderingTools.renderCanvas||(e.renderingTools.renderCanvas=document.createElement("canvas"));var a=e.renderingTools.renderCanvas,o=e.viewport.colormap||e.options.colormap;if(e.options&&e.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),o&&"string"==typeof o&&(o=c.default.getColormap(o)),!o)throw new Error("renderPseudoColorImage: colormap not found.");var u=o.getId();if(!1===Object(d.default)(e,t)&&!0!==n&&e.renderingTools.colormapId===u)return a;a.width===t.width&&a.height===t.height||Object(i.default)(e,t);var f=Object(r.default)();e.renderingTools.colorLut&&!n&&e.renderingTools.colormapId===u||(o.setNumberOfColors(256),e.renderingTools.colorLut=o.createLookupTable(),e.renderingTools.colormapId=u);var v=Object(l.default)(t,e.viewport,n);t.stats=t.stats||{},t.stats.lastLutGenerateTime=Object(r.default)()-f;var m=e.renderingTools.colorLut,g=e.renderingTools.renderCanvasData,h=e.renderingTools.renderCanvasContext;return Object(s.default)(t,v,m,g.data),f=Object(r.default)(),h.putImageData(g,0,0),t.stats.lastPutImageDataTime=Object(r.default)()-f,a}function m(e,t){if(void 0===e)throw new Error("drawImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("drawImage: image must be loaded before it can be drawn");var r=e.canvas.getContext("2d",{desynchronized:!0});r.setTransform(1,0,0,1,0,0),r.fillStyle=Object(o.default)(e),r.fillRect(0,0,e.canvas.width,e.canvas.height),r.imageSmoothingEnabled=!e.viewport.pixelReplication,r.mozImageSmoothingEnabled=r.imageSmoothingEnabled,Object(a.default)(e,r);var i=v(e,n,t),l=Object(f.default)(e.image,e.viewport),d=l.tlhc.x-1,s=l.tlhc.y-1,c=l.brhc.x-d,m=l.brhc.y-s;r.drawImage(i,d,s,c,m,d,s,c,m),e.renderingTools=Object(u.default)(e)}function g(e,t){if(void 0===e)throw new Error("addPseudoColorLayer: layer parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("addPseudoColorLayer: image must be loaded before it can be drawn");e.canvas=v(e,n,t);var a=e.canvas.getContext("2d",{desynchronized:!0});a.imageSmoothingEnabled=!e.viewport.pixelReplication,a.mozImageSmoothingEnabled=a.imageSmoothingEnabled,e.renderingTools=Object(u.default)(e)}},"./rendering/renderToCanvas.js":function(e,t,n){"use strict";n.r(t);var a=n("./triggerEvent.js"),r=n("./events.js"),o=n("./internal/drawImageSync.js"),i=n("./internal/getDefaultViewport.js"),l=n("./internal/tryEnableWebgl.js");function u(e,t,n,a){return{element:e,canvas:e,image:t,invalid:!0,needsRedraw:!0,options:n,layers:[],data:{},renderingTools:{},viewport:a}}t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(void 0===e)throw new Error("renderToCanvas: parameter canvas cannot be undefined");d&&d.renderer&&"webgl"===d.renderer.toLowerCase()&&Object(l.default)(d);var s=Object(i.default)(e,t);n&&Object.assign(s,n);var c=u(e,t,d,s),f={enabledElement:c,timestamp:Date.now()};Object(a.default)(c.element,r.default.PRE_RENDER,f),Object(o.default)(c,c.invalid)}},"./rendering/renderWebImage.js":function(e,t,n){"use strict";n.r(t),n.d(t,"renderWebImage",(function(){return i}));var a=n("./setToPixelCoordinateSystem.js"),r=n("./rendering/renderColorImage.js"),o=n("./internal/getDisplayedArea.js");function i(e,t){if(void 0===e)throw new Error("renderWebImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("renderWebImage: image must be loaded before it can be drawn");if(e.viewport.voi.windowWidth===e.image.windowWidth&&e.viewport.voi.windowCenter===e.image.windowCenter&&!1===e.viewport.invert){var i=e.canvas.getContext("2d",{desynchronized:!0});i.setTransform(1,0,0,1,0,0),i.fillStyle="black",i.fillRect(0,0,e.canvas.width,e.canvas.height),i.imageSmoothingEnabled=!e.viewport.pixelReplication,i.mozImageSmoothingEnabled=i.imageSmoothingEnabled,Object(a.default)(e,i);var l=Object(o.default)(e.image,e.viewport),u=l.tlhc.x-1,d=l.tlhc.y-1,s=l.brhc.x-u,c=l.brhc.y-d;i.drawImage(n.getImage(),u,d,s,c,u,d,s,c)}else Object(r.renderColorImage)(e,t)}},"./rendering/saveLastRendered.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){var t=e.image.imageId,n=e.viewport,a=e.image.color;return e.renderingTools.lastRenderedImageId=t,e.renderingTools.lastRenderedIsColor=a,e.renderingTools.lastRenderedViewport={windowCenter:n.voi.windowCenter,windowWidth:n.voi.windowWidth,invert:n.invert,rotation:n.rotation,hflip:n.hflip,vflip:n.vflip,modalityLUT:n.modalityLUT,voiLUT:n.voiLUT,colormap:n.colormap},e.renderingTools}},"./requestPool/RequestPoolManager.ts":function(e,t,n){"use strict";function a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,o=function(){};return{s:o,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,l=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){u=!0,i=e},f:function(){try{l||null==n.return||n.return()}finally{if(u)throw i}}}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function o(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.r(t),n.d(t,"RequestPoolManager",(function(){return l}));var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i(this,"requestPool",void 0),i(this,"awake",void 0),i(this,"numRequests",void 0),i(this,"maxNumRequests",void 0),i(this,"grabDelay",void 0),i(this,"timeoutHandle",void 0),this.requestPool={interaction:{0:[]},thumbnail:{0:[]},prefetch:{0:[]}},this.awake=!1,this.grabDelay=5,this.numRequests={interaction:0,thumbnail:0,prefetch:0},this.maxNumRequests={interaction:6,thumbnail:6,prefetch:5}}var t,n,r;return t=e,(n=[{key:"destroy",value:function(){this.timeoutHandle&&window.clearTimeout(this.timeoutHandle)}},{key:"addRequest",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o={requestFn:e,type:t,additionalDetails:n};void 0===this.requestPool[t][a]&&(this.requestPool[t][a]=[]),r?this.requestPool[t][a].unshift(o):this.requestPool[t][a].push(o),this.awake||(this.awake=!0,this.startGrabbing())}},{key:"filterRequests",value:function(e){var t=this;Object.keys(this.requestPool).forEach((function(n){var a=t.requestPool[n];Object.keys(a).forEach((function(t){a[t]=a[t].filter((function(t){return e(t)}))}))}))}},{key:"clearRequestStack",value:function(e){if(!this.requestPool[e])throw new Error("No category for the type ".concat(e," found"));this.requestPool[e]={0:[]}}},{key:"sendRequest",value:function(e){var t=this,n=e.requestFn,a=e.type;this.numRequests[a]++,this.awake=!0,n().finally((function(){t.numRequests[a]--,t.startAgain()}))}},{key:"startGrabbing",value:function(){for(var e=this.maxNumRequests.interaction+this.maxNumRequests.thumbnail+this.maxNumRequests.prefetch-(this.numRequests.interaction+this.numRequests.thumbnail+this.numRequests.prefetch),t=0;t<e;t++){var n=this.getNextRequest();if(!1===n)break;n&&this.sendRequest(n)}}},{key:"startAgain",value:function(){var e=this;this.awake&&(this.grabDelay?this.timeoutHandle=window.setTimeout((function(){e.startGrabbing()}),this.grabDelay):this.startGrabbing())}},{key:"getSortedPriorityGroups",value:function(e){var t=this;return Object.keys(this.requestPool[e]).map(Number).filter((function(n){return t.requestPool[e][n].length})).sort()}},{key:"getNextRequest",value:function(){var e,t=this.getSortedPriorityGroups("interaction"),n=a(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(this.requestPool.interaction[r].length&&this.numRequests.interaction<this.maxNumRequests.interaction)return this.requestPool.interaction[r].shift()}}catch(e){n.e(e)}finally{n.f()}var o,i=this.getSortedPriorityGroups("thumbnail"),l=a(i);try{for(l.s();!(o=l.n()).done;){var u=o.value;if(this.requestPool.thumbnail[u].length&&this.numRequests.thumbnail<this.maxNumRequests.thumbnail)return this.requestPool.thumbnail[u].shift()}}catch(e){l.e(e)}finally{l.f()}var d,s=this.getSortedPriorityGroups("prefetch"),c=a(s);try{for(c.s();!(d=c.n()).done;){var f=d.value;if(this.requestPool.prefetch[f].length&&this.numRequests.prefetch<this.maxNumRequests.prefetch)return this.requestPool.prefetch[f].shift()}}catch(e){c.e(e)}finally{c.f()}return t.length||i.length||s.length||(this.awake=!1),!1}},{key:"getRequestPool",value:function(){return this.requestPool}}])&&o(t.prototype,n),r&&o(t,r),e}()},"./requestPool/imageLoadPoolManager.ts":function(e,t,n){"use strict";n.r(t);var a=new(n("./requestPool/RequestPoolManager.ts").RequestPoolManager);a.maxNumRequests={interaction:1e3,thumbnail:1e3,prefetch:1e3},a.grabDelay=0,t.default=a},"./requestPool/imageRetrievalPoolManager.ts":function(e,t,n){"use strict";n.r(t);var a=new(n("./requestPool/RequestPoolManager.ts").RequestPoolManager);a.maxNumRequests={interaction:20,thumbnail:20,prefetch:20},a.grabDelay=0,t.default=a},"./reset.js":function(e,t,n){"use strict";n.r(t);var a=n("./internal/getDefaultViewport.js"),r=n("./enabledElements.js"),o=n("./updateImage.js");t.default=function(e){var t=Object(r.getEnabledElement)(e);t.viewport=Object(a.default)(t.canvas,t.image),Object(o.default)(e)}},"./resize.js":function(e,t,n){"use strict";n.r(t);var a=n("./enabledElements.js"),r=n("./fitToWindow.js"),o=n("./updateImage.js"),i=n("./triggerEvent.js"),l=n("./internal/getImageSize.js"),u=n("./events.js");t.default=function(e,t){var n=Object(a.getEnabledElement)(e),d=n.canvas.width,s=n.canvas.height;!function(e,t){t.width!==e.clientWidth&&(t.width=e.clientWidth,t.style.width="".concat(e.clientWidth,"px")),t.height!==e.clientHeight&&(t.height=e.clientHeight,t.style.height="".concat(e.clientHeight,"px"))}(e,n.canvas);var c={element:e};Object(i.default)(e,u.default.ELEMENT_RESIZED,c),void 0!==n.image&&(t||function(e,t,n){var a=e.viewport.scale,r=Object(l.default)(e.image,e.viewport.rotation),o=Math.round(r.width*a),i=Math.round(r.height*a),u=e.viewport.translation.x,d=e.viewport.translation.y;return o===t&&i<=n||o<=t&&i===n&&0===u&&0===d}(n,d,s)?Object(r.default)(e):(function(e,t,n){var a=e.viewport.scale,r=e.canvas.width/t,o=e.canvas.height/n,i=Math.sqrt(r*o);e.viewport.scale=i*a}(n,d,s),Object(o.default)(e)))}},"./setToPixelCoordinateSystem.js":function(e,t,n){"use strict";n.r(t);var a=n("./internal/calculateTransform.js");t.default=function(e,t,n){if(void 0===e)throw new Error("setToPixelCoordinateSystem: parameter enabledElement must not be undefined");if(void 0===t)throw new Error("setToPixelCoordinateSystem: parameter context must not be undefined");var r=Object(a.default)(e,n);t.setTransform(r.m[0],r.m[1],r.m[2],r.m[3],r.m[4],r.m[5])}},"./setViewport.js":function(e,t,n){"use strict";n.r(t);var a=n("./internal/getDefaultViewport.js"),r=n("./enabledElements.js"),o=n("./updateImage.js");t.default=function(e,t){var n=Object(r.getEnabledElement)(e);if(void 0===n.viewport&&(n.viewport=Object(a.default)(n.canvas)),t)for(var i in t)null!==t[i]&&(n.viewport[i]=t[i]);n.viewport.voi.windowWidth&&(n.viewport.voi.windowWidth=Math.max(n.viewport.voi.windowWidth,1e-6)),n.viewport.scale&&(n.viewport.scale=Math.max(n.viewport.scale,1e-4)),n.viewport.rotation%=360,n.viewport.rotation<0&&(n.viewport.rotation+=360),n.image&&Object(o.default)(e)}},"./triggerEvent.js":function(e,t,n){"use strict";function a(e,t){var n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return"function"==typeof window.CustomEvent?n=new CustomEvent(t,{detail:a,cancelable:!0}):(n=document.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,a),e.dispatchEvent(n)}n.r(t),n.d(t,"default",(function(){return a}))},"./updateImage.js":function(e,t,n){"use strict";n.r(t);var a=n("./enabledElements.js"),r=n("./internal/drawImage.js");t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Object(a.getEnabledElement)(e);Object(r.default)(n,t)}},"./webgl/createProgramFromString.js":function(e,t,n){"use strict";function a(e,t,n){var a=e.createShader(n);if(e.shaderSource(a,t),e.compileShader(a),!e.getShaderParameter(a,e.COMPILE_STATUS)&&!e.isContextLost()){var r=e.getShaderInfoLog(a);console.error("Could not compile shader:\n".concat(r))}return a}n.r(t),t.default=function(e,t,n){return function(e,t,n){var a=e.createProgram();if(e.attachShader(a,t),e.attachShader(a,n),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS)&&!e.isContextLost()){var r=e.getProgramInfoLog(a);console.error("WebGL program filed to link:\n".concat(r))}return a}(e,a(e,t,e.VERTEX_SHADER),a(e,n,e.FRAGMENT_SHADER))}},"./webgl/index.js":function(e,t,n){"use strict";n.r(t);var a=n("./webgl/renderer.js"),r=n("./webgl/createProgramFromString.js"),o=n("./webgl/textureCache.js"),i={createProgramFromString:r.default,renderer:{render:a.render,initRenderer:a.initRenderer,getRenderCanvas:a.getRenderCanvas,isWebGLAvailable:a.isWebGLAvailable},textureCache:o.default};Object.defineProperty(i,"isWebGLInitialized",{enumerable:!0,configurable:!1,get:function(){return a.isWebGLInitialized}}),t.default=i},"./webgl/renderer.js":function(e,t,n){"use strict";n.r(t),n.d(t,"isWebGLInitialized",(function(){return c})),n.d(t,"getRenderCanvas",(function(){return f})),n.d(t,"initRenderer",(function(){return v})),n.d(t,"render",(function(){return y})),n.d(t,"isWebGLAvailable",(function(){return b}));var a,r,o,i=n("./webgl/shaders/index.js"),l=n("./webgl/vertexShader.js"),u=n("./webgl/textureCache.js"),d=n("./webgl/createProgramFromString.js"),s=document.createElement("canvas"),c=!1;function f(){return s}function v(){!0!==c&&function(e){a=null;try{var t={desynchronized:!0,preserveDrawingBuffer:!0};a=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),e.removeEventListener("webglcontextlost",m,!1),e.addEventListener("webglcontextlost",m,!1),e.removeEventListener("webglcontextrestored",g,!1),e.addEventListener("webglcontextrestored",g,!1)}catch(e){throw new Error("Error creating WebGL context")}return a||(console.error("Unable to initialize WebGL. Your browser may not support it."),a=null),a}(s)&&(o=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,o),a.bufferData(a.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,0,0]),a.STATIC_DRAW),r=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,r),a.bufferData(a.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,0,0]),a.STATIC_DRAW),function(){for(var e in i.shaders){var t=i.shaders[e];t.attributes={},t.uniforms={},t.vert=l.vertexShader,t.program=Object(d.default)(a,t.vert,t.frag),t.attributes.texCoordLocation=a.getAttribLocation(t.program,"a_texCoord"),a.enableVertexAttribArray(t.attributes.texCoordLocation),t.attributes.positionLocation=a.getAttribLocation(t.program,"a_position"),a.enableVertexAttribArray(t.attributes.positionLocation),t.uniforms.resolutionLocation=a.getUniformLocation(t.program,"u_resolution")}}(),c=!0)}function m(e){e.preventDefault(),console.warn("WebGL Context Lost!")}function g(e){e.preventDefault(),c=!1,u.default.purgeCache(),v()}function h(e){if(e.color)return"rgb";var t=e.getPixelData();return t instanceof Int16Array?"int16":t instanceof Uint16Array?"uint16":t instanceof Int8Array?"int8":"uint8"}function p(e){var t=u.default.getImageTexture(e.imageId);return t||(t=function(e){var t={uint8:a.LUMINANCE,int8:a.LUMINANCE_ALPHA,uint16:a.LUMINANCE_ALPHA,int16:a.RGB,rgb:a.RGB},n=h(e),r=t[n],o=a.createTexture();a.bindTexture(a.TEXTURE_2D,o),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.pixelStorei(a.UNPACK_ALIGNMENT,1);var l=i.dataUtilities[n].storedPixelDataToImageData(e,e.width,e.height);return a.texImage2D(a.TEXTURE_2D,0,r,e.width,e.height,0,r,a.UNSIGNED_BYTE,l),{texture:o,sizeInBytes:e.width*e.height*{int8:1,uint16:2,int16:3,rgb:3}[n]}}(e),u.default.putImageTexture(e,t)),t.texture}function E(e,t,n,i,l){for(var u in a.clearColor(1,0,0,1),a.viewport(0,0,i,l),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),a.useProgram(e.program),a.bindBuffer(a.ARRAY_BUFFER,r),a.vertexAttribPointer(e.attributes.texCoordLocation,2,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,o),a.vertexAttribPointer(e.attributes.positionLocation,2,a.FLOAT,!1,0,0),t){var d=a.getUniformLocation(e.program,u);if(d){var s=t[u],c=s.type,f=s.value;"i"===c?a.uniform1i(d,f):"f"===c?a.uniform1f(d,f):"2f"===c&&a.uniform2f(d,f[0],f[1])}}!function(e,t,n){e.bufferData(e.ARRAY_BUFFER,new Float32Array([t,n,0,n,t,0,0,0]),e.STATIC_DRAW)}(a,i,l),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,n),a.drawArrays(a.TRIANGLE_STRIP,0,4)}function y(e){var t=e.image;s.width=t.width,s.height=t.height;var n=e.viewport,a=function(e){var t=h(e);return i.shaders.hasOwnProperty(t)?i.shaders[t]:i.shaders.rgb}(t),r=p(t);return E(a,{u_resolution:{type:"2f",value:[t.width,t.height]},wc:{type:"f",value:n.voi.windowCenter},ww:{type:"f",value:n.voi.windowWidth},slope:{type:"f",value:t.slope},intercept:{type:"f",value:t.intercept},minPixelValue:{type:"f",value:t.minPixelValue},invert:{type:"i",value:n.invert?1:0}},r,t.width,t.height),s}function b(){var e={failIfMajorPerformanceCaveat:!0};try{var t=document.createElement("canvas");return Boolean(window.WebGLRenderingContext)&&(t.getContext("webgl",e)||t.getContext("experimental-webgl",e))}catch(e){return!1}}},"./webgl/shaders/index.js":function(e,t,n){"use strict";n.r(t),n.d(t,"shaders",(function(){return u})),n.d(t,"dataUtilities",(function(){return d}));var a=n("./webgl/shaders/int16.js"),r=n("./webgl/shaders/int8.js"),o=n("./webgl/shaders/rgb.js"),i=n("./webgl/shaders/uint16.js"),l=n("./webgl/shaders/uint8.js"),u={int16:a.int16Shader,int8:r.int8Shader,rgb:o.rgbShader,uint16:i.uint16Shader,uint8:l.uint8Shader},d={int16:a.int16DataUtilities,int8:r.int8DataUtilities,rgb:o.rgbDataUtilities,uint16:i.uint16DataUtilities,uint8:l.uint8DataUtilities}},"./webgl/shaders/int16.js":function(e,t,n){"use strict";n.r(t),n.d(t,"int16DataUtilities",(function(){return r})),n.d(t,"int16Shader",(function(){return a}));var a={},r={storedPixelDataToImageData:function(e){for(var t=e.getPixelData(),n=new Uint8Array(e.width*e.height*3),a=0,r=0;r<t.length;r++){var o=Math.abs(t[r]);n[a++]=255&o,n[a++]=o>>8,n[a++]=t[r]<0?0:1}return n}};a.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0 + color.g*65536.0;if (color.b == 0.0)intensity = -intensity;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}"},"./webgl/shaders/int8.js":function(e,t,n){"use strict";n.r(t),n.d(t,"int8DataUtilities",(function(){return r})),n.d(t,"int8Shader",(function(){return a}));var a={},r={storedPixelDataToImageData:function(e){for(var t=e.getPixelData(),n=new Uint8Array(e.width*e.height*2),a=0,r=0;r<t.length;r++)n[a++]=t[r],n[a++]=t[r]<0?0:1;return n}};a.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.;if (color.a == 0.0)intensity = -intensity;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}"},"./webgl/shaders/rgb.js":function(e,t,n){"use strict";n.r(t),n.d(t,"rgbDataUtilities",(function(){return r})),n.d(t,"rgbShader",(function(){return a}));var a={},r={storedPixelDataToImageData:function(e){var t=e.minPixelValue,n=0,a=0,r=e.width*e.height*4,o=e.width*e.height*3,i=e.getPixelData(),l=new Uint8Array(o);if(t<0)for(;a<r;)l[n++]=i[a++]+-t,l[n++]=i[a++]+-t,l[n++]=i[a++]+-t,a+=1;else for(;a<r;)l[n++]=i[a++],l[n++]=i[a++],l[n++]=i[a++],a+=1;return l}};a.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform float minPixelValue;uniform int invert;varying vec2 v_texCoord;void main() {vec3 color = texture2D(u_image, v_texCoord).xyz;color = color * 256.0 * slope + intercept;float center0 = wc - 0.5 - minPixelValue;float width0 = max(ww, 1.0);color = (color - center0) / width0 + 0.5;gl_FragColor = vec4(color, 1);if (invert == 1)gl_FragColor.rgb = 1. - gl_FragColor.rgb;}"},"./webgl/shaders/uint16.js":function(e,t,n){"use strict";n.r(t),n.d(t,"uint16DataUtilities",(function(){return r})),n.d(t,"uint16Shader",(function(){return a}));var a={},r={storedPixelDataToImageData:function(e){for(var t=e.getPixelData(),n=new Uint8Array(e.width*e.height*2),a=0,r=0;r<t.length;r++){var o=t[r];n[a++]=255&o,n[a++]=o>>8}return n}};a.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0 + color.a*65536.0;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}"},"./webgl/shaders/uint8.js":function(e,t,n){"use strict";n.r(t),n.d(t,"uint8DataUtilities",(function(){return r})),n.d(t,"uint8Shader",(function(){return a}));var a={},r={storedPixelDataToImageData:function(e){return e.getPixelData()}};a.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}"},"./webgl/textureCache.js":function(e,t,n){"use strict";n.r(t);var a=n("./events.js"),r=n("./triggerEvent.js"),o={},i=[],l=268435456,u=0;function d(){if(!(u<=l)){for(i.sort((function(e,t){return e.timeStamp>t.timeStamp?-1:e.timeStamp<t.timeStamp?1:0}));u>l;){var e=i[i.length-1];u-=e.sizeInBytes,delete o[e.imageId],i.pop(),Object(r.default)(a.events,a.default.WEBGL_TEXTURE_REMOVED,{imageId:e.imageId})}var t={maximumSizeInBytes:l,cacheSizeInBytes:u,numberOfImagesCached:i.length};Object(r.default)(a.events,a.default.WEBGL_TEXTURE_CACHE_FULL,t)}}t.default={purgeCache:function(){for(;i.length>0;){var e=i.pop();delete o[e.imageId]}u=0},getImageTexture:function(e){if(void 0===e)throw new Error("getImageTexture: imageId must not be undefined");var t=o[e];if(void 0!==t)return t.timeStamp=new Date,t.imageTexture},putImageTexture:function(e,t){var n=e.imageId;if(void 0===e)throw new Error("putImageTexture: image must not be undefined");if(void 0===n)throw new Error("putImageTexture: imageId must not be undefined");if(void 0===t)throw new Error("putImageTexture: imageTexture must not be undefined");if(!0===Object.prototype.hasOwnProperty.call(o,n))throw new Error("putImageTexture: imageId already in cache");var a={imageId:n,imageTexture:t,timeStamp:new Date,sizeInBytes:t.sizeInBytes};if(o[n]=a,i.push(a),void 0===t.sizeInBytes)throw new Error("putImageTexture: imageTexture.sizeInBytes must not be undefined");if(void 0===t.sizeInBytes.toFixed)throw new Error("putImageTexture: imageTexture.sizeInBytes is not a number");u+=a.sizeInBytes,d()},removeImageTexture:function(e){if(void 0===e)throw new Error("removeImageTexture: imageId must not be undefined");var t=o[e];if(void 0===t)throw new Error("removeImageTexture: imageId must not be undefined");return i.splice(i.indexOf(t),1),u-=t.sizeInBytes,delete o[e],t.imageTexture},setMaximumSizeBytes:function(e){if(void 0===e)throw new Error("setMaximumSizeBytes: parameter numBytes must not be undefined");if(void 0===e.toFixed)throw new Error("setMaximumSizeBytes: parameter numBytes must be a number");l=e,d()}}},"./webgl/vertexShader.js":function(e,t,n){"use strict";n.r(t),n.d(t,"vertexShader",(function(){return a}));var a="attribute vec2 a_position;attribute vec2 a_texCoord;uniform vec2 u_resolution;varying vec2 v_texCoord;void main() {vec2 zeroToOne = a_position / u_resolution;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;}"}})},e.exports=a()},function(e,t){e.exports=window.PropTypes},function(e,t,n){var a;!function(){"use strict";var n={}.hasOwnProperty;function r(){for(var e=[],t=0;t<arguments.length;t++){var a=arguments[t];if(a){var o=typeof a;if("string"===o||"number"===o)e.push(a);else if(Array.isArray(a)){if(a.length){var i=r.apply(null,a);i&&e.push(i)}}else if("object"===o)if(a.toString===Object.prototype.toString)for(var l in a)n.call(a,l)&&a[l]&&e.push(l);else e.push(a.toString())}}return e.join(" ")}e.exports?(r.default=r,e.exports=r):void 0===(a=function(){return r}.apply(t,[]))||(e.exports=a)}()},function(e,t,n){window,e.exports=function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=function(e){return e&&e.__esModule?e:{default:e}}(n(2)),o=n(1),i=function(){function e(t,n,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t||0,this.y=n||0,this.z=a||0}return a(e,[{key:"set",value:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,a=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*a,this.y=r[1]*t+r[4]*n+r[7]*a,this.z=r[2]*t+r[5]*n+r[8]*a,this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,a=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*a+r[12],this.y=r[1]*t+r[5]*n+r[9]*a+r[13],this.z=r[2]*t+r[6]*n+r[10]*a+r[14],this}},{key:"applyProjection",value:function(e){var t=this.x,n=this.y,a=this.z,r=e.elements,o=1/(r[3]*t+r[7]*n+r[11]*a+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*a+r[12])*o,this.y=(r[1]*t+r[5]*n+r[9]*a+r[13])*o,this.z=(r[2]*t+r[6]*n+r[10]*a+r[14])*o,this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,a=this.z,r=e.x,o=e.y,i=e.z,l=e.w,u=l*t+o*a-i*n,d=l*n+i*t-r*a,s=l*a+r*n-o*t,c=-r*t-o*n-i*a;return this.x=u*l+c*-r+d*-i-s*-o,this.y=d*l+c*-o+s*-r-u*-i,this.z=s*l+c*-i+u*-o-d*-r,this}},{key:"transformDirection",value:function(e){var t=this.x,n=this.y,a=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*a,this.y=r[1]*t+r[5]*n+r[9]*a,this.z=r[2]*t+r[6]*n+r[10]*a,this.normalize(),this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this}},{key:"min",value:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this}},{key:"max",value:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this}},{key:"clamp",value:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.multiplyScalar(-1)}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"cross",value:function(e,t){if(void 0!==t)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var n=this.x,a=this.y,r=this.z;return this.x=a*e.z-r*e.y,this.y=r*e.x-n*e.z,this.z=n*e.y-a*e.x,this}},{key:"crossVectors",value:function(e,t){var n=e.x,a=e.y,r=e.z,o=t.x,i=t.y,l=t.z;return this.x=a*l-r*i,this.y=r*o-n*l,this.z=n*i-a*o,this}},{key:"angleTo",value:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos((0,o.clamp)(t,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,a=this.z-e.z;return t*t+n*n+a*a}},{key:"setFromMatrixPosition",value:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),n=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),a=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=n,this.z=a,this}},{key:"setFromMatrixColumn",value:function(e,t){var n=4*e,a=t.elements;return this.x=a[n],this.y=a[n+1],this.z=a[n+2],this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}},{key:"clone",value:function(){return new e(this.x,this.y,this.z)}}]),e}();i.prototype.projectOnVector=function(){var e=void 0,t=void 0;return function(n){return void 0===e&&(e=new i),e.copy(n).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),i.prototype.projectOnPlane=function(){var e=void 0;return function(t){return void 0===e&&(e=new i),e.copy(this).projectOnVector(t),this.sub(e)}}(),i.prototype.reflect=function(){var e=void 0;return function(t){return void 0===e&&(e=new i),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),i.prototype.clampScalar=function(){var e=void 0,t=void 0;return function(n,a){return void 0===e&&(e=new i,t=new i),e.set(n,n,n),t.set(a,a,a),this.clamp(e,t)}}(),i.prototype.applyAxisAngle=function(){var e=void 0;return function(t,n){return void 0===e&&(e=new r.default),this.applyQuaternion(e.setFromAxisAngle(t.normalize(),n)),this}}(),t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clamp=function(e,t,n){return e<t?t:e>n?n:e},t.degToRad=function(e){return e*(Math.PI/180)},t.approximatelyEquals=function(e,t,n){var a=n||1e-4;return Math.abs(e-t)<=a*Math.max(1,Math.abs(e),Math.abs(t))},t.radToDeg=function(e){return e*(180/Math.PI)},t.sign=function(e){return"number"==typeof e?e?e<0?-1:1:e==e?0:NaN:NaN}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=function(){function e(t,n,a,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t||0,this.y=n||0,this.z=a||0,this.w=void 0!==r?r:1}return a(e,[{key:"setFromAxisAngle",value:function(e,t){var n=t/2,a=Math.sin(n);return this.x=e.x*a,this.y=e.y*a,this.z=e.z*a,this.w=Math.cos(n),this}},{key:"multiplyQuaternions",value:function(e,t){var n=e.x,a=e.y,r=e.z,o=e.w,i=t.x,l=t.y,u=t.z,d=t.w;return this.x=n*d+o*i+a*u-r*l,this.y=a*d+o*l+r*i-n*u,this.z=r*d+o*u+n*l-a*i,this.w=o*d-n*i-a*l-r*u,this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,n=t[0],a=t[4],r=t[8],o=t[1],i=t[5],l=t[9],u=t[2],d=t[6],s=t[10],c=n+i+s,f=void 0;return c>0?(f=.5/Math.sqrt(c+1),this.w=.25/f,this.x=(d-l)*f,this.y=(r-u)*f,this.z=(o-a)*f):n>i&&n>s?(f=2*Math.sqrt(1+n-i-s),this.w=(d-l)/f,this.x=.25*f,this.y=(a+o)/f,this.z=(r+u)/f):i>s?(f=2*Math.sqrt(1+i-n-s),this.w=(r-u)/f,this.x=(a+o)/f,this.y=.25*f,this.z=(l+d)/f):(f=2*Math.sqrt(1+s-n-i),this.w=(o-a)/f,this.x=(r+u)/f,this.y=(l+d)/f,this.z=.25*f),this}}]),e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(1);function r(e){return e*e}function o(e,t){return r(e.x-t.x)+r(e.y-t.y)}var i={distanceToPoint:function(e,t){return Math.sqrt(function(e,t){var n=o(e.start,e.end);if(0===n)return o(t,e.start);var a=((t.x-e.start.x)*(e.end.x-e.start.x)+(t.y-e.start.y)*(e.end.y-e.start.y))/n;return o(t,a<0?e.start:a>1?e.end:{x:e.start.x+a*(e.end.x-e.start.x),y:e.start.y+a*(e.end.y-e.start.y)})}(e,t))},intersectLine:function(e,t){var n,r,o,i,l,u,d,s,c,f,v,m={},g=e.start.x,h=e.start.y,p=e.end.x,E=e.end.y,y=t.start.x,b=t.start.y,T=t.end.x,x=t.end.y,w=void 0;if(f=(n=E-h)*T+(o=g-p)*x+(l=p*h-g*E),(0===(c=n*y+o*b+l)||0===f||(0,a.sign)(c)!==(0,a.sign)(f))&&(s=(r=x-b)*p+(i=y-T)*E+(u=T*b-y*x),0===(d=r*g+i*h+u)||0===s||(0,a.sign)(d)!==(0,a.sign)(s))){v=n*i-r*o,w=o*u-i*l;var C=parseFloat(w/v);w=r*l-n*u;var M=parseFloat(w/v);return m.x=C,m.y=M,m}}};t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Vector3=t.rect=t.quaternion=t.point=t.Plane=t.Matrix4=t.sign=t.radToDeg=t.degToRad=t.clamp=t.lineSegment=t.Line3=void 0;var a=f(n(5)),r=f(n(3)),o=n(1),i=f(n(6)),l=f(n(7)),u=f(n(8)),d=f(n(2)),s=f(n(9)),c=f(n(0));function f(e){return e&&e.__esModule?e:{default:e}}var v={Line3:a.default,lineSegment:r.default,clamp:o.clamp,degToRad:o.degToRad,radToDeg:o.radToDeg,sign:o.sign,Matrix4:i.default,Plane:l.default,point:u.default,quaternion:d.default,rect:s.default,Vector3:c.default};t.Line3=a.default,t.lineSegment=r.default,t.clamp=o.clamp,t.degToRad=o.degToRad,t.radToDeg=o.radToDeg,t.sign=o.sign,t.Matrix4=i.default,t.Plane=l.default,t.point=u.default,t.quaternion=d.default,t.rect=s.default,t.Vector3=c.default,t.default=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),o=n(1),i=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.start=void 0!==t?t:new r.default,this.end=void 0!==n?n:new r.default}return a(e,[{key:"set",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:"copy",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:"center",value:function(e){return(e||new r.default).addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(e){return(e||new r.default).subVectors(this.end,this.start)}},{key:"distanceSq",value:function(){return this.start.distanceToSquared(this.end)}},{key:"distance",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(e,t){var n=t||new r.default;return this.delta(n).multiplyScalar(e).add(this.start)}},{key:"closestPointToPointParameter",value:function(e,t){var n=new r.default,a=new r.default;n.subVectors(e,this.start),a.subVectors(this.end,this.start);var i=a.dot(a),l=a.dot(n)/i;return t&&(l=(0,o.clamp)(l,0,1)),l}},{key:"closestPointToPoint",value:function(e,t,n){var a=this.closestPointToPointParameter(e,t),o=n||new r.default;return this.delta(o).multiplyScalar(a).add(this.start)}},{key:"applyMatrix4",value:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}},{key:"equals",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"intersectLine",value:function(e){var t=this.end.clone().sub(this.start),n=e.end.clone().sub(e.start),a=e.start.clone().sub(this.start),r=t.clone().cross(n),i=a.clone().cross(n),l=a.dot(r)/(a.lengthSq()*r.lengthSq());if((0,o.approximatelyEquals)(l,0)){var u=i.dot(r)/r.lengthSq();if(!(u>1||isNaN(u))){var d=this.start.clone().add(t.clone().multiplyScalar(u));return d.clone().sub(e.start).lengthSq()+d.clone().sub(e.end).lengthSq()<=e.distanceSq()?d:void 0}}}}]),e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),o=function(){function e(t,n,a,r,o,i,l,u,d,s,c,f,v,m,g,h){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.elements=new Float32Array(16);var p=this.elements;p[0]=void 0!==t?t:1,p[4]=n||0,p[8]=a||0,p[12]=r||0,p[1]=o||0,p[5]=void 0!==i?i:1,p[9]=l||0,p[13]=u||0,p[2]=d||0,p[6]=s||0,p[10]=void 0!==c?c:1,p[14]=f||0,p[3]=v||0,p[7]=m||0,p[11]=g||0,p[15]=void 0!==h?h:1}return a(e,[{key:"makeRotationFromQuaternion",value:function(e){var t=this.elements,n=e.x,a=e.y,r=e.z,o=e.w,i=n+n,l=a+a,u=r+r,d=n*i,s=n*l,c=n*u,f=a*l,v=a*u,m=r*u,g=o*i,h=o*l,p=o*u;return t[0]=1-(f+m),t[4]=s-p,t[8]=c+h,t[1]=s+p,t[5]=1-(d+m),t[9]=v-g,t[2]=c-h,t[6]=v+g,t[10]=1-(d+f),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,a=t.elements,r=this.elements,o=n[0],i=n[4],l=n[8],u=n[12],d=n[1],s=n[5],c=n[9],f=n[13],v=n[2],m=n[6],g=n[10],h=n[14],p=n[3],E=n[7],y=n[11],b=n[15],T=a[0],x=a[4],w=a[8],C=a[12],M=a[1],S=a[5],O=a[9],I=a[13],_=a[2],P=a[6],L=a[10],D=a[14],j=a[3],A=a[7],R=a[11],k=a[15];return r[0]=o*T+i*M+l*_+u*j,r[4]=o*x+i*S+l*P+u*A,r[8]=o*w+i*O+l*L+u*R,r[12]=o*C+i*I+l*D+u*k,r[1]=d*T+s*M+c*_+f*j,r[5]=d*x+s*S+c*P+f*A,r[9]=d*w+s*O+c*L+f*R,r[13]=d*C+s*I+c*D+f*k,r[2]=v*T+m*M+g*_+h*j,r[6]=v*x+m*S+g*P+h*A,r[10]=v*w+m*O+g*L+h*R,r[14]=v*C+m*I+g*D+h*k,r[3]=p*T+E*M+y*_+b*j,r[7]=p*x+E*S+y*P+b*A,r[11]=p*w+E*O+y*L+b*R,r[15]=p*C+E*I+y*D+b*k,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}},{key:"getInverse",value:function(e,t){var n=this.elements,a=e.elements,r=a[0],o=a[4],i=a[8],l=a[12],u=a[1],d=a[5],s=a[9],c=a[13],f=a[2],v=a[6],m=a[10],g=a[14],h=a[3],p=a[7],E=a[11],y=a[15];n[0]=s*g*p-c*m*p+c*v*E-d*g*E-s*v*y+d*m*y,n[4]=l*m*p-i*g*p-l*v*E+o*g*E+i*v*y-o*m*y,n[8]=i*c*p-l*s*p+l*d*E-o*c*E-i*d*y+o*s*y,n[12]=l*s*v-i*c*v-l*d*m+o*c*m+i*d*g-o*s*g,n[1]=c*m*h-s*g*h-c*f*E+u*g*E+s*f*y-u*m*y,n[5]=i*g*h-l*m*h+l*f*E-r*g*E-i*f*y+r*m*y,n[9]=l*s*h-i*c*h-l*u*E+r*c*E+i*u*y-r*s*y,n[13]=i*c*f-l*s*f+l*u*m-r*c*m-i*u*g+r*s*g,n[2]=d*g*h-c*v*h+c*f*p-u*g*p-d*f*y+u*v*y,n[6]=l*v*h-o*g*h-l*f*p+r*g*p+o*f*y-r*v*y,n[10]=o*c*h-l*d*h+l*u*p-r*c*p-o*u*y+r*d*y,n[14]=l*d*f-o*c*f-l*u*v+r*c*v+o*u*g-r*d*g,n[3]=s*v*h-d*m*h-s*f*p+u*m*p+d*f*E-u*v*E,n[7]=o*m*h-i*v*h+i*f*p-r*m*p-o*f*E+r*v*E,n[11]=i*d*h-o*s*h-i*u*p+r*s*p+o*u*E-r*d*E,n[15]=o*s*f-i*d*f+i*u*v-r*s*v-o*u*m+r*d*m;var b=r*n[0]+u*n[4]+f*n[8]+h*n[12];if(0===b){var T="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(T);return console.warn(T),this.identity(),this}return this.multiplyScalar(1/b),this}},{key:"applyToVector3Array",value:function(){var e=new r.default;return function(t,n,a){void 0===n&&(n=0),void 0===a&&(a=t.length);for(var r=0,o=n;r<a;r+=3,o+=3)e.x=t[o],e.y=t[o+1],e.z=t[o+2],e.applyMatrix4(this),t[o]=e.x,t[o+1]=e.y,t[o+2]=e.z;return t}}},{key:"makeTranslation",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"set",value:function(e,t,n,a,r,o,i,l,u,d,s,c,f,v,m,g){var h=this.elements;return h[0]=e,h[4]=t,h[8]=n,h[12]=a,h[1]=r,h[5]=o,h[9]=i,h[13]=l,h[2]=u,h[6]=d,h[10]=s,h[14]=c,h[3]=f,h[7]=v,h[11]=m,h[15]=g,this}},{key:"makeScale",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}}]),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),o=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.normal=void 0!==t?t:new r.default(1,0,0),this.constant=void 0!==n?n:0}return a(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,n,a){return this.normal.set(e,t,n),this.constant=a,this}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return this.orthoPoint(e,t).sub(e).negate()}},{key:"orthoPoint",value:function(e,t){var n=this.distanceToPoint(e);return(t||new r.default).copy(this.normal).multiplyScalar(n)}},{key:"isIntersectionLine",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}},{key:"intersectPlane",value:function(e){var t=this.normal.clone().cross(e.normal),n={origin:new r.default,direction:t};if(this.normal.clone().cross(e.normal).length<1e-10)return n.direction=new r.default,n;var a=this.constant,o=e.constant,i=this.normal.clone().dot(e.normal),l=-(a-o*i)/(1-i*i),u=-(o-a*i)/(1-i*i);return n.origin=this.normal.clone().multiplyScalar(l).add(e.normal.clone().multiplyScalar(u)),n}},{key:"coplanarPoint",value:function(e){return(e||new r.default).copy(this.normal).multiplyScalar(-this.constant)}},{key:"translate",value:function(e){return this.constant=this.constant-e.dot(this.normal),this}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},{key:"clone",value:function(){return(new e).copy(this)}}]),e}();o.prototype.setFromCoplanarPoints=function(){var e=new r.default,t=new r.default;return function(n,a,r){var o=e.subVectors(r,a).cross(t.subVectors(n,a)).normalize();return this.setFromNormalAndCoplanarPoint(o,n),this}}(),o.prototype.intersectLine=function(){var e=new r.default;return function(t,n){var a=n||new r.default,o=t.delta(e),i=this.normal.dot(o);if(0===i)return 0===this.distanceToPoint(t.start)?a.copy(t.start):void 0;var l=-(t.start.dot(this.normal)+this.constant)/i;return l<0||l>1?void 0:a.copy(o).multiplyScalar(l).add(t.start)}}(),t.default=o},function(e,t,n){"use strict";function a(e,t){return{x:e.x-t.x,y:e.y-t.y}}function r(e,t){return Math.sqrt(o(e,t))}function o(e,t){var n=a(e,t);return n.x*n.x+n.y*n.y}Object.defineProperty(t,"__esModule",{value:!0});var i={subtract:a,copy:function(e){return{x:e.x,y:e.y}},pageToPoint:function(e){return{x:e.pageX,y:e.pageY}},distance:r,distanceSquared:o,insideRect:function(e,t){return!(e.x<t.left||e.x>t.left+t.width||e.y<t.top||e.y>t.top+t.height)},findClosestPoint:function(e,t){var n=[],a=void 0;return e.forEach((function(e,o){var i=r(e,t);n.push(i),a=0===o?i:Math.min(i,a)})),e[n.indexOf(a)]}};t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return e&&e.__esModule?e:{default:e}}(n(3));function r(e){return{topLeft:{x:e.left,y:e.top},bottomRight:{x:e.left+e.width,y:e.top+e.height}}}var o={distanceToPoint:function(e,t){var n=655535;return function(e){return[{start:{x:e.left,y:e.top},end:{x:e.left+e.width,y:e.top}},{start:{x:e.left+e.width,y:e.top},end:{x:e.left+e.width,y:e.top+e.height}},{start:{x:e.left+e.width,y:e.top+e.height},end:{x:e.left,y:e.top+e.height}},{start:{x:e.left,y:e.top+e.height},end:{x:e.left,y:e.top}}]}(e).forEach((function(e){var r=a.default.distanceToPoint(e,t);r<n&&(n=r)})),n},getIntersectionRect:function(e,t){var n={topLeft:{},bottomRight:{}};if(function(e,t){var n,a,o=r(e),i=r(t);return n=e.width>=0?t.width>=0?!(o.bottomRight.x<=i.topLeft.x||i.bottomRight.x<=o.topLeft.x):!(o.bottomRight.x<=i.bottomRight.x||i.topLeft.x<=o.topLeft.x):t.width>=0?!(o.topLeft.x<=i.topLeft.x||i.bottomRight.x<=o.bottomRight.x):!(o.topLeft.x<=i.bottomRight.x||i.topLeft.x<=o.bottomRight.x),a=e.height>=0?t.height>=0?!(o.bottomRight.y<=i.topLeft.y||i.bottomRight.y<=o.topLeft.y):!(o.bottomRight.y<=i.bottomRight.y||i.topLeft.y<=o.topLeft.y):t.height>=0?!(o.topLeft.y<=i.topLeft.y||i.bottomRight.y<=o.bottomRight.y):!(o.topLeft.y<=i.bottomRight.y||i.top<=o.bottomRight.y),n&&a}(e,t)){var a=r(e),o=r(t);return e.width>=0?t.width>=0?(n.topLeft.x=Math.max(a.topLeft.x,o.topLeft.x),n.bottomRight.x=Math.min(a.bottomRight.x,o.bottomRight.x)):(n.topLeft.x=Math.max(a.topLeft.x,o.bottomRight.x),n.bottomRight.x=Math.min(a.bottomRight.x,o.topLeft.x)):t.width>=0?(n.topLeft.x=Math.min(a.topLeft.x,o.bottomRight.x),n.bottomRight.x=Math.max(a.bottomRight.x,o.topLeft.x)):(n.topLeft.x=Math.min(a.topLeft.x,o.topLeft.x),n.bottomRight.x=Math.max(a.bottomRight.x,o.bottomRight.x)),e.height>=0?t.height>=0?(n.topLeft.y=Math.max(a.topLeft.y,o.topLeft.y),n.bottomRight.y=Math.min(a.bottomRight.y,o.bottomRight.y)):(n.topLeft.y=Math.max(a.topLeft.y,o.bottomRight.y),n.bottomRight.y=Math.min(a.bottomRight.y,o.topLeft.y)):t.height>=0?(n.topLeft.y=Math.min(a.topLeft.y,o.bottomRight.y),n.bottomRight.y=Math.max(a.bottomRight.y,o.topLeft.y)):(n.topLeft.y=Math.min(a.topLeft.y,o.topLeft.y),n.bottomRight.y=Math.max(a.bottomRight.y,o.bottomRight.y)),n}}};t.default=o}])},function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),o=n(3),i=n.n(o),l=n(4),u=n.n(l),d=n(2),s=n(0),c=n(5);function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function m(e,t){return(m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function g(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=E(e);if(t){var r=E(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return h(this,n)}}function h(e,t){if(t&&("object"===f(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return p(e)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var b=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&m(e,t)}(i,e);var t,n,a,o=g(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),console.log("constructor"),y(p(t=o.call(this,e)),"onPlayButtonClick",(function(){void 0!==p(t)&&void 0!==t.element&&void 0!==t.state.framerate&&s.playClip(t.element,t.state.framerate)})),y(p(t),"onStopButtonClick",(function(){void 0!==p(t)&&void 0!==t.element&&s.stopClip(t.element)})),y(p(t),"onPreviousFrameButtonClick",(function(){var e=t.element,n=s.getToolState(e,"stack");if(void 0!==n){var a=(n.data[0].currentImageIdIndex-1)%n.data[0].imageIds.length;d.loadImage(n.data[0].imageIds[a]).then((function(t){d.displayImage(e,t)}));var r={currentImageIdIndex:a,imageIds:n.data[0].imageIds};s.clearToolState(e,"stack"),s.addToolState(e,"stack",r)}})),y(p(t),"onNextFrameButtonClick",(function(){var e=t.element,n=s.getToolState(e,"stack");if(void 0!==n){var a=(n.data[0].currentImageIdIndex+1)%n.data[0].imageIds.length;d.loadImage(n.data[0].imageIds[a]).then((function(t){d.displayImage(e,t)}));var r={currentImageIdIndex:a,imageIds:n.data[0].imageIds};s.clearToolState(e,"stack"),s.addToolState(e,"stack",r)}})),y(p(t),"onSliderChange",(function(e){void 0!==p(t)&&void 0!==t.element&&void 0!==s.getToolState(t.element,"stack")&&(t.setState({framerate:e.target.value}),document.getElementById(t.state.framerateSliderId).value=e.target.value,document.getElementById(t.state.framerateDisplayId).innerHTML="Framerate: "+e.target.value,s.playClip(t.element,e.target.value))})),s.external.cornerstone=d,s.external.cornerstoneMath=c,d.registerImageLoader("dicomImageLoader",t.getDicomImage),t.state={dicomName:"",dicomDateTime:"",framerate:0,playButtonId:t.props.id.concat("_playButton"),stopButtonId:t.props.id.concat("_stopButton"),previousFrameButtonId:t.props.id.concat("_previousFrame"),nextFrameButtonId:t.props.id.concat("_nextFrame"),framerateSliderId:t.props.id.concat("_framerateSlider"),framerateDisplayId:t.props.id.concat("_framerateDisplay")},t}return t=i,a=[{key:"getDerivedStateFromProps",value:function(e,t){if(console.log("getDerivedStateFromProps"),console.log("prevState:",t),console.log("nextProps:",e),void 0!==e.imagePixelsList&&e.imagePixelsList.length>0&&e.dicomName!==t.dicomName){console.log("getDerivedStateFromProps doing work.");for(var n=e.imagePixelsList.length,a=new Array,r=new Array,o=0;o<n;o++){var i="dicomImageLoader://".concat(o);a.push(i),i=(i=i.concat("_",e.imageHeight,"-",e.imageWidth)).concat("_",e.imagePixelsList[o]),r.push(i)}return t.imageIDs=a,t.imageIDs_data=r,t.dicomName=e.dicomName,t.dicomDateTime=e.dicomDateTime,t.imageHeight=e.imageHeight,t.imageWidth=e.imageWidth,t.framerate=e.framerate,t}return null}}],(n=[{key:"getDicomImage",value:function(e){var t=function(e,t){var n=e.length;if(0==n)return[];for(var a,r=0,o=[];(a=t.indexOf(e,r))>-1;)o.push(a),r=a+n;return o}("_",e),n=e.substring("dicomImageLoader://".length,t[0]),a=e.substring(t[0]+1,t[1]),r=Number(a.substring(0,a.search("-"))),o=Number(a.substring(a.search("-")+1,a.length)),i=e.substring(t[1]+1,e.length);i=(i=i.split(",")).map(Number);var l={imageId:n,minPixelValue:0,maxPixelValue:255,slope:1,intercept:0,windowCenter:r/2,windowWidth:o,render:d.renderColorImage,getPixelData:function(){return i},rows:r,columns:o,height:r,width:o,color:!0,rgba:!0,columnPixelSpacing:1,rowPixelSpacing:1,invert:!1,sizeInBytes:o*r*4};return{promise:new Promise((function(e){e(l)})),cancelFn:function(){console.log("cancelFn")}}}},{key:"shouldComponentUpdate",value:function(e,t){return console.log("shouldComponentUpdate"),console.log("this.state:",this.state),console.log("nextProps:",e),null==e.dicomName?(console.log("false"),!1):(console.log("true"),!0)}},{key:"render",value:function(){var e=this;return console.log("rendering"),r.a.createElement("div",{style:{width:"100%",height:"100%",backgroundColor:"black"}},r.a.createElement("div",{style:{width:"100%",height:"95%"},className:u()("viewport-wrapper")},r.a.createElement("div",{style:{width:"100%",height:"100%"},className:"viewport-element",onContextMenu:function(e){return e.preventDefault()},onMouseDown:function(e){return e.preventDefault()},ref:function(t){e.element=t}},r.a.createElement("canvas",{className:"cornerstone-canvas"}))),r.a.createElement("div",{className:"playback-controls",style:{width:"100%",height:"5%",verticalAlign:"middle"}},r.a.createElement("p",{style:{width:"10%",height:"100%",margin:"0% 0% 0% 1%",display:"inline-block",verticalAlign:"middle",color:"yellow",textAlign:"left"}},this.state.dicomName),r.a.createElement("button",{id:this.state.playButtonId,onClick:this.onPlayButtonClick,style:{width:"5%",height:"100%",margin:"0% 0% 0% 12%",verticalAlign:"middle"}},"Play"),r.a.createElement("button",{id:this.state.stopButtonId,onClick:this.onStopButtonClick,style:{width:"5%",height:"100%",margin:"0% 0% 0% 1%",verticalAlign:"middle"}},"Stop"),r.a.createElement("button",{id:this.state.previousFrameButtonId,onClick:this.onPreviousFrameButtonClick,style:{width:"12%",height:"100%",margin:"0% 0% 0% 1%",verticalAlign:"middle"}},"Previous Frame"),r.a.createElement("button",{id:this.state.nextFrameButtonId,onClick:this.onNextFrameButtonClick,style:{width:"12%",height:"100%",margin:"0% 0% 0% 1%",verticalAlign:"middle"}},"Next Frame"),r.a.createElement("input",{type:"range",min:"1",max:"120",defaultValue:this.state.framerate,onChange:this.onSliderChange,id:this.state.framerateSliderId,style:{width:"12%",height:"100%",margin:"0% 0% 0% 3%",verticalAlign:"middle"}}),r.a.createElement("p",{id:this.state.framerateDisplayId,style:{width:"13%",height:"100%",margin:"0% 0% 0% 1%",display:"inline-block",verticalAlign:"middle",color:"yellow",textAlign:"center"}},"Framerate: ",this.state.framerate)))}},{key:"componentDidMount",value:function(){console.log("CVP: Mounting.");var e=this.element;if(d.enable(this.element),s.mouseInput.enable(this.element),s.wwwc.activate(this.element,1),s.pan.activate(this.element,2),s.zoom.activate(this.element,4),null==this.state.imageIDs_data)return document.getElementById(this.state.framerateSliderId).disabled=!0,document.getElementById(this.state.framerateDisplayId).innerHTML="Framerate: ",void console.log("CVP initiallized with no video");d.loadImage(this.state.imageIDs_data[0]).then((function(t){d.displayImage(e,t)}));var t={currentImageIdIndex:0,imageIds:this.state.imageIDs_data};s.clearToolState(this.element,"stack"),s.addStackStateManager(this.element,["stack","playClip"]),s.addToolState(this.element,"stack",t),s.playClip(this.element,this.state.framerate),document.getElementById(this.state.framerateDisplayId).innerHTML="Framerate: "+this.state.framerate,document.getElementById(this.state.framerateSliderId).value=this.state.framerate,console.log("CVP: Mounted.")}},{key:"componentDidUpdate",value:function(e,t){if(console.log("componentDidUpdate"),console.log("this.props:",this.props),console.log("prevProps:",e),this.props.dicomName!==e.dicomName&&this.props.imagePixelsList.length>0){console.log("componentDidUpdate doing work."),s.stopClip(this.element),s.clearToolState(this.element,"stack"),s.clearToolState(this.element,"playclip"),1==document.getElementById(this.state.framerateSliderId).disabled&&(document.getElementById(this.state.framerateSliderId).disabled=!1);var n=this.element;d.loadImage(this.state.imageIDs_data[0]).then((function(e){d.displayImage(n,e)}));var a={currentImageIdIndex:0,imageIds:this.state.imageIDs_data};s.addStackStateManager(this.element,["stack","playClip"]),s.addToolState(this.element,"stack",a),s.playClip(this.element,this.state.framerate),document.getElementById(this.state.framerateDisplayId).innerHTML="Framerate: "+this.state.framerate,document.getElementById(this.state.framerateSliderId).value=this.state.framerate}}},{key:"componentWillUnmount",value:function(){console.log("CVP unmounting."),s.stopClip(this.element),s.clearToolState(this.element),d.disable(this.element),console.log("CVP unmounted")}}])&&v(t.prototype,n),a&&v(t,a),Object.defineProperty(t,"prototype",{writable:!1}),i}(a.Component);b.propTypes={id:i.a.string.isRequired,imagePixelsList:i.a.arrayOf(i.a.arrayOf(i.a.number)),dicomName:i.a.string,dicomDateTime:i.a.string,imageHeight:i.a.number,imageWidth:i.a.number,framerate:i.a.number},b.defaultProps={imagePixelsList:void 0,dicomName:void 0,dicomDateTime:void 0,imageHeight:void 0,imageWidth:void 0,framerate:void 0};b.defaultProps,b.propTypes;n.d(t,"cornerstoneVP",(function(){return b}))}]);
//# sourceMappingURL=cvp.min.js.map
//# sourceMappingURL=cvp.min.js.map